import{r as m,j as e,L as H,S as R}from"./app-D6lyKCb0.js";import{A as U,S as V,P as O,T as G,a as J,d as K}from"./app-layout-BJ6RDFjC.js";import{B as p}from"./button-CCPkYfcN.js";import{C as b,a as Q,b as W,c as X}from"./card-DPyw2mDh.js";import{I as o}from"./input-BekdTFNy.js";import{L as n}from"./label-BNivIVyg.js";import{S as P,a as w,b as _,c as M,d as u}from"./select-pSh8MoHv.js";import{t as x}from"./index-C2dM8uf0.js";import"./index-BTiWGghc.js";import"./createLucideIcon-zTYlLHSb.js";import"./index-DTjwdlGq.js";import"./index-PyfYCCz6.js";import"./app-logo-icon-DREUhacY.js";import"./folder-root-DLhWLZqd.js";import"./grip-vertical-Czs-UF6q.js";import"./index-BsLD0GjN.js";import"./index-pfB5R6qP.js";function he({project:t,projectTypes:k}){var S,C;const l=!!(t!=null&&t.id),[h,D]=m.useState((t==null?void 0:t.name)||""),[j,I]=m.useState(((S=t==null?void 0:t.budget)==null?void 0:S.toString())||""),[g,L]=m.useState(((t==null?void 0:t.project_type_id)||"").toString()),[f,T]=m.useState((t==null?void 0:t.description)||""),[N,E]=m.useState((t==null?void 0:t.priority)||"Medium"),[v,y]=m.useState(((C=t==null?void 0:t.milestones)==null?void 0:C.map(s=>({key:Date.now()+s.id,id:s.id,name:s.name,description:s.description||"",due_date:s.due_date,img:null,existingImg:s.img||void 0,preview:s.img?`${s.img}`:void 0})))||[]),$=Object.entries(k).map(([s,a])=>({id:parseInt(s),name:a})),A=()=>{y(s=>[...s,{key:Date.now(),name:"",description:"",due_date:"",img:null}])},B=s=>{y(a=>a.filter(r=>r.key!==s)),x.success("Milestone removed")},c=(s,a,r)=>{y(i=>i.map(d=>d.key===s?{...d,[a]:r}:d))},F=(s,a)=>{if(!a){c(s,"img",null),c(s,"preview",void 0);return}const r=new FileReader;r.onloadend=()=>{c(s,"preview",r.result)},r.readAsDataURL(a),c(s,"img",a)},q=s=>{if(s.preventDefault(),!h.trim()||!j||!g){x.error("Please fill all required project fields");return}const a=new FormData;a.append("name",h),a.append("budget",j),a.append("project_type_id",g),a.append("description",f),a.append("priority",N),l&&a.append("_method","PUT"),v.forEach((i,d)=>{i.name.trim()&&i.due_date&&(i.id&&a.append(`milestones[${d}][id]`,i.id.toString()),a.append(`milestones[${d}][name]`,i.name),a.append(`milestones[${d}][description]`,i.description),a.append(`milestones[${d}][due_date]`,i.due_date),i.img&&a.append(`milestones[${d}][img]`,i.img))});const r=l?`/projects/${t.id}`:"/projects";R.post(r,a,{forceFormData:!0,onSuccess:()=>{x.success(l?"Project updated!":"Project created!")},onError:i=>{console.error(i),x.error("Please fix the errors")}})},z=[{title:"Projects",href:"/projects"},{title:l?"Edit Project":"Create Project",href:"#"}];return e.jsxs(U,{breadcrumbs:z,children:[e.jsx(H,{title:l?"Edit Project":"Create Project"}),e.jsx("div",{className:"p-4 md:p-6 w-full mx-auto",children:e.jsxs(b,{children:[e.jsx(Q,{children:e.jsx(W,{className:"text-2xl",children:l?"Edit Project":"Create New Project"})}),e.jsx(V,{}),e.jsx(X,{className:"pt-6",children:e.jsxs("form",{onSubmit:q,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:["Project Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{value:h,onChange:s=>D(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:["Budget ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{type:"number",value:j,onChange:s=>I(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:["Project Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(P,{value:g,onValueChange:L,children:[e.jsx(w,{children:e.jsx(_,{placeholder:"Select type"})}),e.jsx(M,{children:$.map(s=>e.jsx(u,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Priority"}),e.jsxs(P,{value:N,onValueChange:E,children:[e.jsx(w,{children:e.jsx(_,{})}),e.jsxs(M,{children:[e.jsx(u,{value:"Low",children:"Low"}),e.jsx(u,{value:"Medium",children:"Medium"}),e.jsx(u,{value:"High",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(n,{children:"Description"}),e.jsx(o,{value:f,onChange:s=>T(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Milestones"}),e.jsxs(p,{type:"button",onClick:A,size:"sm",children:[e.jsx(O,{className:"w-4 h-4 mr-2"})," Add Milestone"]})]}),v.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 border-2 border-dashed rounded-lg",children:'No milestones yet. Click "Add Milestone" to start.'}):e.jsx("div",{className:"space-y-6",children:v.map(s=>e.jsx(b,{className:"p-6 border",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5  gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:["Milestone Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{value:s.name,onChange:a=>c(s.key,"name",a.target.value),placeholder:"e.g. Site Survey"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Description"}),e.jsx(o,{value:s.description,onChange:a=>c(s.key,"description",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{type:"date",value:s.due_date,onChange:a=>c(s.key,"due_date",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Proof Image"}),e.jsx(o,{type:"file",accept:"image/*",onChange:a=>{var r;return F(s.key,((r=a.target.files)==null?void 0:r[0])||null)}})]}),e.jsx("div",{className:"space-y-2",children:(s.preview||s.existingImg)&&e.jsx("img",{src:`/${s.existingImg}`,alt:s.name,className:"w-full h-32 object-cover rounded-md"})}),e.jsx("div",{className:"flex items-end",children:e.jsx(p,{type:"button",variant:"destructive",size:"sm",onClick:()=>B(s.key),children:e.jsx(G,{className:"w-4 h-4"})})})]})},s.key))})]}),e.jsxs("div",{className:"flex justify-between pt-8 border-t",children:[e.jsx(p,{type:"button",variant:"secondary",asChild:!0,children:e.jsxs("a",{href:"/projects",children:[e.jsx(J,{className:"mr-2 h-4 w-4"})," Back"]})}),e.jsxs(p,{type:"submit",size:"lg",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),l?"Update Project":"Create Project"]})]})]})})]})})]})}export{he as default};
