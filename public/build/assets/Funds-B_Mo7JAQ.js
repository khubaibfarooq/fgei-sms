import{r as n,j as t,L as O}from"./app-CfGXSdso.js";import{A as U,S as C,t as _}from"./app-layout-BJpq0BJ0.js";import{B as c}from"./button-GlNkGw60.js";import{C as R,a as E,b as k,c as A}from"./card-DCzB_HVl.js";import{S as W,a as $,b as J,c as Y,d as H}from"./select-CXm9AuaR.js";import{l as q}from"./lodash-CMc_fFdk.js";import{C as B}from"./combobox-CnTgxtCL.js";import{E as G,F as K,a as Q,b as X}from"./jspdf.plugin.autotable-w0YzkJfV.js";import"./index-HKzI40PN.js";import"./createLucideIcon-Bg_wYs3r.js";import"./input-B8WFn7JR.js";import"./index-DLsuT42h.js";import"./app-logo-icon-DuGuFDpE.js";import"./folder-root-BbSjc8zO.js";import"./grip-vertical-TWMOnFIm.js";import"./index-DtRx7V62.js";import"./index-kqss0TnI.js";import"./popover-N5_s81fT.js";const Z=[{title:"Reports",href:"/reports"},{title:"Funds",href:"/reports/funds"}];function je({funds:p,institutes:i,fundheads:L,regions:x,filters:u}){const[w,T]=n.useState(u.search||""),[l,m]=n.useState(u.institute_id||""),[f,y]=n.useState(u.fund_head_id||""),[d,S]=n.useState(p),[b,h]=n.useState(i||[]),[j,F]=n.useState(u.region_id||""),N=e=>e!=null&&typeof e.id=="number"&&e.id>0&&typeof e.name=="string"&&e.name.trim()!=="",z=n.useMemo(()=>Array.isArray(b)?b.filter(N):[],[b]),P=n.useMemo(()=>Array.isArray(x)?x.filter(N):[],[x]);n.useEffect(()=>{S(p),h(i||[])},[p,i]);const V=async e=>{if(!e||e==="0"||e===""){h(i||[]),l&&m("");return}try{const s=new URLSearchParams({region_id:e}).toString(),o=await fetch(`/reports/getInstitutes?${s}`);if(!o.ok)throw new Error("Failed to fetch institutes");const a=await o.json();h(a),l&&!a.some(r=>r.id.toString()===l)&&m("")}catch(s){console.error("Error fetching institutes:",s),_.error("Failed to load institutes"),h([])}},I=e=>{F(e),V(e)},g=async e=>{try{const s=new URLSearchParams({search:w||"",institute_id:l||"",region_id:j||"",fund_head_id:f||""}),o=e||`/reports/funds/getfunds?${s.toString()}`,a=await fetch(o);if(!a.ok)throw new Error("Failed to fetch funds");const r=await a.json();S(r)}catch(s){console.error(s),_.error("Failed to fetch funds")}};n.useMemo(()=>q.debounce(g,300),[w,l,j,f]);const M=async()=>{const e=new G.Workbook,s=e.addWorksheet("Funds");s.columns=[{header:"Fund Head",key:"fund_head",width:30},{header:"Balance",key:"balance",width:15}],d.data.forEach(r=>{var v;s.addRow({fund_head:((v=r.fund_head)==null?void 0:v.name)||"N/A",balance:typeof r.balance=="number"?r.balance.toFixed(2):r.balance??"0"})});const o=await e.xlsx.writeBuffer(),a=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});K.saveAs(a,"Funds_Report.xlsx")},D=()=>{const e=new Q;e.setFontSize(16),e.text("Funds Report",14,15);const s=["Fund Head","Balance"],o=d.data.map(a=>{var r;return[((r=a.fund_head)==null?void 0:r.name)||"N/A",typeof a.balance=="number"?a.balance.toFixed(2):a.balance??"0"]});X(e,{head:[s],body:o,startY:25,styles:{fontSize:9,cellPadding:2},headStyles:{fillColor:[66,139,202],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]}}),e.save("Funds_Report.pdf")};return t.jsxs(U,{breadcrumbs:Z,children:[t.jsx(O,{title:"Funds Report"}),t.jsx("div",{className:"flex-1 p-2 md:p-2",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[t.jsx("div",{className:"w-full md:w-1/3",children:t.jsxs(R,{children:[t.jsxs(E,{children:[t.jsx(k,{className:"text-2xl font-bold",children:"Funds Report"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"View fund balances by institute / fund head"})]}),t.jsx(C,{}),t.jsxs(A,{className:"space-y-4",children:[t.jsx(B,{entity:"region",value:j,onChange:I,options:P.map(e=>({id:e.id.toString(),name:e.name.split(" ").pop()||e.name})),includeAllOption:!0,placeholder:"Select Region"}),t.jsx(B,{entity:"institute",value:l,onChange:m,options:z.map(e=>({id:e.id.toString(),name:e.name})),includeAllOption:!1,placeholder:"Select Institute"}),t.jsxs(W,{value:f,onValueChange:e=>y(e),children:[t.jsx($,{children:t.jsx(J,{placeholder:"Select Fund Head"})}),t.jsxs(Y,{children:[t.jsx(H,{value:"0",children:"All Fund Heads"}),L.map(e=>t.jsx(H,{value:e.id.toString(),children:e.name},e.id))]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(c,{onClick:()=>g(),children:"Apply Filters"}),t.jsx(c,{onClick:()=>{T(""),F(""),m(""),y("")},children:"Reset"})]})]})]})}),t.jsx("div",{className:"w-full md:w-2/3",children:t.jsxs(R,{children:[t.jsxs(E,{children:[t.jsx(k,{className:"text-2xl font-bold",children:"Funds Report"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"View fund balances by institute / fund head"}),t.jsxs("div",{className:"flex float-end gap-2",children:[t.jsx(c,{onClick:D,className:"w-full md:w-auto",children:"Export PDF"})," ",t.jsx(c,{onClick:M,className:"w-full md:w-auto",children:"Export Excel"})," "]})]}),t.jsx(C,{}),t.jsx(A,{className:"pt-6 space-y-6",children:t.jsxs("div",{children:[t.jsxs("table",{className:"w-full border-collapse border-1 rounded-md overflow-hidden shadow-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-primary text-white ",children:[t.jsx("th",{className:"p-2",children:"Fund Head"}),t.jsx("th",{className:"p-2",children:"Balance"})]})}),t.jsx("tbody",{children:d.data.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:4,className:"p-4 text-muted-foreground",children:"No funds found."})}):d.data.map(e=>{var s;return t.jsxs("tr",{className:"border-1 hover:bg-primary/10  dark:hover:bg-gray-700",children:[t.jsx("td",{className:"p-2 text-left border-r-1 font-bold",children:((s=e.fund_head)==null?void 0:s.name)||"N/A"}),t.jsx("td",{className:"p-2 text-right",children:typeof e.balance=="number"?e.balance.toFixed(2):e.balance??"0"})]},e.id)})})]}),d.links&&d.links.length>1&&t.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:d.links.map((e,s)=>t.jsx(c,{disabled:!e.url,variant:e.active?"default":"outline",size:"sm",onClick:()=>e.url?g(e.url):void 0,className:e.active?"bg-blue-600 hover:bg-blue-700":"",children:t.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})},s))})]})})]})})]})})]})}export{je as default};
