import{r as f,j as e,L as D,S as o,R as E}from"./app-QprhJZ06.js";import{A as T,S as I}from"./app-layout-B9K3_aGt.js";import{C as R,a as V,b as z,c as B}from"./card-DnJ_cVzm.js";import{B as l}from"./button-CpTWwzUI.js";import{B as P}from"./badge-D8LaEDFQ.js";import{S as U,a as F,b as O,c as H,d as j}from"./select-uMF_NISx.js";import{I as m}from"./input-rz8FXf4X.js";import{L as c}from"./label-DjAncwwd.js";import{X as k}from"./index-C9TLFy3Y.js";import{C as J,a as K}from"./index-cToYmfdw.js";import"./index-BDp_ksdu.js";import"./createLucideIcon-CkYmE4Et.js";import"./index-DaR4Iucw.js";import"./index-CP_ej-uK.js";import"./index-6kIsNT08.js";import"./app-logo-icon-jy-42en1.js";import"./circle-x-Y8nGU1IC.js";import"./folder-root-BmeYBaiz.js";import"./grip-vertical-B4qo9ZqK.js";import"./clsx-B-dksMZM.js";import"./index-B2h6pwQw.js";import"./index-n7pHTsnB.js";const M=[{title:"Audit Log",href:"/audit-logs"}];function he({logs:n,tables:g,filters:d,users_lookup:b,fund_heads_lookup:N,institutes_lookup:_,assets_lookup:y,rooms_lookup:S}){const[x,v]=f.useState([]),[a,p]=f.useState({table:d.table||"",record_id:d.record_id||"",date_from:d.date_from||"",date_to:d.date_to||""}),C=s=>{v(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},i=(s,t)=>{p(r=>({...r,[s]:t}))},h=()=>{o.get("/audit-logs",a,{preserveState:!0,preserveScroll:!0})},w=()=>{const s={table:"",record_id:"",date_from:"",date_to:""};p(s),o.get("/audit-logs",s,{preserveState:!0,preserveScroll:!0})},L=s=>{switch(s){case"INSERT":return"bg-green-100 text-green-800 hover:bg-green-200 border-green-200";case"UPDATE":return"bg-blue-100 text-blue-800 hover:bg-blue-200 border-blue-200";case"DELETE":return"bg-red-100 text-red-800 hover:bg-red-200 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},A=(s,t)=>{if(t==null)return e.jsx("span",{className:"text-gray-400 italic",children:"null"});if(["changed_by","added_by","approver_id","user_id"].includes(s)&&typeof t=="number"){const r=b[t];return r?e.jsxs("span",{children:[t," ",e.jsxs("span",{className:"text-blue-600 font-medium",children:["(",r,")"]})]}):t}if(s==="fund_head_id"&&typeof t=="number"){const r=N[t];return r?e.jsxs("span",{children:[t," ",e.jsxs("span",{className:"text-indigo-600 font-medium",children:["(",r,")"]})]}):t}if(s==="institute_id"&&typeof t=="number"){const r=_[t];return r?e.jsxs("span",{children:[t," ",e.jsxs("span",{className:"text-orange-600 font-medium",children:["(",r,")"]})]}):t}if(s==="asset_id"&&typeof t=="number"){const r=y[t];return r?e.jsxs("span",{children:[t," ",e.jsxs("span",{className:"text-teal-600 font-medium",children:["(",r,")"]})]}):t}if(s==="room_id"&&typeof t=="number"){const r=S[t];return r?e.jsxs("span",{children:[t," ",e.jsxs("span",{className:"text-purple-600 font-medium",children:["(",r,")"]})]}):t}if(["created_at","updated_at","action_date","deadline","completed_date"].includes(s)&&typeof t=="string")try{return new Date(t).toLocaleString()}catch{return t}return typeof t=="boolean"?t?e.jsx("span",{className:"text-green-600",children:"true"}):e.jsx("span",{className:"text-red-600",children:"false"}):typeof t=="object"?JSON.stringify(t):t},u=({values:s})=>e.jsx("div",{className:"bg-background border rounded px-3 py-2 text-xs overflow-auto max-h-60 grid grid-cols-[auto_1fr] gap-x-4 gap-y-1",children:Object.entries(s).map(([t,r])=>e.jsxs(E.Fragment,{children:[e.jsxs("div",{className:"font-medium text-muted-foreground",children:[t,":"]}),e.jsx("div",{className:"break-all",children:A(t,r)})]},t))});return e.jsxs(T,{breadcrumbs:M,children:[e.jsx(D,{title:"Audit Log"}),e.jsx("div",{className:"flex-1 p-4 md:p-6",children:e.jsxs(R,{children:[e.jsxs(V,{className:"pb-3",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("div",{children:[e.jsx(z,{className:"text-2xl font-bold",children:"Audit Log"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"System-wide change history tracked by database triggers"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mt-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"Table Name"}),e.jsxs(U,{value:a.table,onValueChange:s=>i("table",s==="all"?"":s),children:[e.jsx(F,{className:"h-8",children:e.jsx(O,{placeholder:"All Tables"})}),e.jsxs(H,{children:[e.jsx(j,{value:"all",children:"All Tables"}),g.map(s=>e.jsx(j,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"Record ID"}),e.jsx(m,{placeholder:"ID",type:"number",className:"h-8",value:a.record_id,onChange:s=>i("record_id",s.target.value),onKeyDown:s=>s.key==="Enter"&&h()})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"From Date"}),e.jsx(m,{type:"date",className:"h-8",value:a.date_from,onChange:s=>i("date_from",s.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"To Date"}),e.jsx(m,{type:"date",className:"h-8",value:a.date_to,onChange:s=>i("date_to",s.target.value)})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(l,{size:"sm",className:"h-8 flex-1",onClick:h,children:"Search"}),e.jsx(l,{size:"sm",variant:"outline",className:"h-8 px-2",onClick:w,title:"Reset Filters",children:e.jsx(k,{className:"h-4 w-4"})})]})]})]}),e.jsx(I,{}),e.jsxs(B,{className:"pt-6 space-y-4",children:[n.data.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No audit logs found matching your criteria."}):n.data.map(s=>{var t;return e.jsxs("div",{className:"border rounded-md bg-card hover:bg-muted/30 transition overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between cursor-pointer",onClick:()=>C(s.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:"outline",className:`${L(s.action)}`,children:s.action}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[s.table_name.toUpperCase()," #",s.record_id]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",((t=s.user)==null?void 0:t.name)??"System/Unknown"," â€¢ ",new Date(s.changed_at).toLocaleString()]})]})]}),e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8",children:x.includes(s.id)?e.jsx(J,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})]}),x.includes(s.id)&&e.jsx("div",{className:"bg-muted/50 px-4 py-3 text-sm border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.old_values&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-red-600",children:"Old Values"}),e.jsx(u,{values:s.old_values})]}),s.new_values&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-green-600",children:"New Values"}),e.jsx(u,{values:s.new_values})]})]})})]},s.id)}),n.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:n.links.map((s,t)=>e.jsx(l,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",onClick:()=>o.visit(s.url||"",{preserveScroll:!0,preserveState:!0,only:["logs"]}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t))})]})]})})]})}export{he as default};
