import{r as t,a as j,j as e,S as v}from"./app-Ckd00XjB.js";import{D as y,a as N,b,c as C,d as D,C as w,e as S,f as A,t as g}from"./index-Cr4Z16Jw.js";import{B as n}from"./button-DN_423EJ.js";import{T as F}from"./textarea-BaMFDxqH.js";import{L as k}from"./label-DEtFFioE.js";import"./createLucideIcon-CImEr1Cq.js";import"./index-BQq7n3OH.js";import"./index-CN9Vo_2d.js";function P({isOpen:r,onClose:o,project:a}){const[l,c]=t.useState(""),[m,u]=t.useState([]),[i,d]=t.useState(!1);t.useEffect(()=>{r&&a&&f()},[r,a]);const f=async()=>{if(a)try{const{data:s}=await j.get(`/projects/${a.id}/history`);u(s)}catch(s){console.error("Failed to fetch history",s)}},p=s=>{a&&(d(!0),v.post(`/projects/${a.id}/approvals`,{status:s,comments:l},{onSuccess:()=>{g.success(`Project ${s} successfully`),o(),c("")},onError:()=>{g.error("Failed to process approval")},onFinish:()=>d(!1)}))};return a?e.jsx(y,{open:r,onOpenChange:o,children:e.jsxs(N,{className:"max-w-2xl",children:[e.jsxs(b,{children:[e.jsxs(C,{children:["Project Approval: ",a.name]}),e.jsx(D,{children:"Review project details and action approval."})]}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Approval History"}),e.jsx("div",{className:"border rounded-lg p-4 h-48 overflow-y-auto space-y-4 bg-muted/30",children:m.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No approval history."}):m.map(s=>{var x,h;return e.jsxs("div",{className:"flex gap-3 text-sm",children:[s.status==="approved"?e.jsx(w,{className:"w-5 h-5 text-green-500 mt-0.5"}):e.jsx(S,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[((x=s.stage)==null?void 0:x.stage_name)||"Stage"," - ",s.status]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["by ",(h=s.approver)==null?void 0:h.name," on ",s.action_date?new Date(s.action_date).toLocaleString():""]}),s.comments&&e.jsxs("p",{className:"mt-1 text-gray-700 bg-white p-2 rounded border",children:['"',s.comments,'"']})]})]},s.id)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"comments",children:"Comments"}),e.jsx(F,{id:"comments",placeholder:"Add comments for this action...",value:l,onChange:s=>c(s.target.value)})]})]}),e.jsxs(A,{className:"gap-2 sm:gap-0",children:[e.jsx(n,{variant:"outline",onClick:o,disabled:i,children:"Cancel"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"destructive",onClick:()=>p("rejected"),disabled:i,children:"Reject"}),e.jsx(n,{className:"bg-green-600 hover:bg-green-700",onClick:()=>p("approved"),disabled:i,children:"Approve"})]})]})]})}):null}export{P as default};
