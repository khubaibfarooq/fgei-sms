import{K as is,r,j as e,L as ds,$ as re,S as w,a as f}from"./app-Cp_IQVQG.js";import{A as cs,g as ke,S as os,c as _e,E as ms,h as xs,T as ps,d as Se,F as De,e as hs}from"./app-layout-Ci0vZgwU.js";import{B as i}from"./button-Cde_-LRF.js";import{C as S,a as V,b as gs,c as D,d as us}from"./card-BQuwsQUn.js";import{I as g}from"./input-Bxlq5blS.js";import{A as Fe,a as js,b as Ae,c as Pe,d as ze,e as Ie,f as Me,g as $e,h as Te}from"./alert-dialog-C7Wl3Xsc.js";import{t as d,X as fs,D as F,a as A,b as P,c as z,d as I,e as M}from"./index-kmMY05Ii.js";import{T as ys,a as bs,b as W,c as B}from"./tabs-DwKbnDy-.js";import{B as $}from"./badge-CD42chZP.js";import{L as m}from"./label-Dyu8wAJV.js";import{T as Le}from"./textarea-CGVSdGvC.js";import Ns from"./ApprovalModal-Db6b1Sxl.js";import{I as K}from"./image-preview2-DrX23nkN.js";import{C as vs,a as ws}from"./circle-x-Ba36GsbC.js";import"./index-Bh87lOOC.js";import"./createLucideIcon-BcqMgscP.js";import"./index-BSBFl1gM.js";import"./index-Dm3x3kdv.js";import"./index-BMNJhqSZ.js";import"./index-BV2jfRMR.js";import"./app-logo-icon-B7S6SPik.js";import"./clsx-B-dksMZM.js";import"./folder-root-b74NyfMv.js";import"./grip-vertical-BXZrwIMv.js";const Cs=[{title:"Projects",href:"/projects"}];function Xs({projects:T,filters:L,permissions:G}){var we;const{props:C}=is(),[O,Oe]=r.useState(L.search||""),[le,Re]=r.useState(L.status||"");r.useEffect(()=>{var s,t;(s=C.flash)!=null&&s.success&&d.success(C.flash.success),(t=C.flash)!=null&&t.error&&d.error(C.flash.error)},[C.flash]);const[a,X]=r.useState(null),[ne,ie]=r.useState([]),[de,Y]=r.useState([]),[u,J]=r.useState([]),[ce,Q]=r.useState([]),[R,oe]=r.useState(!1),[Ue,k]=r.useState(!1),[x,_]=r.useState({desc:"",date:"",image:null}),[me,xe]=r.useState(!1),[Ee,pe]=r.useState(!1),[qe,He]=r.useState(null),[Ve,Z]=r.useState(!1),[j,We]=r.useState(null),[he,ee]=r.useState(!1),[U,ge]=r.useState({actual_cost:""}),[Be,E]=r.useState(!1),[Ke,q]=r.useState(!1),[h,se]=r.useState({stage_name:"",amount:""}),[ue,je]=r.useState(!1),[b,Ge]=r.useState(0),[Xe,te]=r.useState(!1),[N,Ye]=r.useState(null),Je=s=>{var t,n;return((n=(t=s.current_stage)==null?void 0:t.level)==null?void 0:n.toLowerCase())==="institutional"&&s.status!=="completed"},[ae,H]=r.useState(null),[l,y]=r.useState({name:"",description:"",days:0,status:"",completed_date:"",img:null,pdf:null}),[fe,ye]=r.useState(!1),Qe=s=>{H(s),y({name:s.name,description:s.description||"",days:s.days||0,status:s.status,completed_date:s.completed_date?s.completed_date.split("T")[0]:"",img:null,pdf:null})},Ze=async()=>{if(!ae)return;ye(!0);const s=new FormData;s.append("_method","PUT"),s.append("name",l.name),s.append("days",l.days.toString()),s.append("status",l.status),s.append("description",l.description),l.status==="completed"&&l.completed_date?s.append("completed_date",l.completed_date):s.append("completed_date",""),l.img&&s.append("img",l.img),l.pdf&&s.append("pdf",l.pdf);try{if(await f.post(`/milestones/${ae.id}`,s,{headers:{"Content-Type":"multipart/form-data"}}),d.success("Milestone updated successfully"),H(null),a){const t=await f.get(`/projects/${a.id}/milestones`);Y(t.data)}}catch(t){console.error(t),d.error("Failed to update milestone")}finally{ye(!1)}},es=s=>{w.delete(`/projects/${s}`,{onSuccess:()=>d.success("Project deleted successfully"),onError:()=>d.error("Failed to delete project")})},ss=s=>{s.key==="Enter"&&w.get("/projects",{...L,search:O},{preserveScroll:!0})},ts=s=>{const t=s.target.value;Re(t),be({search:O,status:t})},be=s=>{w.get("/projects",{...L,...s},{preserveScroll:!0,preserveState:!0,replace:!0,only:["projects","filters"]})};r.useEffect(()=>{a?(oe(!0),(async()=>{try{const[t,n,c,o]=await Promise.all([f.get(`/projects/${a.id}/history`),f.get(`/projects/${a.id}/milestones`),f.get(`/projects/${a.id}/payments`),f.get(`/projects/${a.id}/images`)]);ie(t.data),Y(n.data),J(c.data.payments),Q(o.data)}catch(t){console.error("Failed to fetch project details",t),d.error("Failed to load project details.")}finally{oe(!1)}})()):(ie([]),Y([]),J([]),Q([]))},[a]);const as=s=>{if(s.preventDefault(),!j)return;const t=parseFloat(U.actual_cost),n=j.estimated_cost;if(t>n){E(!0);return}Ne()},Ne=()=>{j&&(ee(!0),w.post(`/projects/${j.id}/update-cost`,rs(),{onSuccess:()=>{d.success("Actual cost updated successfully"),Z(!1),E(!1),ee(!1)},onError:s=>{d.error("Failed to update cost"),ee(!1)}}))},rs=()=>({actual_cost:U.actual_cost}),ve=()=>{var c;if(!a)return;const s=parseFloat(((c=a.actual_cost)==null?void 0:c.toString())||"0")||0,t=u.filter(o=>o.status==="Approved").reduce((o,p)=>{var v;return o+(parseFloat(((v=p.amount)==null?void 0:v.toString())||"0")||0)},0),n=s-t;Ge(n),se({stage_name:"",amount:""}),q(!0)},ls=async()=>{var t,n;if(!a)return;const s=parseFloat(h.amount);if(isNaN(s)||s<=0){d.error("Please enter a valid amount");return}if(s>b){d.error(`Amount cannot exceed remaining amount (${b.toLocaleString()})`);return}if(!h.stage_name.trim()){d.error("Please enter a stage name");return}je(!0);try{const c=await f.post(`/projects/${a.id}/request-payment`,{stage_name:h.stage_name,amount:s});if(c.data.success){d.success(c.data.message),q(!1);const o=await f.get(`/projects/${a.id}/payments`);J(o.data.payments)}else d.error(c.data.message)}catch(c){d.error(((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to request payment")}finally{je(!1)}};return e.jsxs(cs,{breadcrumbs:Cs,children:[e.jsx(ds,{title:"Project Management"}),e.jsxs("div",{className:"flex flex-col lg:flex-row h-[calc(100vh-65px)] overflow-hidden",children:[e.jsx("div",{className:`flex-1 p-2 md:p-4 lg:p-6 overflow-y-auto ${a?"lg:w-2/3":"w-full"}`,children:e.jsxs(S,{className:"h-full flex flex-col",children:[e.jsxs(V,{className:"p-3 pb-2 md:pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shrink-0",children:[e.jsxs("div",{children:[e.jsx(gs,{className:"text-2xl font-bold",children:"Projects"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-md lg:text-lg",children:"Manage institutional projects"})]}),G.can_add&&e.jsx(re,{href:"/projects/create",children:e.jsxs(i,{children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Add Project"]})})]}),e.jsx(os,{}),e.jsxs(D,{className:"p-2 pt-4 md:pt-6 space-y-4 md:space-y-6 flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 shrink-0",children:[e.jsx(g,{type:"text",placeholder:"Search projects... (press Enter)",value:O,onChange:s=>Oe(s.target.value),onKeyDown:ss}),e.jsxs("select",{value:le,onChange:ts,className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"inprogress",children:"InProgress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"planned",children:"Planned"}),e.jsx("option",{value:"waiting",children:"Waiting"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsx(i,{onClick:()=>be({search:O,status:le}),children:"Fetch"})]}),e.jsx("div",{className:"space-y-3 flex-1 overflow-auto",children:e.jsxs("table",{className:"w-full border-collapse border-1 rounded-md overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Project"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Type"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20 hidden lg:table-cell",children:"Fund Head"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Est. Cost"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Act. Cost"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Priority"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Status"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20 hidden sm:table-cell",children:"Approval"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20 hidden md:table-cell",children:"Current Stage"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20 hidden lg:table-cell",children:"Comment"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Action"})]})}),e.jsx("tbody",{children:T.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-muted-foreground text-center p-4",children:"No projects found."})}):T.data.map(s=>{var t,n,c,o;return e.jsxs("tr",{className:`hover:bg-primary/10 dark:hover:bg-gray-700 text-center cursor-pointer transition-colors ${(a==null?void 0:a.id)===s.id?"bg-primary/5 dark:bg-gray-700 border-l-4 border-l-primary":""}`,onClick:()=>X(s),children:[e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 font-medium whitespace-nowrap text-left",children:e.jsx(re,{href:`/projects/${s.id}/details`,className:"text-blue-600 hover:text-blue-800 hover:underline",onClick:p=>p.stopPropagation(),children:s.name})}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-center",children:((t=s.projecttype)==null?void 0:t.name)||"-"}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 hidden lg:table-cell",children:(n=s.fund_head)==null?void 0:n.name}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100",children:s.estimated_cost}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.actual_cost||"",((c=s.current_stage)==null?void 0:c.can_change_cost)&&!s.actual_cost&&e.jsx(i,{variant:"ghost",size:"icon",className:"h-5 w-5 text-blue-600 hover:text-blue-700",title:"Add/Update Actual Cost",onClick:p=>{p.stopPropagation(),We(s),ge({actual_cost:(s.actual_cost||"").toString()}),Z(!0)},children:e.jsx(ke,{className:"h-3 w-3"})})]})}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 capitalize",children:s.priority||"-"}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 capitalize",children:s.status}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 capitalize hidden sm:table-cell",children:s.approval_status}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 hidden md:table-cell",children:((o=s.current_stage)==null?void 0:o.stage_name)||"Held with Regional Office"}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 hidden lg:table-cell truncate max-w-[150px]",title:s.final_comments||"",children:s.final_comments||"-"}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100",onClick:p=>p.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6 text-blue-600 hover:text-blue-700",onClick:()=>{_({desc:"",date:new Date().toISOString().split("T")[0],image:null}),k(!0)},children:e.jsx(_e,{className:"h-3 w-3 mr-1"})}),s.pdf?e.jsx("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center text-blue-600 hover:text-blue-700",title:"View PDF",children:"PDF"}):e.jsx("span",{className:"text-muted-foreground",children:"-"}),s.description?e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6 text-blue-600 hover:text-blue-700",title:"View Description",onClick:()=>{Ye(s),te(!0)},children:e.jsx(ms,{className:"h-3 w-3"})}):e.jsx("span",{className:"text-muted-foreground",children:"-"}),G.can_edit&&e.jsx(re,{href:`/projects/${s.id}/edit`,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",children:e.jsx(xs,{className:"h-3 w-3"})})}),G.can_delete&&e.jsxs(Fe,{children:[e.jsx(js,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"text-destructive hover:text-red-600 h-6 w-6",children:e.jsx(ps,{className:"h-3 w-3"})})}),e.jsxs(Ae,{children:[e.jsxs(Pe,{children:[e.jsx(ze,{children:"Delete this project?"}),e.jsxs(Ie,{children:["Project ",e.jsx("strong",{children:s.name})," will be permanently deleted."]})]}),e.jsxs(Me,{children:[e.jsx($e,{children:"Cancel"}),e.jsx(Te,{className:"bg-destructive hover:bg-destructive/90",onClick:()=>es(s.id),children:"Delete"})]})]})]}),Je(s)&&e.jsx(i,{variant:"ghost",size:"icon",title:"View/Approve",className:"text-blue-600 hover:text-blue-700 h-6 w-6",onClick:p=>{p.stopPropagation(),He(s),pe(!0)},children:e.jsx(us,{className:"h-3 w-3"})})]})})]},s.id)})})]})}),T.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2 shrink-0",children:T.links.map((s,t)=>e.jsx(i,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",onClick:()=>w.visit(s.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t))})]})]})}),a&&e.jsxs("div",{className:"w-full lg:w-1/3 border-l bg-background p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col h-full transition-all duration-300 ease-in-out z-20 absolute lg:relative right-0 top-0 lg:top-auto bottom-0 lg:bottom-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(we=a.institute)==null?void 0:we.name})]}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>X(null),children:e.jsx(fs,{className:"h-5 w-5"})})]}),e.jsxs(ys,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs(bs,{className:"grid w-full grid-cols-4",children:[e.jsx(W,{value:"approvals",children:"Approvals"}),e.jsx(W,{value:"milestones",children:"Milestones"}),e.jsx(W,{value:"payments",children:"Payments"}),e.jsxs(W,{value:"images",children:[e.jsx(_e,{className:"h-3 w-3 mr-1"}),"Images"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(B,{value:"approvals",className:"space-y-4 m-0 h-full",children:R?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading history..."}):ne.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No approval history found."}):e.jsx("div",{className:"space-y-4",children:ne.map(s=>{var t,n;return e.jsxs(S,{className:"overflow-hidden border shadow-sm",children:[e.jsx(V,{className:"p-2 bg-muted/30 pb-1 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold text-xs",children:((t=s.stage)==null?void 0:t.stage_name)||"Stage"}),s.status==="approved"?e.jsxs($,{variant:"outline",className:"h-4 border-green-500 text-green-600 bg-green-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(vs,{className:"w-2.5 h-2.5"})," Approved"]}):s.status==="rejected"?e.jsxs($,{variant:"outline",className:"h-4 border-red-500 text-red-600 bg-red-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(ws,{className:"w-2.5 h-2.5"})," Rejected"]}):e.jsxs($,{variant:"outline",className:"h-4 border-yellow-500 text-yellow-600 bg-yellow-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(Se,{className:"w-2.5 h-2.5"})," Pending"]})]})}),e.jsxs(D,{className:"p-2 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1 mb-1",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground flex items-center",children:[e.jsx(Se,{className:"w-2.5 h-2.5 mr-1"}),s.action_date?new Date(s.action_date).toLocaleString():"-"]}),e.jsxs("div",{className:"text-[10px]",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Approved by: "}),e.jsx("span",{className:"font-medium",children:(n=s.approver)==null?void 0:n.name})]})]}),s.comments&&e.jsxs("div",{className:"bg-muted/50 px-2 py-1 rounded text-[10px] italic border mt-1 line-clamp-2",children:['"',s.comments,'"']}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.pdf&&e.jsxs("a",{href:`/${s.pdf}`,target:"_blank",className:"text-blue-600 hover:underline text-[10px] flex items-center gap-1",children:[e.jsx(De,{className:"h-3 w-3"})," PDF"]}),s.img&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{dataImg:s.img,size:"h-4 w-4",className:"rounded border object-cover"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Image"})]})]})]})]},s.id)})})}),e.jsx(B,{value:"milestones",className:"space-y-4 m-0 h-full",children:R?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading milestones..."}):de.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No milestones found."}):e.jsx("div",{className:"space-y-4",children:de.map(s=>e.jsx(S,{className:"cursor-pointer hover:bg-muted/50 transition-colors border shadow-sm overflow-hidden",onClick:()=>Qe(s),children:e.jsxs("div",{className:"flex items-start",children:[s.img&&e.jsx("div",{className:"w-16 h-16 shrink-0",children:e.jsx(K,{dataImg:s.img,size:"h-16 w-16",className:"h-16 w-16 object-cover rounded-none"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(V,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsx("div",{className:"font-semibold text-xs truncate pr-2",children:s.name}),e.jsx($,{variant:s.status==="completed"?"default":s.status==="inprogress"?"secondary":"outline",className:"capitalize text-[10px] px-1 py-0 h-4 shrink-0",children:s.status})]}),e.jsxs(D,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Due: ",s.days," days"]}),s.completed_date&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Done: ",new Date(s.completed_date).toLocaleDateString()]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-[10px] line-clamp-1",children:s.description}),"    ",s.pdf&&e.jsxs("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",onClick:t=>t.stopPropagation(),className:"text-blue-600 hover:underline text-[10px] flex items-center gap-1 mt-0.5",children:[e.jsx(De,{className:"h-3 w-3"})," View PDF"]})]})]})]})},s.id))})}),e.jsx(B,{value:"payments",className:"space-y-4 m-0 h-full",children:R?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading payments..."}):u.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:["No payments found.",a.actual_cost&&a.approval_status==="approved"&&e.jsx("div",{className:"pt-2",children:e.jsx(i,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:ve,children:"Request Payment"})})]}):e.jsxs("div",{className:"space-y-4",children:[u.map(s=>{var t,n;return e.jsxs(S,{className:"border shadow-sm",children:[e.jsxs(V,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{className:"font-semibold text-xs",children:["Rs. ",s.amount.toLocaleString()]}),e.jsx($,{variant:"outline",className:`capitalize text-[10px] px-1 py-0 h-4 ${s.status==="Approved"?"border-green-500 text-green-600 bg-green-50":s.status==="Rejected"?"border-red-500 text-red-600 bg-red-50":"border-yellow-500 text-yellow-600 bg-yellow-50"}`,children:s.status})]}),e.jsxs(D,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[e.jsx("div",{className:"text-muted-foreground font-medium truncate max-w-[150px]",title:((t=s.fund_head)==null?void 0:t.name)||"General Fund",children:((n=s.fund_head)==null?void 0:n.name)||"General Fund"}),e.jsx("div",{className:"text-muted-foreground",children:new Date(s.added_date).toLocaleDateString()})]}),s.description&&e.jsxs("p",{className:"text-muted-foreground text-[10px] italic bg-muted/30 px-1.5 py-0.5 rounded truncate",children:['"',s.description,'"']}),s.img&&e.jsx("div",{className:"mt-1",children:e.jsx(K,{dataImg:s.img,size:"h-12",className:"rounded border"})})]})]},s.id)}),(()=>{var c,o,p;const s=parseFloat(((c=a.actual_cost)==null?void 0:c.toString())||"0")||0,t=u.filter(v=>v.status==="Approved").reduce((v,ns)=>{var Ce;return v+(parseFloat(((Ce=ns.amount)==null?void 0:Ce.toString())||"0")||0)},0),n=s-t;return a.actual_cost&&((o=u[u.length-1])==null?void 0:o.status)==="Approved"&&n>0&&(u.length===1||u.length===2||u.length===3||u.length===4||(p=a.current_stage)!=null&&p.is_last)?e.jsx("div",{className:"pt-2",children:e.jsx(i,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:ve,children:"Request  Payment"})}):null})()]})}),e.jsx(B,{value:"images",className:"space-y-4 m-0 h-full",children:R?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading images..."}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs(i,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{_({desc:"",date:new Date().toISOString().split("T")[0],image:null}),k(!0)},children:[e.jsx(hs,{className:"h-4 w-4 mr-2"})," Upload Image"]}),ce.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No images found."}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ce.map(s=>e.jsxs(S,{className:"overflow-hidden border shadow-sm",children:[e.jsx("div",{className:"relative",children:e.jsx(K,{dataImg:`assets/${s.image}`,size:"w-full h-28 object-cover"})}),e.jsxs(D,{className:"p-1.5",children:[s.desc&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2",title:s.desc,children:s.desc}),s.date&&e.jsx("p",{className:"text-[9px] text-muted-foreground mt-0.5",children:new Date(s.date).toLocaleDateString()})]})]},s.id))})]})})]})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/20 lg:hidden z-10",onClick:()=>X(null)}),e.jsx(F,{open:!!ae,onOpenChange:s=>!s&&H(null),children:e.jsxs(A,{className:"sm:max-w-[500px]",children:[e.jsxs(P,{children:[e.jsx(z,{children:"Edit Milestone"}),e.jsx(I,{children:"Update the details of the milestone. Click save when you're done."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"name",className:"text-right",children:"Name"}),e.jsx(g,{id:"name",value:l.name,onChange:s=>y({...l,name:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs("select",{id:"status",value:l.status,onChange:s=>y({...l,status:s.target.value}),className:"col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"inprogress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"days",className:"text-right",children:"Days"}),e.jsx(g,{id:"days",type:"number",value:l.days,onChange:s=>y({...l,days:parseInt(s.target.value)||0}),className:"col-span-3"})]}),l.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"completed_date",className:"text-right",children:"Completed Date"}),e.jsx(g,{id:"completed_date",type:"date",value:l.completed_date,onChange:s=>y({...l,completed_date:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"img",className:"text-right",children:"Image"}),e.jsx(g,{id:"img",type:"file",accept:"image/*",onChange:s=>{s.target.files&&s.target.files[0]&&y({...l,img:s.target.files[0]})},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"pdf",className:"text-right",children:"PDF"}),e.jsx(g,{id:"pdf",type:"file",accept:".pdf",onChange:s=>{s.target.files&&s.target.files[0]&&y({...l,pdf:s.target.files[0]})},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"description",className:"text-right",children:"Description"}),e.jsx(Le,{id:"description",value:l.description,onChange:s=>y({...l,description:s.target.value}),className:"col-span-3"})]})]}),e.jsxs(M,{children:[e.jsx(i,{type:"button",variant:"secondary",onClick:()=>H(null),children:"Cancel"}),e.jsx(i,{type:"submit",onClick:Ze,disabled:fe,children:fe?"Saving...":"Save changes"})]})]})}),e.jsx(Ns,{isOpen:Ee,onClose:()=>pe(!1),project:qe,onSuccess:()=>{w.reload({only:["projects"]})}}),e.jsx(F,{open:Ve,onOpenChange:Z,children:e.jsxs(A,{className:"sm:max-w-[425px]",children:[e.jsxs(P,{children:[e.jsx(z,{children:"Update Actual Cost"}),e.jsxs(I,{children:["Enter the actual cost for ",e.jsx("strong",{children:j==null?void 0:j.name}),"."]})]}),e.jsxs("form",{onSubmit:as,children:[e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"actual_cost",className:"text-right",children:"Cost"}),e.jsx(g,{id:"actual_cost",type:"number",step:"0.01",className:"col-span-3",value:U.actual_cost,onChange:s=>ge({actual_cost:s.target.value}),required:!0})]})}),e.jsx(M,{children:e.jsx(i,{type:"submit",disabled:he,children:he?"Updating...":"Save changes"})})]})]})}),e.jsx(Fe,{open:Be,onOpenChange:E,children:e.jsxs(Ae,{children:[e.jsxs(Pe,{children:[e.jsx(ze,{children:"Actual Cost Higher than Estimated"}),e.jsxs(Ie,{children:["The actual cost you entered (",e.jsx("strong",{children:U.actual_cost}),") is higher than the estimated cost (",e.jsx("strong",{children:j==null?void 0:j.estimated_cost}),").",e.jsx("br",{}),e.jsx("br",{}),"Are you sure you want to proceed with this then  project will be marked as waiting and project submit to Regional Head for approval ?"]})]}),e.jsxs(Me,{children:[e.jsx($e,{onClick:()=>E(!1),children:"No"}),e.jsx(Te,{onClick:Ne,children:"Yes"})]})]})}),e.jsx(F,{open:Ke,onOpenChange:q,children:e.jsxs(A,{className:"sm:max-w-[450px]",children:[e.jsxs(P,{children:[e.jsx(z,{children:"Request Payment"}),e.jsxs(I,{children:["Enter the stage name and amount for the payment request.",e.jsx("br",{}),e.jsxs("span",{className:"text-sm font-medium mt-2 inline-block",children:["Remaining Amount: ",e.jsx("span",{className:"text-green-600 font-bold",children:b.toLocaleString()})]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"stage_name",className:"text-right",children:"Stage Name"}),e.jsx(g,{id:"stage_name",placeholder:"e.g., Foundation Work",className:"col-span-3",value:h.stage_name,onChange:s=>se({...h,stage_name:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"payment_amount",className:"text-right",children:"Amount"}),e.jsx(g,{id:"payment_amount",type:"number",step:"0.01",max:b,placeholder:`Max: ${b.toLocaleString()}`,className:"col-span-3",value:h.amount,onChange:s=>se({...h,amount:s.target.value})})]}),parseFloat(h.amount)>b&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:"Amount exceeds remaining balance!"})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"secondary",onClick:()=>q(!1),children:"Cancel"}),e.jsx(i,{onClick:ls,disabled:ue||!h.stage_name||!h.amount||parseFloat(h.amount)>b,children:ue?"Requesting...":"Confirm Request"})]})]})}),e.jsx(F,{open:Xe,onOpenChange:te,children:e.jsxs(A,{className:"sm:max-w-[500px]",children:[e.jsxs(P,{children:[e.jsx(z,{children:"Project Description"}),e.jsx(I,{children:N==null?void 0:N.name})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"bg-muted/30 p-4 rounded-lg border text-sm leading-relaxed whitespace-pre-wrap",children:(N==null?void 0:N.description)||"No description available."})}),e.jsx(M,{children:e.jsx(i,{onClick:()=>te(!1),children:"Close"})})]})}),e.jsx(F,{open:Ue,onOpenChange:k,children:e.jsxs(A,{className:"sm:max-w-[450px]",children:[e.jsxs(P,{children:[e.jsx(z,{children:"Upload Project Image"}),e.jsxs(I,{children:["Add a new image for ",e.jsx("strong",{children:a==null?void 0:a.name}),"."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"img_file",className:"text-right",children:"Image"}),e.jsx(g,{id:"img_file",type:"file",accept:"image/*",className:"col-span-3",onChange:s=>{s.target.files&&s.target.files[0]&&_({...x,image:s.target.files[0]})}})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"img_desc",className:"text-right",children:"Description"}),e.jsx(Le,{id:"img_desc",placeholder:"Describe the image...",className:"col-span-3",value:x.desc,onChange:s=>_({...x,desc:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"img_date",className:"text-right",children:"Date"}),e.jsx(g,{id:"img_date",type:"date",className:"col-span-3",value:x.date,onChange:s=>_({...x,date:s.target.value})})]})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"secondary",onClick:()=>k(!1),children:"Cancel"}),e.jsx(i,{disabled:me||!x.image,onClick:async()=>{if(!a||!x.image)return;xe(!0);const s=new FormData;s.append("image",x.image),x.desc&&s.append("desc",x.desc),x.date&&s.append("date",x.date);try{await f.post(`/projects/${a.id}/images`,s,{headers:{"Content-Type":"multipart/form-data"}}),d.success("Image uploaded successfully"),k(!1);const t=await f.get(`/projects/${a.id}/images`);Q(t.data)}catch{d.error("Failed to upload image")}finally{xe(!1)}},children:me?"Uploading...":"Upload"})]})]})})]})}export{Xs as default};
