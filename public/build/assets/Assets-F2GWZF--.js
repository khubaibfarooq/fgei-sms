var xe=Object.defineProperty;var ue=(n,a,i)=>a in n?xe(n,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[a]=i;var re=(n,a,i)=>ue(n,typeof a!="symbol"?a+"":a,i);import{r,j as s,L as fe}from"./app-BArolwli.js";import{t as h,A as pe,S as ge,B as je}from"./app-layout-Db04ZtC5.js";import{B as C}from"./button-BB4cnepi.js";import{C as oe,a as le,b as ae,c as ne}from"./card-CIgoRFiF.js";import{S,a as w,b as A,c as E,d as c}from"./select-CP-uqnTP.js";import{l as ve,E as be}from"./jspdf.plugin.autotable-DyxuL5Zi.js";import{E as ye,F as Ne}from"./FileSaver.min-CQaUSyVW.js";import"./index-BxfiikOc.js";import"./index-HU8Kab0-.js";import"./createLucideIcon-Cy3ZFC5Y.js";import"./index-DF7LLozB.js";import"./app-logo-icon-Bu54fPZo.js";import"./index-CbPWfD7W.js";import"./index-BIjApg2Y.js";const ke=[{title:"Reports",href:"/reports"},{title:"Assets",href:"/reports/assets"}];class Se extends r.Component{constructor(){super(...arguments);re(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(i){return{hasError:!0,error:i.message}}componentDidCatch(i,v){console.error("ErrorBoundary caught:",i,v),h.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?s.jsxs("div",{className:"p-4",children:[s.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),s.jsx(C,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const l=n=>{const a=n!=null&&typeof n.id=="number"&&n.id>0&&typeof n.name=="string"&&n.name.trim()!=="";return a||console.warn("Invalid item detected:",n),a};function $e({instituteAssets:n,institutes:a,blocks:i,rooms:v,assetCategories:R,assets:F,filters:x}){var Z,ee,se;const[V,we]=r.useState(x.search||""),[u,ie]=r.useState(x.institute_id||""),[f,D]=r.useState(x.block_id||""),[B,b]=r.useState(x.room_id||""),[p,ce]=r.useState(x.asset_category_id||""),[L,z]=r.useState(x.asset_id||""),[M,I]=r.useState(i.filter(l)),[T,g]=r.useState(v.filter(l)),[q,_]=r.useState(F.filter(l)),[$,P]=r.useState(!1),[Q,H]=r.useState(!1),[W,J]=r.useState(!1),[j,O]=r.useState(n||[]);r.useEffect(()=>{const e={institutes:a.filter(t=>!l(t)),blocks:i.filter(t=>!l(t)),rooms:v.filter(t=>!l(t)),assetCategories:R.filter(t=>!l(t)),assets:F.filter(t=>!l(t))};Object.entries(e).forEach(([t,o])=>{o.length>0&&console.warn(`Invalid ${t}:`,o)})},[a,i,v,R,F]),r.useEffect(()=>{u?(P(!0),fetch(`/reports/blocks?institute_id=${u}`).then(e=>e.json()).then(e=>{if(console.log("Fetched blocks:",e),Array.isArray(e)){const t=e.filter(l);t.length<e.length&&console.warn("Filtered out invalid blocks:",e.filter(o=>!l(o))),I(t)}else console.warn("Blocks response is not an array:",e),h.error("Invalid blocks data received"),I([])}).catch(e=>{console.error("Error fetching blocks:",e),h.error("Failed to fetch blocks"),I([])}).finally(()=>P(!1)),D(""),g([]),b("")):(I([]),g([]),b(""))},[u]),r.useEffect(()=>{f?(H(!0),fetch(`/reports/rooms?block_id=${f}`).then(e=>e.json()).then(e=>{if(console.log("Fetched rooms:",e),Array.isArray(e)){const t=e.filter(l);t.length<e.length&&console.warn("Filtered out invalid rooms:",e.filter(o=>!l(o))),g(t)}else console.warn("Rooms response is not an array:",e),h.error("Invalid rooms data received"),g([])}).catch(e=>{console.error("Error fetching rooms:",e),h.error("Failed to fetch rooms"),g([])}).finally(()=>H(!1)),b("")):(g([]),b(""))},[f]),r.useEffect(()=>{p?(J(!0),fetch(`/reports/assets/list?asset_category_id=${p}`).then(e=>e.json()).then(e=>{if(console.log("Fetched assets:",e),Array.isArray(e)){const t=e.filter(l);t.length<e.length&&console.warn("Filtered out invalid assets:",e.filter(o=>!l(o))),_(t)}else console.warn("Assets response is not an array:",e),h.error("Invalid assets data received"),_([])}).catch(e=>{console.error("Error fetching assets:",e),h.error("Failed to fetch assets"),_([])}).finally(()=>J(!1)),z("")):(_([]),z(""))},[p]);const de=async()=>{const e=new ye.Workbook,t=e.addWorksheet("Assets");t.columns=[{header:"Details",key:"details",width:30},{header:"Quantity",key:"qty",width:10},{header:"Institute",key:"institute",width:20},{header:"Room",key:"room",width:20},{header:"Asset",key:"asset",width:20}],j.data.forEach(m=>{var y,N,k;t.addRow({details:m.details,qty:m.current_qty,institute:((y=m.institute)==null?void 0:y.name)||"N/A",room:((N=m.room)==null?void 0:N.name)||"N/A",asset:((k=m.asset)==null?void 0:k.name)||"N/A"})});const o=await e.xlsx.writeBuffer(),d=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ne.saveAs(d,"Assets_Report.xlsx")},me=()=>{const e=new be;e.setFontSize(16),e.text("Assets Report",14,15);const t=["Details","Qty","Institute","Block","Room","Category","Asset"],o=j.data.map(d=>{var m,y,N,k,te;return[d.details,d.current_qty,((m=d.institute)==null?void 0:m.name)||"N/A",((y=d.block)==null?void 0:y.name)||"N/A",((N=d.room)==null?void 0:N.name)||"N/A",((k=d.assetCategory)==null?void 0:k.name)||"N/A",((te=d.asset)==null?void 0:te.name)||"N/A"]});e.autoTable({head:[t],body:o,startY:25,styles:{fontSize:10}}),e.save("Assets_Report.pdf")},he=r.useMemo(()=>ve.debounce(()=>{const e=new URLSearchParams({search:V||"",institute_id:u||"",block_id:f||"",room_id:B||"",asset_category_id:p||"",asset_id:L||""});fetch(`/reports/assets/institute-assets?${e.toString()}`).then(t=>t.json()).then(t=>{console.log("Fetched filtered institute assets:",t),O(t)}).catch(t=>{console.error("Error fetching filtered assets:",t),h.error("Failed to fetch filtered assets")})},300),[V,u,f,B,p,L]),U=r.useMemo(()=>a.filter(l),[a]),Y=r.useMemo(()=>M.filter(l),[M]),G=r.useMemo(()=>T.filter(l),[T]),K=r.useMemo(()=>R.filter(l),[R]),X=r.useMemo(()=>q.filter(l),[q]);return s.jsx(Se,{children:s.jsxs(pe,{breadcrumbs:ke,children:[s.jsx(fe,{title:"Assets Report"}),s.jsx("div",{className:"flex-1 p-2 md:p-2",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[s.jsx("div",{className:"w-full md:w-1/3",children:s.jsxs(oe,{children:[s.jsxs(le,{children:[s.jsx(ae,{className:"text-xl font-bold",children:"Filters"}),s.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your assets search"})]}),s.jsxs(ne,{className:"space-y-4",children:[s.jsxs(S,{value:u,onValueChange:e=>{ie(e)},children:[s.jsx(w,{children:s.jsx(A,{placeholder:"Select Institute"})}),s.jsxs(E,{children:[s.jsx(c,{value:"0",children:"All Institutes"}),U.length>0?U.map(e=>s.jsx(c,{value:e.id.toString(),children:e.name},e.id)):s.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]}),s.jsxs(S,{value:f,onValueChange:e=>{D(e)},disabled:$,children:[s.jsx(w,{children:s.jsx(A,{placeholder:"Select Block"})}),s.jsxs(E,{children:[s.jsx(c,{value:"0",children:"All Blocks"}),$?s.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"Loading blocks..."}):Y.length>0?Y.map(e=>(console.log("Rendering block SelectItem:",{id:e.id,value:e.id.toString(),name:e.name}),s.jsx(c,{value:e.id.toString(),children:e.name},e.id))):s.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No blocks available"})]})]}),s.jsxs(S,{value:B,onValueChange:e=>{b(e)},disabled:Q,children:[s.jsx(w,{children:s.jsx(A,{placeholder:"Select Room"})}),s.jsxs(E,{children:[s.jsx(c,{value:"0",children:"All Rooms"}),Q?s.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"Loading rooms..."}):G.length>0?G.map(e=>(console.log("Rendering room SelectItem:",{id:e.id,value:e.id.toString(),name:e.name}),s.jsx(c,{value:e.id.toString(),children:e.name},e.id))):s.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No rooms available"})]})]}),s.jsxs(S,{value:p,onValueChange:e=>{ce(e)},children:[s.jsx(w,{children:s.jsx(A,{placeholder:"Select Asset Category"})}),s.jsxs(E,{children:[s.jsx(c,{value:"0",children:"All Asset Categories"}),K.length>0?K.map(e=>(console.log("Rendering assetCategory SelectItem:",{id:e.id,value:e.id.toString(),name:e.name}),s.jsx(c,{value:e.id.toString(),children:e.name},e.id))):s.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No asset categories available"})]})]}),s.jsxs(S,{value:L,onValueChange:e=>{z(e)},disabled:W,children:[s.jsx(w,{children:s.jsx(A,{placeholder:"Select Asset"})}),s.jsxs(E,{children:[s.jsx(c,{value:"0",children:"All Assets"}),W?s.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"Loading assets..."}):X.length>0?X.map(e=>(console.log("Rendering asset SelectItem:",{id:e.id,value:e.id.toString(),name:e.name}),s.jsx(c,{value:e.id.toString(),children:e.name},e.id))):s.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No assets available"})]})]}),s.jsx(C,{onClick:he,className:"w-full",children:"Apply Filters"})]})]})}),s.jsx("div",{className:"w-full md:w-2/3",children:s.jsxs(oe,{children:[s.jsxs(le,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[s.jsx("div",{children:s.jsx(ae,{className:"text-2xl font-bold",children:"Assets Report"})}),s.jsx(C,{onClick:me,className:"w-full",children:"Export PDF"}),s.jsx(C,{onClick:de,className:"w-full",children:"Export Excel"})]}),s.jsx(ge,{}),s.jsxs(ne,{className:"pt-6 space-y-6",children:[s.jsxs("table",{className:"w-full border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[s.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset"}),s.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Quantity"}),s.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Room"}),s.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Description"})]})}),s.jsx("tbody",{children:((Z=j.data)==null?void 0:Z.length)===0?s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"border p-2 text-center text-sm text-gray-900 dark:text-gray-100",children:"No assets found."})}):(ee=j.data)==null?void 0:ee.map(e=>{var t,o;return s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[s.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(je,{className:"h-5 w-5 text-blue-600"}),s.jsx("div",{className:"space-y-1",children:s.jsx("div",{className:"font-medium",children:(t=e.asset)==null?void 0:t.name})})]})}),s.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:e.current_qty}),s.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:((o=e.room)==null?void 0:o.name)||"N/A"}),s.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:e.details||"N/A"})]},e.id)})})]}),((se=j.links)==null?void 0:se.length)>1&&s.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:j.links.map((e,t)=>s.jsx(C,{disabled:!e.url,variant:e.active?"default":"outline",size:"sm",onClick:()=>{e.url&&fetch(e.url).then(o=>o.json()).then(o=>{O(o)}).catch(o=>{console.error("Error:",o)})},className:e.active?"bg-blue-600 hover:bg-blue-700":"",children:s.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})},t))})]})]})})]})})]})})}export{$e as default};
