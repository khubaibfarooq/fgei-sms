var Je=Object.defineProperty;var Ke=(n,o,u)=>o in n?Je(n,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):n[o]=u;var xe=(n,o,u)=>Ke(n,typeof o!="symbol"?o+"":o,u);import{r as l,K as Ye,j as e,L as Qe,a as R}from"./app-drY0ifa1.js";import{A as Ze,E as pe,F as ue,P as he,c as fe}from"./app-layout-DnXuvvBU.js";import{B as c}from"./button-CYn5PWoH.js";import{C as y,a as z,b as es,c as w,d as ge}from"./card-CXkWBJ0p.js";import{I as ss}from"./input-DH06XpC5.js";import{S as je,a as Ne,b as be,c as ve,d as g}from"./select-n3VW7UFB.js";import{t as f,X as ts,D as ye,a as we,b as Ce,c as Se,d as _e,e as ke}from"./index-CGY5UVit.js";import{l as as}from"./lodash-BisEYiKk.js";import{E as rs,F as ls,a as ns,b as is}from"./jspdf.plugin.autotable-D-i4n2Gl.js";import{C as Pe}from"./combobox-B3xfBibV.js";import{T as os,a as ds,b as W,c as q}from"./tabs-2blmw2WS.js";import{B as P}from"./badge-B6bmZUj-.js";import cs from"./ApprovalModal-CI1ZdJ22.js";import ms from"./FundHeadSelectModal-DYA25xyp.js";import{I as Fe}from"./image-preview2-DojAXfRk.js";import{L as xs}from"./label-Dkz85CIw.js";import{C as ps,a as us}from"./circle-x-EbPhIxF0.js";import"./index-CaWpFlgf.js";import"./createLucideIcon-Byf3rwq1.js";import"./index-CO5_H05L.js";import"./index-BvjGUsA0.js";import"./index-Bf6nxSgG.js";import"./index-C3yVxpcF.js";import"./app-logo-icon-C9udVR47.js";import"./folder-root-BLTMXAO6.js";import"./grip-vertical-0Af7JnV3.js";import"./index-CyUYUMcw.js";import"./index-hYYhHKVC.js";import"./popover-D4Lbkcu7.js";import"./textarea-DDmKmXv7.js";const hs=[{title:"Reports",href:"/reports"},{title:"Projects",href:"/reports/projects"}],L=n=>{if(n==null)return"-";const o=typeof n=="string"?parseFloat(n):n;return isNaN(o)?"-":o>=1e6?`${(o/1e6).toFixed(2)} Mn`:o.toLocaleString()};class fs extends l.Component{constructor(){super(...arguments);xe(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(u){return{hasError:!0,error:u.message}}componentDidCatch(u,C){console.error("ErrorBoundary caught:",u,C),f.error("An error occurred. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(c,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const X=n=>{const o=n!=null&&typeof n.id=="number"&&n.id>0&&typeof n.name=="string"&&n.name.trim()!=="";return o||console.warn("Invalid item:",n),o};function Js({projects:n,institutes:o,regions:u,projectTypes:C,fundHeads:Ae,filters:S}){var me;const[G,gs]=l.useState(S.search||""),[j,I]=l.useState(S.institute_id||""),[M,Ee]=l.useState(S.project_type_id||""),[T,De]=l.useState(S.status||""),[h,F]=l.useState(n),[$,O]=l.useState(o||[]);l.useEffect(()=>{F(n)},[n]),l.useEffect(()=>{if(d){const s=h.data.find(t=>t.id===d.id);s&&_(s)}},[h]);const[H,Re]=l.useState(S.region_id||""),{auth:ze}=Ye().props,N=ze.user,J=s=>{var m,p;const t=(m=s.current_stage)==null?void 0:m.level,a=s.approval_status;if(!t)return!1;const r=(N.roles[0].name||"").toLowerCase(),i=t.toLowerCase(),x=((p=s.current_stage)==null?void 0:p.users_can_approve)??"";return!!(i==="regional"&&r==="region"&&a!=="approved"||i==="dte"&&(r==="dirhrm"||r==="directorate"||r==="sms_tech_approval")&&a!=="approved"&&x.includes(N.id))},[Le,U]=l.useState(!1),[Ie,K]=l.useState(null),[Me,V]=l.useState(!1),[Te,Y]=l.useState(null),[d,_]=l.useState(null),[Q,Z]=l.useState([]),[ee,se]=l.useState([]),[te,ae]=l.useState([]),[B,re]=l.useState(!1),[$e,A]=l.useState(!1),[k,Oe]=l.useState(null),[b,le]=l.useState(""),[ne,ie]=l.useState(!1),[He,E]=l.useState(!1),[v,oe]=l.useState(null),Ue=l.useMemo(()=>Array.isArray($)?$.filter(X):[],[$]),de=l.useMemo(()=>Array.isArray(u)?u.filter(X):[],[u]),Ve=l.useMemo(()=>Array.isArray(C)?C.filter(X):[],[C]);l.useEffect(()=>{d?(re(!0),(async()=>{try{const[t,a,r]=await Promise.all([R.get(`/projects/${d.id}/history`),R.get(`/projects/${d.id}/milestones`),R.get(`/projects/${d.id}/payments`)]);Z(t.data),se(a.data),ae(r.data.payments)}catch(t){console.error("Failed to fetch project details",t),f.error("Failed to load project details.")}finally{re(!1)}})()):(Z([]),se([]),ae([]))},[d]);const Be=async s=>{if(!s||s==="0"){O(o||[]),j&&I("");return}try{const t=new URLSearchParams({region_id:s}).toString(),a=await fetch(`/reports/getInstitutes?${t}`);if(!a.ok)throw new Error("Failed to fetch institutes");const r=await a.json();O(r),j&&!r.some(i=>i.id.toString()===j)&&I("")}catch(t){console.error("Error fetching institutes:",t),f.error("Failed to load institutes"),O([])}},We=s=>{Re(s),Be(s)},ce=s=>{Oe(s),le(parseFloat((s.completion_per||0).toString()).toString()),A(!0)},qe=async()=>{var t,a;if(!k)return;const s=parseFloat(b);if(isNaN(s)||s<0||s>100){f.error("Please enter a valid percentage (0-100)");return}ie(!0);try{const r=await R.post(`/projects/${k.id}/update-completion`,{completion_per:s});r.data.success?(f.success("Completion percentage updated successfully"),A(!1),D()):f.error(r.data.message||"Failed to update")}catch(r){f.error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update completion percentage")}finally{ie(!1)}},Xe=async()=>{const s=new rs.Workbook,t=s.addWorksheet("Projects");t.columns=[{header:"Name",key:"name",width:30},{header:"Cost",key:"cost",width:15},{header:"Status",key:"status",width:15},{header:"Project Type",key:"project_type",width:25},{header:"Institute",key:"institute",width:30},{header:"Region",key:"region",width:25}],h.data.forEach(i=>{var x,m,p;t.addRow({name:i.name,estimated_cost:i.estimated_cost,actual_cost:i.actual_cost,status:i.status,project_type:((x=i.projecttype)==null?void 0:x.name)||"N/A",institute:((m=i.institute)==null?void 0:m.name)||"N/A",region:((p=i.region)==null?void 0:p.name)||"N/A"})});const a=await s.xlsx.writeBuffer(),r=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ls.saveAs(r,"Projects_Report.xlsx")},Ge=()=>{const s=new ns;s.setFontSize(16),s.text("Projects Report",14,15);const t=["Name","Estimated Cost","Actual Cost","Status","Project Type","Institute","Region"],a=h.data.map(r=>{var i,x,m;return[r.name,r.estimated_cost,r.actual_cost,r.status,((i=r.projecttype)==null?void 0:i.name)||"N/A",((x=r.institute)==null?void 0:x.name)||"N/A",((m=r.region)==null?void 0:m.name)||"N/A"]});is(s,{head:[t],body:a,startY:25,styles:{fontSize:9,cellPadding:2},headStyles:{fillColor:[66,139,202],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]}}),s.save("Projects_Report.pdf")},D=l.useMemo(()=>as.debounce(()=>{const s=new URLSearchParams({search:G.trim(),institute_id:j||"",region_id:H||"",project_type_id:M||"",status:T||""});fetch(`/reports/projects/getprojects?${s.toString()}`).then(t=>t.json()).then(t=>{console.log("Filtered projects:",t),F(t)}).catch(t=>{console.error("Fetch error:",t),f.error("Failed to load projects")})},300),[G,j,H,M,T]);return e.jsx(fs,{children:e.jsxs(Ze,{breadcrumbs:hs,children:[e.jsx(Qe,{title:"Projects Report"}),e.jsxs("div",{className:"flex flex-col lg:flex-row h-[calc(100vh-65px)] overflow-hidden",children:[e.jsx("div",{className:`flex-1 p-2 md:p-4 overflow-y-auto ${d?"lg:w-2/3":"w-full"}`,children:e.jsxs("div",{className:"flex flex-col gap-3 h-full",children:[e.jsxs(y,{className:"shrink-0",children:[e.jsx(z,{className:"py-3",children:e.jsx(es,{className:"text-xl font-bold",children:"Filters"})}),e.jsxs(w,{className:"py-2 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[de.length>0&&e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Pe,{entity:"region",value:H,onChange:s=>We(s),options:de.map(s=>({id:s.id.toString(),name:s.name.split(" ").pop()||s.name})),includeAllOption:!0})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Pe,{entity:"institute",value:j,onChange:I,options:Ue.map(s=>({id:s.id.toString(),name:s.name})),includeAllOption:!1,placeholder:"Select Institute"})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsxs(je,{value:M,onValueChange:s=>Ee(s),children:[e.jsx(Ne,{children:e.jsx(be,{placeholder:"Select Project Type"})}),e.jsxs(ve,{children:[e.jsx(g,{value:"0",children:"All Project Types"}),Ve.map(s=>e.jsx(g,{value:s.id.toString(),children:s.name},s.id))]})]})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsxs(je,{value:T,onValueChange:s=>De(s),children:[e.jsx(Ne,{children:e.jsx(be,{placeholder:"Select Status"})}),e.jsxs(ve,{children:[e.jsx(g,{value:"all",children:"All Status"}),e.jsx(g,{value:"planned",children:"Planned"}),e.jsx(g,{value:"inprogress",children:"In Progress"}),e.jsx(g,{value:"completed",children:"Completed"}),e.jsx(g,{value:"waiting",children:"Waiting"})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[e.jsx(c,{onClick:D,size:"sm",children:"Apply Filters"}),e.jsx(c,{onClick:Ge,size:"sm",variant:"outline",children:"PDF"}),e.jsx(c,{onClick:Xe,size:"sm",variant:"outline",children:"Excel"})]})]})]}),e.jsxs(y,{className:"flex-1 min-h-0 flex-col hidden md:flex",children:[e.jsx(w,{className:"p-0 flex-1 overflow-auto",children:e.jsxs("table",{className:"w-full border-collapse text-sm min-w-[900px]",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-primary text-white text-center",children:[e.jsx("th",{className:"border p-2 font-medium",children:"Institute"}),e.jsx("th",{className:"border p-2 font-medium hidden lg:table-cell",children:"Type"}),e.jsx("th",{className:"border p-2 font-medium",children:"Project"}),e.jsx("th",{className:"border p-2 font-medium",children:"Est. Cost"}),e.jsx("th",{className:"border p-2 font-medium",children:"Act. Cost"}),e.jsx("th",{className:"border p-2 font-medium hidden xl:table-cell",children:"Fund Head"}),e.jsx("th",{className:"border p-2 font-medium hidden lg:table-cell",children:"Stage"}),e.jsx("th",{className:"border p-2 font-medium",children:"Status"}),e.jsx("th",{className:"border p-2 font-medium hidden xl:table-cell",children:"Comments"}),e.jsx("th",{className:"border p-2 font-medium",children:"Action"})]})}),e.jsx("tbody",{children:h.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center p-4 text-muted-foreground",children:"No projects found."})}):h.data.map(s=>{var t,a,r,i,x,m;return e.jsxs("tr",{className:`hover:bg-primary/10 dark:hover:bg-gray-700 cursor-pointer transition-colors ${(d==null?void 0:d.id)===s.id?"bg-primary/5 dark:bg-gray-700 border-l-4 border-l-primary":""}`,onClick:()=>_(s),children:[e.jsx("td",{className:"border p-2",children:((t=s.institute)==null?void 0:t.name)||"-"}),e.jsx("td",{className:"border p-2 text-center hidden lg:table-cell",children:((a=s.projecttype)==null?void 0:a.name)||"-"}),e.jsx("td",{className:"border p-2 font-medium",children:s.name}),e.jsx("td",{className:"border p-2 text-right whitespace-nowrap",children:L(s.estimated_cost)}),e.jsx("td",{className:"border p-2 text-right whitespace-nowrap",children:L(s.actual_cost)}),e.jsx("td",{className:"border p-2 text-center hidden xl:table-cell",children:(r=s.fundhead)==null?void 0:r.name}),e.jsx("td",{className:"border p-2 text-center hidden lg:table-cell",children:((i=s.current_stage)==null?void 0:i.stage_name)||"Request Initiated"}),e.jsx("td",{className:"border p-2 text-center",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("span",{className:"text-xs",children:"App:"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.approval_status==="completed"?"bg-green-100 text-green-800":s.approval_status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.approval_status.charAt(0).toUpperCase()+s.approval_status.slice(1)})]}),s.approval_status==="waiting"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:((x=s.current_stage)==null?void 0:x.level)||"Regional Office"}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("span",{className:"text-xs",children:"Proj:"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),e.jsxs("span",{className:"text-xs",children:[s.completion_per?parseFloat(s.completion_per.toString()):"-","%"]})]})}),e.jsx("td",{className:"border p-2 text-center hidden xl:table-cell",children:s.final_comments||"-"}),e.jsxs("td",{className:"border p-2 text-center",onClick:p=>p.stopPropagation(),children:[s.description&&e.jsx(c,{variant:"ghost",size:"sm",className:"text-blue-600 hover:text-blue-700",title:"View Description",onClick:()=>{oe(s),E(!0)},children:e.jsx(pe,{className:"h-4 w-4"})}),s.pdf&&e.jsx("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center text-blue-600 hover:text-blue-700",title:"View PDF",children:e.jsx(ue,{className:"h-5 w-5"})}),J(s)&&e.jsx(c,{variant:"ghost",size:"icon",title:"View/Approve",className:"text-blue-600 hover:text-blue-700",onClick:p=>{p.stopPropagation(),K(s),U(!0)},children:e.jsx(ge,{className:"h-4 w-4"})}),((m=N.roles[0])==null?void 0:m.name.toLowerCase())==="region"&&!s.fund_head_id&&e.jsx(c,{variant:"ghost",size:"sm",title:"Select Fund Head",className:"text-orange-600 hover:text-orange-700 font-bold",onClick:p=>{p.stopPropagation(),Y(s),V(!0)},children:"Select Head"}),N.type==="Regional Office"&&s.status==="inprogress"&&e.jsx(c,{variant:"ghost",size:"icon",title:`Update Completion (${s.completion_per||0}%)`,className:"text-purple-600 hover:text-purple-700",onClick:p=>{p.stopPropagation(),ce(s)},children:e.jsx(he,{className:"h-4 w-4"})})]})]},s.id)})})]})}),h.links.length>1&&e.jsx("div",{className:"p-4 border-t flex justify-center flex-wrap gap-2 shrink-0",children:h.links.map((s,t)=>e.jsx(c,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",onClick:()=>{s.url&&fetch(s.url).then(a=>a.json()).then(a=>{F(a)}).catch(a=>{console.error("Error:",a)})},children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t))})]}),e.jsxs(y,{className:"flex-1 min-h-0 flex flex-col md:hidden",children:[e.jsx(w,{className:"p-2 flex-1 overflow-auto",children:h.data.length===0?e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:"No projects found."}):e.jsx("div",{className:"space-y-3",children:h.data.map(s=>{var t,a,r,i,x;return e.jsxs("div",{className:`p-3 rounded-lg border bg-card shadow-sm cursor-pointer transition-all hover:shadow-md ${(d==null?void 0:d.id)===s.id?"ring-2 ring-primary":""}`,onClick:()=>_(s),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:((t=s.institute)==null?void 0:t.name)||"-"})]}),e.jsxs("div",{className:"flex gap-1",onClick:m=>m.stopPropagation(),children:[s.description&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7 text-blue-600",onClick:()=>{oe(s),E(!0)},children:e.jsx(pe,{className:"h-4 w-4"})}),s.pdf&&e.jsx("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center h-7 w-7 text-blue-600 hover:text-blue-700",children:e.jsx(ue,{className:"h-4 w-4"})}),J(s)&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7 text-blue-600",onClick:()=>{K(s),U(!0)},children:e.jsx(ge,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-4 text-xs mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Est: "}),e.jsx("span",{className:"font-medium",children:L(s.estimated_cost)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Act: "}),e.jsx("span",{className:"font-medium",children:L(s.actual_cost)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.approval_status==="completed"?"bg-green-100 text-green-800":s.approval_status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:["App: ",s.approval_status.charAt(0).toUpperCase()+s.approval_status.slice(1)]}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:["Proj: ",s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.completion_per?parseFloat(s.completion_per.toString()):"-","%"]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t flex flex-wrap gap-2 text-xs text-muted-foreground",children:[((a=s.projecttype)==null?void 0:a.name)&&e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:s.projecttype.name}),((r=s.fundhead)==null?void 0:r.name)&&e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:s.fundhead.name}),e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:((i=s.current_stage)==null?void 0:i.stage_name)||"Request Initiated"})]}),e.jsxs("div",{className:"mt-2 flex gap-2",onClick:m=>m.stopPropagation(),children:[((x=N.roles[0])==null?void 0:x.name.toLowerCase())==="region"&&!s.fund_head_id&&e.jsx(c,{variant:"outline",size:"sm",className:"text-xs h-7 text-orange-600 border-orange-300",onClick:()=>{Y(s),V(!0)},children:"Select Head"}),N.type==="Regional Office"&&s.status==="inprogress"&&e.jsxs(c,{variant:"outline",size:"sm",className:"text-xs h-7 text-purple-600 border-purple-300",onClick:()=>ce(s),children:[e.jsx(he,{className:"h-3 w-3 mr-1"})," Update"]})]})]},s.id)})})}),h.links.length>1&&e.jsx("div",{className:"p-3 border-t flex justify-center flex-wrap gap-1 shrink-0",children:h.links.map((s,t)=>e.jsx(c,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",className:"h-8 text-xs px-2",onClick:()=>{s.url&&fetch(s.url).then(a=>a.json()).then(a=>{F(a)}).catch(a=>{console.error("Error:",a)})},children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t))})]})]})}),d&&e.jsxs("div",{className:"w-2/3  lg:w-1/3 border-l bg-background p-3 sm:p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col transition-all duration-300 ease-in-out z-20 fixed lg:relative inset-0 lg:inset-auto h-full lg:h-auto rounded-none lg:rounded-l-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:d.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(me=d.institute)==null?void 0:me.name})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_(null),children:e.jsx(ts,{className:"h-5 w-5"})})]}),e.jsxs(os,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs(ds,{className:"grid w-full grid-cols-3",children:[e.jsx(W,{value:"approvals",children:"Approvals"}),e.jsx(W,{value:"milestones",children:"Milestones"}),e.jsx(W,{value:"payments",children:"Payments"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(q,{value:"approvals",className:"space-y-4 m-0 h-full",children:B?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading history..."}):Q.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No approval history found."}):e.jsx("div",{className:"space-y-4",children:Q.map(s=>{var t,a;return e.jsxs(y,{className:"overflow-hidden",children:[e.jsx(z,{className:"p-3 bg-muted/50 pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"font-semibold text-sm",children:((t=s.stage)==null?void 0:t.stage_name)||"Stage"}),s.status==="approved"?e.jsxs(P,{variant:"outline",className:"border-green-500 text-green-600 bg-green-50 gap-1",children:[e.jsx(ps,{className:"w-3 h-3"})," Approved"]}):s.status==="rejected"?e.jsxs(P,{variant:"outline",className:"border-red-500 text-red-600 bg-red-50 gap-1",children:[e.jsx(us,{className:"w-3 h-3"})," Rejected"]}):e.jsxs(P,{variant:"outline",className:"border-yellow-500 text-yellow-600 bg-yellow-50 gap-1",children:[e.jsx(fe,{className:"w-3 h-3"})," Pending"]})]})}),e.jsxs(w,{className:"p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mb-2",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),s.action_date?new Date(s.action_date).toLocaleString():""]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-medium text-xs",children:"Approver: "}),(a=s.approver)==null?void 0:a.name]}),s.comments&&e.jsxs("div",{className:"bg-muted/30 p-2 rounded text-xs italic border",children:['"',s.comments,'"']}),s.pdf&&e.jsx("a",{href:`/${s.pdf}`,target:"_blank",className:"mt-1 text-blue-600 underline text-xs flex items-center gap-1",children:"View PDF"}),s.img&&e.jsx("div",{className:"mt-2",children:e.jsx(Fe,{dataImg:s.img,size:"h-20",className:"rounded border"})})]})]},s.id)})})}),e.jsx(q,{value:"milestones",className:"space-y-4 m-0 h-full",children:B?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading milestones..."}):ee.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No milestones found."}):e.jsx("div",{className:"space-y-4",children:ee.map(s=>e.jsxs(y,{children:[e.jsx(z,{className:"p-3 pb-1",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"font-semibold text-sm",children:s.name}),e.jsx(P,{variant:s.status==="completed"?"default":s.status==="inprogress"?"secondary":"outline",className:"capitalize text-xs",children:s.status})]})}),e.jsxs(w,{className:"p-3 text-sm space-y-2",children:[s.img&&e.jsx("div",{className:"mb-2",children:e.jsx(Fe,{dataImg:s.img,size:"h-32",className:"w-full object-cover rounded-md"})}),s.pdf&&e.jsx("a",{href:`/${s.pdf}`,target:"_blank",className:"mb-2 text-blue-600 underline text-xs flex items-center gap-1",children:"View Document (PDF)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Due in: "}),s.days," days"]}),s.completed_date&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Completed: "}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:new Date(s.completed_date).toLocaleDateString()})]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:s.description})]})]},s.id))})}),e.jsx(q,{value:"payments",className:"space-y-4 m-0 h-full",children:B?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading payments..."}):te.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No payments found."}):e.jsx("div",{className:"space-y-4",children:te.map(s=>{var t;return e.jsxs(y,{children:[e.jsx(z,{className:"p-3 pb-1",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"font-semibold text-sm",children:["Amount: ",s.amount]}),e.jsx(P,{variant:"outline",className:`capitalize text-xs ${s.status==="Approved"?"border-green-500 text-green-600 bg-green-50":s.status==="Rejected"?"border-red-500 text-red-600 bg-red-50":"border-yellow-500 text-yellow-600 bg-yellow-50"}`,children:s.status})]})}),e.jsxs(w,{className:"p-3 text-sm space-y-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:((t=s.fund_head)==null?void 0:t.name)||"General Fund"}),e.jsx("div",{className:"text-xs",children:new Date(s.added_date).toLocaleDateString()}),s.description&&e.jsxs("p",{className:"text-muted-foreground text-xs italic",children:['"',s.description,'"']})]})]},s.id)})})})]})]})]})]}),e.jsx(cs,{isOpen:Le,onClose:()=>U(!1),project:Ie,onSuccess:()=>{D()}}),e.jsx(ms,{isOpen:Me,onClose:()=>V(!1),project:Te,fundHeads:Ae,onSuccess:()=>{D()}}),e.jsx(ye,{open:$e,onOpenChange:A,children:e.jsxs(we,{className:"sm:max-w-[400px]",children:[e.jsxs(Ce,{children:[e.jsx(Se,{children:"Update Completion Percentage"}),e.jsxs(_e,{children:["Update the completion percentage for ",e.jsx("strong",{children:k==null?void 0:k.name}),"."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(xs,{htmlFor:"completion_per",className:"text-right",children:"Percentage"}),e.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[e.jsx(ss,{id:"completion_per",type:"number",min:"0",max:"100",step:"1",placeholder:"0-100",className:"flex-1",value:b,onChange:s=>le(s.target.value)}),e.jsx("span",{className:"text-muted-foreground",children:"%"})]})]}),(parseFloat(b)<0||parseFloat(b)>100)&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:"Percentage must be between 0 and 100"})]}),e.jsxs(ke,{children:[e.jsx(c,{variant:"secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsx(c,{onClick:qe,disabled:ne||parseFloat(b)<0||parseFloat(b)>100,children:ne?"Updating...":"Save"})]})]})}),e.jsx(ye,{open:He,onOpenChange:E,children:e.jsxs(we,{className:"sm:max-w-[500px]",children:[e.jsxs(Ce,{children:[e.jsx(Se,{children:"Project Description"}),e.jsx(_e,{children:v==null?void 0:v.name})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"bg-muted/30 p-4 rounded-lg border text-sm leading-relaxed whitespace-pre-wrap",children:(v==null?void 0:v.description)||"No description available."})}),e.jsx(ke,{children:e.jsx(c,{onClick:()=>E(!1),children:"Close"})})]})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/20 lg:hidden z-10",onClick:()=>_(null)})]})})}export{Js as default};
