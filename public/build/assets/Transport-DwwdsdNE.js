var D=Object.defineProperty;var O=(a,n,o)=>n in a?D(a,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[n]=o;var _=(a,n,o)=>O(a,typeof n!="symbol"?n+"":n,o);import{r as i,j as t,L as $}from"./app-DVOAiRIL.js";import{A as H}from"./app-layout-D2Fj6hbW.js";import{B as g}from"./button-KzePY_tZ.js";import{C as U,a as W,b as J,c as Y}from"./card-DBRTn0aO.js";import{S as q,a as G,b as K,c as Q,d as R}from"./select-D0ssHkA0.js";import{t as N}from"./index-BcYe97bt.js";import{l as X}from"./lodash-g7Co_Dmk.js";import{E as Z,F as ee,a as te,b as re}from"./jspdf.plugin.autotable-D0p6n1hk.js";import{C as I}from"./combobox-BUeqUvnp.js";import"./index-C9Igw1JK.js";import"./createLucideIcon--GE2a8Cc.js";import"./index-DSMlm7_1.js";import"./index-C2CBZj9-.js";import"./index-dmCZSdq7.js";import"./index-CBDouGYd.js";import"./input-DhTxEEj2.js";import"./app-logo-icon-maZ5uBc-.js";import"./circle-x-BxQ9Uurt.js";import"./folder-root-C2nxVQUo.js";import"./grip-vertical-BX3Pomhe.js";import"./index-lNCG9698.js";import"./index-DW9Tad9w.js";import"./popover-CHl0kUa2.js";const se=[{title:"Reports",href:"/reports"},{title:"Transports",href:"/reports/transports"}];class oe extends i.Component{constructor(){super(...arguments);_(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(o){return{hasError:!0,error:o.message}}componentDidCatch(o,c){console.error("ErrorBoundary caught:",o,c),N.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?t.jsxs("div",{className:"p-4",children:[t.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),t.jsx(g,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const p=a=>{const n=a!=null&&typeof a.id=="number"&&a.id>0&&typeof a.name=="string"&&a.name.trim()!=="";return n||console.warn("Invalid item detected:",a),n};function _e({transports:a,institutes:n,vehicleTypes:o,regions:c,filters:y}){const[v,ae]=i.useState(y.search||""),[u,j]=i.useState(y.institute_id||""),[b,S]=i.useState(y.vehicle_type_id||""),[w,F]=i.useState(y.region_id||""),[h,A]=i.useState(a),[m,T]=i.useState(n||[]),V=i.useMemo(()=>Array.isArray(m)?m.filter(p):(console.warn("filteredInstitutes is not an array or is null:",m),[]),[m]),E=i.useMemo(()=>Array.isArray(o)?o.filter(p):(console.warn("vehicleTypes is not an array or is null:",o),[]),[o]),k=i.useMemo(()=>Array.isArray(c)?c.filter(p):(console.warn("regions is not an array or is null:",c),[]),[c]);i.useEffect(()=>{const e={institutes:Array.isArray(m)?m.filter(r=>!p(r)):[],vehicleTypes:Array.isArray(o)?o.filter(r=>!p(r)):[],regions:Array.isArray(c)?c.filter(r=>!p(r)):[]};Object.entries(e).forEach(([r,s])=>{s.length>0&&console.warn(`Invalid ${r}:`,s)})},[m,o,c]);const z=async e=>{try{const r=new URLSearchParams({region_id:e||""}).toString(),s=await fetch(`/reports/getInstitutes?${r}`);if(!s.ok)throw new Error("Failed to fetch institutes");const l=await s.json();console.log("Fetched institutes:",l),T(l),u&&e!=="0"&&!l.some(d=>d.id.toString()===u)&&j("")}catch(r){console.error("Error fetching institutes:",r),N.error("Failed to load institutes"),T([])}},B=e=>{F(e),j(""),S(""),z(e)},L=i.useMemo(()=>X.debounce(()=>{const e=new URLSearchParams({search:v||"",institute_id:u||"",vehicle_type_id:b||"",region_id:w||""});fetch(`/reports/transports/getTransports?${e.toString()}`).then(r=>r.json()).then(r=>{console.log("Fetched filtered Transports:",r),A(r)}).catch(r=>{console.error("Error fetching filtered Transports:",r),N.error("Failed to fetch filtered Transports")})},300),[v,u,b,w]),M=async()=>{const e=new Z.Workbook,r=e.addWorksheet("Transports");r.columns=[{header:"VehicleNo",key:"vehicle_no",width:30},{header:"Type",key:"vehicleType",width:10},{header:"Institute",key:"institute",width:20},{header:"Region",key:"region",width:20}],h.data.forEach(d=>{var x,f,C;r.addRow({vehicle_no:d.vehicle_no,vehicleType:((x=d.vehicle_type)==null?void 0:x.name)||"N/A",institute:((f=d.institute)==null?void 0:f.name)||"N/A",region:((C=d.region)==null?void 0:C.name)||"N/A"})});const s=await e.xlsx.writeBuffer(),l=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ee.saveAs(l,"Transports_Report.xlsx")},P=()=>{const e=new te;e.setFontSize(16),e.text("Transports Report",14,15);const r=["VehicleNo","VehicleType","Institute","Region"],s=h.data.map(l=>{var d,x,f;return[l.vehicle_no,((d=l.vehicle_type)==null?void 0:d.name)||"N/A",((x=l.institute)==null?void 0:x.name)||"N/A",((f=l.region)==null?void 0:f.name)||"N/A"]});re(e,{head:[r],body:s,startY:25,styles:{fontSize:10}}),e.save("Transport_Report.pdf")};return t.jsx(oe,{children:t.jsxs(H,{breadcrumbs:se,children:[t.jsx($,{title:"Transports Report"}),t.jsx("div",{className:"flex-1 p-2 md:p-2",children:t.jsxs(U,{children:[t.jsxs(W,{children:[t.jsx(J,{className:"text-xl font-bold",children:"Filters"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your Transport search"})]}),t.jsxs(Y,{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-row gap-2",children:[k.length>0&&t.jsx(I,{entity:"region",value:w,onChange:e=>B(e),options:k.map(e=>({id:e.id.toString(),name:e.name.split(" ").pop()||e.name})),includeAllOption:!0}),t.jsx(I,{entity:"institute",value:u,onChange:j,options:V.map(e=>({id:e.id.toString(),name:e.name})),includeAllOption:!1,placeholder:"Select Institute"}),t.jsxs(q,{value:b,onValueChange:e=>S(e),children:[t.jsx(G,{children:t.jsx(K,{placeholder:"Select Vehicle Type"})}),t.jsxs(Q,{children:[t.jsx(R,{value:"0",children:"All Vehicle Types"}),E.length>0?E.map(e=>t.jsx(R,{value:e.id.toString(),children:e.name},e.id)):t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No vehicle types available"})]})]}),t.jsx(g,{onClick:L,className:"w-full",children:"Apply Filters"}),t.jsx(g,{onClick:P,className:"w-full md:w-auto",children:"Export PDF"}),t.jsx(g,{onClick:M,className:"w-full md:w-auto",children:"Export Excel"})]}),t.jsxs("table",{className:"w-full border-collapse border-1 rounded-md overflow-hidden shadow-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Vehicle No"}),t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Type"}),t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Institute"})]})}),t.jsx("tbody",{children:h.data.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:3,className:"text-muted-foreground text-center p-4",children:"No Transports found."})}):h.data.map(e=>{var r,s;return t.jsxs("tr",{className:"hover:bg-primary/10 dark:hover:bg-gray-700 text-center",children:[t.jsx("td",{className:"border p-2 text-sm md:text-md lg:text-lg border-r-1 font-bold text-gray-900 dark:text-gray-100",children:e.vehicle_no}),t.jsx("td",{className:"border p-2 text-sm md:text-md lg:text-lg  text-gray-900 dark:text-gray-100",children:((r=e.vehicle_type)==null?void 0:r.name)||"N/A"}),t.jsx("td",{className:"border p-2 text-sm md:text-md lg:text-lg  text-gray-900 dark:text-gray-100",children:((s=e.institute)==null?void 0:s.name)||"N/A"})]},e.id)})})]}),h.links.length>1&&t.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:h.links.map((e,r)=>t.jsx(g,{disabled:!e.url,variant:e.active?"default":"outline",size:"sm",onClick:()=>{e.url&&fetch(e.url).then(s=>s.json()).then(s=>{A(s)}).catch(s=>{console.error("Error:",s)})},className:e.active?"bg-blue-600 hover:bg-blue-700":"",children:t.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})},r))})]})]})})]})})}export{_e as default};
