import{r as g,j as e,L as w,S as o,R as L}from"./app-BkIYF0B_.js";import{A,S as D}from"./app-layout-B8yZ-LC9.js";import{C as E,a as T,b as I,c as R}from"./card-CojAARqZ.js";import{B as i}from"./button-FpQlVGsK.js";import{B as V}from"./badge-B-tbVHHS.js";import{S as k,a as z,b as B,c as P,d as j}from"./select-CJoYNvoF.js";import{I as m}from"./input-CCfghYXo.js";import{L as c}from"./label-e1l0PEdY.js";import{X as U}from"./index-DcBKgsN-.js";import{C as F,a as O}from"./index-B0ZYHbNm.js";import"./index-BKlDaJyT.js";import"./createLucideIcon-CBPUJ6Fa.js";import"./index-C_6opvjc.js";import"./index-DtEHKdL_.js";import"./index-s94pc9Ud.js";import"./app-logo-icon-C0uA72ug.js";import"./circle-x-e6sBlHxe.js";import"./folder-root-D7P9g72l.js";import"./grip-vertical-BUM2KCUv.js";import"./clsx-B-dksMZM.js";import"./index-Oo5f47Fr.js";import"./index-C97SbZEo.js";const H=[{title:"Audit Log",href:"/audit-logs"}];function me({logs:d,tables:f,filters:l,users_lookup:b,fund_heads_lookup:N}){const[x,v]=g.useState([]),[r,p]=g.useState({table:l.table||"",record_id:l.record_id||"",date_from:l.date_from||"",date_to:l.date_to||""}),_=s=>{v(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},n=(s,t)=>{p(a=>({...a,[s]:t}))},h=()=>{o.get("/audit-logs",r,{preserveState:!0,preserveScroll:!0})},y=()=>{const s={table:"",record_id:"",date_from:"",date_to:""};p(s),o.get("/audit-logs",s,{preserveState:!0,preserveScroll:!0})},S=s=>{switch(s){case"INSERT":return"bg-green-100 text-green-800 hover:bg-green-200 border-green-200";case"UPDATE":return"bg-blue-100 text-blue-800 hover:bg-blue-200 border-blue-200";case"DELETE":return"bg-red-100 text-red-800 hover:bg-red-200 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},C=(s,t)=>{if(t==null)return e.jsx("span",{className:"text-gray-400 italic",children:"null"});if(["changed_by","added_by","approver_id","user_id"].includes(s)&&typeof t=="number"){const a=b[t];return a?e.jsxs("span",{children:[t," ",e.jsxs("span",{className:"text-blue-600 font-medium",children:["(",a,")"]})]}):t}if(s==="fund_head_id"&&typeof t=="number"){const a=N[t];return a?e.jsxs("span",{children:[t," ",e.jsxs("span",{className:"text-indigo-600 font-medium",children:["(",a,")"]})]}):t}if(["created_at","updated_at","action_date","deadline","completed_date"].includes(s)&&typeof t=="string")try{return new Date(t).toLocaleString()}catch{return t}return typeof t=="boolean"?t?e.jsx("span",{className:"text-green-600",children:"true"}):e.jsx("span",{className:"text-red-600",children:"false"}):typeof t=="object"?JSON.stringify(t):t},u=({values:s})=>e.jsx("div",{className:"bg-background border rounded px-3 py-2 text-xs overflow-auto max-h-60 grid grid-cols-[auto_1fr] gap-x-4 gap-y-1",children:Object.entries(s).map(([t,a])=>e.jsxs(L.Fragment,{children:[e.jsxs("div",{className:"font-medium text-muted-foreground",children:[t,":"]}),e.jsx("div",{className:"break-all",children:C(t,a)})]},t))});return e.jsxs(A,{breadcrumbs:H,children:[e.jsx(w,{title:"Audit Log"}),e.jsx("div",{className:"flex-1 p-4 md:p-6",children:e.jsxs(E,{children:[e.jsxs(T,{className:"pb-3",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("div",{children:[e.jsx(I,{className:"text-2xl font-bold",children:"Audit Log"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"System-wide change history tracked by database triggers"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mt-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"Table Name"}),e.jsxs(k,{value:r.table,onValueChange:s=>n("table",s==="all"?"":s),children:[e.jsx(z,{className:"h-8",children:e.jsx(B,{placeholder:"All Tables"})}),e.jsxs(P,{children:[e.jsx(j,{value:"all",children:"All Tables"}),f.map(s=>e.jsx(j,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"Record ID"}),e.jsx(m,{placeholder:"ID",type:"number",className:"h-8",value:r.record_id,onChange:s=>n("record_id",s.target.value),onKeyDown:s=>s.key==="Enter"&&h()})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"From Date"}),e.jsx(m,{type:"date",className:"h-8",value:r.date_from,onChange:s=>n("date_from",s.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"To Date"}),e.jsx(m,{type:"date",className:"h-8",value:r.date_to,onChange:s=>n("date_to",s.target.value)})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(i,{size:"sm",className:"h-8 flex-1",onClick:h,children:"Search"}),e.jsx(i,{size:"sm",variant:"outline",className:"h-8 px-2",onClick:y,title:"Reset Filters",children:e.jsx(U,{className:"h-4 w-4"})})]})]})]}),e.jsx(D,{}),e.jsxs(R,{className:"pt-6 space-y-4",children:[d.data.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No audit logs found matching your criteria."}):d.data.map(s=>{var t;return e.jsxs("div",{className:"border rounded-md bg-card hover:bg-muted/30 transition overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between cursor-pointer",onClick:()=>_(s.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{variant:"outline",className:`${S(s.action)}`,children:s.action}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[s.table_name.toUpperCase()," #",s.record_id]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",((t=s.user)==null?void 0:t.name)??"System/Unknown"," â€¢ ",new Date(s.changed_at).toLocaleString()]})]})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:x.includes(s.id)?e.jsx(F,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})})]}),x.includes(s.id)&&e.jsx("div",{className:"bg-muted/50 px-4 py-3 text-sm border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.old_values&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-red-600",children:"Old Values"}),e.jsx(u,{values:s.old_values})]}),s.new_values&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-green-600",children:"New Values"}),e.jsx(u,{values:s.new_values})]})]})})]},s.id)}),d.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:d.links.map((s,t)=>e.jsx(i,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",onClick:()=>o.visit(s.url||"",{preserveScroll:!0,preserveState:!0,only:["logs"]}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t))})]})]})})]})}export{me as default};
