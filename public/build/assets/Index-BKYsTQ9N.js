import{r,j as e,L as Be,$ as me,S as N,a as f}from"./app-Dmsca3ga.js";import{A as Ve,e as xe,S as Ke,f as Xe,T as Ge,c as ue}from"./app-layout-C2xmX1Hb.js";import{B as o}from"./button-Bj6BrUH6.js";import{C as P,a as D,b as Ye,c as F,d as Je}from"./card-xvL8uskR.js";import{I as p}from"./input-BdAOZbtJ.js";import{A as ge,a as Qe,b as pe,c as he,d as je,e as fe,f as ve,g as Ne,h as ye}from"./alert-dialog-B3f9XUFV.js";import{X as Ze,D as H,a as U,b as W,c as B,d as V,e as K,t as c}from"./index-D6UOAD5w.js";import{T as et,a as tt,b as X,c as G}from"./tabs-DOFvAhYf.js";import{B as y}from"./badge-3ECQLlNQ.js";import{L as g}from"./label-jHN8ErKr.js";import{T as st}from"./textarea-Bh_mJt4v.js";import at from"./ApprovalModal-DxIh5DWE.js";import{I as be}from"./image-preview2-B5BJuRH9.js";import{C as lt,a as rt}from"./circle-x-DVsUFmrb.js";import"./index-Zg5VAYB9.js";import"./createLucideIcon-DbbURgfX.js";import"./index-zWcryNbA.js";import"./index-CyxareTc.js";import"./index-Ba5aNK9e.js";import"./index-C2LZNCwO.js";import"./app-logo-icon-BrPrkrko.js";import"./folder-root-DCKUxTuK.js";import"./grip-vertical-lBHA5wj6.js";const nt=[{title:"Projects",href:"/projects"}];function Dt({projects:b,filters:w,permissions:M}){var oe;const[T,we]=r.useState(w.search||""),[Ce,_e]=r.useState(w.status||""),[a,$]=r.useState(null),[Y,J]=r.useState([]),[Q,L]=r.useState([]),[x,R]=r.useState([]),[q,Z]=r.useState(!1),[Se,ee]=r.useState(!1),[ke,Ae]=r.useState(null),[Pe,z]=r.useState(!1),[u,De]=r.useState(null),[te,E]=r.useState(!1),[C,se]=r.useState({actual_cost:""}),[Fe,_]=r.useState(!1),[Me,S]=r.useState(!1),[m,I]=r.useState({stage_name:"",amount:""}),[ae,le]=r.useState(!1),[j,Te]=r.useState(0),$e=t=>{var s,n;return((n=(s=t.current_stage)==null?void 0:s.level)==null?void 0:n.toLowerCase())==="institutional"&&t.status!=="completed"},[O,k]=r.useState(null),[l,h]=r.useState({name:"",description:"",days:0,status:"",completed_date:"",img:null,pdf:null}),[re,ne]=r.useState(!1),Le=t=>{k(t),h({name:t.name,description:t.description||"",days:t.days||0,status:t.status,completed_date:t.completed_date?t.completed_date.split("T")[0]:"",img:null,pdf:null})},Re=async()=>{if(!O)return;ne(!0);const t=new FormData;t.append("_method","PUT"),t.append("name",l.name),t.append("days",l.days.toString()),t.append("status",l.status),t.append("description",l.description),l.status==="completed"&&l.completed_date?t.append("completed_date",l.completed_date):t.append("completed_date",""),l.img&&t.append("img",l.img),l.pdf&&t.append("pdf",l.pdf);try{if(await f.post(`/milestones/${O.id}`,t,{headers:{"Content-Type":"multipart/form-data"}}),c.success("Milestone updated successfully"),k(null),a){const s=await f.get(`/projects/${a.id}/milestones`);L(s.data)}}catch(s){console.error(s),c.error("Failed to update milestone")}finally{ne(!1)}},qe=t=>{N.delete(`/projects/${t}`,{onSuccess:()=>c.success("Project deleted successfully"),onError:()=>c.error("Failed to delete project")})},ze=t=>{t.key==="Enter"&&N.get("/projects",{...w,search:T},{preserveScroll:!0})},Ee=t=>{const s=t.target.value;_e(s),Ie({search:T,status:s})},Ie=t=>{N.get("/projects",{...w,...t},{preserveScroll:!0,preserveState:!0,replace:!0,only:["projects","filters"]})};r.useEffect(()=>{a?(Z(!0),(async()=>{try{const[s,n,d]=await Promise.all([f.get(`/projects/${a.id}/history`),f.get(`/projects/${a.id}/milestones`),f.get(`/projects/${a.id}/payments`)]);J(s.data),L(n.data),R(d.data.payments)}catch(s){console.error("Failed to fetch project details",s),c.error("Failed to load project details.")}finally{Z(!1)}})()):(J([]),L([]),R([]))},[a]);const Oe=t=>{if(t.preventDefault(),!u)return;const s=parseFloat(C.actual_cost),n=u.estimated_cost;if(s>n){_(!0);return}de()},de=()=>{u&&(E(!0),N.post(`/projects/${u.id}/update-cost`,He(),{onSuccess:()=>{c.success("Actual cost updated successfully"),z(!1),_(!1),E(!1)},onError:t=>{c.error("Failed to update cost"),E(!1)}}))},He=()=>({actual_cost:C.actual_cost}),ie=()=>{var d;if(!a)return;const t=parseFloat(((d=a.actual_cost)==null?void 0:d.toString())||"0")||0,s=x.filter(i=>i.status==="Approved").reduce((i,A)=>{var v;return i+(parseFloat(((v=A.amount)==null?void 0:v.toString())||"0")||0)},0),n=t-s;Te(n),I({stage_name:"",amount:""}),S(!0)},Ue=async()=>{var s,n;if(!a)return;const t=parseFloat(m.amount);if(isNaN(t)||t<=0){c.error("Please enter a valid amount");return}if(t>j){c.error(`Amount cannot exceed remaining amount (${j.toLocaleString()})`);return}if(!m.stage_name.trim()){c.error("Please enter a stage name");return}le(!0);try{const d=await f.post(`/projects/${a.id}/request-payment`,{stage_name:m.stage_name,amount:t});if(d.data.success){c.success(d.data.message),S(!1);const i=await f.get(`/projects/${a.id}/payments`);R(i.data.payments)}else c.error(d.data.message)}catch(d){c.error(((n=(s=d.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to request payment")}finally{le(!1)}};return e.jsxs(Ve,{breadcrumbs:nt,children:[e.jsx(Be,{title:"Project Management"}),e.jsxs("div",{className:"flex flex-col lg:flex-row h-[calc(100vh-65px)] overflow-hidden",children:[e.jsx("div",{className:`flex-1 p-4 md:p-6 overflow-y-auto ${a?"lg:w-2/3":"w-full"}`,children:e.jsxs(P,{className:"h-full flex flex-col",children:[e.jsxs(D,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shrink-0",children:[e.jsxs("div",{children:[e.jsx(Ye,{className:"text-2xl font-bold",children:"Projects"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-md lg:text-lg",children:"Manage institutional projects"})]}),M.can_add&&e.jsx(me,{href:"/projects/create",children:e.jsxs(o,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Add Project"]})})]}),e.jsx(Ke,{}),e.jsxs(F,{className:"pt-6 space-y-6 flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 shrink-0",children:[e.jsx(p,{type:"text",placeholder:"Search projects... (press Enter)",value:T,onChange:t=>we(t.target.value),onKeyDown:ze}),e.jsxs("select",{value:Ce,onChange:Ee,className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"inprogress",children:"InProgress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"planned",children:"Planned"}),e.jsx("option",{value:"waiting",children:"Waiting"})]})]}),e.jsx("div",{className:"space-y-3 flex-1 overflow-auto",children:e.jsxs("table",{className:"w-full border-collapse border-1 rounded-md overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Fund Head"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Estimated Cost"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Actual Cost"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Priority"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Overall Status"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Approval Status"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Current Stage"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Final Comment"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Action"})]})}),e.jsx("tbody",{children:b.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-muted-foreground text-center p-4",children:"No projects found."})}):b.data.map(t=>{var s,n,d;return e.jsxs("tr",{className:`hover:bg-primary/10 dark:hover:bg-gray-700 text-center cursor-pointer transition-colors ${(a==null?void 0:a.id)===t.id?"bg-primary/5 dark:bg-gray-700 border-l-4 border-l-primary":""}`,onClick:()=>$(t),children:[e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:(s=t.fund_head)==null?void 0:s.name}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.estimated_cost}),e.jsx("td",{className:"border text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.actual_cost||"-",((n=t.current_stage)==null?void 0:n.can_change_cost)&&!t.actual_cost&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-6 w-6 text-blue-600 hover:text-blue-700",title:"Add/Update Actual Cost",onClick:i=>{i.stopPropagation(),De(t),se({actual_cost:(t.actual_cost||"").toString()}),z(!0)},children:e.jsx(xe,{className:"h-3 w-3"})})]})}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.priority||"-"}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.status}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.approval_status}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:((d=t.current_stage)==null?void 0:d.stage_name)||"Waiting"}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.final_comments||"-"}),e.jsxs("td",{className:"border text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",onClick:i=>i.stopPropagation(),children:[M.can_edit&&e.jsx(me,{href:`/projects/${t.id}/edit`,children:e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(Xe,{className:"h-4 w-4"})})}),M.can_delete&&e.jsxs(ge,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"icon",className:"text-destructive hover:text-red-600",children:e.jsx(Ge,{className:"h-4 w-4"})})}),e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsx(je,{children:"Delete this project?"}),e.jsxs(fe,{children:["Project ",e.jsx("strong",{children:t.name})," will be permanently deleted."]})]}),e.jsxs(ve,{children:[e.jsx(Ne,{children:"Cancel"}),e.jsx(ye,{className:"bg-destructive hover:bg-destructive/90",onClick:()=>qe(t.id),children:"Delete"})]})]})]}),$e(t)&&e.jsx(o,{variant:"ghost",size:"icon",title:"View/Approve",className:"text-blue-600 hover:text-blue-700",onClick:i=>{i.stopPropagation(),Ae(t),ee(!0)},children:e.jsx(Je,{className:"h-4 w-4"})})]})]},t.id)})})]})}),b.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2 shrink-0",children:b.links.map((t,s)=>e.jsx(o,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>N.visit(t.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},s))})]})]})}),a&&e.jsxs("div",{className:"w-full lg:w-1/3 border-l bg-background p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col h-full transition-all duration-300 ease-in-out z-20 absolute lg:relative right-0 top-0 lg:top-auto bottom-0 lg:bottom-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(oe=a.institute)==null?void 0:oe.name})]}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>$(null),children:e.jsx(Ze,{className:"h-5 w-5"})})]}),e.jsxs(et,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs(tt,{className:"grid w-full grid-cols-3",children:[e.jsx(X,{value:"approvals",children:"Approvals"}),e.jsx(X,{value:"milestones",children:"Milestones"}),e.jsx(X,{value:"payments",children:"Payments"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(G,{value:"approvals",className:"space-y-4 m-0 h-full",children:q?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading history..."}):Y.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No approval history found."}):e.jsx("div",{className:"space-y-4",children:Y.map(t=>{var s,n;return e.jsxs(P,{className:"overflow-hidden",children:[e.jsx(D,{className:"p-3 bg-muted/50 pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"font-semibold text-sm",children:((s=t.stage)==null?void 0:s.stage_name)||"Stage"}),t.status==="approved"?e.jsxs(y,{variant:"outline",className:"border-green-500 text-green-600 bg-green-50 gap-1",children:[e.jsx(lt,{className:"w-3 h-3"})," Approved"]}):t.status==="rejected"?e.jsxs(y,{variant:"outline",className:"border-red-500 text-red-600 bg-red-50 gap-1",children:[e.jsx(rt,{className:"w-3 h-3"})," Rejected"]}):e.jsxs(y,{variant:"outline",className:"border-yellow-500 text-yellow-600 bg-yellow-50 gap-1",children:[e.jsx(ue,{className:"w-3 h-3"})," Pending"]})]})}),e.jsxs(F,{className:"p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mb-2",children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),t.action_date?new Date(t.action_date).toLocaleString():""]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-medium text-xs",children:"Approver: "}),(n=t.approver)==null?void 0:n.name]}),t.comments&&e.jsxs("div",{className:"bg-muted/30 p-2 rounded text-xs italic border",children:['"',t.comments,'"']}),t.pdf&&e.jsx("a",{href:`/${t.pdf}`,target:"_blank",className:"mt-1 text-blue-600 underline text-xs flex items-center gap-1",children:"View PDF"}),t.img&&e.jsx("div",{className:"mt-2",children:e.jsx(be,{dataImg:t.img,size:"h-20",className:"rounded border"})})]})]},t.id)})})}),e.jsx(G,{value:"milestones",className:"space-y-4 m-0 h-full",children:q?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading milestones..."}):Q.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No milestones found."}):e.jsx("div",{className:"space-y-4",children:Q.map(t=>e.jsxs(P,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>Le(t),children:[e.jsx(D,{className:"p-3 pb-1",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.name}),e.jsx(y,{variant:t.status==="completed"?"default":t.status==="inprogress"?"secondary":"outline",className:"capitalize text-xs",children:t.status})]})}),e.jsxs(F,{className:"p-3 text-sm space-y-2",children:[t.img&&e.jsx("div",{className:"mb-2",children:e.jsx(be,{dataImg:t.img,size:"h-32",className:"w-full object-cover rounded-md"})}),t.pdf&&e.jsx("a",{href:`/${t.pdf}`,target:"_blank",className:"mb-2 text-blue-600 underline text-xs flex items-center gap-1",children:"View Document (PDF)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Due in: "}),t.days," days"]}),t.completed_date&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Completed: "}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:new Date(t.completed_date).toLocaleDateString()})]})]}),t.description&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:t.description})]})]},t.id))})}),e.jsx(G,{value:"payments",className:"space-y-4 m-0 h-full",children:q?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading payments..."}):x.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:["No payments found.",a.actual_cost&&a.approval_status==="approved"&&e.jsx("div",{className:"pt-2",children:e.jsx(o,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:ie,children:"Request Next Payment"})})]}):e.jsxs("div",{className:"space-y-4",children:[x.map(t=>{var s;return e.jsxs(P,{children:[e.jsx(D,{className:"p-3 pb-1",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"font-semibold text-sm",children:["Amount: ",t.amount]}),e.jsx(y,{variant:"outline",className:`capitalize text-xs ${t.status==="Approved"?"border-green-500 text-green-600 bg-green-50":t.status==="Rejected"?"border-red-500 text-red-600 bg-red-50":"border-yellow-500 text-yellow-600 bg-yellow-50"}`,children:t.status})]})}),e.jsxs(F,{className:"p-3 text-sm space-y-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:((s=t.fund_head)==null?void 0:s.name)||"General Fund"}),e.jsx("div",{className:"text-xs",children:new Date(t.added_date).toLocaleDateString()}),t.description&&e.jsxs("p",{className:"text-muted-foreground text-xs italic",children:['"',t.description,'"']})]})]},t.id)}),(()=>{var d,i,A;const t=parseFloat(((d=a.actual_cost)==null?void 0:d.toString())||"0")||0,s=x.filter(v=>v.status==="Approved").reduce((v,We)=>{var ce;return v+(parseFloat(((ce=We.amount)==null?void 0:ce.toString())||"0")||0)},0),n=t-s;return a.actual_cost&&((i=x[x.length-1])==null?void 0:i.status)==="Approved"&&n>0&&(x.length===1||x.length===2||x.length===3||x.length===4||(A=a.current_stage)!=null&&A.is_last)?e.jsx("div",{className:"pt-2",children:e.jsx(o,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:ie,children:"Request Next Payment"})}):null})()]})})]})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/20 lg:hidden z-10",onClick:()=>$(null)}),e.jsx(H,{open:!!O,onOpenChange:t=>!t&&k(null),children:e.jsxs(U,{className:"sm:max-w-[500px]",children:[e.jsxs(W,{children:[e.jsx(B,{children:"Edit Milestone"}),e.jsx(V,{children:"Update the details of the milestone. Click save when you're done."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"name",className:"text-right",children:"Name"}),e.jsx(p,{id:"name",value:l.name,onChange:t=>h({...l,name:t.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs("select",{id:"status",value:l.status,onChange:t=>h({...l,status:t.target.value}),className:"col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"inprogress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"days",className:"text-right",children:"Days"}),e.jsx(p,{id:"days",type:"number",value:l.days,onChange:t=>h({...l,days:parseInt(t.target.value)||0}),className:"col-span-3"})]}),l.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"completed_date",className:"text-right",children:"Completed Date"}),e.jsx(p,{id:"completed_date",type:"date",value:l.completed_date,onChange:t=>h({...l,completed_date:t.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"img",className:"text-right",children:"Image"}),e.jsx(p,{id:"img",type:"file",accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&h({...l,img:t.target.files[0]})},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"pdf",className:"text-right",children:"PDF"}),e.jsx(p,{id:"pdf",type:"file",accept:".pdf",onChange:t=>{t.target.files&&t.target.files[0]&&h({...l,pdf:t.target.files[0]})},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"description",className:"text-right",children:"Description"}),e.jsx(st,{id:"description",value:l.description,onChange:t=>h({...l,description:t.target.value}),className:"col-span-3"})]})]}),e.jsxs(K,{children:[e.jsx(o,{type:"button",variant:"secondary",onClick:()=>k(null),children:"Cancel"}),e.jsx(o,{type:"submit",onClick:Re,disabled:re,children:re?"Saving...":"Save changes"})]})]})}),e.jsx(at,{isOpen:Se,onClose:()=>ee(!1),project:ke,onSuccess:()=>{N.reload({only:["projects"]})}}),e.jsx(H,{open:Pe,onOpenChange:z,children:e.jsxs(U,{className:"sm:max-w-[425px]",children:[e.jsxs(W,{children:[e.jsx(B,{children:"Update Actual Cost"}),e.jsxs(V,{children:["Enter the actual cost for ",e.jsx("strong",{children:u==null?void 0:u.name}),"."]})]}),e.jsxs("form",{onSubmit:Oe,children:[e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"actual_cost",className:"text-right",children:"Cost"}),e.jsx(p,{id:"actual_cost",type:"number",step:"0.01",className:"col-span-3",value:C.actual_cost,onChange:t=>se({actual_cost:t.target.value}),required:!0})]})}),e.jsx(K,{children:e.jsx(o,{type:"submit",disabled:te,children:te?"Updating...":"Save changes"})})]})]})}),e.jsx(ge,{open:Fe,onOpenChange:_,children:e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsx(je,{children:"Actual Cost Higher than Estimated"}),e.jsxs(fe,{children:["The actual cost you entered (",e.jsx("strong",{children:C.actual_cost}),") is higher than the estimated cost (",e.jsx("strong",{children:u==null?void 0:u.estimated_cost}),").",e.jsx("br",{}),e.jsx("br",{}),"Are you sure you want to proceed with this then  project will be marked as waiting and project submit to Regional Head for approval ?"]})]}),e.jsxs(ve,{children:[e.jsx(Ne,{onClick:()=>_(!1),children:"No"}),e.jsx(ye,{onClick:de,children:"Yes"})]})]})}),e.jsx(H,{open:Me,onOpenChange:S,children:e.jsxs(U,{className:"sm:max-w-[450px]",children:[e.jsxs(W,{children:[e.jsx(B,{children:"Request Payment"}),e.jsxs(V,{children:["Enter the stage name and amount for the payment request.",e.jsx("br",{}),e.jsxs("span",{className:"text-sm font-medium mt-2 inline-block",children:["Remaining Amount: ",e.jsx("span",{className:"text-green-600 font-bold",children:j.toLocaleString()})]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"stage_name",className:"text-right",children:"Stage Name"}),e.jsx(p,{id:"stage_name",placeholder:"e.g., Foundation Work",className:"col-span-3",value:m.stage_name,onChange:t=>I({...m,stage_name:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"payment_amount",className:"text-right",children:"Amount"}),e.jsx(p,{id:"payment_amount",type:"number",step:"0.01",max:j,placeholder:`Max: ${j.toLocaleString()}`,className:"col-span-3",value:m.amount,onChange:t=>I({...m,amount:t.target.value})})]}),parseFloat(m.amount)>j&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:"Amount exceeds remaining balance!"})]}),e.jsxs(K,{children:[e.jsx(o,{variant:"secondary",onClick:()=>S(!1),children:"Cancel"}),e.jsx(o,{onClick:Ue,disabled:ae||!m.stage_name||!m.amount||parseFloat(m.amount)>j,children:ae?"Requesting...":"Confirm Request"})]})]})})]})}export{Dt as default};
