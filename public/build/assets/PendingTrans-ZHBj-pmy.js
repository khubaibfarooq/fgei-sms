import{r as a,j as e,L as V,S as f,a as q}from"./app-DndAw-cj.js";import{A as J,F as v,S as N,cx as X,C as $,hc as Q}from"./app-layout-CUtuJ9IB.js";import{B as i}from"./button-D7beTIdL.js";import{C as p,a as W,b as Y,c as g}from"./card-DuVoY6UD.js";import{I as y}from"./input-_mw0L_ns.js";import{B as u}from"./badge-CdyspmJQ.js";import{D as Z,a as ee,b as se,c as te,d as ae,X as re,e as le}from"./index-CBWTPZE2.js";import{S as de,a as ne,b as ie,c as oe,d as I}from"./select-C4ezBlIE.js";import{C as _}from"./index-5ST579Yb.js";import{f as ce}from"./format-CAPgRCzf.js";import"./index-BHjiyRYI.js";import"./index-B7HPx22p.js";import"./index-CUOWXGhR.js";import"./index-CuUs_T8F.js";import"./createLucideIcon-Zftdm0RY.js";import"./app-logo-icon-DVjb_-tR.js";import"./circle-x-Xqd7LKdH.js";import"./folder-root-CsVmuN8T.js";import"./grip-vertical-BvD8MxWn.js";import"./index-Cbqq6Sl3.js";import"./index-BOAAG2fe.js";const me=[{title:"Funds",href:"/funds"},{title:"Pending Transactions",href:"#"}];function Pe({transactions:n,summary:j,fundHeads:P,filters:o}){const[w,H]=a.useState(o.search||""),[S,L]=a.useState(o.from||""),[k,M]=a.useState(o.to||""),[C,B]=a.useState(o.fund_head_id||""),[O,c]=a.useState(!1),[t,U]=a.useState(null),[b,F]=a.useState(null),[m,x]=a.useState(null),[D,h]=a.useState(null),T=()=>{f.get(window.location.pathname,{search:w,from:S||void 0,to:k||void 0,fund_head_id:C||void 0},{preserveState:!0,preserveScroll:!0})},z=s=>{s.key==="Enter"&&T()},R=s=>{U(s),x(null),h(null),c(!0)},E=s=>{var l;const r=(l=s.target.files)==null?void 0:l[0];if(r){x(r);const d=new FileReader;d.onloadend=()=>{h(d.result)},d.readAsDataURL(r)}},G=()=>{x(null),h(null)},K=async()=>{var s,r;if(t){F(t.id);try{const l=new FormData;m?(console.log("Appending image to FormData:",m.name,m.size),l.append("img",m)):console.log("No image selected"),console.log("Sending approval request for transaction:",t.id);const{data:d}=await q.post(`/funds/${t.id}/approve`,l);d.success?(c(!1),x(null),h(null),f.reload()):alert(d.message||"Failed to approve transaction")}catch(l){console.error("Failed to approve transaction:",l);const d=((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.message)||"An error occurred while approving the transaction";alert(d)}finally{F(null)}}},A=s=>s==="in"?e.jsx(u,{variant:"default",className:"bg-green-100 text-green-800 hover:bg-green-200",children:"IN"}):e.jsx(u,{variant:"destructive",className:"bg-red-100 text-red-800 hover:bg-red-200",children:"OUT"});return e.jsxs(J,{breadcrumbs:me,children:[e.jsx(V,{title:"Pending Fund Transactions"}),e.jsx("div",{className:"flex-1 p-2 md:p-3",children:e.jsxs(p,{children:[e.jsx(W,{className:"pb-3",children:e.jsxs(Y,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(v,{className:"h-6 w-6"}),"Pending Fund Transactions"]})}),e.jsx(N,{}),e.jsxs(g,{className:"pt-3 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(p,{children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Pending"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:j.total_count})]}),e.jsx(v,{className:"h-5 w-5 text-blue-600"})]})})}),e.jsx(p,{children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending IN"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:j.total_in.toLocaleString()})]}),e.jsx(u,{variant:"default",className:"bg-green-100 text-green-800",children:"IN"})]})})}),e.jsx(p,{children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending OUT"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:j.total_out.toLocaleString()})]}),e.jsx(u,{variant:"destructive",className:"bg-red-100 text-red-800",children:"OUT"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search"}),e.jsx(y,{placeholder:"Search description...",value:w,onChange:s=>H(s.target.value),onKeyDown:z})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fund Head"}),e.jsxs(de,{value:C,onValueChange:B,children:[e.jsx(ne,{children:e.jsx(ie,{placeholder:"All Fund Heads"})}),e.jsxs(oe,{children:[e.jsx(I,{value:"0",children:"All Fund Heads"}),P.map(s=>e.jsx(I,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"From"}),e.jsx(y,{type:"date",value:S,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"To"}),e.jsx(y,{type:"date",value:k,onChange:s=>M(s.target.value)})]})]}),e.jsxs(i,{onClick:T,className:"w-full md:w-auto",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Apply Filters"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",n.from," to ",n.to," of ",n.total," pending transactions"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800",children:[e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Fund Head"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Institute"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Description"}),e.jsx("th",{className:"border p-3 text-center text-sm font-medium text-white dark:text-gray-200",children:"Type"}),e.jsx("th",{className:"border p-3 text-right text-sm font-medium text-white dark:text-gray-200",children:"Amount"}),e.jsx("th",{className:"border p-3 text-center text-sm font-medium text-white dark:text-gray-200",children:"Actions"})]})}),e.jsx("tbody",{children:n.data.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"border p-8 text-center",children:[e.jsx(v,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending transactions found."})]})}):n.data.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),new Date(s.added_date).toLocaleDateString()]})}),e.jsx("td",{className:"border p-3 text-sm font-medium",children:s.fund_head.name}),e.jsx("td",{className:"border p-3 text-sm",children:s.institute.name}),e.jsx("td",{className:"border p-3 text-sm",children:s.description}),e.jsx("td",{className:"border p-3 text-center",children:A(s.type)}),e.jsx("td",{className:"border p-3 text-right text-sm font-medium",children:e.jsxs("span",{className:s.type==="in"?"text-green-600":"text-red-600",children:[s.type==="in"?"+":"-",s.amount.toLocaleString()]})}),e.jsx("td",{className:"border p-3 text-center",children:e.jsxs(i,{size:"sm",variant:"default",onClick:()=>R(s),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Approve"]})})]},s.id))})]})}),n.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:n.links.map((s,r)=>e.jsx(i,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",onClick:()=>f.visit(s.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},r))})]})]})}),e.jsx(Z,{open:O,onOpenChange:c,children:e.jsxs(ee,{className:"max-w-2xl",children:[e.jsxs(se,{children:[e.jsx(te,{children:"Approve Transaction"}),e.jsx(ae,{children:"Review the transaction details before approving"})]}),t&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fund Head:"})," ",t.fund_head.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Institute:"})," ",t.institute.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",A(t.type)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Amount:"})," ",e.jsxs("span",{className:t.type==="in"?"text-green-600 font-semibold":"text-red-600 font-semibold",children:[t.type==="in"?"+":"-",t.amount.toLocaleString()]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("strong",{children:"Description:"})," ",t.description]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",ce(new Date(t.added_date),"dd MMM yyyy")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Added By:"})," ",t.user.name]})]}),e.jsx(N,{}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Note:"})," Approving this transaction will update the fund balance.",t.type==="in"?" The balance will be increased by the transaction amount.":" The balance will be decreased by the transaction amount."]})}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Attach Image (Optional)"}),D?e.jsxs("div",{className:"relative border rounded-lg p-2",children:[e.jsx("img",{src:D,alt:"Preview",className:"max-h-48 mx-auto rounded"}),e.jsx(i,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:G,children:e.jsx(re,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center hover:border-gray-400 dark:hover:border-gray-500 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:E,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(Q,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Click to upload an image"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"PNG, JPG, GIF up to 5MB"})]})]})]})]}),e.jsxs(le,{children:[e.jsx(i,{variant:"outline",onClick:()=>c(!1),disabled:b!==null,children:"Cancel"}),e.jsx(i,{onClick:K,disabled:b!==null,className:"bg-green-600 hover:bg-green-700",children:b!==null?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Approve Transaction"]})})]})]})})]})}export{Pe as default};
