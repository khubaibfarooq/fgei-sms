import{r as d,j as e,L as se}from"./app-Br2uDyRr.js";import{A as ae,S as re,t as B}from"./app-layout-DhmnGNgU.js";import{B as de}from"./button-Bg_BXllM.js";import{C as le,a as ie,b as oe,c as ne}from"./card-X2VTSAXr.js";import{I as ce}from"./index-DiiwdyOS.js";import{S as C,a as D,b as q,c as L,d as h}from"./select-CW4thx1A.js";import{E as xe,F as me}from"./FileSaver.min-C7lc-I6c.js";import"./index-CHagCES8.js";import"./createLucideIcon-CtQ7eItF.js";import"./index-Dieugcgs.js";import"./app-logo-icon-Dk_E89vD.js";import"./index-BktUEEO8.js";import"./index-SmPAtOrj.js";const he=[{title:"Institutional Report",href:"/reports/institutes"}],F=l=>{const n=l!=null&&typeof l.id=="number"&&l.id>0&&typeof l.name=="string"&&l.name.trim()!=="";return n||console.warn("Invalid item detected:",l),n};function _e({institutes:l=[],regions:n=[],blocks:T=[],instituteAssets:W=[],rooms:U=[],shifts:V=[],upgradations:z=[],filters:g={search:"",institute_id:"",region_id:""}}){const[y,K]=d.useState(g.search||""),[c,N]=d.useState(g.institute_id||""),[u,M]=d.useState(g.region_id||""),[w,v]=d.useState(l),[S,ge]=d.useState(n),[b,P]=d.useState(T),[f,Q]=d.useState(W),[j,$]=d.useState(U),[p,H]=d.useState(V),[k,J]=d.useState(z),R=d.useMemo(()=>w.filter(F),[w]),x=d.useMemo(()=>S.filter(F),[S]);console.log(x);const I=async t=>{try{const a=new URLSearchParams(t).toString(),i=await fetch(`/reports/institutes/getData?${a}`);if(!i.ok)throw new Error("Failed to fetch data");const r=await i.json();P(r.blocks||[]),Q(r.instituteAssets||[]),$(r.rooms||[]),H(r.shifts||[]),J(r.upgradations||[])}catch(a){console.error("Error fetching data:",a),B.error("Failed to load data")}},G=t=>{t.key==="Enter"&&I({search:y,institute_id:c,region_id:u})},O=t=>{N(t),I({search:y,institute_id:t,region_id:u})},X=async t=>{try{const a=new URLSearchParams({region_id:t||""}).toString(),i=await fetch(`/reports/getInstitutes?${a}`);if(!i.ok)throw new Error("Failed to fetch institutes");const r=await i.json();console.log("Fetched institutes:",r),v(r),c&&t!=="0"&&!r.some(m=>m.id.toString()===c)&&N("")}catch(a){console.error("Error fetching institutes:",a),B.error("Failed to load institutes"),v([])}},Y=async t=>{M(t),X(t)},Z=async()=>{const t=new xe.Workbook,a=t.addWorksheet("Shifts");a.columns=[{header:"Name",key:"name",width:20},{header:"Building Name",key:"building_name",width:20},{header:"Building Type",key:"building_type",width:20}],p.forEach(s=>{var o;a.addRow({name:s.name,building_name:s.building_name,building_type:((o=s.building_type)==null?void 0:o.name)||"N/A"})});const i=t.addWorksheet("Blocks");i.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15}],b.forEach(s=>{i.addRow({name:s.name,area:s.area})});const r=t.addWorksheet("Rooms");r.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15},{header:"Block",key:"block",width:20}],j.forEach(s=>{var o;r.addRow({name:s.name,area:s.area,block:((o=s.block)==null?void 0:o.name)||"N/A"})});const m=t.addWorksheet("Assets");m.columns=[{header:"Details",key:"details",width:30},{header:"Quantity",key:"qty",width:10},{header:"Institute",key:"institute",width:20},{header:"Room",key:"room",width:20},{header:"Asset",key:"asset",width:20}],f.forEach(s=>{var o,A,E;m.addRow({details:s.details,qty:s.current_qty,institute:((o=s.institute)==null?void 0:o.name)||"N/A",room:((A=s.room)==null?void 0:A.name)||"N/A",asset:((E=s.asset)==null?void 0:E.name)||"N/A"})});const _=t.addWorksheet("Upgradations");_.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:15},{header:"Date To",key:"to",width:15},{header:"Level From",key:"levelfrom",width:15},{header:"Level To",key:"levelto",width:15},{header:"Status",key:"status",width:15}],k.forEach(s=>{_.addRow({details:s.details,from:s.from,to:s.to,levelfrom:s.levelfrom,levelto:s.levelto,status:s.status})});const ee=await t.xlsx.writeBuffer(),te=new Blob([ee],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});me.saveAs(te,"Institutional_Report.xlsx")};return e.jsxs(ae,{breadcrumbs:he,children:[e.jsx(se,{title:"Institutional Report"}),e.jsxs("div",{className:"flex-1 p-2 md:p-2",children:[e.jsxs(le,{children:[e.jsxs(ie,{children:[e.jsx(oe,{children:"Institutional Report"}),e.jsx(de,{onClick:Z,className:"w-full",children:"Export Excel"})]}),e.jsx(re,{}),e.jsxs(ne,{className:"py-3 space-y-2",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:e.jsx(ce,{type:"text",placeholder:"Search institutes... (press Enter)",value:y,onChange:t=>K(t.target.value),onKeyDown:G})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[x.length>0&&e.jsxs(C,{value:u,onValueChange:Y,children:[e.jsx(D,{children:e.jsx(q,{placeholder:"Select Region"})}),e.jsxs(L,{children:[e.jsx(h,{value:"0",children:"All Regions"}),x.length>0?x.map(t=>e.jsx(h,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No Regions available"})]})]}),e.jsxs(C,{value:c,onValueChange:O,children:[e.jsx(D,{children:e.jsx(q,{placeholder:"Select Institute"})}),e.jsxs(L,{children:[e.jsx(h,{value:"0",children:"All Institutes"}),R.length>0?R.map(t=>e.jsx(h,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Shifts"}),p.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Type"})]})}),e.jsx("tbody",{children:p.map(t=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.building_name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(a=t.building_type)==null?void 0:a.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No blocks available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Blocks"}),b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No blocks available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Rooms"}),j.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Block"})]})}),e.jsx("tbody",{children:j.map(t=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(a=t.block)==null?void 0:a.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No rooms available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Institute Assets"}),f.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Quantity"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Room"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Added Date"})]})}),e.jsx("tbody",{children:f.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.asset.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.current_qty}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.room.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.added_date})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No assets available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Institute Upgradations"}),k.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date from"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date to"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Status"})]})}),e.jsx("tbody",{children:k.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.from}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.to}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelfrom}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelto}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.status})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No assets available"})]})]})]})}export{_e as default};
