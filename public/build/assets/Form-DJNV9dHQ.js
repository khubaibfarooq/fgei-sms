import{r as c,m as D,j as e,L as I,$ as A,S as N}from"./app-D2yfe91A.js";import{A as L,S as B,e as w,T,B as O,a as Q,d as F}from"./app-layout-TbNRwi80.js";import{B as m}from"./button-D8cKjy96.js";import{C as U,a as z,b as K,c as P}from"./card-D_0ugHV_.js";import{I as y}from"./input-C5lyt2TR.js";import{L as p}from"./label-DEn8bx0C.js";import{C as k}from"./combobox-03mMs1pT.js";import"./index-DMAbBzle.js";import"./createLucideIcon-zfdp9wgf.js";import"./index-D034NJxB.js";import"./index-CmmfoCgt.js";import"./index-I2D0tqza.js";import"./index-ErdJwvbp.js";import"./index-CWWH-7J6.js";import"./app-logo-icon-DFNUwCLV.js";import"./circle-x-BPoZhuA6.js";import"./clsx-B-dksMZM.js";import"./folder-root-CS05cmH6.js";import"./grip-vertical-BUDcUNgI.js";import"./popover-Dk3f89vB.js";function me({instituteAsset:i,assets:_,rooms:S}){const l=!!i,[x,C]=c.useState((i==null?void 0:i.room_id)||""),[u,R]=c.useState((i==null?void 0:i.added_date)||new Date().toISOString().split("T")[0]),[d,h]=c.useState(l?[{id:"1",asset_id:i.asset_id,current_qty:i.current_qty,details:i.details}]:[]),{processing:v}=D({room_id:x,added_date:u,assets:[]}),[r,f]=c.useState({}),g=c.useRef(null),b=()=>{if(l)return;const t=Date.now().toString(),s={id:t,asset_id:"",current_qty:"",details:""};h([...d,s]),g.current=t};c.useEffect(()=>{g.current&&setTimeout(()=>{const t=document.querySelector(`[data-row-id="${g.current}"] button[role="combobox"]`);t&&t.click(),g.current=null},50)},[d]);const q=t=>{h(d.filter(s=>s.id!==t))},j=(t,s,a)=>{h(d.map(n=>n.id===t?{...n,[s]:a}:n))};c.useEffect(()=>{const t=s=>{s.shiftKey&&s.key==="Enter"&&(s.preventDefault(),b())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[d]);const E=t=>{t.preventDefault();const s={};if(x||(s.room_id="Room is required"),u||(s.added_date="Date is required"),d.length===0&&(s.assets="Please add at least one asset"),d.forEach((n,o)=>{n.asset_id||(s[`assets.${o}.asset_id`]="Asset is required"),n.current_qty||(s[`assets.${o}.current_qty`]="Quantity is required"),n.details||(s[`assets.${o}.details`]="Description is required")}),Object.keys(s).length>0){f(s);return}f({});const a={room_id:x,added_date:u,assets:d.map(({id:n,...o})=>o)};l?N.put(`/institute-assets/${i.id}`,{...a,asset_id:d[0].asset_id,current_qty:d[0].current_qty,details:d[0].details},{preserveScroll:!0,preserveState:!0}):N.post("/institute-assets",a,{onSuccess:()=>{h([]),f({})},onError:n=>{f(n)}})},$=[{title:"Institute Assets",href:"/institute-assets"},{title:l?"Edit Asset":"Add Asset",href:"#"}];return e.jsxs(L,{breadcrumbs:$,children:[e.jsx(I,{title:l?"Edit Institute Asset":"Add Institute Asset"}),e.jsx("div",{className:"flex-1 p-4 md:p-6 w-full max-w-7xl mx-auto",children:e.jsxs(U,{className:"shadow-lg border-primary/10",children:[e.jsxs(z,{className:"space-y-1",children:[e.jsx(K,{className:"text-2xl md:text-3xl font-black uppercase tracking-tighter",children:l?"Modify Asset":"Register Assets"}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:l?"Update existing inventory record":"Batch add new assets to institute rooms"})]}),e.jsx(B,{}),e.jsx(P,{className:"pt-6",children:e.jsxs("form",{onSubmit:E,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-6 items-end bg-muted/20 p-4 md:p-6 rounded-2xl border border-primary/5",children:[e.jsxs("div",{className:"space-y-2 md:col-span-5",children:[e.jsx(p,{htmlFor:"room_id",className:"text-[10px] uppercase font-black tracking-widest text-primary/70 ml-1",children:"Location / Room"}),e.jsx(k,{entity:"room",disabled:l,value:x.toString(),onChange:t=>C(t?parseInt(t):""),options:S.map(t=>({id:t.id.toString(),name:t.name+(t.block?` (${t.block.name})`:"")+(t.type?` - ${t.type.name}`:"")})),includeAllOption:!1}),r.room_id&&e.jsx("p",{className:"text-[10px] font-bold text-destructive italic",children:r.room_id})]}),e.jsxs("div",{className:"space-y-2 md:col-span-4",children:[e.jsx(p,{htmlFor:"added_date",className:"text-[10px] uppercase font-black tracking-widest text-primary/70 ml-1",children:"Registration Date"}),e.jsx(y,{id:"added_date",type:"date",value:u,onChange:t=>R(t.target.value),className:"bg-background font-bold h-10"}),r.added_date&&e.jsx("p",{className:"text-[10px] font-bold text-destructive italic",children:r.added_date})]}),e.jsx("div",{className:"md:col-span-3",children:!l&&e.jsxs(m,{type:"button",onClick:b,className:"w-full h-10 font-black uppercase text-[10px] tracking-widest shadow-sm",variant:"outline",children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"New Row (Shift+Enter)"]})})]}),r.assets&&e.jsx("p",{className:"text-sm font-bold text-destructive text-center bg-destructive/5 py-2 rounded-md border border-destructive/10 animate-pulse",children:r.assets}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"hidden md:grid md:grid-cols-12 gap-4 px-4 text-[10px] uppercase font-black tracking-widest text-muted-foreground/60",children:[e.jsx("div",{className:"col-span-12 lg:col-span-5",children:"Asset Details"}),e.jsx("div",{className:"col-span-12 lg:col-span-2",children:"Quantity"}),e.jsx("div",{className:"col-span-12 lg:col-span-4",children:"Description / Condition"}),e.jsx("div",{className:"col-span-12 lg:col-span-1 text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-4 md:space-y-1",children:d.length>0?d.map((t,s)=>e.jsxs("div",{"data-row-id":t.id,className:"group relative flex flex-col md:grid md:grid-cols-12 gap-4 bg-card md:bg-transparent p-5 md:p-3 rounded-2xl md:rounded-none border md:border-0 md:border-b last:border-0 hover:bg-primary/[0.02] transition-colors shadow-sm md:shadow-none",children:[e.jsxs("div",{className:"space-y-1 md:col-span-12 lg:col-span-5",children:[e.jsx(p,{className:"md:hidden text-[9px] uppercase font-black text-primary/50 mb-1 block tracking-widest",children:"Select Asset"}),e.jsx(k,{entity:"asset",value:t.asset_id.toString(),onChange:a=>j(t.id,"asset_id",a?parseInt(a):""),options:_.map(a=>({id:a.id.toString(),name:a.name+(a.category?` (${a.category.name})`:"")})),includeAllOption:!1}),r[`assets.${s}.asset_id`]&&e.jsx("p",{className:"text-[10px] font-bold text-destructive italic mt-1",children:r[`assets.${s}.asset_id`]})]}),e.jsxs("div",{className:"space-y-1 md:col-span-12 lg:col-span-2",children:[e.jsx(p,{className:"md:hidden text-[9px] uppercase font-black text-primary/50 mb-1 block tracking-widest",children:"Current Qty"}),e.jsx(y,{type:"number",min:"1",value:t.current_qty,onChange:a=>j(t.id,"current_qty",a.target.value?parseInt(a.target.value):""),placeholder:"Qty",className:"font-bold h-10 md:h-9"}),r[`assets.${s}.current_qty`]&&e.jsx("p",{className:"text-[10px] font-bold text-destructive italic mt-1",children:r[`assets.${s}.current_qty`]})]}),e.jsxs("div",{className:"space-y-1 md:col-span-12 lg:col-span-4",children:[e.jsx(p,{className:"md:hidden text-[9px] uppercase font-black text-primary/50 mb-1 block tracking-widest",children:"Description"}),e.jsx(y,{type:"text",value:t.details,onChange:a=>j(t.id,"details",a.target.value),placeholder:"Condition, batch, etc.",className:"font-medium h-10 md:h-9"}),r[`assets.${s}.details`]&&e.jsx("p",{className:"text-[10px] font-bold text-destructive italic mt-1",children:r[`assets.${s}.details`]})]}),e.jsx("div",{className:"md:col-span-12 lg:col-span-1 flex items-center justify-end md:justify-center pt-2 md:pt-0",children:!l&&e.jsxs(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>q(t.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10 w-full md:w-auto font-black text-[10px] uppercase tracking-widest h-9",children:[e.jsx(T,{className:"h-4 w-4 mr-2 md:mr-0"}),e.jsx("span",{className:"md:hidden",children:"Remove Asset"})]})})]},t.id)):e.jsxs("div",{className:"text-center py-20 bg-muted/10 rounded-3xl border-2 border-dashed border-muted flex flex-col items-center justify-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted/20 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"h-8 w-8 text-muted-foreground/30"})}),e.jsxs("div",{className:"max-w-[280px]",children:[e.jsx("p",{className:"font-bold text-sm text-foreground/70 uppercase tracking-tight",children:"Empty Inventory Batch"}),e.jsx("p",{className:"text-[11px] text-muted-foreground font-medium leading-relaxed mt-1",children:"Use the button above to add assets to this room. You can add multiple assets at once."})]}),e.jsxs(m,{type:"button",size:"sm",onClick:b,variant:"outline",className:"font-black text-[10px] uppercase tracking-widest mt-2 h-9",children:[e.jsx(w,{className:"mr-2 h-4 w-4"})," Start Adding"]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 pt-8 border-t",children:[e.jsx(A,{href:"/institute-assets",className:"w-full md:w-auto order-2 md:order-1",children:e.jsxs(m,{type:"button",variant:"ghost",className:"w-full font-black uppercase text-[10px] tracking-widest h-12 md:h-10",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Back to List"]})}),e.jsx("div",{className:"flex w-full md:w-auto gap-3 order-1 md:order-2",children:e.jsxs(m,{type:"submit",className:"flex-1 md:flex-none w-full md:w-48 h-12 md:h-10 font-black uppercase text-[10px] tracking-[0.1em] shadow-lg shadow-primary/20",disabled:v||d.length===0,children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),v?"Saving...":l?"Update Record":"Commit Changes"]})})]})]})})]})})]})}export{me as default};
