import{r as d,j as e,L as Z}from"./app-Dz6Y4NYM.js";import{t as z,A as $,S as W}from"./app-layout-Dcngf0AY.js";import{B as i}from"./button-CTyV7QiL.js";import{C as w,a as k,b,c as _}from"./card-a7ph9NvF.js";import{S as Y,a as O,b as H,c as J,d as g}from"./select-B2aNcyNd.js";import{C as T}from"./combobox-slvlq3jx.js";import{E as q,F as G,a as K,b as S}from"./jspdf.plugin.autotable-BmvbRpwo.js";import"./index-BpFDX6Ra.js";import"./createLucideIcon-C64l_bc1.js";import"./input-Rem8VCBE.js";import"./index-DfhaLKpz.js";import"./app-logo-icon-CAPFRVWw.js";import"./folder-root-DzANYbkG.js";import"./grip-vertical-ByQHJAo3.js";import"./index-Bb3dgo4L.js";import"./index-uqGhEill.js";import"./popover-DyEX5KGz.js";const M=[{title:"Reports",href:"/reports"},{title:"Completion",href:"/reports/completion"}];function ue({regions:y=[],filters:f,institutes:I=[]}){const[h,m]=d.useState(f.region_id||""),[C,p]=d.useState(f.institute_id||""),[n,x]=d.useState(f.status||""),[A,N]=d.useState(I),[j,P]=d.useState([]),[l,E]=d.useState([]),[R,v]=d.useState(!1);d.useEffect(()=>{h&&h!=="0"?fetch(`/reports/getInstitutes?region_id=${h}`).then(t=>t.json()).then(t=>N(t)).catch(()=>z.error("Failed to load institutes")):N([])},[h]);const F=t=>{const r=t.toString();m(r),p(""),o({region_id:r,institute_id:""})},L=async()=>{const t=new q.Workbook,r=t.addWorksheet("Summary");r.columns=[{header:"Region",key:"region",width:30},{header:"Total Institutes",key:"total",width:20},{header:"Completed",key:"completed",width:20},{header:"< 50%",key:"less",width:20}],j.forEach(a=>{r.addRow({region:a.region,total:a.total_institutes,completed:a.completed,less:a.less_than_50})});const s=t.addWorksheet("Details");l.length>0&&l[0].is_region?(s.columns=[{header:"Region",key:"name",width:30},{header:"Shifts",key:"shifts",width:10},{header:"Blocks",key:"blocks",width:10},{header:"Rooms",key:"rooms",width:10},{header:"Assets",key:"assets",width:10},{header:"Plants",key:"plants",width:10},{header:"Transports",key:"transports",width:12},{header:"Funds",key:"funds",width:10},{header:"Projects",key:"projects",width:10},{header:"Upgradations",key:"upgradations",width:12},{header:"Total Institutes",key:"total",width:20},{header:"Completed",key:"completed",width:20},{header:"< 50%",key:"less",width:20}],l.forEach(a=>{s.addRow({name:a.name,shifts:a.shifts,blocks:a.blocks,rooms:a.rooms,assets:a.assets,plants:a.plants,transports:a.transports,funds:a.funds,projects:a.projects,upgradations:a.upgradations,total:a.total_institutes,completed:a.completed,less:a.less_than_50})})):(s.columns=[{header:"Institute",key:"name",width:40},{header:"Region",key:"region",width:30},{header:"Shifts",key:"shifts",width:10},{header:"Blocks",key:"blocks",width:10},{header:"Rooms",key:"rooms",width:10},{header:"Assets",key:"assets",width:10},{header:"Plants",key:"plants",width:10},{header:"Transports",key:"transports",width:12},{header:"Funds",key:"funds",width:10},{header:"Projects",key:"projects",width:10},{header:"Upgradations",key:"upgradations",width:12},{header:"Total %",key:"percentage",width:10}],l.forEach(a=>{s.addRow({name:a.name,region:a.region_name,shifts:a.shifts,blocks:a.blocks,rooms:a.rooms,assets:a.assets,plants:a.plants,transports:a.transports,funds:a.funds,projects:a.projects,upgradations:a.upgradations,percentage:a.percentage+"%"})}));const U=await t.xlsx.writeBuffer();G.saveAs(new Blob([U]),"Completion_Report.xlsx")},D=()=>{const t=new K("l","mm","a4");t.text("Completion Report - Summary",14,15),S(t,{head:[["Region","Total Institutes","Completed","< 50%"]],body:j.map(s=>[s.region,s.total_institutes,s.completed,s.less_than_50]),startY:20}),t.addPage(),t.text("Completion Report - Details",14,15),l.length>0&&l[0].is_region?S(t,{head:[["Region","Shifts","Blocks","Rooms","Assets","Plants","Transports","Funds","Projects","Upgradations","Total Inst.","Comp.","< 50%"]],body:l.map(s=>[s.name,s.shifts||0,s.blocks||0,s.rooms||0,s.assets||0,s.plants||0,s.transports||0,s.funds||0,s.projects||0,s.upgradations||0,s.total_institutes||0,s.completed||0,s.less_than_50||0]),startY:20,styles:{fontSize:8}}):S(t,{head:[["Institute","Region","Shifts","Blocks","Rooms","Assets","Plants","Transports","Funds","Projects","Upgradations","Total %"]],body:l.map(s=>[s.name,s.region_name||"",s.shifts||0,s.blocks||0,s.rooms||0,s.assets||0,s.plants||0,s.transports||0,s.funds||0,s.projects||0,s.upgradations||0,(s.percentage||0)+"%"]),startY:20,styles:{fontSize:8}}),t.save("Completion_Report.pdf")},o=async t=>{v(!0);try{const r=new URLSearchParams({region_id:(t==null?void 0:t.region_id)??h??"",institute_id:(t==null?void 0:t.institute_id)??C??"",status:(t==null?void 0:t.status)??n??""}),s=await fetch(`/reports/completion/getData?${r.toString()}`);if(!s.ok)throw new Error;const u=await s.json();P(u.summary),E(u.details),u.institutes&&N(u.institutes)}catch{z.error("Failed to load report data")}finally{v(!1)}};d.useEffect(()=>{o()},[]);const B=()=>{o()},V=()=>{m(""),p(""),x(""),o({region_id:"",institute_id:"",status:""})},c=l.length>0&&l[0].is_region;return e.jsxs($,{breadcrumbs:M,children:[e.jsx(Z,{title:"Completion Report"}),e.jsxs("div",{className:"p-4 lg:p-6 max-w-full space-y-6",children:[e.jsxs(w,{className:"w-full shadow-lg",children:[e.jsx(k,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-2xl font-bold",children:"Completion Report"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Institute data completion status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{onClick:D,variant:"outline",size:"sm",children:"PDF"}),e.jsx(i,{onClick:L,variant:"outline",size:"sm",children:"Excel"})]})]})}),e.jsx(W,{}),e.jsx(_,{className:"pt-6 pb-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[y.length>0&&e.jsx(T,{entity:"region",value:h,onChange:t=>{m(t),p("")},options:y.map(t=>({id:t.id.toString(),name:t.name.split(" ").pop()||t.name})),includeAllOption:!0,placeholder:"Select Region"}),e.jsx(T,{entity:"institute",value:C,onChange:p,options:A.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!0,placeholder:"Select Institute"}),e.jsxs(Y,{value:n,onValueChange:x,children:[e.jsx(O,{children:e.jsx(H,{placeholder:"Status"})}),e.jsxs(J,{children:[e.jsx(g,{value:"all",children:"All Statuses"}),e.jsx(g,{value:"completed",children:"Completed (100%)"}),e.jsx(g,{value:"less_than_50",children:"Less than 50%"}),e.jsx(g,{value:"zero",children:"Zero (0%)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{onClick:B,className:"flex-1",disabled:R,children:R?"Loading...":"Apply"}),e.jsx(i,{variant:"outline",onClick:V,className:"flex-1",children:"Reset"})]})]})})]}),e.jsxs(w,{children:[e.jsx(k,{children:e.jsx(b,{className:"text-lg",children:"Summary"})}),e.jsx(_,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted/50 text-muted-foreground uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:"Total Institutes"}),n=="completed"||n==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Completed Data"}):null,n=="less_than_50"||n==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Less than 50%"}):null,n=="zero"||n==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Zero (0%)"}):null]})}),e.jsx("tbody",{className:"divide-y",children:j.length>0?j.map((t,r)=>e.jsxs("tr",{className:"hover:bg-muted/50",children:[e.jsx("td",{className:"px-4 py-3 text-center",children:t.total_institutes}),n=="completed"||n==""?e.jsx("td",{className:"px-4 py-3 text-center text-green-600 font-bold",children:t.completed}):null,n=="less_than_50"||n==""?e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",children:t.less_than_50}):null,n=="zero"||n==""?e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",children:t.zero}):null]},r)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-muted-foreground",children:"No summary data available"})})})]})})})]}),e.jsxs(w,{children:[e.jsx(k,{children:e.jsx(b,{className:"text-lg",children:"Institute Details"})}),e.jsxs(_,{children:[!c&&y.length>0?e.jsx(i,{onClick:()=>{m(""),p(""),o({region_id:"",institute_id:""})},variant:"outline",size:"sm",children:"Show All Regions"}):e.jsx(i,{onClick:()=>{m(""),p(""),o({region_id:"",institute_id:""})},variant:"outline",size:"sm",children:"Show All Institutes"}),e.jsx(i,{onClick:()=>{x(""),o({status:""})},variant:"outline",size:"sm",className:"mr-2 text-white bg-blue-500 hover:bg-blue-600",children:"All Statuses"}),"  ",e.jsx(i,{onClick:()=>{x("completed"),o({status:"completed"})},variant:"outline",size:"sm",className:"mr-2 text-white bg-green-500 hover:bg-green-600",children:"Completed (100%)"}),"  ",e.jsx(i,{onClick:()=>{x("less_than_50"),o({status:"less_than_50"})},variant:"outline",size:"sm",className:"mr-2 text-white bg-red-500 hover:bg-red-600",children:"Less than 50%"}),e.jsx(i,{onClick:()=>{x("zero"),o({status:"zero"})},variant:"outline",size:"sm",className:"mr-2 text-white bg-red-500 hover:bg-red-600",children:"Zero (0%)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted/50 text-muted-foreground uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 min-w-[200px]",children:c?"Region":"Institute"}),c?e.jsxs(e.Fragment,{children:[n==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Total Inst."}):null,n=="completed"||n==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Comp."}):null,n=="less_than_50"||n==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"< 50%"}):null,n=="zero"||n==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Zero (0%)"}):null]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:"Shifts"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Blocks"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Rooms"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Assets"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Plants"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Transports"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Fund"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Projects"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Upgrad."}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Total %"})]})]})}),e.jsx("tbody",{className:"divide-y",children:l.length>0?l.map(t=>e.jsxs("tr",{className:`hover:bg-muted/50 ${c?"cursor-pointer":""}`,onClick:()=>c&&F(t.id),children:[e.jsx("td",{className:`px-4 py-3 font-medium ${c?"text-blue-600":""}`,children:c&&t.name.split(" ").pop()||t.name}),c?e.jsxs(e.Fragment,{children:[n==""?e.jsx("td",{className:"px-4 py-3 text-center",children:t.total_institutes}):null,n=="completed"||n==""?e.jsx("td",{className:"px-4 py-3 text-center text-green-600 font-bold",children:t.completed}):null,n=="less_than_50"||n==""?e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",children:t.less_than_50}):null,n=="zero"||n==""?e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",children:t.zero}):null]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:t.shifts}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.blocks}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.rooms}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.assets}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.plants}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.transports}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.funds}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.projects}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.upgradations}),e.jsx("td",{className:"px-4 py-3 text-center font-bold",children:e.jsxs("span",{className:t.percentage===100?"text-green-600":t.percentage<50?"text-red-600":"text-yellow-600",children:[t.percentage,"%"]})})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:c?14:11,className:"px-4 py-8 text-center text-muted-foreground",children:"No details available"})})})]})})]})]})]})]})}export{ue as default};
