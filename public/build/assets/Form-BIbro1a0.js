import{r as c,j as e,L as U,$ as O,S as G}from"./app-Cmws1I6H.js";import{A as J,S as K,P as Q,T as W,a as X,d as Y}from"./app-layout-kqjHsP1m.js";import{B as x}from"./button-BkfvgYYL.js";import{C as P,a as Z,b as ee,c as se}from"./card-sbmcU4Sn.js";import{I as o}from"./input-DHrAUVqQ.js";import{L as d}from"./label-BqMK9hU4.js";import{S as w,a as _,b as k,c as D,d as p}from"./select-CT1kD_g9.js";import{t as u}from"./index-C55IgIYm.js";import"./index-L7FGzSW8.js";import"./createLucideIcon-BouZ-GEQ.js";import"./index-DY6OT_JB.js";import"./index-DxEZuzwK.js";import"./index-BIZ_cT5B.js";import"./index-Dw6q9L2G.js";import"./app-logo-icon-BUKJYXXn.js";import"./circle-x-Bwy1YOO4.js";import"./folder-root-g8bdIByW.js";import"./grip-vertical-B0QDnzRG.js";import"./index-CpSjuTt3.js";import"./index-CRkBWHM7.js";function be({project:t,projectTypes:I}){var C,S,b;const m=!!(t!=null&&t.id),[h,M]=c.useState((t==null?void 0:t.name)||""),[g,$]=c.useState(((C=t==null?void 0:t.estimated_cost)==null?void 0:C.toString())||""),[E,te]=c.useState(((S=t==null?void 0:t.actual_cost)==null?void 0:S.toString())||""),[L,ae]=c.useState((t==null?void 0:t.final_comments)||""),[j,T]=c.useState(((t==null?void 0:t.project_type_id)||"").toString()),[y,A]=c.useState((t==null?void 0:t.description)||""),[N,F]=c.useState((t==null?void 0:t.priority)||"Medium"),[f,v]=c.useState(((b=t==null?void 0:t.milestones)==null?void 0:b.map(s=>({key:Date.now()+s.id,id:s.id,name:s.name,description:s.description||"",due_date:s.due_date,img:null,pdf:null,existingImg:s.img||void 0,existingPdf:s.pdf||void 0,preview:s.img?`${s.img}`:void 0})))||[]),H=Object.entries(I).map(([s,a])=>({id:parseInt(s),name:a})),V=()=>{v(s=>[...s,{key:Date.now(),name:"",description:"",due_date:"",img:null,pdf:null}])},q=s=>{v(a=>a.filter(n=>n.key!==s)),u.success("Milestone removed")},l=(s,a,n)=>{v(i=>i.map(r=>r.key===s?{...r,[a]:n}:r))},z=(s,a)=>{if(!a){l(s,"img",null),l(s,"preview",void 0);return}const n=new FileReader;n.onloadend=()=>{l(s,"preview",n.result)},n.readAsDataURL(a),l(s,"img",a)},B=s=>{if(s.preventDefault(),!h.trim()||!g||!j){u.error("Please fill all required project fields");return}const a=new FormData;a.append("name",h),a.append("estimated_cost",g),a.append("actual_cost",E),a.append("final_comments",L),a.append("project_type_id",j),a.append("description",y),a.append("priority",N),m&&a.append("_method","PUT"),f.forEach((i,r)=>{i.name.trim()&&i.due_date&&(i.id&&a.append(`milestones[${r}][id]`,i.id.toString()),a.append(`milestones[${r}][name]`,i.name),a.append(`milestones[${r}][description]`,i.description),a.append(`milestones[${r}][due_date]`,i.due_date),i.img&&a.append(`milestones[${r}][img]`,i.img),i.pdf&&a.append(`milestones[${r}][pdf]`,i.pdf))});const n=m?`/projects/${t.id}`:"/projects";G.post(n,a,{forceFormData:!0,onSuccess:()=>{u.success(m?"Project updated!":"Project created!")},onError:i=>{console.error(i),u.error("Please fix the errors")}})},R=[{title:"Projects",href:"/projects"},{title:m?"Edit Project":"Create Project",href:"#"}];return e.jsxs(J,{breadcrumbs:R,children:[e.jsx(U,{title:m?"Edit Project":"Create Project"}),e.jsx("div",{className:"p-4 md:p-6 w-full mx-auto",children:e.jsxs(P,{children:[e.jsx(Z,{children:e.jsx(ee,{className:"text-2xl",children:m?"Edit Project":"Create New Project"})}),e.jsx(K,{}),e.jsx(se,{className:"pt-6",children:e.jsxs("form",{onSubmit:B,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Project Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{value:h,onChange:s=>M(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Estimated Cost ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{type:"number",value:g,onChange:s=>$(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Project Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(w,{value:j,onValueChange:T,children:[e.jsx(_,{children:e.jsx(k,{placeholder:"Select type"})}),e.jsx(D,{children:H.map(s=>e.jsx(p,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Priority"}),e.jsxs(w,{value:N,onValueChange:F,children:[e.jsx(_,{children:e.jsx(k,{})}),e.jsxs(D,{children:[e.jsx(p,{value:"Low",children:"Low"}),e.jsx(p,{value:"Medium",children:"Medium"}),e.jsx(p,{value:"High",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(d,{children:"Description"}),e.jsx(o,{value:y,onChange:s=>A(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Milestones"}),e.jsxs(x,{type:"button",onClick:V,size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Add Milestone"]})]}),f.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 border-2 border-dashed rounded-lg",children:'No milestones yet. Click "Add Milestone" to start.'}):e.jsx("div",{className:"space-y-6",children:f.map((s,a)=>e.jsx(P,{className:"p-6 border",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Milestone Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{value:s.name,onChange:n=>l(s.key,"name",n.target.value),placeholder:"e.g. Site Survey"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Description"}),e.jsx(o,{value:s.description,onChange:n=>l(s.key,"description",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{type:"date",value:s.due_date,onChange:n=>l(s.key,"due_date",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Proof Image"}),e.jsx(o,{type:"file",accept:"image/*",onChange:n=>{var i;return z(s.key,((i=n.target.files)==null?void 0:i[0])||null)}}),s.existingImg&&!s.preview&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Has existing image"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Signed Document (PDF)"}),e.jsx(o,{type:"file",accept:".pdf",onChange:n=>{var i;return l(s.key,"pdf",((i=n.target.files)==null?void 0:i[0])||null)}}),s.existingPdf&&e.jsx("a",{href:`/${s.existingPdf}`,target:"_blank",className:"text-xs text-blue-500 underline mt-1 block",children:"View PDF"})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded bg-muted border flex items-center justify-center",children:s.preview||s.existingImg?e.jsx("img",{src:s.preview||`/${s.existingImg}`,alt:"Preview",className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-[10px] text-muted-foreground italic",children:"No image"})}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",onClick:()=>q(s.key),children:e.jsx(W,{className:"w-4 h-4"})})]})]})},s.key))})]}),e.jsxs("div",{className:"flex justify-between pt-8 border-t",children:[e.jsx(x,{type:"button",variant:"secondary",asChild:!0,children:e.jsxs(O,{href:"/projects",children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Back"]})}),e.jsxs(x,{type:"submit",size:"lg",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),m?"Update Project":"Create Project"]})]})]})})]})})]})}export{be as default};
