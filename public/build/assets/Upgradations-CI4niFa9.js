var R=Object.defineProperty;var T=(a,r,o)=>r in a?R(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o;var f=(a,r,o)=>T(a,typeof r!="symbol"?r+"":r,o);import{r as i,j as e,L as D,S as L}from"./app-Lpnl5WRd.js";import{t as S,A,S as B,B as _}from"./app-layout--a0JIXIT.js";import{B as m}from"./button-Dp8cY3rT.js";import{C as j,a as v,b as g,c as w}from"./card-DEmbEYEO.js";import{S as z,a as P,b as U,c as V,d as b}from"./select-uwL5b2rq.js";import{l as M,E as H}from"./jspdf.plugin.autotable-C-bFazg0.js";import{E as W,F as $}from"./FileSaver.min-CfmlEjip.js";import{f as N}from"./dateFormatter-Cn65gwBN.js";import"./index-0mzi6f94.js";import"./index-VkJyzDK4.js";import"./createLucideIcon-KDeK4WUp.js";import"./index-B1pBNKfN.js";import"./app-logo-icon-C3K0CK4E.js";import"./index-Clik64LW.js";import"./index-BiP7Ezay.js";const J=[{title:"Reports",href:"/reports"},{title:"upgradations",href:"/reports/upgradations"}];class O extends i.Component{constructor(){super(...arguments);f(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(o){return{hasError:!0,error:o.message}}componentDidCatch(o,u){console.error("ErrorBoundary caught:",o,u),S.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(m,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const y=a=>{const r=a!=null&&typeof a.id=="number"&&a.id>0&&typeof a.name=="string"&&a.name.trim()!=="";return r||console.warn("Invalid item detected:",a),r};function ce({upgradations:a,institutes:r,filters:o}){const[u,Y]=i.useState(o.search||""),[h,E]=i.useState(o.institute_id||""),[d,F]=i.useState(a||[]);i.useEffect(()=>{const t={institutes:r.filter(s=>!y(s))};Object.entries(t).forEach(([s,c])=>{c.length>0&&console.warn(`Invalid ${s}:`,c)})},[r]);const k=async()=>{const t=new W.Workbook,s=t.addWorksheet("upgradations");s.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:30},{header:"Date To",key:"to",width:20},{header:"Level From",key:"levelfrom",width:30},{header:"Level To",key:"levelto",width:20},{header:"Status",key:"status",width:20},{header:"Institute",key:"institute",width:30}],d.data.forEach(l=>{var x;s.addRow({details:l.details,from:l.from,to:l.to,levelfrom:l.levelfrom,levelto:l.levelto,status:l.status,institute:((x=l.institute)==null?void 0:x.name)||"N/A"})});const c=await t.xlsx.writeBuffer(),n=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});$.saveAs(n,"upgradations_Report.xlsx")},C=()=>{const t=new H;t.setFontSize(16),t.text("upgradations Report",14,15);const s=["Details","Date From","Date To","Level From","Level To","Status","Institute"],c=d.data.map(n=>{var l;return[n.details,n.from,n.to,n.levelfrom,n.levelto,n.status,((l=n.institute)==null?void 0:l.name)||"N/A"]});t.autoTable({head:[s],body:c,startY:25,styles:{fontSize:10}}),t.save("upgradation_Report.pdf")},I=i.useMemo(()=>M.debounce(()=>{const t=new URLSearchParams({search:u||"",institute_id:h||""});fetch(`/reports/upgradations/getUpgradations?${t.toString()}`).then(s=>s.json()).then(s=>{console.log("Fetched filtered upgradations:",s),F(s)}).catch(s=>{console.error("Error fetching filtered upgradations:",s),S.error("Failed to fetch filtered upgradations")})},300),[u,h]),p=i.useMemo(()=>r.filter(y),[r]);return e.jsx(O,{children:e.jsxs(A,{breadcrumbs:J,children:[e.jsx(D,{title:"Upgradations Report"}),e.jsx("div",{className:"flex-1 p-2 md:p-2",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs(j,{children:[e.jsxs(v,{children:[e.jsx(g,{className:"text-xl font-bold",children:"Filters"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your Upgradation search"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs(z,{value:h,onValueChange:t=>{E(t)},children:[e.jsx(P,{children:e.jsx(U,{placeholder:"Select Institute"})}),e.jsxs(V,{children:[e.jsx(b,{value:"0",children:"All Institutes"}),p.length>0?p.map(t=>e.jsx(b,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]}),e.jsx(m,{onClick:I,className:"w-full",children:"Apply Filters"})]})]})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsxs(j,{children:[e.jsxs(v,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{children:e.jsx(g,{className:"text-2xl font-bold",children:"upgradation Report"})}),e.jsx(m,{onClick:C,className:"w-full",children:"Export PDF"}),e.jsx(m,{onClick:k,className:"w-full",children:"Export Excel"})]}),e.jsx(B,{}),e.jsxs(w,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"space-y-3",children:d.data.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"No upgradations found."}):d.data.map(t=>{var s;return e.jsx("div",{className:"flex items-center justify-between border px-4 py-3 rounded-md bg-muted/50 hover:bg-muted/70 transition shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-sm text-foreground",children:t.details}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["From: ",N(t.from)," • To: ",N(t.to)," • Status: ",t.status," • Level From: ",t.levelfrom," • Level To: ",t.levelto,"  Institute: ",((s=t.institute)==null?void 0:s.name)||"N/A"]})]})]})},t.id)})}),d.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:d.links.map((t,s)=>e.jsx(m,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>L.visit(t.url||"",{preserveScroll:!0}),className:t.active?"bg-blue-600 hover:bg-blue-700":"",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},s))})]})]})})]})})]})})}export{ce as default};
