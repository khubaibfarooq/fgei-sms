import{r,j as e,L as K,$ as Q,S as W}from"./app-DqLaw2Tf.js";import{A as X,S as Y,e as Z,T as ee,a as se,d as te}from"./app-layout-CxteGIdE.js";import{B as u}from"./button-BYD9wi3g.js";import{C as _,a as ae,b as ie,c as ne}from"./card-ZO6btW5n.js";import{I as p}from"./input-ubl0T69H.js";import{L as l}from"./label-GF8g1A9k.js";import{S as k,a as D,b as $,c as I,d as x}from"./select-CqjKwbbq.js";import{t as h}from"./index-CyecoKA2.js";import"./index-4GMTqfxU.js";import"./createLucideIcon-DJxTyhun.js";import"./index-sLHKYRyJ.js";import"./index-CSXN30rB.js";import"./index-BllKNMjS.js";import"./index-DcRT_H8f.js";import"./app-logo-icon-h5YpMaN2.js";import"./circle-x-0eYwrnE_.js";import"./folder-root-CCaYxE8w.js";import"./grip-vertical-BY3TiC2O.js";import"./index-DHC5QG9v.js";import"./index-BT0X1lYb.js";function Fe({project:t,projectTypes:F}){var S,C,w;const c=!!(t!=null&&t.id),[g,M]=r.useState((t==null?void 0:t.name)||""),[f,E]=r.useState(((S=t==null?void 0:t.estimated_cost)==null?void 0:S.toString())||""),[T,le]=r.useState(((C=t==null?void 0:t.actual_cost)==null?void 0:C.toString())||""),[A,de]=r.useState((t==null?void 0:t.approval_status)||""),[re,ce]=r.useState((t==null?void 0:t.status)||""),[L,oe]=r.useState((t==null?void 0:t.final_comments)||""),[v,V]=r.useState(((t==null?void 0:t.project_type_id)||"").toString()),[b,H]=r.useState((t==null?void 0:t.description)||""),[P,q]=r.useState((t==null?void 0:t.priority)||"Medium"),[m,z]=r.useState(null),[j,pe]=r.useState((t==null?void 0:t.pdf)||null),[y,N]=r.useState(((w=t==null?void 0:t.milestones)==null?void 0:w.map(s=>({key:Date.now()+s.id,id:s.id,name:s.name,description:s.description||"",days:(s.days||"").toString(),img:null,pdf:null,existingImg:s.img||void 0,existingPdf:s.pdf||void 0,preview:s.img?`${s.img}`:void 0,status:s.status||"pending",completed_date:s.completed_date?s.completed_date.split("T")[0]:""})))||[]),B=Object.entries(F).map(([s,a])=>({id:parseInt(s),name:a})),R=()=>{N(s=>[...s,{key:Date.now(),name:"",description:"",days:"",img:null,pdf:null,status:"pending",completed_date:""}])},U=s=>{N(a=>a.filter(n=>n.key!==s)),h.success("Milestone removed")},o=(s,a,n)=>{N(i=>i.map(d=>d.key===s?{...d,[a]:n}:d))},O=(s,a)=>{if(!a){o(s,"img",null),o(s,"preview",void 0);return}const n=new FileReader;n.onloadend=()=>{o(s,"preview",n.result)},n.readAsDataURL(a),o(s,"img",a)},G=s=>{if(s.preventDefault(),!g.trim()||!f||!v){h.error("Please fill all required project fields");return}const a=new FormData;a.append("name",g),a.append("estimated_cost",f),a.append("actual_cost",T),a.append("final_comments",L),a.append("project_type_id",v),a.append("description",b),a.append("priority",P),m&&a.append("pdf",m),c&&a.append("_method","PUT"),y.forEach((i,d)=>{i.name.trim()&&i.days&&(i.id&&a.append(`milestones[${d}][id]`,i.id.toString()),a.append(`milestones[${d}][name]`,i.name),a.append(`milestones[${d}][description]`,i.description),a.append(`milestones[${d}][days]`,i.days),a.append(`milestones[${d}][status]`,i.status),i.status==="completed"&&i.completed_date&&a.append(`milestones[${d}][completed_date]`,i.completed_date),i.img&&a.append(`milestones[${d}][img]`,i.img),i.pdf&&a.append(`milestones[${d}][pdf]`,i.pdf))});const n=c?`/projects/${t.id}`:"/projects";W.post(n,a,{forceFormData:!0,onSuccess:()=>{h.success(c?"Project updated!":"Project created!")},onError:i=>{console.error(i),h.error("Please fix the errors")}})},J=[{title:"Projects",href:"/projects"},{title:c?"Edit Project":"Create Project",href:"#"}];return e.jsxs(X,{breadcrumbs:J,children:[e.jsx(K,{title:c?"Edit Project":"Create Project"}),e.jsx("div",{className:"p-4 md:p-6 w-full mx-auto",children:e.jsxs(_,{children:[e.jsx(ae,{children:e.jsx(ie,{className:"text-2xl",children:c?"Edit Project":"Create New Project"})}),e.jsx(Y,{}),e.jsx(ne,{className:"pt-6",children:e.jsxs("form",{onSubmit:G,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Project Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{value:g,onChange:s=>M(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Estimated Cost ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{type:"number",disabled:c,value:f,onChange:s=>E(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Project Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(k,{value:v,onValueChange:V,children:[e.jsx(D,{children:e.jsx($,{placeholder:"Select type"})}),e.jsx(I,{children:B.map(s=>e.jsx(x,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Priority"}),e.jsxs(k,{value:P,onValueChange:q,children:[e.jsx(D,{children:e.jsx($,{})}),e.jsxs(I,{children:[e.jsx(x,{value:"Low",children:"Low"}),e.jsx(x,{value:"Medium",children:"Medium"}),e.jsx(x,{value:"High",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(l,{children:"Description"}),e.jsx(p,{value:b,onChange:s=>H(s.target.value)})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(l,{children:"Project PDF Document"}),(A!=="approved"||!j)&&e.jsx(p,{type:"file",accept:".pdf",onChange:s=>{var a;return z(((a=s.target.files)==null?void 0:a[0])||null)}}),j&&!m&&e.jsx("a",{href:`/assets/${j}`,target:"_blank",className:"text-sm text-blue-600 hover:underline",children:"View Current PDF"}),m&&e.jsxs("p",{className:"text-sm text-green-600",children:["New PDF selected: ",m.name]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Milestones"}),e.jsxs(u,{type:"button",onClick:R,size:"sm",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"})," Add Milestone"]})]}),y.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 border-2 border-dashed rounded-lg",children:'No milestones yet. Click "Add Milestone" to start.'}):e.jsx("div",{className:"space-y-6",children:y.map((s,a)=>e.jsx(_,{className:"p-6 border",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Milestone Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{value:s.name,onChange:n=>o(s.key,"name",n.target.value),placeholder:"e.g. Site Survey"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Description"}),e.jsx(p,{value:s.description,onChange:n=>o(s.key,"description",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Due (Days) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{type:"number",value:s.days,onChange:n=>o(s.key,"days",n.target.value),placeholder:"e.g. 30"})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Status"}),e.jsxs("select",{value:s.status,onChange:n=>o(s.key,"status",n.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"inprogress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),s.status==="completed"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Completed Date"}),e.jsx(p,{type:"date",value:s.completed_date,onChange:n=>o(s.key,"completed_date",n.target.value)})]})]}),c&&e.jsxs(e.Fragment,{children:[(s.status!=="completed"||!s.existingPdf)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Proof Image"}),e.jsx(p,{type:"file",accept:"image/*",onChange:n=>{var i;return O(s.key,((i=n.target.files)==null?void 0:i[0])||null)}}),s.existingImg&&!s.preview&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Has existing image"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Signed Document (PDF)"}),(s.status!=="completed"||!s.existingPdf)&&e.jsx(p,{type:"file",accept:".pdf",onChange:n=>{var i;return o(s.key,"pdf",((i=n.target.files)==null?void 0:i[0])||null)}}),s.existingPdf&&e.jsx("a",{href:`/${s.existingPdf}`,target:"_blank",className:"text-xs text-blue-500 underline mt-1 block",children:"View PDF"})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded bg-muted border flex items-center justify-center",children:s.preview||s.existingImg?e.jsx("img",{src:s.preview||`/${s.existingImg}`,alt:"Preview",className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-[10px] text-muted-foreground italic",children:"No image"})}),s.status!=="completed"&&e.jsx(u,{type:"button",variant:"destructive",size:"icon",onClick:()=>U(s.key),children:e.jsx(ee,{className:"w-4 h-4"})})]})]})]})},s.key))})]}),e.jsxs("div",{className:"flex justify-between pt-8 border-t",children:[e.jsx(u,{type:"button",variant:"secondary",asChild:!0,children:e.jsxs(Q,{href:"/projects",children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Back"]})}),e.jsxs(u,{type:"submit",size:"lg",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),c?"Update Project":"Create Project"]})]})]})})]})})]})}export{Fe as default};
