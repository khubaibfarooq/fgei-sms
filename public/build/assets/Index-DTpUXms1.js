import{r as l,j as e,L as ge}from"./app-DQOnOCji.js";import{A as ue,S as fe,t as q}from"./app-layout-D7f4rM7y.js";import{B as W}from"./button-DxaTv_LC.js";import{C as be,a as ye,b as pe,c as je}from"./card-CZaQtEmO.js";import{I as ke}from"./index-DzwLc95r.js";import{S as O,a as M,b as U,c as $,d as j}from"./select-DYyFmtGj.js";import{E as Ne,F as we,a as ve,b as Se}from"./jspdf.plugin.autotable-Cy-uFL-w.js";import"./index-DYdBfOMc.js";import"./createLucideIcon-COe4Dzom.js";import"./index-CU3ww6-I.js";import"./app-logo-icon-DHsOh_Xq.js";import"./index-Cj4ik10W.js";import"./index-DPkm_vAq.js";const Ce=[{title:"Institutional Report",href:"/reports/institutes"}],z=i=>{const b=i!=null&&typeof i.id=="number"&&i.id>0&&typeof i.name=="string"&&i.name.trim()!=="";return b||console.warn("Invalid item detected:",i),b};function Ue({institutes:i=[],regions:b=[],blocks:P=[],instituteAssets:V=[],rooms:Q=[],shifts:Y=[],upgradations:K=[],filters:k={search:"",institute_id:"",region_id:""}}){const[N,H]=l.useState(k.search||""),[y,I]=l.useState(k.institute_id||""),[w,J]=l.useState(k.region_id||""),[_,D]=l.useState(i),[B,Re]=l.useState(b),[x,G]=l.useState(P),[h,X]=l.useState(V),[g,Z]=l.useState(Q),[u,ee]=l.useState(Y),[f,te]=l.useState(K),[v,se]=l.useState(!1),[S,ae]=l.useState(!1),[C,re]=l.useState(!1),[R,oe]=l.useState(!1),[A,le]=l.useState(!1),L=l.useMemo(()=>_.filter(z),[_]),p=l.useMemo(()=>B.filter(z),[B]);console.log(p);const E=async t=>{try{const r=new URLSearchParams(t).toString(),n=await fetch(`/reports/institutes/getData?${r}`);if(!n.ok)throw new Error("Failed to fetch data");const a=await n.json();G(a.blocks||[]),X(a.instituteAssets||[]),Z(a.rooms||[]),ee(a.shifts||[]),te(a.upgradations||[])}catch(r){console.error("Error fetching data:",r),q.error("Failed to load data")}},de=t=>{t.key==="Enter"&&E({search:N,institute_id:y,region_id:w})},ne=t=>{I(t),E({search:N,institute_id:t,region_id:w})},ie=async t=>{try{const r=new URLSearchParams({region_id:t||""}).toString(),n=await fetch(`/reports/getInstitutes?${r}`);if(!n.ok)throw new Error("Failed to fetch institutes");const a=await n.json();console.log("Fetched institutes:",a),D(a),y&&t!=="0"&&!a.some(d=>d.id.toString()===y)&&I("")}catch(r){console.error("Error fetching institutes:",r),q.error("Failed to load institutes"),D([])}},ce=async t=>{J(t),ie(t)},me=async()=>{const t=new Ne.Workbook,r=t.addWorksheet("Shifts");r.columns=[{header:"Name",key:"name",width:20},{header:"Building Name",key:"building_name",width:20},{header:"Building Type",key:"building_type",width:20}],u.forEach(o=>{var c;r.addRow({name:o.name,building_name:o.building_name,building_type:((c=o.building_type)==null?void 0:c.name)||"N/A"})});const n=t.addWorksheet("Blocks");n.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15}],x.forEach(o=>{n.addRow({name:o.name,area:o.area})});const a=t.addWorksheet("Rooms");a.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15},{header:"Block",key:"block",width:20}],g.forEach(o=>{var c;a.addRow({name:o.name,area:o.area,block:((c=o.block)==null?void 0:c.name)||"N/A"})});const d=t.addWorksheet("Assets");d.columns=[{header:"Details",key:"details",width:30},{header:"Quantity",key:"qty",width:10},{header:"Institute",key:"institute",width:20},{header:"Room",key:"room",width:20},{header:"Asset",key:"asset",width:20}],h.forEach(o=>{var c,F,T;d.addRow({details:o.details,qty:o.current_qty,institute:((c=o.institute)==null?void 0:c.name)||"N/A",room:((F=o.room)==null?void 0:F.name)||"N/A",asset:((T=o.asset)==null?void 0:T.name)||"N/A"})});const s=t.addWorksheet("Upgradations");s.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:15},{header:"Date To",key:"to",width:15},{header:"Level From",key:"levelfrom",width:15},{header:"Level To",key:"levelto",width:15},{header:"Status",key:"status",width:15}],f.forEach(o=>{s.addRow({details:o.details,from:o.from,to:o.to,levelfrom:o.levelfrom,levelto:o.levelto,status:o.status})});const m=await t.xlsx.writeBuffer(),he=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});we.saveAs(he,"Institutional_Report.xlsx")},xe=()=>{const t=new ve;let r=20;const n=(a,d,s)=>{t.setFontSize(14),t.text(a,14,r),Se(t,{head:[d],body:s,startY:r+3,styles:{fontSize:10},headStyles:{fillColor:[11,67,27]}}),r=t.lastAutoTable.finalY+8,r>t.internal.pageSize.height-50&&(t.addPage(),r=20)};if(t.setFontSize(16),t.text("Institutional Report",14,15),r=25,u.length>0){const a=["Name","Building Name","Building Type"],d=u.map(s=>{var m;return[s.name,s.building_name,((m=s.building_type)==null?void 0:m.name)||"N/A"]});n("Shifts",a,d)}if(x.length>0){const a=["Name","Area (sq ft)"],d=x.map(s=>[s.name,s.area]);n("Blocks",a,d)}if(g.length>0){const a=["Name","Area (sq ft)","Block"],d=g.map(s=>{var m;return[s.name,s.area,((m=s.block)==null?void 0:m.name)||"N/A"]});n("Rooms",a,d)}if(h.length>0){const a=["Asset Name","Details","Quantity","Room","Added Date"],d=h.map(s=>[s.asset.name,s.details,s.current_qty.toString(),s.room.name,s.added_date]);n("Institute Assets",a,d)}if(f.length>0){const a=["Details","Date From","Date To","Level From","Level To","Status"],d=f.map(s=>[s.details,s.from,s.to,s.levelfrom,s.levelto,s.status]);n("Institute Upgradations",a,d)}t.save("Institutional_Report.pdf")};return e.jsxs(ue,{breadcrumbs:Ce,children:[e.jsx(ge,{title:"Institutional Report"}),e.jsxs("div",{className:"flex-1 p-3 ",children:[e.jsxs(be,{children:[e.jsxs(ye,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:["          ",e.jsx(pe,{children:"Institutional Report"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{onClick:xe,className:"w-full md:w-auto",children:"Export PDF"}),e.jsx(W,{onClick:me,className:"w-full md:w-auto",children:"Export Excel"})]})]}),e.jsx(fe,{}),e.jsxs(je,{className:"py-3 space-y-2",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:e.jsx(ke,{type:"text",placeholder:"Search institutes... (press Enter)",value:N,onChange:t=>H(t.target.value),onKeyDown:de})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[p.length>0&&e.jsxs(O,{value:w,onValueChange:ce,children:[e.jsx(M,{children:e.jsx(U,{placeholder:"Select Region"})}),e.jsxs($,{children:[e.jsx(j,{value:"0",children:"All Regions"}),p.length>0?p.map(t=>e.jsx(j,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No Regions available"})]})]}),e.jsxs(O,{value:y,onValueChange:ne,children:[e.jsx(M,{children:e.jsx(U,{placeholder:"Select Institute"})}),e.jsxs($,{children:[e.jsx(j,{value:"0",children:"All Institutes"}),L.length>0?L.map(t=>e.jsx(j,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:`w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800 

  `,onClick:()=>se(!v),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Shifts(",u.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${v?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&e.jsx("div",{className:"p-4 border-t",children:u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Type"})]})}),e.jsx("tbody",{children:u.map(t=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.building_name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(r=t.building_type)==null?void 0:r.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No shifts available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>ae(!S),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Blocks(",x.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${S?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),S&&e.jsx("div",{className:"p-4 border-t",children:x.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No blocks available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>re(!C),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Rooms(",g.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${C?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),C&&e.jsx("div",{className:"p-4 border-t",children:g.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Block"})]})}),e.jsx("tbody",{children:g.map(t=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(r=t.block)==null?void 0:r.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No rooms available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>oe(!R),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Assets(",h.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${R?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),R&&e.jsx("div",{className:"p-4 border-t",children:h.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Quantity"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Room"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Added Date"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.asset.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.current_qty}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.room.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.added_date})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No assets available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>le(!A),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Upgradations(",f.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${A?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),A&&e.jsx("div",{className:"p-4 border-t",children:f.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date from"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date to"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Status"})]})}),e.jsx("tbody",{children:f.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.from}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.to}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelfrom}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelto}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.status})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No upgradations available"})})]})]})]})}export{Ue as default};
