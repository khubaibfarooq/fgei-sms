import{r,j as e,L as V}from"./app-CNwIZxOJ.js";import{t as n,A as D,S as P,P as H,T as z}from"./app-layout-BCEbCuPZ.js";import{B as S}from"./button-BajYX9XM.js";import{C as M,a as G,b as J,c as O}from"./card-C1OM93uE.js";import{I as N}from"./input-vF_AASkD.js";import{L as c}from"./label-DydU3TF9.js";import{S as A,a as w,b as C,c as F,d as b}from"./select-Ys6o8pet.js";import"./index-CXeubv1v.js";import"./createLucideIcon-BqaNQg0Z.js";import"./index-BJ30r5gq.js";import"./app-logo-icon-stI6khL3.js";import"./folder-root-BmWTyySN.js";import"./grip-vertical-DV8g-OxK.js";import"./index-BPLY0FOE.js";import"./index-qErH53Ag.js";const U=[{title:"Asset Transactions",href:"/asset-transactions"}];function xe({fundHeads:L=[],assetCategories:E=[]}){const[i,_]=r.useState(""),[h,q]=r.useState(""),[I,v]=r.useState(""),[a,m]=r.useState(null),[d,u]=r.useState(""),[o,j]=r.useState(""),[f,p]=r.useState(0),[Q,W]=r.useState(null),[l,g]=r.useState([]);r.useEffect(()=>{i&&fetch(`/asset-trans/getbalance?id=${i}`).then(s=>s.json()).then(s=>{console.log("Fetched data:",s),p(s.balance)}).catch(s=>{console.error("Error fetching :",s),n.error("Failed to fetch "),p(0)})},[i]),r.useEffect(()=>{h&&fetch(`/asset-trans/getbalance?id=${h}`).then(s=>s.json()).then(s=>{console.log("Fetched data:",s),p(s.balance)}).catch(s=>{console.error("Error fetching :",s),n.error("Failed to fetch "),p(0)})},[h]);const B=s=>{const t=Q.find($=>$.id.toString()===s);m(t),t&&(u(""),j(""))},k=s=>{s.key==="Enter"&&a&&T()},T=()=>{if(!a){n.error("Please select an asset");return}if(!d||isNaN(parseInt(d))||parseInt(d)<=0){n.error("Please enter a valid quantity");return}if(!o||isNaN(parseFloat(o))||parseFloat(o)<=0){n.error("Please enter a valid amount");return}const s=l.findIndex(t=>t.asset_id===a.id);if(s!==-1){const t=[...l];t[s]={...t[s],new_qty:parseInt(d),amount:parseFloat(o)},g(t),n.success("Asset quantity updated")}else{const t={id:Date.now(),asset_id:a.id,asset_name:a.name,current_qty:a.current_qty||0,remaining_qty:(a.current_qty||0)-parseInt(d),new_qty:parseInt(d),amount:parseFloat(o)};g([...l,t]),n.success("Asset added to transaction")}m(null),v(""),u(""),j("")},K=s=>{g(l.filter(t=>t.id!==s)),n.success("Asset removed from transaction")},x=r.useMemo(()=>l.reduce((s,t)=>s+t.amount,0),[l]),y=r.useMemo(()=>f===0?!0:x<=f,[f,x]),R=()=>{if(!i){n.error("Please select a fund head");return}if(l.length===0){n.error("Please add at least one asset");return}if(!y){n.error("Insufficient fund balance");return}const s={fund_head_id:parseInt(i),items:l.map(t=>({asset_id:t.asset_id,new_qty:t.new_qty,amount:t.amount})),total_amount:x};console.log("Transaction Data:",s),n.success("Asset transaction created successfully!"),_(""),q(""),v(""),m(null),u(""),j(""),g([])};return r.useEffect(()=>{a&&!filteredAssets.find(s=>s.id===a.id)&&(m(null),u(""),j(""))},[filteredAssets,a]),e.jsxs(D,{breadcrumbs:U,children:[e.jsx(V,{title:"Create Asset Transaction"}),e.jsx("div",{className:"flex-1 p-3",children:e.jsxs(M,{children:[e.jsx(G,{className:"pb-3",children:e.jsx(J,{children:"Create Asset Transaction"})}),e.jsx(P,{}),e.jsxs(O,{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"fund-head",children:"Fund Head *"}),e.jsxs(A,{value:i,onValueChange:_,children:[e.jsx(w,{children:e.jsx(C,{placeholder:"Select Fund Head"})}),e.jsx(F,{children:L.map(s=>e.jsx(b,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Available Funds"}),e.jsx("div",{className:"p-3 border rounded-md bg-muted/50 min-h-[42px]",children:f!=0?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex justify-between text-sm",children:e.jsxs("span",{className:"font-medium",children:["RS ",f.toLocaleString("en-PK",{style:"currency",currency:"PKR"})]})}),x>0&&e.jsxs("div",{className:"border-t pt-1 mt-1",children:[e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{children:"Total Required:"}),e.jsxs("span",{className:y?"text-green-600":"text-red-600",children:["$",x.toLocaleString()]})]}),!y&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Insufficient balance"})]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:i?"No funds available":"Select a fund head to view funds"})})]})]}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Assets"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"asset-category",children:"Asset Category"}),e.jsxs(A,{value:h,onValueChange:s=>{q(s),m(null)},children:[e.jsx(w,{children:e.jsx(C,{placeholder:"All Categories"})}),e.jsxs(F,{children:[e.jsx(b,{value:"0",children:"All Categories"}),E.map(s=>e.jsx(b,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"asset-select",children:"Select Asset *"}),e.jsxs(A,{value:(a==null?void 0:a.id.toString())||"",onValueChange:B,children:[e.jsx(w,{children:e.jsx(C,{placeholder:filteredAssets.length>0?"Choose asset":"No assets found"})}),e.jsx(F,{children:filteredAssets.length>0?filteredAssets.map(s=>e.jsx(b,{value:s.id.toString(),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),s.details&&e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:s.details})]})},s.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:I||h!=="0"?"No assets found":"No assets available"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"asset-search",children:"Search Asset"}),e.jsx(N,{id:"asset-search",type:"text",placeholder:"Search by name or details...",value:I,onChange:s=>{v(s.target.value),a&&!s.target.value&&m(null)}})]})]}),a&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"current-qty",children:"Current Quantity"}),e.jsx(N,{id:"current-qty",type:"text",value:a.current_qty||0,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"new-qty",children:"New Quantity *"}),e.jsx(N,{id:"new-qty",type:"number",placeholder:"Enter quantity",value:d,onChange:s=>u(s.target.value),onKeyPress:k,min:"1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"amount",children:"Amount *"}),e.jsx(N,{id:"amount",type:"number",step:"0.01",placeholder:"0.00",value:o,onChange:s=>j(s.target.value),onKeyPress:k,min:"0.01"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(S,{onClick:T,className:"w-full",disabled:!d||!o,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Add to List"]})})]})]}),l.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Transaction Items (",l.length,")"]}),e.jsxs("div",{className:"text-lg font-bold",children:["Total: $",x.toLocaleString()]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Current Qty"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Remaining Qty"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"New Qty"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Amount"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:s.asset_name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:s.current_qty}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:s.remaining_qty}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:s.new_qty}),e.jsxs("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:["$",s.amount.toLocaleString()]}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:e.jsx(S,{variant:"destructive",size:"sm",onClick:()=>K(s.id),children:e.jsx(z,{className:"w-4 h-4"})})})]},s.id))})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(S,{onClick:R,size:"lg",disabled:!y,children:"Create Transaction"})})]})]})]})})]})}export{xe as default};
