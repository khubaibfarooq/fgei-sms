import{r as l,j as e,L as Xe,$ as Y,S as N,a as y}from"./app-DcVejKmQ.js";import{A as Ye,e as je,S as Je,E as Qe,f as Ze,T as et,c as fe,F as tt}from"./app-layout-Bkum-iwa.js";import{B as i}from"./button-VLF_SepY.js";import{C as D,a as z,b as st,c as M,d as at}from"./card-Dt2MshyH.js";import{I as g}from"./input-CaDihKTA.js";import{A as ye,a as rt,b as be,c as ve,d as Ne,e as we,f as Ce,g as ke,h as _e}from"./alert-dialog-Bhyw7Zr0.js";import{X as lt,D as T,a as $,b as L,c as R,d as O,e as E,t as c}from"./index-BFTTV9lJ.js";import{T as nt,a as it,b as J,c as Q}from"./tabs-C-_6UXlE.js";import{B as w}from"./badge-DPwMBO9o.js";import{L as u}from"./label-eXX_uRz8.js";import{T as dt}from"./textarea-DBv-v73Q.js";import ct from"./ApprovalModal-BFdMHzgj.js";import{I as Z}from"./image-preview2-nt7Z-_ss.js";import{C as ot,a as mt}from"./circle-x-CGsAE1os.js";import"./index-ZgcTR5Bw.js";import"./createLucideIcon-LRW2I29Q.js";import"./index-B22CfWr2.js";import"./index-BwfnS1vR.js";import"./index-Dj5lvv5L.js";import"./index-DTL3CFO1.js";import"./app-logo-icon-BnLRKnTY.js";import"./clsx-B-dksMZM.js";import"./folder-root-DhAc6VXR.js";import"./grip-vertical-D5l9DCvt.js";const xt=[{title:"Projects",href:"/projects"}];function Rt({projects:C,filters:k,permissions:I}){var ue;const[_,Se]=l.useState(k.search||""),[ee,Pe]=l.useState(k.status||""),[a,q]=l.useState(null),[te,se]=l.useState([]),[ae,H]=l.useState([]),[p,U]=l.useState([]),[W,re]=l.useState(!1),[Ae,le]=l.useState(!1),[Fe,De]=l.useState(null),[ze,B]=l.useState(!1),[h,Me]=l.useState(null),[ne,V]=l.useState(!1),[S,ie]=l.useState({actual_cost:""}),[Te,P]=l.useState(!1),[$e,A]=l.useState(!1),[m,G]=l.useState({stage_name:"",amount:""}),[de,ce]=l.useState(!1),[f,Le]=l.useState(0),[Re,K]=l.useState(!1),[b,Oe]=l.useState(null),Ee=t=>{var s,n;return((n=(s=t.current_stage)==null?void 0:s.level)==null?void 0:n.toLowerCase())==="institutional"&&t.status!=="completed"},[X,F]=l.useState(null),[r,j]=l.useState({name:"",description:"",days:0,status:"",completed_date:"",img:null,pdf:null}),[oe,me]=l.useState(!1),Ie=t=>{F(t),j({name:t.name,description:t.description||"",days:t.days||0,status:t.status,completed_date:t.completed_date?t.completed_date.split("T")[0]:"",img:null,pdf:null})},qe=async()=>{if(!X)return;me(!0);const t=new FormData;t.append("_method","PUT"),t.append("name",r.name),t.append("days",r.days.toString()),t.append("status",r.status),t.append("description",r.description),r.status==="completed"&&r.completed_date?t.append("completed_date",r.completed_date):t.append("completed_date",""),r.img&&t.append("img",r.img),r.pdf&&t.append("pdf",r.pdf);try{if(await y.post(`/milestones/${X.id}`,t,{headers:{"Content-Type":"multipart/form-data"}}),c.success("Milestone updated successfully"),F(null),a){const s=await y.get(`/projects/${a.id}/milestones`);H(s.data)}}catch(s){console.error(s),c.error("Failed to update milestone")}finally{me(!1)}},He=t=>{N.delete(`/projects/${t}`,{onSuccess:()=>c.success("Project deleted successfully"),onError:()=>c.error("Failed to delete project")})},Ue=t=>{t.key==="Enter"&&N.get("/projects",{...k,search:_},{preserveScroll:!0})},We=t=>{const s=t.target.value;Pe(s),xe({search:_,status:s})},xe=t=>{N.get("/projects",{...k,...t},{preserveScroll:!0,preserveState:!0,replace:!0,only:["projects","filters"]})};l.useEffect(()=>{a?(re(!0),(async()=>{try{const[s,n,d]=await Promise.all([y.get(`/projects/${a.id}/history`),y.get(`/projects/${a.id}/milestones`),y.get(`/projects/${a.id}/payments`)]);se(s.data),H(n.data),U(d.data.payments)}catch(s){console.error("Failed to fetch project details",s),c.error("Failed to load project details.")}finally{re(!1)}})()):(se([]),H([]),U([]))},[a]);const Be=t=>{if(t.preventDefault(),!h)return;const s=parseFloat(S.actual_cost),n=h.estimated_cost;if(s>n){P(!0);return}pe()},pe=()=>{h&&(V(!0),N.post(`/projects/${h.id}/update-cost`,Ve(),{onSuccess:()=>{c.success("Actual cost updated successfully"),B(!1),P(!1),V(!1)},onError:t=>{c.error("Failed to update cost"),V(!1)}}))},Ve=()=>({actual_cost:S.actual_cost}),he=()=>{var d;if(!a)return;const t=parseFloat(((d=a.actual_cost)==null?void 0:d.toString())||"0")||0,s=p.filter(x=>x.status==="Approved").reduce((x,o)=>{var v;return x+(parseFloat(((v=o.amount)==null?void 0:v.toString())||"0")||0)},0),n=t-s;Le(n),G({stage_name:"",amount:""}),A(!0)},Ge=async()=>{var s,n;if(!a)return;const t=parseFloat(m.amount);if(isNaN(t)||t<=0){c.error("Please enter a valid amount");return}if(t>f){c.error(`Amount cannot exceed remaining amount (${f.toLocaleString()})`);return}if(!m.stage_name.trim()){c.error("Please enter a stage name");return}ce(!0);try{const d=await y.post(`/projects/${a.id}/request-payment`,{stage_name:m.stage_name,amount:t});if(d.data.success){c.success(d.data.message),A(!1);const x=await y.get(`/projects/${a.id}/payments`);U(x.data.payments)}else c.error(d.data.message)}catch(d){c.error(((n=(s=d.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to request payment")}finally{ce(!1)}};return e.jsxs(Ye,{breadcrumbs:xt,children:[e.jsx(Xe,{title:"Project Management"}),e.jsxs("div",{className:"flex flex-col lg:flex-row h-[calc(100vh-65px)] overflow-hidden",children:[e.jsx("div",{className:`flex-1 p-2 md:p-4 lg:p-6 overflow-y-auto ${a?"lg:w-2/3":"w-full"}`,children:e.jsxs(D,{className:"h-full flex flex-col",children:[e.jsxs(z,{className:"p-3 pb-2 md:pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shrink-0",children:[e.jsxs("div",{children:[e.jsx(st,{className:"text-2xl font-bold",children:"Projects"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-md lg:text-lg",children:"Manage institutional projects"})]}),I.can_add&&e.jsx(Y,{href:"/projects/create",children:e.jsxs(i,{children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Add Project"]})})]}),e.jsx(Je,{}),e.jsxs(M,{className:"p-2 pt-4 md:pt-6 space-y-4 md:space-y-6 flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 shrink-0",children:[e.jsx(g,{type:"text",placeholder:"Search projects... (press Enter)",value:_,onChange:t=>Se(t.target.value),onKeyDown:Ue}),e.jsxs("select",{value:ee,onChange:We,className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"inprogress",children:"InProgress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"planned",children:"Planned"}),e.jsx("option",{value:"waiting",children:"Waiting"})]}),e.jsx(i,{onClick:()=>xe({search:_,status:ee}),children:"Fetch"})]}),e.jsx("div",{className:"space-y-3 flex-1 overflow-auto",children:e.jsxs("table",{className:"w-full border-collapse border-1 rounded-md overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Project"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Type"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20 hidden lg:table-cell",children:"Fund Head"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Est. Cost"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Act. Cost"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Priority"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Status"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20 hidden sm:table-cell",children:"Approval"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20 hidden md:table-cell",children:"Current Stage"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20 hidden lg:table-cell",children:"Comment"}),e.jsx("th",{className:"border p-2 text-xs md:text-sm font-medium text-white dark:text-gray-200 whitespace-nowrap sticky top-0 bg-primary dark:bg-gray-800 z-20",children:"Action"})]})}),e.jsx("tbody",{children:C.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-muted-foreground text-center p-4",children:"No projects found."})}):C.data.map(t=>{var s,n,d,x;return e.jsxs("tr",{className:`hover:bg-primary/10 dark:hover:bg-gray-700 text-center cursor-pointer transition-colors ${(a==null?void 0:a.id)===t.id?"bg-primary/5 dark:bg-gray-700 border-l-4 border-l-primary":""}`,onClick:()=>q(t),children:[e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 font-medium whitespace-nowrap text-left",children:e.jsx(Y,{href:`/projects/${t.id}/details`,className:"text-blue-600 hover:text-blue-800 hover:underline",onClick:o=>o.stopPropagation(),children:t.name})}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-center",children:((s=t.projecttype)==null?void 0:s.name)||"-"}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 hidden lg:table-cell",children:(n=t.fund_head)==null?void 0:n.name}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100",children:t.estimated_cost}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.actual_cost||"",((d=t.current_stage)==null?void 0:d.can_change_cost)&&!t.actual_cost&&e.jsx(i,{variant:"ghost",size:"icon",className:"h-5 w-5 text-blue-600 hover:text-blue-700",title:"Add/Update Actual Cost",onClick:o=>{o.stopPropagation(),Me(t),ie({actual_cost:(t.actual_cost||"").toString()}),B(!0)},children:e.jsx(je,{className:"h-3 w-3"})})]})}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 capitalize",children:t.priority||"-"}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 capitalize",children:t.status}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 capitalize hidden sm:table-cell",children:t.approval_status}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 hidden md:table-cell",children:((x=t.current_stage)==null?void 0:x.stage_name)||"Held with Regional Office"}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100 hidden lg:table-cell truncate max-w-[150px]",title:t.final_comments||"",children:t.final_comments||"-"}),e.jsx("td",{className:"border p-2 text-xs md:text-sm text-gray-900 dark:text-gray-100",onClick:o=>o.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.pdf?e.jsx("a",{href:`/assets/${t.pdf}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center text-blue-600 hover:text-blue-700",title:"View PDF",children:"PDF"}):e.jsx("span",{className:"text-muted-foreground",children:"-"}),t.description?e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6 text-blue-600 hover:text-blue-700",title:"View Description",onClick:()=>{Oe(t),K(!0)},children:e.jsx(Qe,{className:"h-3 w-3"})}):e.jsx("span",{className:"text-muted-foreground",children:"-"}),I.can_edit&&e.jsx(Y,{href:`/projects/${t.id}/edit`,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",children:e.jsx(Ze,{className:"h-3 w-3"})})}),I.can_delete&&e.jsxs(ye,{children:[e.jsx(rt,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"text-destructive hover:text-red-600 h-6 w-6",children:e.jsx(et,{className:"h-3 w-3"})})}),e.jsxs(be,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Delete this project?"}),e.jsxs(we,{children:["Project ",e.jsx("strong",{children:t.name})," will be permanently deleted."]})]}),e.jsxs(Ce,{children:[e.jsx(ke,{children:"Cancel"}),e.jsx(_e,{className:"bg-destructive hover:bg-destructive/90",onClick:()=>He(t.id),children:"Delete"})]})]})]}),Ee(t)&&e.jsx(i,{variant:"ghost",size:"icon",title:"View/Approve",className:"text-blue-600 hover:text-blue-700 h-6 w-6",onClick:o=>{o.stopPropagation(),De(t),le(!0)},children:e.jsx(at,{className:"h-3 w-3"})})]})})]},t.id)})})]})}),C.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2 shrink-0",children:C.links.map((t,s)=>e.jsx(i,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>N.visit(t.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},s))})]})]})}),a&&e.jsxs("div",{className:"w-full lg:w-1/3 border-l bg-background p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col h-full transition-all duration-300 ease-in-out z-20 absolute lg:relative right-0 top-0 lg:top-auto bottom-0 lg:bottom-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(ue=a.institute)==null?void 0:ue.name})]}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>q(null),children:e.jsx(lt,{className:"h-5 w-5"})})]}),e.jsxs(nt,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs(it,{className:"grid w-full grid-cols-3",children:[e.jsx(J,{value:"approvals",children:"Approvals"}),e.jsx(J,{value:"milestones",children:"Milestones"}),e.jsx(J,{value:"payments",children:"Payments"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(Q,{value:"approvals",className:"space-y-4 m-0 h-full",children:W?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading history..."}):te.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No approval history found."}):e.jsx("div",{className:"space-y-4",children:te.map(t=>{var s,n;return e.jsxs(D,{className:"overflow-hidden border shadow-sm",children:[e.jsx(z,{className:"p-2 bg-muted/30 pb-1 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold text-xs",children:((s=t.stage)==null?void 0:s.stage_name)||"Stage"}),t.status==="approved"?e.jsxs(w,{variant:"outline",className:"h-4 border-green-500 text-green-600 bg-green-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(ot,{className:"w-2.5 h-2.5"})," Approved"]}):t.status==="rejected"?e.jsxs(w,{variant:"outline",className:"h-4 border-red-500 text-red-600 bg-red-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(mt,{className:"w-2.5 h-2.5"})," Rejected"]}):e.jsxs(w,{variant:"outline",className:"h-4 border-yellow-500 text-yellow-600 bg-yellow-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(fe,{className:"w-2.5 h-2.5"})," Pending"]})]})}),e.jsxs(M,{className:"p-2 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1 mb-1",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground flex items-center",children:[e.jsx(fe,{className:"w-2.5 h-2.5 mr-1"}),t.action_date?new Date(t.action_date).toLocaleString():"-"]}),e.jsxs("div",{className:"text-[10px]",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Appr: "}),(n=t.approver)==null?void 0:n.name]})]}),t.comments&&e.jsxs("div",{className:"bg-muted/50 px-2 py-1 rounded text-[10px] italic border mt-1 line-clamp-2",children:['"',t.comments,'"']}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.pdf&&e.jsxs("a",{href:`/${t.pdf}`,target:"_blank",className:"text-blue-600 hover:underline text-[10px] flex items-center gap-1",children:[e.jsx(tt,{className:"h-3 w-3"})," PDF"]}),t.img&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{dataImg:t.img,size:"h-4 w-4",className:"rounded border object-cover"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Image"})]})]})]})]},t.id)})})}),e.jsx(Q,{value:"milestones",className:"space-y-4 m-0 h-full",children:W?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading milestones..."}):ae.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No milestones found."}):e.jsx("div",{className:"space-y-4",children:ae.map(t=>e.jsx(D,{className:"cursor-pointer hover:bg-muted/50 transition-colors border shadow-sm overflow-hidden",onClick:()=>Ie(t),children:e.jsxs("div",{className:"flex items-start",children:[t.img&&e.jsx("div",{className:"w-16 h-full shrink-0",children:e.jsx(Z,{dataImg:t.img,size:"h-full w-full",className:"h-full w-full object-cover rounded-none"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(z,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsx("div",{className:"font-semibold text-xs truncate pr-2",children:t.name}),e.jsx(w,{variant:t.status==="completed"?"default":t.status==="inprogress"?"secondary":"outline",className:"capitalize text-[10px] px-1 py-0 h-4 shrink-0",children:t.status})]}),e.jsxs(M,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Due: ",t.days," days"]}),t.completed_date&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Done: ",new Date(t.completed_date).toLocaleDateString()]})]}),t.description&&e.jsx("p",{className:"text-muted-foreground text-[10px] line-clamp-1",children:t.description})]})]})]})},t.id))})}),e.jsx(Q,{value:"payments",className:"space-y-4 m-0 h-full",children:W?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading payments..."}):p.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:["No payments found.",a.actual_cost&&a.approval_status==="approved"&&e.jsx("div",{className:"pt-2",children:e.jsx(i,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:he,children:"Request Payment"})})]}):e.jsxs("div",{className:"space-y-4",children:[p.map(t=>{var s,n;return e.jsxs(D,{className:"border shadow-sm",children:[e.jsxs(z,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{className:"font-semibold text-xs",children:["Rs. ",t.amount.toLocaleString()]}),e.jsx(w,{variant:"outline",className:`capitalize text-[10px] px-1 py-0 h-4 ${t.status==="Approved"?"border-green-500 text-green-600 bg-green-50":t.status==="Rejected"?"border-red-500 text-red-600 bg-red-50":"border-yellow-500 text-yellow-600 bg-yellow-50"}`,children:t.status})]}),e.jsxs(M,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[e.jsx("div",{className:"text-muted-foreground font-medium truncate max-w-[150px]",title:((s=t.fund_head)==null?void 0:s.name)||"General Fund",children:((n=t.fund_head)==null?void 0:n.name)||"General Fund"}),e.jsx("div",{className:"text-muted-foreground",children:new Date(t.added_date).toLocaleDateString()})]}),t.description&&e.jsxs("p",{className:"text-muted-foreground text-[10px] italic bg-muted/30 px-1.5 py-0.5 rounded truncate",children:['"',t.description,'"']}),t.img&&e.jsx("div",{className:"mt-1",children:e.jsx(Z,{dataImg:t.img,size:"h-12",className:"rounded border"})})]})]},t.id)}),(()=>{var d,x,o;const t=parseFloat(((d=a.actual_cost)==null?void 0:d.toString())||"0")||0,s=p.filter(v=>v.status==="Approved").reduce((v,Ke)=>{var ge;return v+(parseFloat(((ge=Ke.amount)==null?void 0:ge.toString())||"0")||0)},0),n=t-s;return a.actual_cost&&((x=p[p.length-1])==null?void 0:x.status)==="Approved"&&n>0&&(p.length===1||p.length===2||p.length===3||p.length===4||(o=a.current_stage)!=null&&o.is_last)?e.jsx("div",{className:"pt-2",children:e.jsx(i,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:he,children:"Request  Payment"})}):null})()]})})]})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/20 lg:hidden z-10",onClick:()=>q(null)}),e.jsx(T,{open:!!X,onOpenChange:t=>!t&&F(null),children:e.jsxs($,{className:"sm:max-w-[500px]",children:[e.jsxs(L,{children:[e.jsx(R,{children:"Edit Milestone"}),e.jsx(O,{children:"Update the details of the milestone. Click save when you're done."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"name",className:"text-right",children:"Name"}),e.jsx(g,{id:"name",value:r.name,onChange:t=>j({...r,name:t.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs("select",{id:"status",value:r.status,onChange:t=>j({...r,status:t.target.value}),className:"col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"inprogress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"days",className:"text-right",children:"Days"}),e.jsx(g,{id:"days",type:"number",value:r.days,onChange:t=>j({...r,days:parseInt(t.target.value)||0}),className:"col-span-3"})]}),r.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"completed_date",className:"text-right",children:"Completed Date"}),e.jsx(g,{id:"completed_date",type:"date",value:r.completed_date,onChange:t=>j({...r,completed_date:t.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"img",className:"text-right",children:"Image"}),e.jsx(g,{id:"img",type:"file",accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&j({...r,img:t.target.files[0]})},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"pdf",className:"text-right",children:"PDF"}),e.jsx(g,{id:"pdf",type:"file",accept:".pdf",onChange:t=>{t.target.files&&t.target.files[0]&&j({...r,pdf:t.target.files[0]})},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"description",className:"text-right",children:"Description"}),e.jsx(dt,{id:"description",value:r.description,onChange:t=>j({...r,description:t.target.value}),className:"col-span-3"})]})]}),e.jsxs(E,{children:[e.jsx(i,{type:"button",variant:"secondary",onClick:()=>F(null),children:"Cancel"}),e.jsx(i,{type:"submit",onClick:qe,disabled:oe,children:oe?"Saving...":"Save changes"})]})]})}),e.jsx(ct,{isOpen:Ae,onClose:()=>le(!1),project:Fe,onSuccess:()=>{N.reload({only:["projects"]})}}),e.jsx(T,{open:ze,onOpenChange:B,children:e.jsxs($,{className:"sm:max-w-[425px]",children:[e.jsxs(L,{children:[e.jsx(R,{children:"Update Actual Cost"}),e.jsxs(O,{children:["Enter the actual cost for ",e.jsx("strong",{children:h==null?void 0:h.name}),"."]})]}),e.jsxs("form",{onSubmit:Be,children:[e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"actual_cost",className:"text-right",children:"Cost"}),e.jsx(g,{id:"actual_cost",type:"number",step:"0.01",className:"col-span-3",value:S.actual_cost,onChange:t=>ie({actual_cost:t.target.value}),required:!0})]})}),e.jsx(E,{children:e.jsx(i,{type:"submit",disabled:ne,children:ne?"Updating...":"Save changes"})})]})]})}),e.jsx(ye,{open:Te,onOpenChange:P,children:e.jsxs(be,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Actual Cost Higher than Estimated"}),e.jsxs(we,{children:["The actual cost you entered (",e.jsx("strong",{children:S.actual_cost}),") is higher than the estimated cost (",e.jsx("strong",{children:h==null?void 0:h.estimated_cost}),").",e.jsx("br",{}),e.jsx("br",{}),"Are you sure you want to proceed with this then  project will be marked as waiting and project submit to Regional Head for approval ?"]})]}),e.jsxs(Ce,{children:[e.jsx(ke,{onClick:()=>P(!1),children:"No"}),e.jsx(_e,{onClick:pe,children:"Yes"})]})]})}),e.jsx(T,{open:$e,onOpenChange:A,children:e.jsxs($,{className:"sm:max-w-[450px]",children:[e.jsxs(L,{children:[e.jsx(R,{children:"Request Payment"}),e.jsxs(O,{children:["Enter the stage name and amount for the payment request.",e.jsx("br",{}),e.jsxs("span",{className:"text-sm font-medium mt-2 inline-block",children:["Remaining Amount: ",e.jsx("span",{className:"text-green-600 font-bold",children:f.toLocaleString()})]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"stage_name",className:"text-right",children:"Stage Name"}),e.jsx(g,{id:"stage_name",placeholder:"e.g., Foundation Work",className:"col-span-3",value:m.stage_name,onChange:t=>G({...m,stage_name:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"payment_amount",className:"text-right",children:"Amount"}),e.jsx(g,{id:"payment_amount",type:"number",step:"0.01",max:f,placeholder:`Max: ${f.toLocaleString()}`,className:"col-span-3",value:m.amount,onChange:t=>G({...m,amount:t.target.value})})]}),parseFloat(m.amount)>f&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:"Amount exceeds remaining balance!"})]}),e.jsxs(E,{children:[e.jsx(i,{variant:"secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsx(i,{onClick:Ge,disabled:de||!m.stage_name||!m.amount||parseFloat(m.amount)>f,children:de?"Requesting...":"Confirm Request"})]})]})}),e.jsx(T,{open:Re,onOpenChange:K,children:e.jsxs($,{className:"sm:max-w-[500px]",children:[e.jsxs(L,{children:[e.jsx(R,{children:"Project Description"}),e.jsx(O,{children:b==null?void 0:b.name})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"bg-muted/30 p-4 rounded-lg border text-sm leading-relaxed whitespace-pre-wrap",children:(b==null?void 0:b.description)||"No description available."})}),e.jsx(E,{children:e.jsx(i,{onClick:()=>K(!1),children:"Close"})})]})})]})}export{Rt as default};
