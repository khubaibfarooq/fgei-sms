import{r as i,a as D,j as e,S as C}from"./app-C_vGv3Mn.js";import{D as b,a as w,b as S,c as A,d as P,e as k,t as o}from"./index-B7RycKoC.js";import{B as c}from"./button-D3ICZUlX.js";import{T as $}from"./textarea-BfOnAr29.js";import{L as m}from"./label-DZZSVEoq.js";import{I as N}from"./input-Dh2IztUZ.js";import{C as E,a as H}from"./circle-x-DVldkpcR.js";import"./index-iuOc_lCk.js";import"./createLucideIcon-N4voy0hI.js";import"./index-B6M9QBmr.js";function G({isOpen:l,onClose:r,project:t}){const[d,p]=i.useState(""),[n,x]=i.useState(null),[h,g]=i.useState(null),[u,y]=i.useState([]),[I,f]=i.useState(!1);i.useEffect(()=>{l&&t&&F()},[l,t]);const F=async()=>{if(t)try{const{data:s}=await D.get(`/projects/${t.id}/history`);y(s)}catch(s){console.error("Failed to fetch history",s)}},j=s=>{if(!t)return;f(!0);const a=new FormData;if(a.append("status",s),a.append("comments",d),!n){o.error("Please upload a PDF file");return}n&&a.append("pdf",n),h&&a.append("img",h),C.post(`/projects/${t.id}/approvals`,a,{forceFormData:!0,onSuccess:()=>{o.success(`Project ${s} successfully`),r(),p(""),x(null),g(null)},onError:()=>{o.error("Failed to process approval")},onFinish:()=>f(!1)})};return t?e.jsx(b,{open:l,onOpenChange:r,children:e.jsxs(w,{className:"max-w-2xl",children:[e.jsxs(S,{children:[e.jsxs(A,{children:["Project Approval: ",t.name]}),e.jsx(P,{children:"Review project details and action approval."})]}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Approval History"}),e.jsx("div",{className:"border rounded-lg p-4 h-48 overflow-y-auto space-y-4 bg-muted/30",children:u.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No approval history."}):u.map(s=>{var a,v;return e.jsxs("div",{className:"flex gap-3 text-sm",children:[s.status==="approved"?e.jsx(E,{className:"w-5 h-5 text-green-500 mt-0.5"}):e.jsx(H,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[((a=s.stage)==null?void 0:a.stage_name)||"Stage"," - ",s.status]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["by ",(v=s.approver)==null?void 0:v.name," on ",s.action_date?new Date(s.action_date).toLocaleString():""]}),s.comments&&e.jsxs("p",{className:"mt-1 text-gray-700 bg-white p-2 rounded border",children:['"',s.comments,'"']}),s.pdf&&e.jsx("a",{href:`/${s.pdf}`,target:"_blank",className:"mt-1 text-blue-600 underline text-xs flex items-center gap-1",children:"View PDF"}),s.img&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:`/${s.img}`,alt:"Approval evidence",className:"h-20 w-auto rounded border"})})]})]},s.id)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"comments",children:"Comments"}),e.jsx($,{id:"comments",placeholder:"Add comments for this action...",value:d,onChange:s=>p(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pdf",children:"Attachment (PDF)"}),e.jsx(N,{id:"pdf",type:"file",accept:".pdf",onChange:s=>{var a;return x(((a=s.target.files)==null?void 0:a[0])||null)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"img",children:"Attachment (Image)"}),e.jsx(N,{id:"img",type:"file",accept:"image/*",onChange:s=>{var a;return g(((a=s.target.files)==null?void 0:a[0])||null)}})]})]})]}),e.jsxs(k,{className:"gap-2 sm:gap-0",children:[e.jsx(c,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"destructive",onClick:()=>j("rejected"),children:"Reject"}),e.jsx(c,{className:"bg-green-600 hover:bg-green-700",onClick:()=>j("approved"),children:"Approve"})]})]})]})}):null}export{G as default};
