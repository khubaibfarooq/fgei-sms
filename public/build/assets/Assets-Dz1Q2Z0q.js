var ke=Object.defineProperty;var we=(l,n,d)=>n in l?ke(l,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[n]=d;var me=(l,n,d)=>we(l,typeof n!="symbol"?n+"":n,d);import{r,j as t,L as Se}from"./app-CylfHKRS.js";import{t as h,A as Ae,S as Ee,B as Re}from"./app-layout-CVL1Iyn-.js";import{B as F}from"./button-D8HhLbFK.js";import{C as he,a as xe,b as ue,c as fe}from"./card-C9gODF9p.js";import{S as b,a as v,b as N,c as k,d as m}from"./select-BEAlBEmw.js";import{l as Ce,E as _e}from"./jspdf.plugin.autotable-BRHPEhJs.js";import{E as Fe,F as Ie}from"./FileSaver.min-CnWGsK-l.js";import"./index-BDAfdMFC.js";import"./index-xdw6RuVl.js";import"./createLucideIcon-0qQpDL3q.js";import"./index-B4YV7qJW.js";import"./app-logo-icon-L8m2nLiQ.js";import"./index-DN4gXtLF.js";import"./index-kOjkuCBN.js";const Be=[{title:"Reports",href:"/reports"},{title:"Assets",href:"/reports/assets"}];class Le extends r.Component{constructor(){super(...arguments);me(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(d){return{hasError:!0,error:d.message}}componentDidCatch(d,w){console.error("ErrorBoundary caught:",d,w),h.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?t.jsxs("div",{className:"p-4",children:[t.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),t.jsx(F,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const a=l=>{const n=l!=null&&typeof l.id=="number"&&l.id>0&&typeof l.name=="string"&&l.name.trim()!=="";return n||console.warn("Invalid item detected:",l),n};function Ke({instituteAssets:l,institutes:n,blocks:d,rooms:w,assetCategories:I,assets:V,regions:B,filters:u}){var ne,ie,ce;const[P,ze]=r.useState(u.search||""),[x,Q]=r.useState(u.institute_id||""),[g,H]=r.useState(u.block_id||""),[M,S]=r.useState(u.room_id||""),[p,ge]=r.useState(u.asset_category_id||""),[D,T]=r.useState(u.asset_id||""),[$,pe]=r.useState(u.region_id||""),[U,L]=r.useState(d.filter(a)),[W,j]=r.useState(w.filter(a)),[J,z]=r.useState(V.filter(a)),[O,Y]=r.useState(!1),[G,K]=r.useState(!1),[X,Z]=r.useState(!1),[y,ee]=r.useState(l),[f,te]=r.useState(n||[]),je=async e=>{try{const s=new URLSearchParams({region_id:e||""}).toString(),o=await fetch(`/reports/getInstitutes?${s}`);if(!o.ok)throw new Error("Failed to fetch institutes");const i=await o.json();console.log("Fetched institutes:",i),te(i),x&&e!=="0"&&!i.some(c=>c.id.toString()===x)&&Q("")}catch(s){console.error("Error fetching institutes:",s),h.error("Failed to load institutes"),te([])}},ye=e=>{pe(e),je(e)};r.useEffect(()=>{const e={institutes:Array.isArray(f)?f.filter(s=>!a(s)):[],blocks:d.filter(s=>!a(s)),rooms:w.filter(s=>!a(s)),assetCategories:I.filter(s=>!a(s)),assets:V.filter(s=>!a(s)),regions:B.filter(s=>!a(s))};Object.entries(e).forEach(([s,o])=>{o.length>0&&console.warn(`Invalid ${s}:`,o)})},[n,d,w,I,V,B,f]),r.useEffect(()=>{x?(Y(!0),fetch(`/reports/blocks?institute_id=${x}`).then(e=>e.json()).then(e=>{if(console.log("Fetched blocks:",e),Array.isArray(e)){const s=e.filter(a);s.length<e.length&&console.warn("Filtered out invalid blocks:",e.filter(o=>!a(o))),L(s)}else console.warn("Blocks response is not an array:",e),h.error("Invalid blocks data received"),L([])}).catch(e=>{console.error("Error fetching blocks:",e),h.error("Failed to fetch blocks"),L([])}).finally(()=>Y(!1)),H(""),j([]),S("")):(L([]),j([]),S(""))},[x]),r.useEffect(()=>{g?(K(!0),fetch(`/reports/rooms?block_id=${g}`).then(e=>e.json()).then(e=>{if(console.log("Fetched rooms:",e),Array.isArray(e)){const s=e.filter(a);s.length<e.length&&console.warn("Filtered out invalid rooms:",e.filter(o=>!a(o))),j(s)}else console.warn("Rooms response is not an array:",e),h.error("Invalid rooms data received"),j([])}).catch(e=>{console.error("Error fetching rooms:",e),h.error("Failed to fetch rooms"),j([])}).finally(()=>K(!1)),S("")):(j([]),S(""))},[g]),r.useEffect(()=>{p?(Z(!0),fetch(`/reports/assets/list?asset_category_id=${p}`).then(e=>e.json()).then(e=>{if(console.log("Fetched assets:",e),Array.isArray(e)){const s=e.filter(a);s.length<e.length&&console.warn("Filtered out invalid assets:",e.filter(o=>!a(o))),z(s)}else console.warn("Assets response is not an array:",e),h.error("Invalid assets data received"),z([])}).catch(e=>{console.error("Error fetching assets:",e),h.error("Failed to fetch assets"),z([])}).finally(()=>Z(!1)),T("")):(z([]),T(""))},[p]);const be=async()=>{const e=new Fe.Workbook,s=e.addWorksheet("Assets");s.columns=[{header:"Details",key:"details",width:30},{header:"Quantity",key:"qty",width:10},{header:"Institute",key:"institute",width:20},{header:"Block",key:"block",width:20},{header:"Room",key:"room",width:20},{header:"Category",key:"category",width:20},{header:"Asset",key:"asset",width:20},{header:"Region",key:"region",width:20}],y.data.forEach(c=>{var A,E,R,C,_,de;s.addRow({details:c.details,qty:c.current_qty,institute:((A=c.institute)==null?void 0:A.name)||"N/A",block:((E=c.block)==null?void 0:E.name)||"N/A",room:((R=c.room)==null?void 0:R.name)||"N/A",category:((C=c.assetCategory)==null?void 0:C.name)||"N/A",asset:((_=c.asset)==null?void 0:_.name)||"N/A",region:((de=c.region)==null?void 0:de.name)||"N/A"})});const o=await e.xlsx.writeBuffer(),i=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ie.saveAs(i,"Assets_Report.xlsx")},ve=()=>{const e=new _e;e.setFontSize(16),e.text("Assets Report",14,15);const s=["Details","Qty","Institute","Block","Room","Category","Asset","Region"],o=y.data.map(i=>{var c,A,E,R,C,_;return[i.details,i.current_qty,((c=i.institute)==null?void 0:c.name)||"N/A",((A=i.block)==null?void 0:A.name)||"N/A",((E=i.room)==null?void 0:E.name)||"N/A",((R=i.assetCategory)==null?void 0:R.name)||"N/A",((C=i.asset)==null?void 0:C.name)||"N/A",((_=i.region)==null?void 0:_.name)||"N/A"]});e.autoTable({head:[s],body:o,startY:25,styles:{fontSize:10}}),e.save("Assets_Report.pdf")},Ne=r.useMemo(()=>Ce.debounce(()=>{const e=new URLSearchParams({search:P||"",institute_id:x||"",block_id:g||"",room_id:M||"",asset_category_id:p||"",asset_id:D||"",region_id:$||""});fetch(`/reports/assets/institute-assets?${e.toString()}`).then(s=>s.json()).then(s=>{console.log("Fetched filtered institute assets:",s),ee(s)}).catch(s=>{console.error("Error fetching filtered assets:",s),h.error("Failed to fetch filtered assets")})},300),[P,x,g,M,p,D,$]),se=r.useMemo(()=>Array.isArray(f)?f.filter(a):(console.warn("filteredInstitutes is not an array or is null:",f),[]),[f]),re=r.useMemo(()=>U.filter(a),[U]),oe=r.useMemo(()=>W.filter(a),[W]),ae=r.useMemo(()=>I.filter(a),[I]),le=r.useMemo(()=>J.filter(a),[J]),q=r.useMemo(()=>B.filter(a),[B]);return t.jsx(Le,{children:t.jsxs(Ae,{breadcrumbs:Be,children:[t.jsx(Se,{title:"Assets Report"}),t.jsx("div",{className:"flex-1 p-2 md:p-2",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[t.jsx("div",{className:"w-full md:w-1/3",children:t.jsxs(he,{children:[t.jsxs(xe,{children:[t.jsx(ue,{className:"text-xl font-bold",children:"Filters"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your assets search"})]}),t.jsxs(fe,{className:"space-y-4",children:[q.length>0&&t.jsxs(b,{value:$,onValueChange:ye,children:[t.jsx(v,{children:t.jsx(N,{placeholder:"Select Region"})}),t.jsxs(k,{children:[t.jsx(m,{value:"0",children:"All Regions"}),q.length>0?q.map(e=>t.jsx(m,{value:e.id.toString(),children:e.name},e.id)):t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No regions available"})]})]}),t.jsxs(b,{value:x,onValueChange:e=>{Q(e)},children:[t.jsx(v,{children:t.jsx(N,{placeholder:"Select Institute"})}),t.jsxs(k,{children:[t.jsx(m,{value:"0",children:"All Institutes"}),se.length>0?se.map(e=>t.jsx(m,{value:e.id.toString(),children:e.name},e.id)):t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]}),t.jsxs(b,{value:g,onValueChange:e=>{H(e)},disabled:O,children:[t.jsx(v,{children:t.jsx(N,{placeholder:"Select Block"})}),t.jsxs(k,{children:[t.jsx(m,{value:"0",children:"All Blocks"}),O?t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"Loading blocks..."}):re.length>0?re.map(e=>t.jsx(m,{value:e.id.toString(),children:e.name},e.id)):t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No blocks available"})]})]}),t.jsxs(b,{value:M,onValueChange:e=>{S(e)},disabled:G,children:[t.jsx(v,{children:t.jsx(N,{placeholder:"Select Room"})}),t.jsxs(k,{children:[t.jsx(m,{value:"0",children:"All Rooms"}),G?t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"Loading rooms..."}):oe.length>0?oe.map(e=>t.jsx(m,{value:e.id.toString(),children:e.name},e.id)):t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No rooms available"})]})]}),t.jsxs(b,{value:p,onValueChange:e=>{ge(e)},children:[t.jsx(v,{children:t.jsx(N,{placeholder:"Select Asset Category"})}),t.jsxs(k,{children:[t.jsx(m,{value:"0",children:"All Asset Categories"}),ae.length>0?ae.map(e=>t.jsx(m,{value:e.id.toString(),children:e.name},e.id)):t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No asset categories available"})]})]}),t.jsxs(b,{value:D,onValueChange:e=>{T(e)},disabled:X,children:[t.jsx(v,{children:t.jsx(N,{placeholder:"Select Asset"})}),t.jsxs(k,{children:[t.jsx(m,{value:"0",children:"All Assets"}),X?t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"Loading assets..."}):le.length>0?le.map(e=>t.jsx(m,{value:e.id.toString(),children:e.name},e.id)):t.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No assets available"})]})]}),t.jsx(F,{onClick:Ne,className:"w-full",children:"Apply Filters"})]})]})}),t.jsx("div",{className:"w-full md:w-2/3",children:t.jsxs(he,{children:[t.jsxs(xe,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[t.jsx("div",{children:t.jsx(ue,{className:"text-2xl font-bold",children:"Assets Report"})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(F,{onClick:ve,className:"w-full md:w-auto",children:"Export PDF"}),t.jsx(F,{onClick:be,className:"w-full md:w-auto",children:"Export Excel"})]})]}),t.jsx(Ee,{}),t.jsxs(fe,{className:"pt-6 space-y-6",children:[t.jsxs("table",{className:"w-full border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[t.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset"}),t.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Quantity"}),t.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Room"}),t.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Description"})]})}),t.jsx("tbody",{children:((ne=y.data)==null?void 0:ne.length)===0?t.jsx("tr",{children:t.jsx("td",{colSpan:4,className:"border p-2 text-center text-sm text-gray-900 dark:text-gray-100",children:"No assets found."})}):(ie=y.data)==null?void 0:ie.map(e=>{var s,o;return t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[t.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Re,{className:"h-5 w-5 text-blue-600"}),t.jsx("div",{className:"space-y-1",children:t.jsx("div",{className:"font-medium",children:(s=e.asset)==null?void 0:s.name})})]})}),t.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:e.current_qty}),t.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:((o=e.room)==null?void 0:o.name)||"N/A"}),t.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:e.details||"N/A"})]},e.id)})})]}),((ce=y.links)==null?void 0:ce.length)>1&&t.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:y.links.map((e,s)=>t.jsx(F,{disabled:!e.url,variant:e.active?"default":"outline",size:"sm",onClick:()=>{e.url&&fetch(e.url).then(o=>o.json()).then(o=>{ee(o)}).catch(o=>{console.error("Error:",o)})},className:e.active?"bg-blue-600 hover:bg-blue-700":"",children:t.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})},s))})]})]})})]})})]})})}export{Ke as default};
