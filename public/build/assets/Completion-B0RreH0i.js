import{r,j as e,L as Q}from"./app-DAj7CVqE.js";import{A as ee,S as te}from"./app-layout-nacYE_Wo.js";import{B as d}from"./button-Ca9KyqGB.js";import{C as k,a as C,b as S,c as v}from"./card-DlszQ9sM.js";import{S as se,a as ae,b as le,c as ne,d as y}from"./select-QiLc29Xz.js";import{t as R,D as re,a as oe,b as ie,c as ce,d as de}from"./index-TsyQ6Yxi.js";import{C as E}from"./combobox-BM1yB8Xn.js";import{E as he,F as xe,a as pe,b as z}from"./jspdf.plugin.autotable-DKttSBwg.js";import{C as me,a as F}from"./circle-x-CvEYnKh0.js";import"./index-Bvbia1rq.js";import"./createLucideIcon-BGkbiYgR.js";import"./index-DgP3OMKc.js";import"./index-DqZvekN6.js";import"./index-DdOi-ESM.js";import"./index-BbRb5pqk.js";import"./input-BwM7ypGM.js";import"./app-logo-icon-0rSIqKZ7.js";import"./folder-root-C6G0J42y.js";import"./grip-vertical-w-UtFkNZ.js";import"./index-BF6_IVeq.js";import"./index-BtqvPGbH.js";import"./popover-zgyfcfYY.js";const ue=[{title:"Reports",href:"/reports"},{title:"Completion",href:"/reports/completion"}];function Le({regions:w=[],filters:N,institutes:P=[],totalinstitutes:L}){const[$,Z]=r.useState(L),[p,u]=r.useState(N.region_id||""),[A,m]=r.useState(N.institute_id||""),[s,i]=r.useState(N.status||""),[V,b]=r.useState(P),[f,O]=r.useState([]),[o,U]=r.useState([]),[D,I]=r.useState(!1),[W,_]=r.useState(!1),[h,T]=r.useState(null),[Y,B]=r.useState(!1),H=async t=>{B(!0),_(!0),T(null);try{const n=await fetch(`/reports/completion/getDetails?institute_id=${t}`);if(!n.ok)throw new Error;const a=await n.json();T(a)}catch{R.error("Failed to load details"),_(!1)}finally{B(!1)}};r.useEffect(()=>{p&&p!=="0"?fetch(`/reports/getInstitutes?region_id=${p}`).then(t=>t.json()).then(t=>b(t)).catch(()=>R.error("Failed to load institutes")):b([])},[p]);const j=t=>{const n=t.toString();u(n),m(""),c({region_id:n,institute_id:""})},M=t=>{const n=t.toString();m(n),u(""),window.open(`/reports/institutes?region_id=${p}&institute_id=${t}`,"_blank")},J=async()=>{const t=new he.Workbook,n=t.addWorksheet("Summary");n.columns=[{header:"Region",key:"region",width:30},{header:"Total Institutes",key:"total",width:20},{header:"Completed",key:"completed",width:20},{header:"Above 50%",key:"greater",width:20},{header:"Below 50%",key:"less",width:20},{header:"Zero (0%)",key:"zero",width:20}],f.forEach(l=>{n.addRow({region:l.region,total:l.total_institutes,completed:l.completed,greater:l.greater_than_50,less:l.less_than_50,zero:l.zero})});const a=t.addWorksheet("Details");o.length>0&&o[0].is_region?(a.columns=[{header:"Region",key:"name",width:30},{header:"Shifts",key:"shifts",width:10},{header:"Blocks",key:"blocks",width:10},{header:"Rooms",key:"rooms",width:10},{header:"Assets",key:"assets",width:10},{header:"Plants",key:"plants",width:10},{header:"Transports",key:"transports",width:12},{header:"Funds",key:"funds",width:10},{header:"Projects",key:"projects",width:10},{header:"Upgradations",key:"upgradations",width:12},{header:"Total Institutes",key:"total",width:20},{header:"Completed",key:"completed",width:20},{header:"Above 50%",key:"greater",width:20},{header:"Below 50%",key:"less",width:20},{header:"Zero (0%)",key:"zero",width:20}],o.forEach(l=>{a.addRow({name:l.name,shifts:l.shifts,blocks:l.blocks,rooms:l.rooms,assets:l.assets,plants:l.plants,transports:l.transports,funds:l.funds,projects:l.projects,upgradations:l.upgradations,total:l.total_institutes,completed:l.completed,greater:l.greater_than_50,less:l.less_than_50,zero:l.zero})})):(a.columns=[{header:"Institute",key:"name",width:40},{header:"Region",key:"region",width:30},{header:"Shifts",key:"shifts",width:10},{header:"Blocks",key:"blocks",width:10},{header:"Rooms",key:"rooms",width:10},{header:"Assets",key:"assets",width:10},{header:"Plants",key:"plants",width:10},{header:"Transports",key:"transports",width:12},{header:"Funds",key:"funds",width:10},{header:"Projects",key:"projects",width:10},{header:"Upgradations",key:"upgradations",width:12},{header:"Total %",key:"percentage",width:10}],o.forEach(l=>{a.addRow({name:l.name,region:l.region_name,shifts:l.shifts,blocks:l.blocks,rooms:l.rooms,assets:l.assets,plants:l.plants,transports:l.transports,funds:l.funds,projects:l.projects,upgradations:l.upgradations,percentage:l.percentage+"%"})}));const K=await t.xlsx.writeBuffer();xe.saveAs(new Blob([K]),"Completion_Report.xlsx")},X=()=>{const t=new pe("l","mm","a4");t.text("Completion Report - Summary",14,15),z(t,{head:[["Region","Total Institutes","Completed","Above 50%","Below 50%","Zero (0%)"]],body:f.map(a=>[a.region,a.total_institutes,a.completed,a.greater_than_50,a.less_than_50,a.zero]),startY:20}),t.addPage(),t.text("Completion Report - Details",14,15),o.length>0&&o[0].is_region?z(t,{head:[["Region","Total Inst.","Comp.","Above 50%","Below 50%","Zero (0%)"]],body:o.map(a=>[a.name,a.total_institutes||0,a.completed||0,a.greater_than_50||0,a.less_than_50||0,a.zero||0]),startY:20,styles:{fontSize:8}}):z(t,{head:[["Institute","Shifts","Blocks","Rooms","Assets","Plants","Transports","Funds","Projects","Upgradations","Total %"]],body:o.map(a=>[a.name,a.shifts||0,a.blocks||0,a.rooms||0,a.assets||0,a.plants||0,a.transports||0,a.funds||0,a.projects||0,a.upgradations||0,(a.percentage||0)+"%"]),startY:20,styles:{fontSize:8}}),t.save("Completion_Report.pdf")},c=async t=>{I(!0);try{const n=new URLSearchParams({region_id:(t==null?void 0:t.region_id)??p??"",institute_id:(t==null?void 0:t.institute_id)??A??"",status:(t==null?void 0:t.status)??s??""}),a=await fetch(`/reports/completion/getData?${n.toString()}`);if(!a.ok)throw new Error;const g=await a.json();O(g.summary),U(g.details),Z(g.totalinstitutes),g.institutes&&b(g.institutes)}catch{R.error("Failed to load report data")}finally{I(!1)}};r.useEffect(()=>{c()},[]);const q=()=>{c()},G=()=>{u(""),m(""),i(""),c({region_id:"",institute_id:"",status:""})},x=o.length>0&&o[0].is_region;return e.jsxs(ee,{breadcrumbs:ue,children:[e.jsx(Q,{title:"Completion Report"}),e.jsxs("div",{className:"p-4 lg:p-6 max-w-full space-y-6",children:[e.jsxs(k,{className:"w-full shadow-lg",children:[e.jsx(C,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-2xl font-bold",children:"Completion Report"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Institute data completion status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:X,variant:"outline",size:"sm",children:"PDF"}),e.jsx(d,{onClick:J,variant:"outline",size:"sm",children:"Excel"})]})]})}),e.jsx(te,{}),e.jsx(v,{className:"pt-6 pb-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[w.length>0&&e.jsx(E,{entity:"region",value:p,onChange:t=>{u(t),m("")},options:w.map(t=>({id:t.id.toString(),name:t.name.split(" ").pop()||t.name})),includeAllOption:!0,placeholder:"Select Region"}),e.jsx(E,{entity:"institute",value:A,onChange:m,options:V.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!0,placeholder:"Select Institute"}),e.jsxs(se,{value:s,onValueChange:i,children:[e.jsx(ae,{children:e.jsx(le,{placeholder:"Status"})}),e.jsxs(ne,{children:[e.jsx(y,{value:"all",children:"All Statuses"}),e.jsx(y,{value:"completed",children:"Completed (100%)"}),e.jsx(y,{value:"greater_than_50",children:"Above 50%"}),e.jsx(y,{value:"less_than_50",children:"Below 50%"}),e.jsx(y,{value:"zero",children:"Zero (0%)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:q,className:"flex-1",disabled:D,children:D?"Loading...":"Apply"}),e.jsx(d,{variant:"outline",onClick:G,className:"flex-1",children:"Reset"})]})]})})]}),e.jsxs(k,{children:[e.jsx(C,{children:e.jsx(S,{className:"text-lg",children:"Summary"})}),e.jsx(v,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted/50 text-muted-foreground uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:"Total Institutes"}),s=="completed"||s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Completed Data"}):null,s=="greater_than_50"||s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Above 50%"}):null,s=="less_than_50"||s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Below 50%"}):null,s=="zero"||s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Zero (0%)"}):null]})}),e.jsx("tbody",{className:"divide-y",children:f.length>0?f.map((t,n)=>e.jsxs("tr",{className:"hover:bg-muted/50",children:[e.jsx("td",{className:"px-4 py-3 text-center",children:$}),s=="completed"||s==""?e.jsx("td",{className:"px-4 py-3 text-center text-green-600 font-bold",children:t.completed}):null,s=="greater_than_50"||s==""?e.jsx("td",{className:"px-4 py-3 text-center text-green-600 font-bold",children:t.greater_than_50}):null,s=="less_than_50"||s==""?e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",children:t.less_than_50}):null,s=="zero"||s==""?e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",children:t.zero}):null]},n)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-muted-foreground",children:"No summary data available"})})})]})})})]}),e.jsxs(k,{children:[e.jsx(C,{children:e.jsx(S,{className:"text-lg",children:"Institute Details"})}),e.jsxs(v,{children:[!x&&w.length>0?e.jsx(d,{onClick:()=>{u(""),m(""),c({region_id:"",institute_id:""})},variant:"outline",size:"sm",children:"Show All Regions"}):e.jsx(d,{onClick:()=>{u(""),m(""),c({region_id:"",institute_id:""})},variant:"outline",size:"sm",children:"Show All Institutes"}),e.jsx(d,{onClick:()=>{i(""),c({status:""})},variant:"outline",size:"sm",className:"mr-2 text-white bg-blue-500 hover:bg-blue-600",children:"All Statuses"}),"  ",e.jsx(d,{onClick:()=>{i("completed"),c({status:"completed"})},variant:"outline",size:"sm",className:"mr-2 text-white bg-green-500 hover:bg-green-600",children:"Completed (100%)"})," ",e.jsx(d,{onClick:()=>{i("greater_than_50"),c({status:"greater_than_50"})},variant:"outline",size:"sm",className:"mr-2 text-white bg-green-500 hover:bg-green-600",children:"Above 50%"})," ",e.jsx(d,{onClick:()=>{i("less_than_50"),c({status:"less_than_50"})},variant:"outline",size:"sm",className:"mr-2 text-white bg-red-500 hover:bg-red-600",children:"Below 50%"}),e.jsx(d,{onClick:()=>{i("zero"),c({status:"zero"})},variant:"outline",size:"sm",className:"mr-2 text-white bg-red-500 hover:bg-red-600",children:"Zero (0%)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted/50 text-muted-foreground uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 min-w-[200px]",children:x?"Region":"Institute"}),x?e.jsxs(e.Fragment,{children:[s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Total Inst."}):null,s=="completed"||s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Comp."}):null,s=="greater_than_50"||s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Above 50%"}):null,s=="less_than_50"||s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Below 50%"}):null,s=="zero"||s==""?e.jsx("th",{className:"px-4 py-3 text-center",children:"Zero (0%)"}):null]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:"Shifts"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Blocks"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Rooms"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Assets"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Plants"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Transports"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Fund"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Projects"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Upgrad."}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Total %"})]})]})}),e.jsx("tbody",{className:"divide-y",children:o.length>0?o.map(t=>e.jsxs("tr",{className:`hover:bg-muted/50 ${x?"cursor-pointer":""}`,onClick:()=>x?j(t.id):M(t.id),children:[e.jsx("td",{className:`px-4 py-3 font-medium ${x?"text-blue-600":""}`,children:x&&t.name.split(" ").pop()||t.name}),x?e.jsxs(e.Fragment,{children:[s==""?e.jsx("td",{className:"px-4 py-3 text-center",children:t.total_institutes}):null,s=="completed"||s==""?e.jsx("td",{className:"px-4 py-3 text-center text-green-600 font-bold",onClick:()=>{i("completed"),j(t.id)},children:t.completed}):null,s=="greater_than_50"||s==""?e.jsx("td",{className:"px-4 py-3 text-center text-green-600 font-bold",onClick:()=>{i("greater_than_50"),j(t.id)},children:t.greater_than_50}):null,s=="less_than_50"||s==""?e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",onClick:()=>{i("less_than_50"),j(t.id)},children:t.less_than_50}):null,s=="zero"||s==""?e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",onClick:()=>{i("zero"),j(t.id)},children:t.zero}):null]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:t.shifts}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.blocks}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.rooms}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.assets}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.plants}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.transports}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.funds}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.projects}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.upgradations}),e.jsx("td",{className:"px-4 py-3 text-center font-bold",children:e.jsxs("span",{className:t.percentage===100?"text-green-600":t.percentage<50?"text-red-600":"text-yellow-600",onClick:n=>{n.stopPropagation(),H(t.id)},style:{cursor:"pointer",textDecoration:"underline"},title:"Click to see breakdown",children:[t.percentage,"%"]})})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:x?14:11,className:"px-4 py-8 text-center text-muted-foreground",children:"No details available"})})})]})})]})]}),e.jsx(re,{open:W,onOpenChange:_,children:e.jsxs(oe,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsxs(ce,{className:"text-xl",children:["Completion Details: ",(h==null?void 0:h.institute)||"Loading..."]}),e.jsx(de,{children:"Detailed breakdown of invalid or missing criteria."})]}),Y?e.jsx("div",{className:"flex justify-center p-8",children:"Loading details..."}):h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsx("span",{className:"font-semibold text-lg",children:"Total Score"}),e.jsxs("span",{className:`text-2xl font-bold ${h.percentage===100?"text-green-600":h.percentage<10?"text-red-600":"text-yellow-600"}`,children:[h.percentage,"%"]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50 text-muted-foreground uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Criteria"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Weight"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Message"})]})}),e.jsx("tbody",{className:"divide-y",children:h.criteria.map((t,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:t.name}),e.jsxs("td",{className:"px-4 py-3 text-right text-muted-foreground",children:[t.weight,"%"]}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.completed?e.jsx(me,{className:"w-5 h-5 text-green-500 mx-auto"}):e.jsx(F,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:`px-4 py-3 ${t.completed?"text-green-600":"text-red-600"}`,children:t.message})]},n))})]})}),h.percentage<100&&e.jsxs("div",{className:"text-sm text-muted-foreground bg-blue-50 p-3 rounded border border-blue-100 dark:bg-blue-900/20 dark:border-blue-900",children:["Note: Please address the items marked with ",e.jsx(F,{className:"w-3 h-3 inline text-red-500"})," to reach 100% completion."]})]}):e.jsx("div",{className:"text-center text-red-500",children:"Failed to load details."})]})})]})]})}export{Le as default};
