var V=Object.defineProperty;var H=(r,o,a)=>o in r?V(r,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[o]=a;var L=(r,o,a)=>H(r,typeof o!="symbol"?o+"":o,a);import{r as c,j as e,L as W,S as J}from"./app-fTHYdGsa.js";import{C as Y,t as F,A as q,S as G}from"./app-layout-5H0-e-lV.js";import{B as f,c as D}from"./button-BHQAtpO8.js";import{C as P,a as T,b as _,c as U}from"./card-_EmB21vm.js";import{S as K,a as Q,b as X,c as Z,d as M}from"./select-CVCmw6c_.js";import{l as ee,E as te}from"./jspdf.plugin.autotable--0Q1XXbk.js";import{E as se,F as re}from"./FileSaver.min-BbzV-nzN.js";import{f as $}from"./dateFormatter-Cn65gwBN.js";import{P as ae,a as oe,b as ne,_ as le,S as ie,C as de,I as ce,E as me,h as B}from"./popover-BfONWIwa.js";import{C as z}from"./index-BCiWSc-I.js";import"./index-CDoAZSK9.js";import"./index-CmdIiAuW.js";import"./createLucideIcon-CEH6isAz.js";import"./app-logo-icon-flERtXXt.js";import"./index-BjDymVkp.js";import"./index-CWn665QU.js";function he({entity:r,value:o,onChange:a,options:h,placeholder:w,notFoundMessage:A,includeAllOption:x=!1,allOptionLabel:b=`All ${r}s`}){const[p,g]=c.useState(!1),u={institute:"Select Institute",permission:"Select permissions",role:"Select roles",user:"Select users",menu:"Select menus"},S={institute:"No institutes available",permission:"Permission not found",role:"Role not found",user:"User not found",menu:"Menu not found"},m=w||u[r]||`Select ${r}s`,N=A||S[r]||`${r} not found`,k=`Search ${r}...`,j=h.find(i=>i.id===o),C=(i,E)=>i==="0"&&x||i.toLowerCase().includes(E.toLowerCase())?1:0;return e.jsxs(ae,{open:p,onOpenChange:g,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":p,className:"w-full justify-between",children:[o&&j?j.name:m,e.jsx(Y,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ne,{className:"w-full p-0 max-h-60 overflow-y-auto",children:e.jsxs(le,{filter:C,className:"w-full",children:[e.jsx(ie,{placeholder:k,className:"w-full h-10 px-3 text-sm border-b"}),e.jsxs(de,{children:[e.jsx(ce,{children:N}),e.jsxs(me,{children:[x&&e.jsxs(B,{value:"0",onSelect:()=>{a("0"),g(!1)},children:[e.jsx(z,{className:D("mr-2 h-4 w-4",o==="0"?"opacity-100":"opacity-0")}),b]}),h.map(i=>e.jsxs(B,{value:i.name,onSelect:()=>{a(i.id),g(!1)},children:[e.jsx(z,{className:D("mr-2 h-4 w-4",o===i.id?"opacity-100":"opacity-0")}),i.name]},i.id))]})]})]})})]})}const xe=[{title:"Reports",href:"/reports"},{title:"upgradations",href:"/reports/upgradations"}];class ue extends c.Component{constructor(){super(...arguments);L(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(a){return{hasError:!0,error:a.message}}componentDidCatch(a,h){console.error("ErrorBoundary caught:",a,h),F.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(f,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const v=r=>{const o=r!=null&&typeof r.id=="number"&&r.id>0&&typeof r.name=="string"&&r.name.trim()!=="";return o||console.warn("Invalid item detected:",r),o};function Le({upgradations:r,institutes:o,regions:a,filters:h}){const[w,A]=c.useState(h.search||""),[x,b]=c.useState(h.institute_id||""),[p,g]=c.useState(h.region_id||""),[u,S]=c.useState(r),[m,N]=c.useState(o||[]),k=c.useMemo(()=>Array.isArray(m)?m.filter(v):(console.warn("filteredInstitutes is not an array or is null:",m),[]),[m]),j=c.useMemo(()=>Array.isArray(a)?a.filter(v):(console.warn("regions is not an array or is null:",a),[]),[a]);c.useEffect(()=>{const t={institutes:Array.isArray(m)?m.filter(s=>!v(s)):[],regions:Array.isArray(a)?a.filter(s=>!v(s)):[]};Object.entries(t).forEach(([s,d])=>{d.length>0&&console.warn(`Invalid ${s}:`,d)})},[m,a]);const C=async t=>{try{const s=new URLSearchParams({region_id:t||""}).toString(),d=await fetch(`/reports/getInstitutes?${s}`);if(!d.ok)throw new Error("Failed to fetch institutes");const n=await d.json();console.log("Fetched institutes:",n),N(n),x&&t!=="0"&&!n.some(l=>l.id.toString()===x)&&b("")}catch(s){console.error("Error fetching institutes:",s),F.error("Failed to load institutes"),N([])}},i=t=>{g(t),C(t),R()},E=async()=>{const t=new se.Workbook,s=t.addWorksheet("upgradations");s.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:30},{header:"Date To",key:"to",width:20},{header:"Level From",key:"levelfrom",width:30},{header:"Level To",key:"levelto",width:20},{header:"Status",key:"status",width:20},{header:"Institute",key:"institute",width:30},{header:"Region",key:"region",width:30}],u.data.forEach(l=>{var y,I;s.addRow({details:l.details,from:l.from,to:l.to,levelfrom:l.levelfrom,levelto:l.levelto,status:l.status,institute:((y=l.institute)==null?void 0:y.name)||"N/A",region:((I=l.region)==null?void 0:I.name)||"N/A"})});const d=await t.xlsx.writeBuffer(),n=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});re.saveAs(n,"upgradations_Report.xlsx")},O=()=>{const t=new te;t.setFontSize(16),t.text("upgradations Report",14,15);const s=["Details","Date From","Date To","Level From","Level To","Status","Institute","Region"],d=u.data.map(n=>{var l,y;return[n.details,n.from,n.to,n.levelfrom,n.levelto,n.status,((l=n.institute)==null?void 0:l.name)||"N/A",((y=n.region)==null?void 0:y.name)||"N/A"]});t.autoTable({head:[s],body:d,startY:25,styles:{fontSize:10}}),t.save("upgradation_Report.pdf")},R=c.useMemo(()=>ee.debounce(()=>{const t=new URLSearchParams({search:w||"",institute_id:x||"",region_id:p||""});fetch(`/reports/upgradations/getUpgradations?${t.toString()}`).then(s=>s.json()).then(s=>{console.log("Fetched filtered upgradations:",s),S(s)}).catch(s=>{console.error("Error fetching filtered upgradations:",s),F.error("Failed to fetch filtered upgradations")})},300),[w,x,p]);return e.jsx(ue,{children:e.jsxs(q,{breadcrumbs:xe,children:[e.jsx(W,{title:"Upgradations Report"}),e.jsx("div",{className:"flex-1 p-1 md:p-1",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs(P,{children:[e.jsxs(T,{children:[e.jsx(_,{className:"text-xl font-bold",children:"Filters"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your Upgradation search"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs(K,{value:p,onValueChange:i,children:[e.jsx(Q,{children:e.jsx(X,{placeholder:"Select Region"})}),e.jsxs(Z,{children:[e.jsx(M,{value:"0",children:"All Regions"}),j.length>0?j.map(t=>e.jsx(M,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-1",children:"No regions available"})]})]}),e.jsx(he,{entity:"institute",value:x,onChange:t=>b(t),options:k.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!1}),e.jsx(f,{onClick:R,className:"w-full",children:"Apply Filters"})]})]})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsxs(P,{children:[e.jsxs(T,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{children:e.jsx(_,{className:"text-2xl font-bold",children:"Upgradation Report"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:O,className:"w-full md:w-auto",children:"Export PDF"}),e.jsx(f,{onClick:E,className:"w-full md:w-auto",children:"Export Excel"})]})]}),e.jsx(G,{}),e.jsxs(U,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"From"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"To"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Status"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Institute"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Region"})]})}),e.jsx("tbody",{children:u.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-muted-foreground text-center p-4",children:"No upgradations found."})}):u.data.map(t=>{var s,d;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 text-center",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:$(t.from)}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:$(t.to)}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelfrom}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelto}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.status}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:((s=t.institute)==null?void 0:s.name)||"N/A"}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:((d=t.region)==null?void 0:d.name)||"N/A"})]},t.id)})})]})}),u.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:u.links.map((t,s)=>e.jsx(f,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>J.visit(t.url||"",{preserveScroll:!0}),className:t.active?"bg-blue-600 hover:bg-blue-700":"",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},s))})]})]})})]})})]})})}export{Le as default};
