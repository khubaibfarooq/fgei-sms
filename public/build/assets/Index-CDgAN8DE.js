import{r,j as e,L as me}from"./app-eQFvco_Z.js";import{A as he,S as ge,t as O}from"./app-layout-gNbV12DA.js";import{B as ue}from"./button-EDd4Qq4O.js";import{C as be,a as fe,b as ye,c as je}from"./card-CPHsdRV0.js";import{I as pe}from"./index-C2ttMzgP.js";import{S as q,a as F,b as T,c as M,d as y}from"./select-BWwX1EHf.js";import{E as ke,F as Ne}from"./FileSaver.min-De7zsSxX.js";import"./index-Cc760h59.js";import"./createLucideIcon-DhafAnds.js";import"./index-CTpQjDWz.js";import"./app-logo-icon-Y__XmXHo.js";import"./index-BWZomMxh.js";import"./index-YvF2fBm_.js";const we=[{title:"Institutional Report",href:"/reports/institutes"}],$=o=>{const i=o!=null&&typeof o.id=="number"&&o.id>0&&typeof o.name=="string"&&o.name.trim()!=="";return i||console.warn("Invalid item detected:",o),i};function Fe({institutes:o=[],regions:i=[],blocks:U=[],instituteAssets:V=[],rooms:z=[],shifts:K=[],upgradations:P=[],filters:j={search:"",institute_id:"",region_id:""}}){const[p,Q]=r.useState(j.search||""),[c,C]=r.useState(j.institute_id||""),[k,H]=r.useState(j.region_id||""),[I,_]=r.useState(o),[A,ve]=r.useState(i),[x,J]=r.useState(U),[m,G]=r.useState(V),[h,X]=r.useState(z),[g,Y]=r.useState(K),[u,Z]=r.useState(P),[N,ee]=r.useState(!1),[w,te]=r.useState(!1),[v,se]=r.useState(!1),[S,re]=r.useState(!1),[R,ae]=r.useState(!1),B=r.useMemo(()=>I.filter($),[I]),b=r.useMemo(()=>A.filter($),[A]);console.log(b);const L=async t=>{try{const a=new URLSearchParams(t).toString(),l=await fetch(`/reports/institutes/getData?${a}`);if(!l.ok)throw new Error("Failed to fetch data");const d=await l.json();J(d.blocks||[]),G(d.instituteAssets||[]),X(d.rooms||[]),Y(d.shifts||[]),Z(d.upgradations||[])}catch(a){console.error("Error fetching data:",a),O.error("Failed to load data")}},de=t=>{t.key==="Enter"&&L({search:p,institute_id:c,region_id:k})},oe=t=>{C(t),L({search:p,institute_id:t,region_id:k})},le=async t=>{try{const a=new URLSearchParams({region_id:t||""}).toString(),l=await fetch(`/reports/getInstitutes?${a}`);if(!l.ok)throw new Error("Failed to fetch institutes");const d=await l.json();console.log("Fetched institutes:",d),_(d),c&&t!=="0"&&!d.some(f=>f.id.toString()===c)&&C("")}catch(a){console.error("Error fetching institutes:",a),O.error("Failed to load institutes"),_([])}},ne=async t=>{H(t),le(t)},ie=async()=>{const t=new ke.Workbook,a=t.addWorksheet("Shifts");a.columns=[{header:"Name",key:"name",width:20},{header:"Building Name",key:"building_name",width:20},{header:"Building Type",key:"building_type",width:20}],g.forEach(s=>{var n;a.addRow({name:s.name,building_name:s.building_name,building_type:((n=s.building_type)==null?void 0:n.name)||"N/A"})});const l=t.addWorksheet("Blocks");l.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15}],x.forEach(s=>{l.addRow({name:s.name,area:s.area})});const d=t.addWorksheet("Rooms");d.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15},{header:"Block",key:"block",width:20}],h.forEach(s=>{var n;d.addRow({name:s.name,area:s.area,block:((n=s.block)==null?void 0:n.name)||"N/A"})});const f=t.addWorksheet("Assets");f.columns=[{header:"Details",key:"details",width:30},{header:"Quantity",key:"qty",width:10},{header:"Institute",key:"institute",width:20},{header:"Room",key:"room",width:20},{header:"Asset",key:"asset",width:20}],m.forEach(s=>{var n,D,W;f.addRow({details:s.details,qty:s.current_qty,institute:((n=s.institute)==null?void 0:n.name)||"N/A",room:((D=s.room)==null?void 0:D.name)||"N/A",asset:((W=s.asset)==null?void 0:W.name)||"N/A"})});const E=t.addWorksheet("Upgradations");E.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:15},{header:"Date To",key:"to",width:15},{header:"Level From",key:"levelfrom",width:15},{header:"Level To",key:"levelto",width:15},{header:"Status",key:"status",width:15}],u.forEach(s=>{E.addRow({details:s.details,from:s.from,to:s.to,levelfrom:s.levelfrom,levelto:s.levelto,status:s.status})});const ce=await t.xlsx.writeBuffer(),xe=new Blob([ce],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ne.saveAs(xe,"Institutional_Report.xlsx")};return e.jsxs(he,{breadcrumbs:we,children:[e.jsx(me,{title:"Institutional Report"}),e.jsxs("div",{className:"flex-1 p-3 ",children:[e.jsxs(be,{children:[e.jsxs(fe,{children:[e.jsx(ye,{children:"Institutional Report"}),e.jsx(ue,{onClick:ie,className:"w-full",children:"Export Excel"})]}),e.jsx(ge,{}),e.jsxs(je,{className:"py-3 space-y-2",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:e.jsx(pe,{type:"text",placeholder:"Search institutes... (press Enter)",value:p,onChange:t=>Q(t.target.value),onKeyDown:de})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[b.length>0&&e.jsxs(q,{value:k,onValueChange:ne,children:[e.jsx(F,{children:e.jsx(T,{placeholder:"Select Region"})}),e.jsxs(M,{children:[e.jsx(y,{value:"0",children:"All Regions"}),b.length>0?b.map(t=>e.jsx(y,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No Regions available"})]})]}),e.jsxs(q,{value:c,onValueChange:oe,children:[e.jsx(F,{children:e.jsx(T,{placeholder:"Select Institute"})}),e.jsxs(M,{children:[e.jsx(y,{value:"0",children:"All Institutes"}),B.length>0?B.map(t=>e.jsx(y,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:`w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800 

  `,onClick:()=>ee(!N),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Shifts(",g.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${N?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),N&&e.jsx("div",{className:"p-4 border-t",children:g.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Type"})]})}),e.jsx("tbody",{children:g.map(t=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.building_name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(a=t.building_type)==null?void 0:a.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No shifts available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>te(!w),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Blocks(",x.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${w?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&e.jsx("div",{className:"p-4 border-t",children:x.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No blocks available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>se(!v),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Rooms(",h.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${v?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&e.jsx("div",{className:"p-4 border-t",children:h.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Block"})]})}),e.jsx("tbody",{children:h.map(t=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(a=t.block)==null?void 0:a.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No rooms available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>re(!S),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Assets(",m.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${S?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),S&&e.jsx("div",{className:"p-4 border-t",children:m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Quantity"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Room"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Added Date"})]})}),e.jsx("tbody",{children:m.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.asset.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.current_qty}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.room.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.added_date})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No assets available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>ae(!R),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Upgradations(",u.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${R?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),R&&e.jsx("div",{className:"p-4 border-t",children:u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date from"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date to"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Status"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.from}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.to}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelfrom}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelto}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.status})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No upgradations available"})})]})]})]})}export{Fe as default};
