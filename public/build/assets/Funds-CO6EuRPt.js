var H=Object.defineProperty;var W=(a,l,s)=>l in a?H(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s;var A=(a,l,s)=>W(a,typeof l!="symbol"?l+"":l,s);import{r as d,j as e,L as J,S as O}from"./app-31n4uykN.js";import{t as y,A as Y,S as q}from"./app-layout-C6VhhX3t.js";import{B as p}from"./button-BRf3LQjJ.js";import{C as F,a as R,b as C,c as I}from"./card-EVXep_qb.js";import{S as D,a as L,b as T,c as _,d as f}from"./select-DaS05jvX.js";import{l as G,E as K}from"./jspdf.plugin.autotable-BH7zYfW1.js";import{E as Q,F as X}from"./FileSaver.min-C3N2rCFk.js";import{f as U}from"./dateFormatter-Cn65gwBN.js";import"./index-DHTHWdUY.js";import"./index-dd87CKKz.js";import"./createLucideIcon-Bna4G_VE.js";import"./index-DOw8ayy4.js";import"./app-logo-icon-D7tNOwZY.js";import"./index-BN47nkbL.js";import"./index-B9-a0ZW_.js";const Z=[{title:"Reports",href:"/reports"},{title:"upgradations",href:"/reports/upgradations"}];class ee extends d.Component{constructor(){super(...arguments);A(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(s){return{hasError:!0,error:s.message}}componentDidCatch(s,x){console.error("ErrorBoundary caught:",s,x),y.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(p,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const g=a=>{const l=a!=null&&typeof a.id=="number"&&a.id>0&&typeof a.name=="string"&&a.name.trim()!=="";return l||console.warn("Invalid item detected:",a),l};function je({upgradations:a,institutes:l,regions:s,filters:x}){const[b,te]=d.useState(x.search||""),[h,w]=d.useState(x.institute_id||""),[j,B]=d.useState(x.region_id||""),[m,z]=d.useState(a),[c,N]=d.useState(l||[]),v=d.useMemo(()=>Array.isArray(c)?c.filter(g):(console.warn("filteredInstitutes is not an array or is null:",c),[]),[c]),k=d.useMemo(()=>Array.isArray(s)?s.filter(g):(console.warn("regions is not an array or is null:",s),[]),[s]);d.useEffect(()=>{const t={institutes:Array.isArray(c)?c.filter(r=>!g(r)):[],regions:Array.isArray(s)?s.filter(r=>!g(r)):[]};Object.entries(t).forEach(([r,i])=>{i.length>0&&console.warn(`Invalid ${r}:`,i)})},[c,s]);const P=async t=>{try{const r=new URLSearchParams({region_id:t||""}).toString(),i=await fetch(`/reports/getInstitutes?${r}`);if(!i.ok)throw new Error("Failed to fetch institutes");const o=await i.json();console.log("Fetched institutes:",o),N(o),h&&t!=="0"&&!o.some(n=>n.id.toString()===h)&&w("")}catch(r){console.error("Error fetching institutes:",r),y.error("Failed to load institutes"),N([])}},V=t=>{B(t),P(t),S()},M=async()=>{const t=new Q.Workbook,r=t.addWorksheet("upgradations");r.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:30},{header:"Date To",key:"to",width:20},{header:"Level From",key:"levelfrom",width:30},{header:"Level To",key:"levelto",width:20},{header:"Status",key:"status",width:20},{header:"Institute",key:"institute",width:30},{header:"Region",key:"region",width:30}],m.data.forEach(n=>{var u,E;r.addRow({details:n.details,from:n.from,to:n.to,levelfrom:n.levelfrom,levelto:n.levelto,status:n.status,institute:((u=n.institute)==null?void 0:u.name)||"N/A",region:((E=n.region)==null?void 0:E.name)||"N/A"})});const i=await t.xlsx.writeBuffer(),o=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});X.saveAs(o,"upgradations_Report.xlsx")},$=()=>{const t=new K;t.setFontSize(16),t.text("upgradations Report",14,15);const r=["Details","Date From","Date To","Level From","Level To","Status","Institute","Region"],i=m.data.map(o=>{var n,u;return[o.details,o.from,o.to,o.levelfrom,o.levelto,o.status,((n=o.institute)==null?void 0:n.name)||"N/A",((u=o.region)==null?void 0:u.name)||"N/A"]});t.autoTable({head:[r],body:i,startY:25,styles:{fontSize:10}}),t.save("upgradation_Report.pdf")},S=d.useMemo(()=>G.debounce(()=>{const t=new URLSearchParams({search:b||"",institute_id:h||"",region_id:j||""});fetch(`/reports/upgradations/getUpgradations?${t.toString()}`).then(r=>r.json()).then(r=>{console.log("Fetched filtered upgradations:",r),z(r)}).catch(r=>{console.error("Error fetching filtered upgradations:",r),y.error("Failed to fetch filtered upgradations")})},300),[b,h,j]);return e.jsx(ee,{children:e.jsxs(Y,{breadcrumbs:Z,children:[e.jsx(J,{title:"Upgradations Report"}),e.jsx("div",{className:"flex-1 p-1 md:p-1",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs(F,{children:[e.jsxs(R,{children:[e.jsx(C,{className:"text-xl font-bold",children:"Filters"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your Upgradation search"})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs(D,{value:j,onValueChange:V,children:[e.jsx(L,{children:e.jsx(T,{placeholder:"Select Region"})}),e.jsxs(_,{children:[e.jsx(f,{value:"0",children:"All Regions"}),k.length>0?k.map(t=>e.jsx(f,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-1",children:"No regions available"})]})]}),e.jsxs(D,{value:h,onValueChange:t=>{w(t)},children:[e.jsx(L,{children:e.jsx(T,{placeholder:"Select Institute"})}),e.jsxs(_,{children:[e.jsx(f,{value:"0",children:"All Institutes"}),v.length>0?v.map(t=>e.jsx(f,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-1",children:"No institutes available"})]})]}),e.jsx(p,{onClick:S,className:"w-full",children:"Apply Filters"})]})]})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsxs(F,{children:[e.jsxs(R,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{children:e.jsx(C,{className:"text-2xl font-bold",children:"Upgradation Report"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:$,className:"w-full md:w-auto",children:"Export PDF"}),e.jsx(p,{onClick:M,className:"w-full md:w-auto",children:"Export Excel"})]})]}),e.jsx(q,{}),e.jsxs(I,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"From"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"To"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Status"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Institute"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Region"})]})}),e.jsx("tbody",{children:m.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-muted-foreground text-center p-4",children:"No upgradations found."})}):m.data.map(t=>{var r,i;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 text-center",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:U(t.from)}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:U(t.to)}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelfrom}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelto}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.status}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:((r=t.institute)==null?void 0:r.name)||"N/A"}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:((i=t.region)==null?void 0:i.name)||"N/A"})]},t.id)})})]})}),m.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:m.links.map((t,r)=>e.jsx(p,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>O.visit(t.url||"",{preserveScroll:!0}),className:t.active?"bg-blue-600 hover:bg-blue-700":"",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},r))})]})]})})]})})]})})}export{je as default};
