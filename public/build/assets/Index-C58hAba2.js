import{r as s,j as e,L as Z}from"./app-3C7Qt8-p.js";import{A as ee,S as te,t as ae}from"./app-layout-CytTxXak.js";import{B as se}from"./button-C9j-7gdS.js";import{C as re,a as de,b as le,c as ie}from"./card-D1XjIXNI.js";import{I as oe}from"./index-CtC3z9lO.js";import{S as A,a as E,b as B,c as C,d as m}from"./select-C2DwXPeg.js";import{E as ne,F as xe}from"./FileSaver.min-BF03T_of.js";import"./index-DPHHZ2JF.js";import"./createLucideIcon-BrAatXE1.js";import"./index-1_-krIUb.js";import"./app-logo-icon-CXgC8SwZ.js";import"./index-Bn8NVYdZ.js";import"./index-BxFvnJ5H.js";const ce=[{title:"Institutional Report",href:"/reports/institutes"}],D=d=>{const x=d!=null&&typeof d.id=="number"&&d.id>0&&typeof d.name=="string"&&d.name.trim()!=="";return x||console.warn("Invalid item detected:",d),x};function _e({institutes:d=[],regions:x=[],blocks:q=[],instituteAssets:L=[],rooms:T=[],shifts:W=[],upgradations:F=[],filters:h={search:"",institute_id:"",region_id:""}}){const[o,V]=s.useState(h.search||""),[g,U]=s.useState(h.institute_id||""),[y,z]=s.useState(h.region_id||""),[N,me]=s.useState(d),[w,he]=s.useState(x),[b,K]=s.useState(q),[u,M]=s.useState(L),[f,Q]=s.useState(T),[j,H]=s.useState(W),[p,J]=s.useState(F),v=s.useMemo(()=>N.filter(D),[N]),k=s.useMemo(()=>w.filter(D),[w]),c=async t=>{try{const r=new URLSearchParams(t).toString(),n=await fetch(`/reports/institutes/getData?${r}`);if(!n.ok)throw new Error("Failed to fetch data");const l=await n.json();K(l.blocks||[]),M(l.instituteAssets||[]),Q(l.rooms||[]),H(l.shifts||[]),J(l.upgradations||[])}catch(r){console.error("Error fetching data:",r),ae.error("Failed to load data")}};s.useEffect(()=>{c({search:o})},[o]);const P=t=>{t.key==="Enter"&&c({search:o,institute_id:g,region_id:y})},$=t=>{U(t),c({search:o,institute_id:t,region_id:y})},G=t=>{z(t),c({search:o,institute_id:g,region_id:t})},O=async()=>{const t=new ne.Workbook,r=t.addWorksheet("Shifts");r.columns=[{header:"Name",key:"name",width:20},{header:"Building Name",key:"building_name",width:20},{header:"Building Type",key:"building_type",width:20}],j.forEach(a=>{var i;r.addRow({name:a.name,building_name:a.building_name,building_type:((i=a.building_type)==null?void 0:i.name)||"N/A"})});const n=t.addWorksheet("Blocks");n.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15}],b.forEach(a=>{n.addRow({name:a.name,area:a.area})});const l=t.addWorksheet("Rooms");l.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15},{header:"Block",key:"block",width:20}],f.forEach(a=>{var i;l.addRow({name:a.name,area:a.area,block:((i=a.block)==null?void 0:i.name)||"N/A"})});const S=t.addWorksheet("Assets");S.columns=[{header:"Details",key:"details",width:30},{header:"Quantity",key:"qty",width:10},{header:"Institute",key:"institute",width:20},{header:"Room",key:"room",width:20},{header:"Asset",key:"asset",width:20}],u.forEach(a=>{var i,_,I;S.addRow({details:a.details,qty:a.current_qty,institute:((i=a.institute)==null?void 0:i.name)||"N/A",room:((_=a.room)==null?void 0:_.name)||"N/A",asset:((I=a.asset)==null?void 0:I.name)||"N/A"})});const R=t.addWorksheet("Upgradations");R.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:15},{header:"Date To",key:"to",width:15},{header:"Level From",key:"levelfrom",width:15},{header:"Level To",key:"levelto",width:15},{header:"Status",key:"status",width:15}],p.forEach(a=>{R.addRow({details:a.details,from:a.from,to:a.to,levelfrom:a.levelfrom,levelto:a.levelto,status:a.status})});const X=await t.xlsx.writeBuffer(),Y=new Blob([X],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});xe.saveAs(Y,"Institutional_Report.xlsx")};return e.jsxs(ee,{breadcrumbs:ce,children:[e.jsx(Z,{title:"Institutional Report"}),e.jsxs("div",{className:"flex-1 p-2 md:p-2",children:[e.jsxs(re,{children:[e.jsxs(de,{children:[e.jsx(le,{children:"Institutional Report"}),e.jsx(se,{onClick:O,className:"w-full",children:"Export Excel"})]}),e.jsx(te,{}),e.jsxs(ie,{className:"py-3 space-y-2",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:e.jsx(oe,{type:"text",placeholder:"Search institutes... (press Enter)",value:o,onChange:t=>V(t.target.value),onKeyDown:P})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[k.length>0&&e.jsxs(A,{value:y,onValueChange:G,children:[e.jsx(E,{children:e.jsx(B,{placeholder:"Select Region"})}),e.jsxs(C,{children:[e.jsx(m,{value:"0",children:"All Regions"}),k.length>0?k.map(t=>e.jsx(m,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No Regions available"})]})]}),e.jsxs(A,{value:g,onValueChange:$,children:[e.jsx(E,{children:e.jsx(B,{placeholder:"Select Institute"})}),e.jsxs(C,{children:[e.jsx(m,{value:"0",children:"All Institutes"}),v.length>0?v.map(t=>e.jsx(m,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Shifts"}),j.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Type"})]})}),e.jsx("tbody",{children:j.map(t=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.building_name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(r=t.building_type)==null?void 0:r.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No blocks available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Blocks"}),b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No blocks available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Rooms"}),f.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Block"})]})}),e.jsx("tbody",{children:f.map(t=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(r=t.block)==null?void 0:r.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No rooms available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Institute Assets"}),u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Quantity"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Room"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Added Date"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.asset.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.current_qty}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.room.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.added_date})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No assets available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Institute Upgradations"}),p.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b]  dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date from"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date to"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Status"})]})}),e.jsx("tbody",{children:p.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.from}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.to}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelfrom}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelto}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.status})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No assets available"})]})]})]})}export{_e as default};
