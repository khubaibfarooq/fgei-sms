import{r as d,j as e,L as we,S as F,a as p}from"./app-DqLaw2Tf.js";import{A as Se,F as T,S as b,B as Q,cz as ke,C as W,U as Y,E as Ce,g as Fe,b as Z,c as Te}from"./app-layout-CxteGIdE.js";import{B as c}from"./button-BYD9wi3g.js";import{C as h,a as _e,b as De,c as y}from"./card-ZO6btW5n.js";import{I as _}from"./input-ubl0T69H.js";import{B as x}from"./badge-Yvw-SkcA.js";import{D,a as A,b as I,c as P,d as L,X as Ae,e as M,t as ee}from"./index-CyecoKA2.js";import{S as Ie,a as Pe,b as Le,c as Me,d as se}from"./select-CqjKwbbq.js";import{T as Be,a as Oe,b as B,c as O}from"./tabs-DG0gQpiO.js";import{I as He}from"./image-preview-C5dze53D.js";import{C as ae}from"./index-4GMTqfxU.js";import{a as Re}from"./circle-x-0eYwrnE_.js";import{f as ze}from"./format-CAPgRCzf.js";import"./index-sLHKYRyJ.js";import"./index-CSXN30rB.js";import"./index-BllKNMjS.js";import"./index-DcRT_H8f.js";import"./createLucideIcon-DJxTyhun.js";import"./app-logo-icon-h5YpMaN2.js";import"./folder-root-CCaYxE8w.js";import"./grip-vertical-BY3TiC2O.js";import"./index-DHC5QG9v.js";import"./index-BT0X1lYb.js";const Ue=[{title:"Funds",href:"/funds"},{title:"Pending Transactions",href:"#"}];function ms({transactions:o,summary:w,fundHeads:te,balances:H=[],filters:u}){const R=s=>{const a=typeof s=="number"?s:parseFloat(String(s).replace(/,/g,""))||0;return a>=1e6?`${(a/1e6).toFixed(2)} Mn`:new Intl.NumberFormat("ur-PK",{style:"currency",currency:"PKR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)},[z,re]=d.useState(u.search||""),[U,le]=d.useState(u.from||""),[E,de]=d.useState(u.to||""),[$,ne]=d.useState(u.fund_head_id||""),[ie,S]=d.useState(!1),[m,G]=d.useState(null),[i,ce]=d.useState(null),[oe,k]=d.useState(!1),[t,me]=d.useState(null),[K,g]=d.useState(!1),[xe,j]=d.useState(!1),[l,he]=d.useState(null),[C,V]=d.useState(null),pe=async s=>{var a;if(s.tid){G(s),S(!0),g(!0);try{const{data:r}=await p.get(`/transactions/getbytid?tid=${s.tid}`);ce(((a=r.transdetails)==null?void 0:a[0])||null)}catch(r){console.error("Failed to load transaction details:",r),ee.error("Failed to load transaction details")}finally{g(!1)}}},ue=async s=>{const a=s.tid;if(a){G(s),k(!0),g(!0);try{const[r,n,ye]=await Promise.all([p.get(`/projects/${a}/history`),p.get(`/projects/${a}/milestones`),p.get(`/projects/${a}/payments`)]);me({project:{id:a,name:s.description,estimated_cost:s.amount,actual_cost:null,status:s.status,approval_status:s.status,priority:"",institute:s.institute},history:r.data,milestones:n.data,payments:ye.data.payments})}catch(r){console.error("Failed to load project details:",r),ee.error("Failed to load project details")}finally{g(!1)}}},ge=s=>{s.trans_type==="project"?ue(s):pe(s)},[f,N]=d.useState(null),[q,v]=d.useState(null),X=()=>{F.get(window.location.pathname,{search:z,from:U||void 0,to:E||void 0,fund_head_id:$||void 0},{preserveState:!0,preserveScroll:!0})},je=s=>{s.key==="Enter"&&X()},fe=s=>{he(s),N(null),v(null),j(!0)},Ne=s=>{var r;const a=(r=s.target.files)==null?void 0:r[0];if(a){N(a);const n=new FileReader;n.onloadend=()=>{v(n.result)},n.readAsDataURL(a)}},ve=()=>{N(null),v(null)},be=async()=>{var s,a;if(l){V(l.id);try{const r=new FormData;f?(console.log("Appending image to FormData:",f.name,f.size),r.append("img",f)):console.log("No image selected"),console.log("Sending approval request for transaction:",l.id);const{data:n}=await p.post(`/funds/${l.id}/approve`,r);n.success?(j(!1),N(null),v(null),F.reload()):alert(n.message||"Failed to approve transaction")}catch(r){console.error("Failed to approve transaction:",r);const n=((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"An error occurred while approving the transaction";alert(n)}finally{V(null)}}},J=s=>s==="in"?e.jsx(x,{variant:"default",className:"bg-green-100 text-green-800 hover:bg-green-200",children:"IN"}):e.jsx(x,{variant:"destructive",className:"bg-red-100 text-red-800 hover:bg-red-200",children:"OUT"});return e.jsxs(Se,{breadcrumbs:Ue,children:[e.jsx(we,{title:"Pending Fund Transactions"}),e.jsx("div",{className:"flex-1 p-2 md:p-3",children:e.jsxs(h,{children:[e.jsx(_e,{className:"pb-3",children:e.jsxs(De,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(T,{className:"h-6 w-6"}),"Pending Fund Transactions"]})}),e.jsx(b,{}),e.jsxs(y,{className:"pt-3 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Pending"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:w.total_count})]}),e.jsx(T,{className:"h-5 w-5 text-blue-600"})]})})}),e.jsx(h,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending IN"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:w.total_in.toLocaleString()})]}),e.jsx(x,{variant:"default",className:"bg-green-100 text-green-800",children:"IN"})]})})}),e.jsx(h,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending OUT"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:w.total_out.toLocaleString()})]}),e.jsx(x,{variant:"destructive",className:"bg-red-100 text-red-800",children:"OUT"})]})})})]}),H.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),"Regional Fund Head Balances"]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:H.map((s,a)=>e.jsxs("div",{className:"bg-muted/50 dark:bg-gray-800 p-4 rounded-lg border hover:shadow-md transition-shadow cursor-default",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground truncate",children:s.fund_head.name}),e.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400 mt-2",children:R(s.balance)})]},a))}),e.jsx(b,{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search"}),e.jsx(_,{placeholder:"Search description...",value:z,onChange:s=>re(s.target.value),onKeyDown:je})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fund Head"}),e.jsxs(Ie,{value:$,onValueChange:ne,children:[e.jsx(Pe,{children:e.jsx(Le,{placeholder:"All Fund Heads"})}),e.jsxs(Me,{children:[e.jsx(se,{value:"0",children:"All Fund Heads"}),te.map(s=>e.jsx(se,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"From"}),e.jsx(_,{type:"date",value:U,onChange:s=>le(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"To"}),e.jsx(_,{type:"date",value:E,onChange:s=>de(s.target.value)})]})]}),e.jsxs(c,{onClick:X,className:"w-full md:w-auto",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Apply Filters"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o.from," to ",o.to," of ",o.total," pending transactions"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800",children:[e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Fund Head"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Institute"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Description"}),e.jsx("th",{className:"border p-3 text-center text-sm font-medium text-white dark:text-gray-200",children:"Type"}),e.jsx("th",{className:"border p-3 text-right text-sm font-medium text-white dark:text-gray-200",children:"Amount"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Added By"}),e.jsx("th",{className:"border p-3 text-center text-sm font-medium text-white dark:text-gray-200",children:"Actions"})]})}),e.jsx("tbody",{children:o.data.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"border p-8 text-center",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending transactions found."})]})}):o.data.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),new Date(s.added_date).toLocaleDateString()]})}),e.jsx("td",{className:"border p-3 text-sm font-medium",children:s.fund_head.name}),e.jsx("td",{className:"border p-3 text-sm",children:s.institute.name}),e.jsx("td",{className:"border p-3 text-sm",children:s.description}),e.jsx("td",{className:"border p-3 text-center",children:J(s.type)}),e.jsx("td",{className:"border p-3 text-right text-sm font-medium",children:e.jsxs("span",{className:s.type==="in"?"text-green-600":"text-red-600",children:[s.type==="in"?"+":"-",R(s.amount)]})}),e.jsx("td",{className:"border p-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),s.user.name]})}),e.jsx("td",{className:"border p-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>ge(s),className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:[e.jsx(Ce,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(c,{size:"sm",variant:"default",onClick:()=>fe(s),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Approve"]})]})})]},s.id))})]})}),o.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:o.links.map((s,a)=>e.jsx(c,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",onClick:()=>F.visit(s.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},a))})]})]})}),e.jsx(D,{open:xe,onOpenChange:j,children:e.jsxs(A,{className:"max-w-2xl",children:[e.jsxs(I,{children:[e.jsx(P,{children:"Approve Transaction"}),e.jsx(L,{children:"Review the transaction details before approving"})]}),l&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fund Head:"})," ",l.fund_head.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Institute:"})," ",l.institute.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",J(l.type)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Amount:"})," ",e.jsxs("span",{className:l.type==="in"?"text-green-600 font-semibold":"text-red-600 font-semibold",children:[l.type==="in"?"+":"-",l.amount.toLocaleString()]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("strong",{children:"Description:"})," ",l.description]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",ze(new Date(l.added_date),"dd MMM yyyy")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Added By:"})," ",l.user.name]})]}),e.jsx(b,{}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Note:"})," Approving this transaction will update the fund balance.",l.type==="in"?" The balance will be increased by the transaction amount.":" The balance will be decreased by the transaction amount."]})}),e.jsx(b,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Attach Image (Optional)"}),q?e.jsxs("div",{className:"relative border rounded-lg p-2",children:[e.jsx("img",{src:q,alt:"Preview",className:"max-h-48 mx-auto rounded"}),e.jsx(c,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:ve,children:e.jsx(Ae,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center hover:border-gray-400 dark:hover:border-gray-500 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:Ne,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(Fe,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Click to upload an image"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"PNG, JPG, GIF up to 5MB"})]})]})]})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>j(!1),disabled:C!==null,children:"Cancel"}),e.jsx(c,{onClick:be,disabled:C!==null,className:"bg-green-600 hover:bg-green-700",children:C!==null?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Approve Transaction"]})})]})]})}),e.jsx(D,{open:ie,onOpenChange:S,children:e.jsxs(A,{className:"max-w-md h-[90vh]  overflow-y-auto",children:[e.jsxs(I,{children:[e.jsx(P,{children:"Transaction Details"}),e.jsx(L,{children:"Detailed breakdown of the selected transaction"})]}),K?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Fund Head"}),e.jsx("p",{className:"font-medium",children:i.fund_head_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-medium text-lg",children:Number(i.amount).toLocaleString()})]}),i.asset_name&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Asset"}),e.jsx("p",{className:"font-medium",children:i.asset_name})]}),i.qty>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:i.qty})]}),i.room_name&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Room"}),e.jsx("p",{className:"font-medium",children:i.room_name})]})]}),(m==null?void 0:m.img)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction Evidence"}),e.jsx(He,{dataImg:m.img,size:"h-64 w-full"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Description"}),e.jsx("p",{className:"text-sm p-3 bg-muted rounded-md border",children:(m==null?void 0:m.description)||"No description provided"})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No additional details found for this transaction."}),e.jsx(M,{children:e.jsx(c,{variant:"outline",onClick:()=>S(!1),children:"Close"})})]})}),e.jsx(D,{open:oe,onOpenChange:k,children:e.jsxs(A,{className:"max-w-3xl h-[90vh] flex flex-col p-0",children:[e.jsxs(I,{className:"p-6 pb-0",children:[e.jsxs(P,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),t==null?void 0:t.project.name]}),e.jsx(L,{children:t==null?void 0:t.project.institute.name})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 h-full min-h-0",children:e.jsxs(Be,{defaultValue:"approvals",className:"w-full h-full flex flex-col",children:[e.jsxs(Oe,{className:"grid w-full grid-cols-3 shrink-0",children:[e.jsx(B,{value:"approvals",children:"Approvals"}),e.jsx(B,{value:"milestones",children:"Milestones"}),e.jsx(B,{value:"payments",children:"Payments"})]}),e.jsxs("div",{className:"flex-1 mt-4 pb-6 h-full min-h-0",children:[e.jsx(O,{value:"approvals",className:"m-0 space-y-4",children:K?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(t==null?void 0:t.history.length)===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground border-2 border-dashed rounded-lg",children:"No approval history."}):e.jsx("div",{className:"space-y-4",children:t==null?void 0:t.history.map(s=>{var a,r;return e.jsx(h,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-4 flex gap-4",children:[e.jsx("div",{className:"mt-1",children:s.status==="approved"?e.jsx(Z,{className:"h-5 w-5 text-green-500"}):e.jsx(Re,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold",children:((a=s.stage)==null?void 0:a.stage_name)||"Stage"}),e.jsx(x,{variant:s.status==="approved"?"default":"destructive",className:"capitalize",children:s.status})]}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"})," ",(r=s.approver)==null?void 0:r.name," • ",e.jsx(Te,{className:"h-3 w-3 ml-1"})," ",new Date(s.action_date).toLocaleString()]}),s.comments&&e.jsxs("p",{className:"text-sm bg-muted/50 p-2 rounded mt-2 border italic",children:['"',s.comments,'"']})]})]})},s.id)})})}),e.jsx(O,{value:"milestones",className:"m-0 space-y-4",children:(t==null?void 0:t.milestones.length)===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground border-2 border-dashed rounded-lg",children:"No milestones found."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t==null?void 0:t.milestones.map(s=>e.jsxs(h,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("p",{className:"font-semibold text-sm",children:s.name}),e.jsx(x,{variant:s.status==="completed"?"default":"outline",className:"text-[10px]",children:s.status})]}),e.jsxs("div",{className:"text-[10px] text-muted-foreground space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"})," Due in: ",s.days," days"]}),s.completed_date&&e.jsxs("p",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Z,{className:"h-3 w-3"})," Done: ",new Date(s.completed_date).toLocaleDateString()]})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.description})]},s.id))})}),e.jsx(O,{value:"payments",className:"m-0 space-y-4",children:(t==null?void 0:t.payments.length)===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground border-2 border-dashed rounded-lg",children:"No payments recorded."}):e.jsx("div",{className:"space-y-3",children:t==null?void 0:t.payments.map(s=>{var a;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-bold",children:s.amount.toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((a=s.fund_head)==null?void 0:a.name)||"General Fund"," • ",new Date(s.added_date).toLocaleDateString()]})]}),e.jsx(x,{variant:s.status==="Approved"?"default":"outline",children:s.status})]},s.id)})})})]})]})}),e.jsx(M,{className:"p-6 border-t shrink-0",children:e.jsx(c,{variant:"outline",onClick:()=>k(!1),children:"Close"})})]})})]})}export{ms as default};
