var K=Object.defineProperty;var Q=(r,a,n)=>a in r?K(r,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[a]=n;var k=(r,a,n)=>Q(r,typeof a!="symbol"?a+"":a,n);import{r as l,j as e,L as X}from"./app-CxIyu7h3.js";import{t as C,A as Z,S as ee}from"./app-layout-C8xWLzwK.js";import{B as f}from"./button-CakpMrn-.js";import{C as F,a as _,b as I,c as T}from"./card-btivF07x.js";import{S as z,a as B,b as L,c as M,d as h}from"./select-BV2qdl71.js";import{l as te}from"./lodash-pLNk-HMC.js";import{E as se,F as re,a as oe,b as ae}from"./jspdf.plugin.autotable-VYfmZhGs.js";import{C as V}from"./combobox-BPIHJ5OY.js";import"./index-DKaPR8Pr.js";import"./createLucideIcon-B6lzvC_V.js";import"./input-BBVhaqdX.js";import"./index-2yKDvXlk.js";import"./app-logo-icon-Dymm9b4u.js";import"./folder-root-DsC7FqO0.js";import"./grip-vertical-BkwZkbhe.js";import"./index-CjYiUVVF.js";import"./index-DzAL8-lA.js";import"./popover-Dh3q8291.js";const ne=[{title:"Reports",href:"/reports"},{title:"Projects",href:"/reports/projects"}];class le extends l.Component{constructor(){super(...arguments);k(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(n){return{hasError:!0,error:n.message}}componentDidCatch(n,u){console.error("ErrorBoundary caught:",n,u),C.error("An error occurred. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(f,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const v=r=>{const a=r!=null&&typeof r.id=="number"&&r.id>0&&typeof r.name=="string"&&r.name.trim()!=="";return a||console.warn("Invalid item:",r),a};function Ee({projects:r,institutes:a,regions:n,projectTypes:u,filters:p}){const[A,ie]=l.useState(p.search||""),[d,y]=l.useState(p.institute_id||""),[g,D]=l.useState(p.project_type_id||""),[b,U]=l.useState(p.status||""),[m,P]=l.useState(r),[N,w]=l.useState(a||[]),[S,$]=l.useState(p.region_id||""),H=l.useMemo(()=>Array.isArray(N)?N.filter(v):[],[N]),E=l.useMemo(()=>Array.isArray(n)?n.filter(v):[],[n]),O=l.useMemo(()=>Array.isArray(u)?u.filter(v):[],[u]),W=async t=>{if(!t||t==="0"){w(a||[]),d&&y("");return}try{const s=new URLSearchParams({region_id:t}).toString(),o=await fetch(`/reports/getInstitutes?${s}`);if(!o.ok)throw new Error("Failed to fetch institutes");const i=await o.json();w(i),d&&!i.some(c=>c.id.toString()===d)&&y("")}catch(s){console.error("Error fetching institutes:",s),C.error("Failed to load institutes"),w([])}},J=t=>{$(t),W(t)},Y=async()=>{const t=new se.Workbook,s=t.addWorksheet("Projects");s.columns=[{header:"Name",key:"name",width:30},{header:"Cost",key:"cost",width:15},{header:"Status",key:"status",width:15},{header:"Project Type",key:"project_type",width:25},{header:"Institute",key:"institute",width:30},{header:"Region",key:"region",width:25}],m.data.forEach(c=>{var x,j,R;s.addRow({name:c.name,cost:c.cost,status:c.status,project_type:((x=c.projecttype)==null?void 0:x.name)||"N/A",institute:((j=c.institute)==null?void 0:j.name)||"N/A",region:((R=c.region)==null?void 0:R.name)||"N/A"})});const o=await t.xlsx.writeBuffer(),i=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});re.saveAs(i,"Projects_Report.xlsx")},q=()=>{const t=new oe;t.setFontSize(16),t.text("Projects Report",14,15);const s=["Name","Cost","Status","Project Type","Institute","Region"],o=m.data.map(i=>{var c,x,j;return[i.name,i.cost,i.status,((c=i.projecttype)==null?void 0:c.name)||"N/A",((x=i.institute)==null?void 0:x.name)||"N/A",((j=i.region)==null?void 0:j.name)||"N/A"]});ae(t,{head:[s],body:o,startY:25,styles:{fontSize:9,cellPadding:2},headStyles:{fillColor:[66,139,202],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]}}),t.save("Projects_Report.pdf")},G=l.useMemo(()=>te.debounce(()=>{const t=new URLSearchParams({search:A.trim(),institute_id:d||"",region_id:S||"",project_type_id:g||"",status:b||""});fetch(`/reports/projects/getprojects?${t.toString()}`).then(s=>s.json()).then(s=>{console.log("Filtered projects:",s),P(s)}).catch(s=>{console.error("Fetch error:",s),C.error("Failed to load projects")})},300),[A,d,S,g,b]);return e.jsx(le,{children:e.jsxs(Z,{breadcrumbs:ne,children:[e.jsx(X,{title:"Projects Report"}),e.jsx("div",{className:"flex-1 p-1 md:p-1",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs(F,{children:[e.jsxs(_,{children:[e.jsx(I,{className:"text-xl font-bold",children:"Filters"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your project search"})]}),e.jsxs(T,{className:"space-y-4",children:[E.length>0&&e.jsx(V,{entity:"region",value:S,onChange:t=>J(t),options:E.map(t=>({id:t.id.toString(),name:t.name.split(" ").pop()||t.name})),includeAllOption:!0}),e.jsx(V,{entity:"institute",value:d,onChange:y,options:H.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!1,placeholder:"Select Institute"}),e.jsxs(z,{value:g,onValueChange:t=>D(t),children:[e.jsx(B,{children:e.jsx(L,{placeholder:"Select Project Type"})}),e.jsxs(M,{children:[e.jsx(h,{value:"0",children:"All Project Types"}),O.map(t=>e.jsx(h,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs(z,{value:b,onValueChange:t=>U(t),children:[e.jsx(B,{children:e.jsx(L,{placeholder:"Select Status"})}),e.jsxs(M,{children:[e.jsx(h,{value:"all",children:"All Status"}),e.jsx(h,{value:"planned",children:"Planned"}),e.jsx(h,{value:"inprogress",children:"In Progress"}),e.jsx(h,{value:"completed",children:"Completed"})]})]}),e.jsx(f,{onClick:G,className:"w-full",children:"Apply Filters"})]})]})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsxs(F,{children:[e.jsxs(_,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{children:e.jsx(I,{className:"text-2xl font-bold",children:"Projects Report"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:q,className:"w-full md:w-auto",children:"Export PDF"}),e.jsx(f,{onClick:Y,className:"w-full md:w-auto",children:"Export Excel"})]})]}),e.jsx(ee,{}),e.jsxs(T,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border-1 rounded-md overflow-hidden shadow-sm  text-sm md:text-md lg:text-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary text-white text-center",children:[e.jsx("th",{className:"border p-2 font-medium",children:"Name"}),e.jsx("th",{className:"border p-2 font-medium",children:"Cost"}),e.jsx("th",{className:"border p-2 font-medium",children:"Status"}),e.jsx("th",{className:"border p-2 font-medium",children:"Project Type"}),e.jsx("th",{className:"border p-2 font-medium",children:"Institute"})]})}),e.jsx("tbody",{children:m.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-4 text-muted-foreground",children:"No projects found."})}):m.data.map(t=>{var s,o;return e.jsxs("tr",{className:"hover:bg-primary/10 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2  font-bold text-left",children:t.name}),e.jsx("td",{className:"border p-2 text-right",children:t.cost}),e.jsx("td",{className:"border p-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})}),e.jsx("td",{className:"border p-2",children:((s=t.projecttype)==null?void 0:s.name)||"N/A"}),e.jsx("td",{className:"border p-2",children:((o=t.institute)==null?void 0:o.name)||"N/A"})]},t.id)})})]})}),m.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:m.links.map((t,s)=>e.jsx(f,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>{t.url&&fetch(t.url).then(o=>o.json()).then(o=>{P(o)}).catch(o=>{console.error("Error:",o)})},children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},s))})]})]})})]})})]})})}export{Ee as default};
