import{r,j as t,L as P}from"./app-B3MVY4nA.js";import{A as I,S as M,t as v}from"./app-layout-hCn9MT3e.js";import{B as c}from"./button-BbIHWR5o.js";import{C as V,a as D,b as O,c as U}from"./card-CojowgcM.js";import{S as W,a as $,b as J,c as Y,d as _}from"./select-D2zZbXPp.js";import{l as q}from"./lodash-lh-GMIbX.js";import{C as R}from"./combobox-BldHj5IN.js";import{E as G,F as K,a as Q,b as X}from"./jspdf.plugin.autotable-DQ3UGJrG.js";import"./index-BTPcSof1.js";import"./index-BMur1Qek.js";import"./createLucideIcon-bGg6PY1_.js";import"./index-9rEhpgcf.js";import"./app-logo-icon-C2XjI3GH.js";import"./index-BSZ22cHv.js";import"./index-B2gRcpXj.js";import"./popover-BacG6oP_.js";const Z=[{title:"Reports",href:"/reports"},{title:"Funds",href:"/reports/funds"}];function fe({funds:p,institutes:i,fundheads:E,regions:x,filters:u}){const[S,A]=r.useState(u.search||""),[d,m]=r.useState(u.institute_id||""),[f,y]=r.useState(u.fund_head_id||""),[l,w]=r.useState(p),[b,h]=r.useState(i||[]),[j,F]=r.useState(u.region_id||""),N=e=>e!=null&&typeof e.id=="number"&&e.id>0&&typeof e.name=="string"&&e.name.trim()!=="",k=r.useMemo(()=>Array.isArray(b)?b.filter(N):[],[b]),H=r.useMemo(()=>Array.isArray(x)?x.filter(N):[],[x]);r.useEffect(()=>{w(p),h(i||[])},[p,i]);const B=async e=>{if(!e||e==="0"||e===""){h(i||[]),d&&m("");return}try{const s=new URLSearchParams({region_id:e}).toString(),o=await fetch(`/reports/getInstitutes?${s}`);if(!o.ok)throw new Error("Failed to fetch institutes");const a=await o.json();h(a),d&&!a.some(n=>n.id.toString()===d)&&m("")}catch(s){console.error("Error fetching institutes:",s),v.error("Failed to load institutes"),h([])}},L=e=>{F(e),B(e)},g=async e=>{try{const s=new URLSearchParams({search:S||"",institute_id:d||"",region_id:j||"",fund_head_id:f||""}),o=e||`/reports/funds/getfunds?${s.toString()}`,a=await fetch(o);if(!a.ok)throw new Error("Failed to fetch funds");const n=await a.json();w(n)}catch(s){console.error(s),v.error("Failed to fetch funds")}};r.useMemo(()=>q.debounce(g,300),[S,d,j,f]);const T=async()=>{const e=new G.Workbook,s=e.addWorksheet("Funds");s.columns=[{header:"Fund Head",key:"fund_head",width:30},{header:"Balance",key:"balance",width:15}],l.data.forEach(n=>{var C;s.addRow({fund_head:((C=n.fund_head)==null?void 0:C.name)||"N/A",balance:typeof n.balance=="number"?n.balance.toFixed(2):n.balance??"0"})});const o=await e.xlsx.writeBuffer(),a=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});K.saveAs(a,"Funds_Report.xlsx")},z=()=>{const e=new Q;e.setFontSize(16),e.text("Funds Report",14,15);const s=["Fund Head","Balance"],o=l.data.map(a=>{var n;return[((n=a.fund_head)==null?void 0:n.name)||"N/A",typeof a.balance=="number"?a.balance.toFixed(2):a.balance??"0"]});X(e,{head:[s],body:o,startY:25,styles:{fontSize:9,cellPadding:2},headStyles:{fillColor:[66,139,202],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]}}),e.save("Funds_Report.pdf")};return t.jsxs(I,{breadcrumbs:Z,children:[t.jsx(P,{title:"Funds Report"}),t.jsx("div",{className:"flex-1 p-4 md:p-6",children:t.jsxs(V,{children:[t.jsxs(D,{children:[t.jsx(O,{className:"text-2xl font-bold",children:"Funds Report"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"View fund balances by institute / fund head"})]}),t.jsx(M,{}),t.jsxs(U,{className:"pt-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx(R,{entity:"region",value:j,onChange:L,options:H.map(e=>({id:e.id.toString(),name:e.name})),includeAllOption:!1,placeholder:"Select Region"}),t.jsx(R,{entity:"institute",value:d,onChange:m,options:k.map(e=>({id:e.id.toString(),name:e.name})),includeAllOption:!1,placeholder:"Select Institute"}),t.jsxs(W,{value:f,onValueChange:e=>y(e),children:[t.jsx($,{children:t.jsx(J,{placeholder:"Select Fund Head"})}),t.jsxs(Y,{children:[t.jsx(_,{value:"0",children:"All Fund Heads"}),E.map(e=>t.jsx(_,{value:e.id.toString(),children:e.name},e.id))]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(c,{onClick:()=>g(),children:"Apply Filters"}),t.jsx(c,{onClick:()=>{A(""),F(""),m(""),y("")},children:"Reset"}),t.jsx(c,{onClick:z,className:"w-full md:w-auto",children:"Export PDF"})," ",t.jsx(c,{onClick:T,className:"w-full md:w-auto",children:"Export Excel"})," "]}),t.jsx("div",{children:t.jsxs("table",{className:"w-full border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-primary text-white",children:[t.jsx("th",{className:"p-2",children:"Fund Head"}),t.jsx("th",{className:"p-2",children:"Balance"})]})}),t.jsx("tbody",{children:l.data.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:4,className:"p-4 text-center text-muted-foreground",children:"No funds found."})}):l.data.map(e=>{var s;return t.jsxs("tr",{className:"text-center",children:[t.jsx("td",{className:"p-2",children:((s=e.fund_head)==null?void 0:s.name)||"N/A"}),t.jsx("td",{className:"p-2",children:typeof e.balance=="number"?e.balance.toFixed(2):e.balance??"0"})]},e.id)})})]})}),l.links&&l.links.length>1&&t.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:l.links.map((e,s)=>t.jsx(c,{disabled:!e.url,variant:e.active?"default":"outline",size:"sm",onClick:()=>e.url?g(e.url):void 0,className:e.active?"bg-blue-600 hover:bg-blue-700":"",children:t.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})},s))})]})]})})]})}export{fe as default};
