import{r as i,a as w,j as e,S as A}from"./app-DnumDQL_.js";import{D as S,a as P,b as E,c as k,d as I,e as R,t as c}from"./index-BM8RsdCP.js";import{B as m}from"./button-W187GbT8.js";import{T as $}from"./textarea-C1zceSGH.js";import{L as d}from"./label-CsMaAUYx.js";import{I as F}from"./input-CO7fgi0N.js";import{C as H,a as L}from"./circle-x-MZP0Slub.js";import"./index-x0URM9An.js";import"./createLucideIcon-BnM6t9vF.js";import"./clsx-B-dksMZM.js";import"./index-Kxh7Oxci.js";function U({isOpen:r,onClose:n,project:a,onSuccess:p}){const[h,x]=i.useState(""),[o,f]=i.useState(null),[g,u]=i.useState(null),[l,D]=i.useState([]),[T,j]=i.useState(!1),v=i.useRef(null),b=()=>{var s;(s=v.current)==null||s.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{l.length>0&&b()},[l]),i.useEffect(()=>{r&&a&&C()},[r,a]);const C=async()=>{if(a)try{const{data:s}=await w.get(`/projects/${a.id}/history`);D(s)}catch(s){console.error("Failed to fetch history",s)}},y=s=>{if(!a)return;j(!0);const t=new FormData;if(t.append("status",s),t.append("comments",h),!o){c.error("Please upload a PDF file");return}o&&t.append("pdf",o),g&&t.append("img",g),A.post(`/projects/${a.id}/approvals`,t,{forceFormData:!0,onSuccess:()=>{c.success(`Project ${s} successfully`),p&&p(),n(),x(""),f(null),u(null)},onError:()=>{c.error("Failed to process approval")},onFinish:()=>j(!1)})};return a?e.jsx(S,{open:r,onOpenChange:n,children:e.jsxs(P,{className:"max-w-2xl",children:[e.jsxs(E,{children:[e.jsxs(k,{children:["Project Approval: ",a.name]}),e.jsx(I,{children:"Review project details and action approval."})]}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Approval History"}),e.jsxs("div",{className:"border rounded-lg p-4 h-48 overflow-y-auto space-y-4 bg-muted/30",children:[l.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No approval history."}):l.map(s=>{var t,N;return e.jsxs("div",{className:"flex gap-3 text-sm",children:[s.status==="approved"?e.jsx(H,{className:"w-5 h-5 text-green-500 mt-0.5"}):e.jsx(L,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[((t=s.stage)==null?void 0:t.stage_name)||"Stage"," - ",s.status]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["by ",(N=s.approver)==null?void 0:N.name," on ",s.action_date?new Date(s.action_date).toLocaleString():""]}),s.comments&&e.jsxs("p",{className:"mt-1 text-gray-700 bg-white p-2 rounded border",children:['"',s.comments,'"']}),s.pdf&&e.jsx("a",{href:`/${s.pdf}`,target:"_blank",className:"mt-1 text-blue-600 underline text-xs flex items-center gap-1",children:"View PDF"}),s.img&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:`/${s.img}`,alt:"Approval evidence",className:"h-20 w-auto rounded border"})})]})]},s.id)}),e.jsx("div",{ref:v})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"comments",children:"Comments"}),e.jsx($,{id:"comments",placeholder:"Add comments for this action...",value:h,onChange:s=>x(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"pdf",children:"Attachment (PDF)"}),e.jsx(F,{id:"pdf",type:"file",accept:".pdf",onChange:s=>{var t;return f(((t=s.target.files)==null?void 0:t[0])||null)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"img",children:"Attachment (Image)"}),e.jsx(F,{id:"img",type:"file",accept:"image/*",onChange:s=>{var t;return u(((t=s.target.files)==null?void 0:t[0])||null)}})]})]})]}),e.jsxs(R,{className:"gap-2 sm:gap-0",children:[e.jsx(m,{variant:"outline",onClick:n,children:"Cancel"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"destructive",onClick:()=>y("rejected"),children:"Reject"}),e.jsx(m,{className:"bg-green-600 hover:bg-green-700",onClick:()=>y("approved"),children:"Approve"})]})]})]})}):null}export{U as default};
