import{r as p,j as e,L as y,S as o}from"./app-DBzhDjnR.js";import{A as S,S as _}from"./app-layout-BNAloD3B.js";import{C as w,a as C,b as L,c as A}from"./card-BHRl5sdy.js";import{B as i}from"./button-D_pD7jfh.js";import{B as E}from"./badge-EeiKbA2b.js";import{S as T,a as D,b as k,c as I,d as g}from"./select-Dk9WhxeT.js";import{I as m}from"./input-W0h1OP1_.js";import{L as c}from"./label-x9t_iHEI.js";import{X as R}from"./index-DB_qMx2A.js";import{C as z,a as B}from"./index-CCpTdKuy.js";import"./index-DbQmxt2k.js";import"./createLucideIcon-bOA2hw3c.js";import"./index-CUAG3HMa.js";import"./index-DOIG-82r.js";import"./index-CvTI4rvu.js";import"./app-logo-icon-ys3Ztymg.js";import"./circle-x-nGrvtWG_.js";import"./folder-root-BD5IpTYC.js";import"./grip-vertical-vsevKQ4A.js";import"./clsx-B-dksMZM.js";import"./index-nv6te0VZ.js";import"./index-DwcGrrx3.js";const P=[{title:"Audit Log",href:"/audit-logs"}];function de({logs:t,tables:j,filters:l}){const[x,f]=p.useState([]),[r,h]=p.useState({table:l.table||"",record_id:l.record_id||"",date_from:l.date_from||"",date_to:l.date_to||""}),b=s=>{f(a=>a.includes(s)?a.filter(n=>n!==s):[...a,s])},d=(s,a)=>{h(n=>({...n,[s]:a}))},u=()=>{o.get("/audit-logs",r,{preserveState:!0,preserveScroll:!0})},v=()=>{const s={table:"",record_id:"",date_from:"",date_to:""};h(s),o.get("/audit-logs",s,{preserveState:!0,preserveScroll:!0})},N=s=>{switch(s){case"INSERT":return"bg-green-100 text-green-800 hover:bg-green-200 border-green-200";case"UPDATE":return"bg-blue-100 text-blue-800 hover:bg-blue-200 border-blue-200";case"DELETE":return"bg-red-100 text-red-800 hover:bg-red-200 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return e.jsxs(S,{breadcrumbs:P,children:[e.jsx(y,{title:"Audit Log"}),e.jsx("div",{className:"flex-1 p-4 md:p-6",children:e.jsxs(w,{children:[e.jsxs(C,{className:"pb-3",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Audit Log"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"System-wide change history tracked by database triggers"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mt-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"Table Name"}),e.jsxs(T,{value:r.table,onValueChange:s=>d("table",s==="all"?"":s),children:[e.jsx(D,{className:"h-8",children:e.jsx(k,{placeholder:"All Tables"})}),e.jsxs(I,{children:[e.jsx(g,{value:"all",children:"All Tables"}),j.map(s=>e.jsx(g,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"Record ID"}),e.jsx(m,{placeholder:"ID",type:"number",className:"h-8",value:r.record_id,onChange:s=>d("record_id",s.target.value),onKeyDown:s=>s.key==="Enter"&&u()})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"From Date"}),e.jsx(m,{type:"date",className:"h-8",value:r.date_from,onChange:s=>d("date_from",s.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{className:"text-xs",children:"To Date"}),e.jsx(m,{type:"date",className:"h-8",value:r.date_to,onChange:s=>d("date_to",s.target.value)})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(i,{size:"sm",className:"h-8 flex-1",onClick:u,children:"Search"}),e.jsx(i,{size:"sm",variant:"outline",className:"h-8 px-2",onClick:v,title:"Reset Filters",children:e.jsx(R,{className:"h-4 w-4"})})]})]})]}),e.jsx(_,{}),e.jsxs(A,{className:"pt-6 space-y-4",children:[t.data.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No audit logs found matching your criteria."}):t.data.map(s=>{var a;return e.jsxs("div",{className:"border rounded-md bg-card hover:bg-muted/30 transition overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between cursor-pointer",onClick:()=>b(s.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{variant:"outline",className:`${N(s.action)}`,children:s.action}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[s.table_name.toUpperCase()," #",s.record_id]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",((a=s.user)==null?void 0:a.name)??"System/Unknown"," â€¢ ",new Date(s.changed_at).toLocaleString()]})]})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:x.includes(s.id)?e.jsx(z,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})]}),x.includes(s.id)&&e.jsx("div",{className:"bg-muted/50 px-4 py-3 text-sm border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.old_values&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-red-600",children:"Old Values"}),e.jsx("pre",{className:"bg-background border rounded p-2 text-xs overflow-auto max-h-60",children:JSON.stringify(s.old_values,null,2)})]}),s.new_values&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-green-600",children:"New Values"}),e.jsx("pre",{className:"bg-background border rounded p-2 text-xs overflow-auto max-h-60",children:JSON.stringify(s.new_values,null,2)})]})]})})]},s.id)}),t.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:t.links.map((s,a)=>e.jsx(i,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",onClick:()=>o.visit(s.url||"",{preserveScroll:!0,preserveState:!0,only:["logs"]}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},a))})]})]})})]})}export{de as default};
