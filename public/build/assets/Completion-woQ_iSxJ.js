import{r,j as e,L as F}from"./app-CS-pVSH3.js";import{t as R,A as U,S as z}from"./app-layout-CBThMk13.js";import{B as i}from"./button-CaUuR6WF.js";import{C as h,a as m,b as u,c as j}from"./card-D_XrG5rw.js";import{S as W,a as $,b as O,c as V,d}from"./select-CGfQS5TV.js";import{C as _}from"./combobox-DQmCWEUU.js";import{E as Y,F as H,a as J,b as T}from"./jspdf.plugin.autotable-BY2sboAo.js";import"./index-BC98DUOz.js";import"./createLucideIcon-6K_5nfl6.js";import"./input-ByUibOQR.js";import"./index-OlNZjlNQ.js";import"./app-logo-icon-emW1COi8.js";import"./folder-root-CIOtW4zj.js";import"./grip-vertical-C9izefko.js";import"./index-CyyphUXJ.js";import"./index-DyqN-IH1.js";import"./popover-CiZ79GHn.js";const Z=[{title:"Reports",href:"/reports"},{title:"Completion",href:"/reports/completion"}];function pe({regions:I=[],filters:p}){const[n,g]=r.useState(p.region_id||""),[y,x]=r.useState(p.institute_id||""),[f,N]=r.useState(p.status||""),[E,w]=r.useState([]),[o,S]=r.useState([]),[c,b]=r.useState([]),[k,v]=r.useState(!1);r.useEffect(()=>{n&&n!=="0"?fetch(`/reports/getInstitutes?region_id=${n}`).then(t=>t.json()).then(t=>w(t)).catch(()=>R.error("Failed to load institutes")):w([])},[n]);const C=async()=>{v(!0);try{const t=new URLSearchParams({region_id:n||"",institute_id:y||"",status:f||""}),s=await fetch(`/reports/completion/getData?${t.toString()}`);if(!s.ok)throw new Error;const l=await s.json();S(l.summary),b(l.details)}catch{R.error("Failed to load report data")}finally{v(!1)}};r.useEffect(()=>{C()},[]);const A=()=>{C()},D=()=>{g(""),x(""),N(""),setTimeout(()=>{const t=new URLSearchParams({region_id:"",institute_id:"",status:""});fetch(`/reports/completion/getData?${t.toString()}`).then(s=>s.json()).then(s=>{S(s.summary),b(s.details)})},0)},L=async()=>{const t=new Y.Workbook,s=t.addWorksheet("Summary");s.columns=[{header:"Region",key:"region",width:30},{header:"Total Institutes",key:"total",width:20},{header:"Completed",key:"completed",width:20},{header:"< 50%",key:"less",width:20}],o.forEach(a=>{s.addRow({region:a.region,total:a.total_institutes,completed:a.completed,less:a.less_than_50})});const l=t.addWorksheet("Details");l.columns=[{header:"Institute",key:"name",width:40},{header:"Region",key:"region",width:30},{header:"Shifts",key:"shifts",width:10},{header:"Blocks",key:"blocks",width:10},{header:"Rooms",key:"rooms",width:10},{header:"Assets",key:"assets",width:10},{header:"Plants",key:"plants",width:10},{header:"Transports",key:"transports",width:12},{header:"Funds",key:"funds",width:10},{header:"Projects",key:"projects",width:10},{header:"Upgradations",key:"upgradations",width:12},{header:"Total %",key:"percentage",width:10}],c.forEach(a=>{l.addRow({name:a.name,region:a.region_name,shifts:a.shifts,blocks:a.blocks,rooms:a.rooms,assets:a.assets,plants:a.plants,transports:a.transports,funds:a.funds,projects:a.projects,upgradations:a.upgradations,percentage:a.percentage+"%"})});const B=await t.xlsx.writeBuffer();H.saveAs(new Blob([B]),"Completion_Report.xlsx")},P=()=>{const t=new J("l","mm","a4");t.text("Completion Report - Summary",14,15),T(t,{head:[["Region","Total Institutes","Completed","< 50%"]],body:o.map(s=>[s.region,s.total_institutes,s.completed,s.less_than_50]),startY:20}),t.addPage(),t.text("Completion Report - Details",14,15),T(t,{head:[["Institute","Region","Shifts","Blocks","Rooms","Assets","Plants","Transports","Funds","Projects","Upgradations","Total %"]],body:c.map(s=>[s.name,s.region_name,s.shifts,s.blocks,s.rooms,s.assets,s.plants,s.transports,s.funds,s.projects,s.upgradations,s.percentage+"%"]),startY:20,styles:{fontSize:8}}),t.save("Completion_Report.pdf")};return e.jsxs(U,{breadcrumbs:Z,children:[e.jsx(F,{title:"Completion Report"}),e.jsxs("div",{className:"p-4 lg:p-6 max-w-full space-y-6",children:[e.jsxs(h,{className:"w-full shadow-lg",children:[e.jsx(m,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-2xl font-bold",children:"Completion Report"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Institute data completion status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{onClick:P,variant:"outline",size:"sm",children:"PDF"}),e.jsx(i,{onClick:L,variant:"outline",size:"sm",children:"Excel"})]})]})}),e.jsx(z,{}),e.jsx(j,{className:"pt-6 pb-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_,{entity:"region",value:n,onChange:t=>{g(t),x("")},options:I.map(t=>({id:t.id.toString(),name:t.name.split(" ").pop()||t.name})),includeAllOption:!0,placeholder:"Select Region"}),e.jsx(_,{entity:"institute",value:y,onChange:x,options:E.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!1,placeholder:"Select Institute"}),e.jsxs(W,{value:f,onValueChange:N,children:[e.jsx($,{children:e.jsx(O,{placeholder:"Status"})}),e.jsxs(V,{children:[e.jsx(d,{value:"all",children:"All Statuses"}),e.jsx(d,{value:"completed",children:"Completed (100%)"}),e.jsx(d,{value:"less_than_50",children:"Less than 50%"}),e.jsx(d,{value:"zero",children:"Zero (0%)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{onClick:A,className:"flex-1",disabled:k,children:k?"Loading...":"Apply"}),e.jsx(i,{variant:"outline",onClick:D,className:"flex-1",children:"Reset"})]})]})})]}),e.jsxs(h,{children:[e.jsx(m,{children:e.jsx(u,{className:"text-lg",children:"Region Wise Summary"})}),e.jsx(j,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted/50 text-muted-foreground uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Region"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Total Institutes"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Completed Data"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Less than 50%"})]})}),e.jsx("tbody",{className:"divide-y",children:o.length>0?o.map((t,s)=>e.jsxs("tr",{className:"hover:bg-muted/50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:t.region}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.total_institutes}),e.jsx("td",{className:"px-4 py-3 text-center text-green-600 font-bold",children:t.completed}),e.jsx("td",{className:"px-4 py-3 text-center text-red-600 font-bold",children:t.less_than_50})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-muted-foreground",children:"No summary data available"})})})]})})})]}),e.jsxs(h,{children:[e.jsx(m,{children:e.jsx(u,{className:"text-lg",children:"Institute Details"})}),e.jsx(j,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted/50 text-muted-foreground uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 min-w-[200px]",children:"Institute"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Shifts"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Blocks"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Rooms"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Assets"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Plants"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Transports"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Fund"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Projects"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Upgrad."}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Total %"})]})}),e.jsx("tbody",{className:"divide-y",children:c.length>0?c.map(t=>e.jsxs("tr",{className:"hover:bg-muted/50",children:[e.jsxs("td",{className:"px-4 py-3 font-medium",children:[e.jsx("div",{children:t.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.region_name})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.shifts}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.blocks}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.rooms}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.assets}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.plants}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.transports}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.funds}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.projects}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.upgradations}),e.jsx("td",{className:"px-4 py-3 text-center font-bold",children:e.jsxs("span",{className:t.percentage===100?"text-green-600":t.percentage<50?"text-red-600":"text-yellow-600",children:[t.percentage,"%"]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-muted-foreground",children:"No details available"})})})]})})})]})]})]})}export{pe as default};
