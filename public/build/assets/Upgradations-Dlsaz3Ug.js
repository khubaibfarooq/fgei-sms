var _=Object.defineProperty;var U=(a,l,s)=>l in a?_(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s;var S=(a,l,s)=>U(a,typeof l!="symbol"?l+"":l,s);import{r as d,j as t,L as B}from"./app-CxIyu7h3.js";import{t as b,A as z,S as P}from"./app-layout-C8xWLzwK.js";import{B as u}from"./button-CakpMrn-.js";import{C as M,a as O,b as $,c as H}from"./card-btivF07x.js";import{l as V}from"./lodash-pLNk-HMC.js";import{E as W,F as J,a as Y,b as q}from"./jspdf.plugin.autotable-VYfmZhGs.js";import{f as E}from"./dateFormatter-D72XrzRE.js";import{C as A}from"./combobox-BPIHJ5OY.js";import"./index-DKaPR8Pr.js";import"./createLucideIcon-B6lzvC_V.js";import"./input-BBVhaqdX.js";import"./index-2yKDvXlk.js";import"./app-logo-icon-Dymm9b4u.js";import"./folder-root-DsC7FqO0.js";import"./grip-vertical-BkwZkbhe.js";import"./popover-Dh3q8291.js";const G=[{title:"Reports",href:"/reports"},{title:"upgradations",href:"/reports/upgradations"}];class K extends d.Component{constructor(){super(...arguments);S(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(s){return{hasError:!0,error:s.message}}componentDidCatch(s,x){console.error("ErrorBoundary caught:",s,x),b.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?t.jsxs("div",{className:"p-4",children:[t.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),t.jsx(u,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const f=a=>{const l=a!=null&&typeof a.id=="number"&&a.id>0&&typeof a.name=="string"&&a.name.trim()!=="";return l||console.warn("Invalid item detected:",a),l};function ue({upgradations:a,institutes:l,regions:s,filters:x}){const[j,Q]=d.useState(x.search||""),[h,g]=d.useState(x.institute_id||""),[y,F]=d.useState(x.region_id||""),[m,w]=d.useState(a),[c,N]=d.useState(l||[]),C=d.useMemo(()=>Array.isArray(c)?c.filter(f):(console.warn("filteredInstitutes is not an array or is null:",c),[]),[c]),v=d.useMemo(()=>Array.isArray(s)?s.filter(f):(console.warn("regions is not an array or is null:",s),[]),[s]);d.useEffect(()=>{const e={institutes:Array.isArray(c)?c.filter(r=>!f(r)):[],regions:Array.isArray(s)?s.filter(r=>!f(r)):[]};Object.entries(e).forEach(([r,o])=>{o.length>0&&console.warn(`Invalid ${r}:`,o)})},[c,s]);const R=async e=>{try{const r=new URLSearchParams({region_id:e||""}).toString(),o=await fetch(`/reports/getInstitutes?${r}`);if(!o.ok)throw new Error("Failed to fetch institutes");const n=await o.json();console.log("Fetched institutes:",n),N(n),h&&e!=="0"&&!n.some(i=>i.id.toString()===h)&&g("")}catch(r){console.error("Error fetching institutes:",r),b.error("Failed to load institutes"),N([])}},I=e=>{F(e),g(""),R(e)},D=async()=>{const e=new W.Workbook,r=e.addWorksheet("upgradations");r.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:30},{header:"Date To",key:"to",width:20},{header:"Level From",key:"levelfrom",width:30},{header:"Level To",key:"levelto",width:20},{header:"Status",key:"status",width:20},{header:"Institute",key:"institute",width:30},{header:"Region",key:"region",width:30}],m.data.forEach(i=>{var p,k;r.addRow({details:i.details,from:i.from,to:i.to,levelfrom:i.levelfrom,levelto:i.levelto,status:i.status,institute:((p=i.institute)==null?void 0:p.name)||"N/A",region:((k=i.region)==null?void 0:k.name)||"N/A"})});const o=await e.xlsx.writeBuffer(),n=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});J.saveAs(n,"upgradations_Report.xlsx")},L=()=>{const e=new Y;e.setFontSize(16),e.text("upgradations Report",14,15);const r=["Details","Date From","Date To","Level From","Level To","Status","Institute","Region"],o=m.data.map(n=>{var i,p;return[n.details,n.from,n.to,n.levelfrom,n.levelto,n.status,((i=n.institute)==null?void 0:i.name)||"N/A",((p=n.region)==null?void 0:p.name)||"N/A"]});q(e,{head:[r],body:o,startY:25,styles:{fontSize:10}}),e.save("upgradation_Report.pdf")},T=d.useMemo(()=>V.debounce(()=>{const e=new URLSearchParams({search:j||"",institute_id:h||"",region_id:y||""});fetch(`/reports/upgradations/getUpgradations?${e.toString()}`).then(r=>r.json()).then(r=>{console.log("Fetched filtered upgradations:",r),w(r)}).catch(r=>{console.error("Error fetching filtered upgradations:",r),b.error("Failed to fetch filtered upgradations")})},300),[j,h,y]);return t.jsx(K,{children:t.jsxs(z,{breadcrumbs:G,children:[t.jsx(B,{title:"Upgradations Report"}),t.jsx("div",{className:"flex-1 p-1 md:p-1",children:t.jsxs(M,{className:"w-full",children:[t.jsx(O,{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:t.jsx($,{className:"text-2xl font-bold",children:"Upgradation Report"})}),t.jsx(P,{}),t.jsxs(H,{className:"space-y-6 pt-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[v.length>0&&t.jsx(A,{entity:"region",value:y,onChange:e=>I(e),options:v.map(e=>({id:e.id.toString(),name:e.name.split(" ").pop()||e.name})),includeAllOption:!0}),t.jsx(A,{entity:"institute",value:h,onChange:e=>g(e),options:C.map(e=>({id:e.id.toString(),name:e.name})),includeAllOption:!1})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-2 justify-end",children:[t.jsx(u,{onClick:T,className:"w-full md:w-auto",children:"Apply Filters"}),t.jsx(u,{onClick:L,className:"w-full md:w-auto",children:"Export PDF"}),t.jsx(u,{onClick:D,className:"w-full md:w-auto",children:"Export Excel"})]}),t.jsx("div",{className:"space-y-3",children:t.jsxs("table",{className:"w-full border-collapse border-1 rounded-md overflow-hidden shadow-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Details"}),t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"From"}),t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"To"}),t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Status"}),t.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Institute"})]})}),t.jsx("tbody",{children:m.data.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"text-muted-foreground text-center p-4",children:"No upgradations found."})}):m.data.map(e=>{var r;return t.jsxs("tr",{className:"hover:bg-primary/10 dark:hover:bg-gray-700 text-center",children:[t.jsx("td",{className:"border p-2 text-sm md:text-md lg:text-lg border-r-1 font-bold text-gray-900 dark:text-gray-100",children:e.details}),t.jsx("td",{className:"border p-2 text-sm md:text-md lg:text-lg border-r-1  text-gray-900 dark:text-gray-100",children:E(e.from)}),t.jsx("td",{className:"border p-2 text-sm md:text-md lg:text-lg border-r-1  text-gray-900 dark:text-gray-100",children:E(e.to)}),t.jsx("td",{className:"border p-2 text-sm md:text-md lg:text-lg border-r-1  text-gray-900 dark:text-gray-100",children:e.levelfrom}),t.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:e.levelto}),t.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:e.status}),t.jsx("td",{className:"border p-2 text-sm md:text-md lg:text-lg border-r-1  text-gray-900 dark:text-gray-100",children:((r=e.institute)==null?void 0:r.name)||"N/A"})]},e.id)})})]})}),m.links.length>1&&t.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:m.links.map((e,r)=>t.jsx(u,{disabled:!e.url,variant:e.active?"default":"outline",size:"sm",onClick:()=>{e.url&&fetch(e.url).then(o=>o.json()).then(o=>{w(o)}).catch(o=>{console.error("Error:",o)})},className:e.active?"bg-blue-600 hover:bg-blue-700":"",children:t.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})},r))})]})]})})]})})}export{ue as default};
