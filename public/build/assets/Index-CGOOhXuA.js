import{r as m,j as e,L as q,S as c}from"./app-fppV9vkJ.js";import{A as G,y as J,z as Z,S as Q,E as k,G as X,T as D,H as I,t as d,I as Y,J as ee,K as se,L as le,M as j}from"./app-layout-ByVbkOtd.js";import{B as u}from"./button-DiqURXmB.js";import{I as S}from"./index-BPkvBPFm.js";import{A,a as _,b as M,c as E,d as z,e as R,f as T,g as P,h as W}from"./alert-dialog-BvrDHzuT.js";import{D as H,a as L,b as U,c as $}from"./dialog-BIeOSoqm.js";import{c as V}from"./createLucideIcon-_mMC9i6K.js";import"./index-NyDPhMXo.js";import"./index-7I5qUh0D.js";import"./app-logo-icon-DmgX-fLt.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M10 12v-1",key:"v7bkov"}],["path",{d:"M10 18v-2",key:"1cjy8d"}],["path",{d:"M10 7V6",key:"dljcrl"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 .274 1.01",key:"gkbcor"}],["circle",{cx:"10",cy:"20",r:"2",key:"1xzdoj"}]],re=V("FileArchive",ae);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["circle",{cx:"12",cy:"13",r:"2",key:"1c1ljs"}],["path",{d:"M12 15v5",key:"11xva1"}]],ie=V("FolderRoot",te),ne=[{title:"File Management",href:"/files"}];function ce(l){const i=new Map,h=[];return l.forEach(r=>{i.set(r.id,{...r,children:[]})}),l.forEach(r=>{if(r.parent_id){const o=i.get(r.parent_id);o&&o.children.push(i.get(r.id))}else h.push(i.get(r.id))}),h}function oe(l){return l.startsWith("image/")?e.jsx(ee,{className:"w-5 h-5 text-blue-500"}):l.startsWith("video/")?e.jsx(se,{className:"w-5 h-5 text-purple-500"}):l.startsWith("audio/")?e.jsx(le,{className:"w-5 h-5 text-pink-500"}):l.includes("zip")||l.includes("rar")||l.includes("tar")||l.includes("7z")?e.jsx(re,{className:"w-5 h-5 text-yellow-500"}):l.includes("pdf")?e.jsx(j,{className:"w-5 h-5 text-red-500"}):l.includes("text")||l.includes("csv")||l.includes("json")?e.jsx(j,{className:"w-5 h-5 text-green-500"}):l.includes("word")?e.jsx(j,{className:"w-5 h-5 text-blue-600"}):l.includes("excel")||l.includes("sheet")?e.jsx(j,{className:"w-5 h-5 text-green-600"}):l.includes("powerpoint")||l.includes("presentation")?e.jsx(j,{className:"w-5 h-5 text-orange-500"}):e.jsx(I,{className:"w-5 h-5 text-gray-500"})}function de(l){return l.startsWith("image/")||l.startsWith("text/")||l.includes("pdf")||l.includes("document")}function ye({folders:l,currentFolderId:i,currentFolder:h,files:r}){const o=m.useRef(null),[f,y]=m.useState(!1),[g,w]=m.useState(""),[N,b]=m.useState(null),[t,v]=m.useState(null),[B,x]=m.useState(!1),K=()=>{if(!N)return;const s=N===i;c.delete(`/media/${N}`,{preserveScroll:!0,onSuccess:()=>{d.success("Folder deleted successfully"),b(null),s?c.visit("/files",{replace:!0}):c.reload({only:["folders"]})},onError:()=>d.error("Failed to delete folder")})},O=s=>{const n=s.target.files;if(!n||n.length===0)return;const a=new FormData;for(let p=0;p<n.length;p++)a.append("files[]",n[p]);i&&a.append("folder_id",i.toString()),y(!0),c.post("/files",a,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{d.success("File uploaded successfully"),o.current&&(o.current.value=""),c.reload({only:["files"]})},onError:()=>d.error("Failed to upload file"),onFinish:()=>y(!1)})},F=()=>{if(!g.trim()){d.error("Folder name cannot be empty");return}x(!0),c.post("/media",{name:g,parent_id:i},{preserveScroll:!0,onSuccess:()=>{d.success("Folder created successfully"),w(""),x(!1),c.reload({only:["folders"]})},onError:()=>{d.error("Failed to create folder"),x(!1)}})},C=(s,n=0)=>s.map(a=>e.jsxs("div",{style:{marginLeft:n*12},className:"mb-1",children:[e.jsxs("div",{className:`flex items-center gap-1 cursor-pointer hover:bg-gray-100 p-1 rounded ${i===a.id?"bg-gray-100":""}`,onClick:()=>c.visit(`/files?folder_id=${a.id}`),children:[a.children.length>0&&e.jsx(Y,{className:"w-4 h-4 text-gray-500"}),a.children.length===0&&e.jsx("span",{className:"w-4 h-4"}),e.jsx(k,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm truncate flex-1",children:a.name}),e.jsxs(A,{children:[e.jsx(_,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"icon",className:"h-6 w-6 text-gray-500 hover:text-red-500",onClick:p=>{p.stopPropagation(),b(a.id)},children:e.jsx(D,{className:"w-3 h-3"})})}),e.jsxs(M,{children:[e.jsxs(E,{children:[e.jsx(z,{children:"Delete Folder?"}),e.jsxs(R,{children:["Folder ",e.jsx("strong",{children:a.name})," and all its contents will be permanently deleted."]})]}),e.jsxs(T,{children:[e.jsx(P,{children:"Cancel"}),e.jsx(W,{onClick:K,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]}),a.children.length>0&&e.jsx("div",{className:"ml-4",children:C(a.children,n+1)})]},a.id));return e.jsxs(G,{breadcrumbs:ne,children:[e.jsx(q,{title:"File Manager"}),e.jsxs("div",{className:"flex-1 p-4 md:p-6 grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"md:col-span-1 border rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold",children:"Folder Structure"}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>x(!0),className:"gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"New Folder"})]})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(100vh-250px)]",children:[e.jsxs("div",{className:`flex items-center gap-2 cursor-pointer hover:bg-gray-100 p-2 rounded mb-2 ${i?"":"bg-gray-100"}`,onClick:()=>c.visit("/files"),children:[e.jsx(ie,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Root Folder"})]}),C(ce(l??[]))]})]}),e.jsxs("div",{className:"md:col-span-3 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:h?h.name:"Root Folder"}),h&&e.jsxs("span",{className:"text-sm text-gray-500",children:["(",r.length," ",r.length===1?"item":"items",")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{ref:o,type:"file",onChange:O,disabled:f,className:"hidden",multiple:!0}),e.jsxs(u,{onClick:()=>{var s;return(s=o.current)==null?void 0:s.click()},disabled:f,className:"gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),f?"Uploading...":"Upload"]})]})]}),e.jsx(Q,{}),r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(k,{className:"w-12 h-12 mb-2"}),e.jsx("p",{children:"No files in this folder"}),e.jsx(u,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>{var s;return(s=o.current)==null?void 0:s.click()},children:"Upload the first file"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:border-blue-500 transition-colors group cursor-pointer",onClick:()=>de(s.mime_type)?v(s):null,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[oe(s.mime_type),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.size}),e.jsx("p",{className:"text-xs text-gray-500",children:s.created_at})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("a",{href:s.url,download:s.name,onClick:n=>n.stopPropagation(),className:"p-1 text-gray-500 hover:text-blue-500",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsxs(A,{children:[e.jsx(_,{asChild:!0,children:e.jsx("button",{className:"p-1 text-gray-500 hover:text-red-500",onClick:n=>n.stopPropagation(),children:e.jsx(D,{className:"w-4 h-4"})})}),e.jsxs(M,{children:[e.jsxs(E,{children:[e.jsx(z,{children:"Delete File?"}),e.jsxs(R,{children:["File ",e.jsx("strong",{children:s.name})," will be permanently deleted."]})]}),e.jsxs(T,{children:[e.jsx(P,{children:"Cancel"}),e.jsx(W,{onClick:()=>c.delete(`/files/${s.id}`,{preserveScroll:!0,onSuccess:()=>{v(null),c.reload({only:["files"]})}}),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})},s.id))})]})]}),e.jsx(H,{open:B,onOpenChange:x,children:e.jsxs(L,{children:[e.jsx(U,{children:e.jsx($,{children:"Create New Folder"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{placeholder:"Folder name",value:g,onChange:s=>w(s.target.value),onKeyDown:s=>s.key==="Enter"&&F()}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(u,{onClick:F,disabled:!g.trim(),children:"Create"})]})]})]})}),e.jsx(H,{open:!!t,onOpenChange:s=>!s&&v(null),children:e.jsx(L,{className:"max-w-4xl max-h-[90vh] flex flex-col",children:t&&e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsx($,{className:"truncate",children:t.name})}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:t.mime_type.startsWith("image/")?e.jsx("img",{src:t.url,alt:t.name,className:"max-w-full max-h-[70vh] mx-auto object-contain"}):t.mime_type.includes("pdf")?e.jsx("iframe",{src:t.url,className:"w-full h-[70vh] border rounded",title:t.name}):t.mime_type.startsWith("text/")?e.jsx("div",{className:"bg-gray-100 p-4 rounded h-[70vh] overflow-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(I,{className:"w-12 h-12 mb-2"}),e.jsx("p",{children:"Preview not available"}),e.jsx("a",{href:t.url,download:t.name,className:"mt-2 text-blue-500 hover:underline",children:"Download file"})]})})]})})})]})}export{ye as default};
