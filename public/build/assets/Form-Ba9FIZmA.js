import{R as u,m as v,j as e,L as S,$ as N,S as m}from"./app-C5naZ0Xu.js";import{A as y,S as B,c as C,d as _}from"./app-layout-CtdoAd8o.js";import{B as h}from"./button-jNbYH9-3.js";import{C as w,a as A,b as L,c as E}from"./card-C37ELfMH.js";import{I as p}from"./input-CSka5UCN.js";import{L as c}from"./label-FKnM1mwm.js";import{S as F,a as R,b as U,c as D,d as $}from"./select-BiMijox_.js";import"./index-DxWWg5H9.js";import"./createLucideIcon-CmR2UCV9.js";import"./index-CrA-1fU4.js";import"./app-logo-icon-B-JspDvR.js";import"./folder-root-CJOfU33W.js";import"./grip-vertical-DGFerWM-.js";import"./index-cmxDaKRj.js";import"./index-523VM5Yc.js";function Y({block:s,blockTypes:n}){const t=!!s;console.log("blockTypes:",n);const d=u.useMemo(()=>n?Array.isArray(n)?n:Object.entries(n).map(([r,i])=>({id:parseInt(r),name:i})):[],[n]),{data:a,setData:o,processing:x,reset:f}=v({name:(s==null?void 0:s.name)||"",area:(s==null?void 0:s.area)||0,institute_id:(s==null?void 0:s.institute_id)||0,block_type_id:(s==null?void 0:s.block_type_id)||0,img:(s==null?void 0:s.img)||null}),j=r=>{r.preventDefault();const i=new FormData;Object.keys(a).forEach(l=>{if(!(a[l]===null||a[l]==="")){if(l==="img"){a[l]instanceof File&&i.append(l,a[l]);return}i.append(l,a[l])}}),t?(i.append("_method","PUT"),m.post(`/blocks/${s.id}`,i,{forceFormData:!0,preserveScroll:!0,preserveState:!0,onSuccess:()=>{m.get("/blocks")}})):m.post("/blocks",i,{onSuccess:()=>{f()}})},g=[{title:"Blocks",href:"/blocks"},{title:t?"Edit Block":"Add Block",href:"#"}];return e.jsxs(y,{breadcrumbs:g,children:[e.jsx(S,{title:t?"Edit Block":"Add Block"}),e.jsx("div",{className:"flex-1 p-4 md:p-6 w-[70vw] mx-auto",children:e.jsxs(w,{children:[e.jsxs(A,{children:[e.jsx(L,{className:"text-2xl font-bold",children:t?"Edit Block":"Add Block"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t?"Edit block details":"Create a new block"})]}),e.jsx(B,{}),e.jsx(E,{className:"pt-6",children:e.jsxs("form",{onSubmit:j,className:"space-y-6",encType:"multipart/form-data",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Block Name"}),e.jsx(p,{id:"name",value:a.name,onChange:r=>o("name",r.target.value),placeholder:"Enter block name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"area",children:"Area (sq ft)"}),e.jsx(p,{id:"area",type:"number",value:a.area,onChange:r=>o("area",Number(r.target.value)),placeholder:"Enter area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"block_type_id",children:"Block Type"}),e.jsxs(F,{value:a.block_type_id.toString(),onValueChange:r=>o("block_type_id",parseInt(r)),children:[e.jsx(R,{children:e.jsx(U,{placeholder:"Select block type"})}),e.jsx(D,{children:d.map(r=>e.jsx($,{value:r.id.toString(),children:r.name},r.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"img",children:"Image"}),e.jsx(p,{id:"img",type:"file",accept:"image/*",onChange:r=>{var i;return o("img",((i=r.target.files)==null?void 0:i[0])||null)}}),e.jsx(c,{children:"Image"}),e.jsx(b,{dataImg:a.img})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6",children:[e.jsx(N,{href:"/blocks",children:e.jsxs(h,{type:"button",variant:"secondary",children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Back"]})}),e.jsxs(h,{type:"submit",disabled:x,children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),x?t?"Saving...":"Adding...":t?"Save Changes":"Add Block"]})]})]})})]})})]})}function b({dataImg:s}){const[n,t]=u.useState(()=>s&&typeof s=="string"?`/assets/${s}`:null);return u.useEffect(()=>{if(s instanceof File){const d=URL.createObjectURL(s);return t(d),()=>URL.revokeObjectURL(d)}else t(typeof s=="string"&&s?`/assets/${s}`:null)},[s]),n?e.jsx("img",{src:n,alt:"Layout",className:"w-full h-48 object-cover rounded"}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No image uploaded."})}export{Y as default};
