import{r as o,j as e,L as ve}from"./app-BmODJ77E.js";import{A as Se,S as Ce,t as M}from"./app-layout-Bbc4kv0B.js";import{B as $}from"./button-D9c9qIUh.js";import{C as Ie,a as Re,b as Ae,c as _e}from"./card-BNsYLI0A.js";import{I as De}from"./index-CVCyow0I.js";import{S as U,a as z,b as V,c as H,d as k}from"./select-B1o2NZql.js";import{E as Be,F as Fe,a as Le,b as Ee}from"./jspdf.plugin.autotable-DI95OolB.js";import"./index-Cmc6Lhtn.js";import"./createLucideIcon-9X6x349L.js";import"./index-B2Es8r4J.js";import"./app-logo-icon-D0wkTzPq.js";import"./index-BvjVE8et.js";import"./index-C-LFzyw2.js";const Pe=[{title:"Institutional Report",href:"/reports/institutes"}],Q=m=>{const p=m!=null&&typeof m.id=="number"&&m.id>0&&typeof m.name=="string"&&m.name.trim()!=="";return p||console.warn("Invalid item detected:",m),p};function Ze({institutes:m=[],regions:p=[],blocks:Y=[],instituteAssets:K=[],rooms:J=[],shifts:G=[],upgradations:X=[],funds:Z=[],projects:ee=[],filters:N={search:"",institute_id:"",region_id:""}}){const[w,te]=o.useState(N.search||""),[y,B]=o.useState(N.institute_id||""),[v,se]=o.useState(N.region_id||""),[F,L]=o.useState(m),[E,Te]=o.useState(p),[x,ae]=o.useState(Y),[h,re]=o.useState(K),[g,de]=o.useState(J),[u,oe]=o.useState(G),[f,ne]=o.useState(X),[S,le]=o.useState(!1),[C,ie]=o.useState(!1),[I,ce]=o.useState(!1),[R,me]=o.useState(!1),[A,xe]=o.useState(!1),[Oe,We]=o.useState(!1),[_,he]=o.useState(Z),[b,ge]=o.useState(ee),[D,ue]=o.useState(!1),P=o.useMemo(()=>F.filter(Q),[F]),j=o.useMemo(()=>E.filter(Q),[E]);console.log(j);const T=async t=>{try{const d=new URLSearchParams(t).toString(),l=await fetch(`/reports/institutes/getData?${d}`);if(!l.ok)throw new Error("Failed to fetch data");const a=await l.json();ae(a.blocks||[]),re(a.instituteAssets||[]),de(a.rooms||[]),oe(a.shifts||[]),ne(a.upgradations||[]),he(a.funds||[]),console.log(a.projects),ge(a.projects||[])}catch(d){console.error("Error fetching data:",d),M.error("Failed to load data")}},fe=t=>{t.key==="Enter"&&T({search:w,institute_id:y,region_id:v})},be=t=>{B(t),T({search:w,institute_id:t,region_id:v})},pe=async t=>{try{const d=new URLSearchParams({region_id:t||""}).toString(),l=await fetch(`/reports/getInstitutes?${d}`);if(!l.ok)throw new Error("Failed to fetch institutes");const a=await l.json();console.log("Fetched institutes:",a),L(a),y&&t!=="0"&&!a.some(n=>n.id.toString()===y)&&B("")}catch(d){console.error("Error fetching institutes:",d),M.error("Failed to load institutes"),L([])}},ye=async t=>{se(t),pe(t)},je=async()=>{const t=new Be.Workbook,d=t.addWorksheet("Shifts");d.columns=[{header:"Name",key:"name",width:20},{header:"Building Name",key:"building_name",width:20},{header:"Building Type",key:"building_type",width:20}],u.forEach(r=>{var c;d.addRow({name:r.name,building_name:r.building_name,building_type:((c=r.building_type)==null?void 0:c.name)||"N/A"})});const l=t.addWorksheet("Blocks");l.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15}],x.forEach(r=>{l.addRow({name:r.name,area:r.area})});const a=t.addWorksheet("Rooms");a.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15},{header:"Block",key:"block",width:20}],g.forEach(r=>{var c;a.addRow({name:r.name,area:r.area,block:((c=r.block)==null?void 0:c.name)||"N/A"})});const n=t.addWorksheet("Assets");n.columns=[{header:"Details",key:"details",width:30},{header:"Quantity",key:"qty",width:10},{header:"Institute",key:"institute",width:20},{header:"Room",key:"room",width:20},{header:"Asset",key:"asset",width:20}],h.forEach(r=>{var c,W,q;n.addRow({details:r.details,qty:r.current_qty,institute:((c=r.institute)==null?void 0:c.name)||"N/A",room:((W=r.room)==null?void 0:W.name)||"N/A",asset:((q=r.asset)==null?void 0:q.name)||"N/A"})});const s=t.addWorksheet("Funds");s.columns=[{header:"Fund Head",key:"Fundhead",width:30},{header:"Balance",key:"balance",width:15}],_.forEach(r=>{var c;s.addRow({Fundhead:(c=r.fund_head)==null?void 0:c.name,balance:r.balance})});const i=t.addWorksheet("Upgradations");i.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:15},{header:"Date To",key:"to",width:15},{header:"Level From",key:"levelfrom",width:15},{header:"Level To",key:"levelto",width:15},{header:"Status",key:"status",width:15}],f.forEach(r=>{i.addRow({details:r.details,from:r.from,to:r.to,levelfrom:r.levelfrom,levelto:r.levelto,status:r.status})});const O=t.addWorksheet("Projects");O.columns=[{header:"Project Type",key:"projecttype",width:30},{header:"Completed",key:"completed",width:15},{header:"In  Progress",key:"inprogress",width:15},{header:"Planned",key:"planned",width:15}],b.forEach(r=>{O.addRow({projecttype:r.name,completed:r.completed,inprogress:r.inprogress,planned:r.planned})});const Ne=await t.xlsx.writeBuffer(),we=new Blob([Ne],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Fe.saveAs(we,"Institutional_Report.xlsx")},ke=()=>{const t=new Le;let d=20;const l=(a,n,s)=>{t.setFontSize(14),t.text(a,14,d),Ee(t,{head:[n],body:s,startY:d+3,styles:{fontSize:10},headStyles:{fillColor:[11,67,27]}}),d=t.lastAutoTable.finalY+8,d>t.internal.pageSize.height-50&&(t.addPage(),d=20)};if(t.setFontSize(16),t.text("Institutional Report",14,15),d=25,u.length>0){const a=["Name","Building Name","Building Type"],n=u.map(s=>{var i;return[s.name,s.building_name,((i=s.building_type)==null?void 0:i.name)||"N/A"]});l("Shifts",a,n)}if(x.length>0){const a=["Name","Area (sq ft)"],n=x.map(s=>[s.name,s.area]);l("Blocks",a,n)}if(g.length>0){const a=["Name","Area (sq ft)","Block"],n=g.map(s=>{var i;return[s.name,s.area,((i=s.block)==null?void 0:i.name)||"N/A"]});l("Rooms",a,n)}if(h.length>0){const a=["Asset Name","Details","Quantity","Room","Added Date"],n=h.map(s=>[s.asset.name,s.details,s.current_qty.toString(),s.room.name,s.added_date]);l("Institute Assets",a,n)}if(_.length>0){const a=["Fund Head","Balance"],n=_.map(s=>{var i;return[(i=s.fund_head)==null?void 0:i.name,s.balance]});l("Institute Funds",a,n)}if(f.length>0){const a=["Details","Date From","Date To","Level From","Level To","Status"],n=f.map(s=>[s.details,s.from,s.to,s.levelfrom,s.levelto,s.status]);l("Institute Upgradations",a,n)}if(b.length>0){const a=["Project Type","Completed","In Progress","Planned"],n=b.map(s=>[s.name,s.completed,s.inprogress,s.planned]);l("Institute Projects",a,n)}t.save("Institutional_Report.pdf")};return e.jsxs(Se,{breadcrumbs:Pe,children:[e.jsx(ve,{title:"Institutional Report"}),e.jsxs("div",{className:"flex-1 p-3 ",children:[e.jsxs(Ie,{children:[e.jsxs(Re,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:["          ",e.jsx(Ae,{children:"Institutional Report"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{onClick:ke,className:"w-full md:w-auto",children:"Export PDF"}),e.jsx($,{onClick:je,className:"w-full md:w-auto",children:"Export Excel"})]})]}),e.jsx(Ce,{}),e.jsxs(_e,{className:"py-3 space-y-2",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:e.jsx(De,{type:"text",placeholder:"Search institutes... (press Enter)",value:w,onChange:t=>te(t.target.value),onKeyDown:fe})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[j.length>0&&e.jsxs(U,{value:v,onValueChange:ye,children:[e.jsx(z,{children:e.jsx(V,{placeholder:"Select Region"})}),e.jsxs(H,{children:[e.jsx(k,{value:"0",children:"All Regions"}),j.length>0?j.map(t=>e.jsx(k,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No Regions available"})]})]}),e.jsxs(U,{value:y,onValueChange:be,children:[e.jsx(z,{children:e.jsx(V,{placeholder:"Select Institute"})}),e.jsxs(H,{children:[e.jsx(k,{value:"0",children:"All Institutes"}),P.length>0?P.map(t=>e.jsx(k,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:`w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800 

  `,onClick:()=>le(!S),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Shifts(",u.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${S?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),S&&e.jsx("div",{className:"p-4 border-t",children:u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Type"})]})}),e.jsx("tbody",{children:u.map(t=>{var d;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.building_name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(d=t.building_type)==null?void 0:d.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No shifts available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>ie(!C),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Blocks(",x.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${C?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),C&&e.jsx("div",{className:"p-4 border-t",children:x.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No blocks available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>ce(!I),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Rooms(",g.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${I?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),I&&e.jsx("div",{className:"p-4 border-t",children:g.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Block"})]})}),e.jsx("tbody",{children:g.map(t=>{var d;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(d=t.block)==null?void 0:d.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No rooms available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>me(!R),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Assets(",h.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${R?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),R&&e.jsx("div",{className:"p-4 border-t",children:h.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Quantity"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Room"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Added Date"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.asset.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.current_qty}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.room.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.added_date})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No assets available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>xe(!A),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Upgradations(",f.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${A?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),A&&e.jsx("div",{className:"p-4 border-t",children:f.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date from"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date to"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Status"})]})}),e.jsx("tbody",{children:f.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.from}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.to}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelfrom}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelto}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.status})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No upgradations available"})})]}),e.jsxs("div",{className:"border rounded-lg mb-4 border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>ue(!D),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Projects(",b.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${D?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),D&&e.jsx("div",{className:"p-4 border-t",children:b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Project Type"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Completed"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"In Progress"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Planned"})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.completed}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.inprogress}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.planned})]}))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No Fund available"})})]})]})]})}export{Ze as default};
