import{r as n,m as R,j as e,L as _,S as p}from"./app-D11bxRh5.js";import{A as F,P as T,fO as E,aL as z,B as N}from"./app-layout-C0HX1335.js";import{B as d}from"./button-D4JCJ08l.js";import{I as o}from"./input-DkRaDipk.js";import{S as B,a as P,b as O,c as M,d as r}from"./select-Dmnwa00t.js";import{A as W,a as K,b as V,c as U,d as Y,e as G,f as J,g as Q,h as X}from"./alert-dialog-Digp5abm.js";import{t as w}from"./index-BdXQa_V8.js";import{C as Z}from"./ChatBox-CjNgsFB3.js";import"./index-D2p8fnIk.js";import"./createLucideIcon-Dgh1T-nI.js";import"./index-C2FgNEgo.js";import"./index-CLhMZ-TS.js";import"./index-kOT80Fu-.js";import"./index-yvXVfYV7.js";import"./app-logo-icon-COWl4HZD.js";import"./circle-x-DXxKQNo3.js";import"./index-fBhu4vWS.js";import"./index-zyk2uxEO.js";import"./card-BtSrY6Qn.js";import"./folder-root-X6oJSnUk.js";import"./grip-vertical-Bkjodxto.js";const q=[{title:"HelpDesks",href:"/helpdesk"}],l=a=>{switch(a){case"Pending":return"bg-yellow-500 text-white";case"Waiting":return"bg-blue-500 text-white";case"Resolved":return"bg-green-500 text-white";case"Rejected":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}};function ke({helpDesk:a,filters:i,institutes:ee,auth:te}){var b;const[x,k]=n.useState(i.search||""),[h,S]=n.useState(i.status||""),[y,g]=n.useState(!1),[t,j]=n.useState(null),{data:f,setData:m,post:C,processing:D,errors:c,reset:A}=R({title:"",description:"",attachment:null}),$=s=>{s.key==="Enter"&&p.get("/helpdesk",{...i,search:x,status:h},{preserveScroll:!0})},H=s=>{S(s),p.get("/helpdesk",{...i,search:x,status:s},{preserveScroll:!0})},L=s=>{s.preventDefault(),C("/helpdesk",{preserveScroll:!0,onSuccess:()=>{g(!1),A(),w.success("Help desk ticket created successfully.")},onError:()=>{w.error("Failed to create help desk ticket.")}})},I=s=>{var v;if(!s)return!1;const u=(v=s.split(".").pop())==null?void 0:v.toLowerCase();return["jpg","jpeg","png"].includes(u||"")};return e.jsxs(F,{breadcrumbs:q,children:[e.jsx(_,{title:"HelpDesk"}),e.jsxs("div",{className:"flex h-[calc(100vh-64px)] overflow-hidden bg-background",children:[e.jsxs("div",{className:`w-full md:w-80 lg:w-96 flex flex-col border-r bg-card transition-all ${t?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"p-4 border-b space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold",children:"HelpDesk"}),e.jsxs(W,{open:y,onOpenChange:g,children:[e.jsx(K,{asChild:!0,children:e.jsx(d,{size:"icon",variant:"ghost",children:e.jsx(T,{className:"h-5 w-5"})})}),e.jsxs(V,{children:[e.jsxs(U,{children:[e.jsx(Y,{children:"Create Help Desk Ticket"}),e.jsx(G,{children:"Fill in the details to create a new help desk ticket."})]}),e.jsxs("form",{onSubmit:L,encType:"multipart/form-data",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"create-title",className:"block text-sm font-medium",children:"Title"}),e.jsx(o,{id:"create-title",type:"text",value:f.title,onChange:s=>m("title",s.target.value),placeholder:"Enter ticket title"}),c.title&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:c.title})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"create-description",className:"block text-sm font-medium",children:"Description"}),e.jsx(o,{id:"create-description",type:"text",value:f.description,onChange:s=>m("description",s.target.value),placeholder:"Enter description"}),c.description&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:c.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"create-attachment",className:"block text-sm font-medium",children:"Attachment"}),e.jsx(o,{id:"create-attachment",type:"file",accept:".jpg,.png,.pdf,.doc,.docx",onChange:s=>m("attachment",s.target.files?s.target.files[0]:null)})]}),e.jsxs(J,{children:[e.jsx(Q,{children:"Cancel"}),e.jsx(X,{type:"submit",disabled:D,children:"Create"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search...",value:x,onChange:s=>k(s.target.value),onKeyDown:$,className:"h-9 pl-9"})]}),e.jsxs(B,{value:h,onValueChange:H,children:[e.jsx(P,{className:"h-9",children:e.jsx(O,{placeholder:"Status"})}),e.jsxs(M,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"Pending",children:"Pending"}),e.jsx(r,{value:"Waiting",children:"Waiting"}),e.jsx(r,{value:"Resolved",children:"Resolved"}),e.jsx(r,{value:"Rejected",children:"Rejected"})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto divide-y",children:[!(a!=null&&a.data)||a.data.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground text-sm italic",children:"No tickets found"}):a.data.map(s=>e.jsxs("div",{onClick:()=>j(s),className:`p-4 cursor-pointer hover:bg-muted/50 transition-colors ${(t==null?void 0:t.id)===s.id?"bg-primary/10 border-r-2 border-primary":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("span",{className:"text-[10px] font-mono font-medium text-muted-foreground",children:["#",s.token]}),e.jsx("span",{className:`text-[9px] uppercase font-bold px-1.5 py-0.5 rounded-full ${l(s.status)}`,children:s.status})]}),e.jsx("h3",{className:"font-semibold text-sm truncate",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.description}),e.jsx("div",{className:"flex justify-between mt-2 text-[10px] text-muted-foreground italic",children:e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()})})]},s.id)),(a==null?void 0:a.links)&&a.links.length>3&&e.jsx("div",{className:"p-4 flex justify-center gap-1 border-t",children:a.links.map((s,u)=>e.jsx(d,{disabled:!s.url,variant:s.active?"default":"ghost",size:"icon",className:"h-8 w-8 text-[10px]",onClick:()=>p.visit(s.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},u))})]})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-muted/5 transition-all ${t?"flex":"hidden md:flex"}`,children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b bg-card flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>j(null),children:e.jsx(z,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-base leading-none mb-1",children:t.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ticket #",t.token," â€¢ ",t.institute.name]})]})]}),e.jsx("div",{className:`text-[10px] uppercase font-black px-2 py-1 rounded-full ${l(t.status)}`,children:t.status})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-full mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl border p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pb-4 border-b",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-1",children:"Created By"}),e.jsx("p",{className:"text-sm font-medium",children:t.user.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-1",children:"Date Created"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-1",children:"Last Update"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(t.updated_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-1",children:"Institute"}),e.jsx("p",{className:"text-sm font-medium truncate",children:t.institute.name})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm leading-relaxed text-foreground/80 whitespace-pre-wrap italic",children:['"',t.description,'"']}),t.attachment&&e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-2",children:"Attached Documents"}),I(t.attachment)?e.jsx("div",{className:"relative group max-w-[240px]",children:e.jsx("img",{src:`/storage/${t.attachment}`,alt:"Attachment preview",className:"rounded-lg border object-cover h-32 w-full hover:brightness-90 transition-all cursor-zoom-in",onClick:()=>window.open(`/storage/${t.attachment}`,"_blank")})}):e.jsx(d,{variant:"outline",size:"sm",className:"h-8",onClick:()=>window.open(`/storage/${t.attachment}`,"_blank"),children:"Download File"})]})]})]}),(t.feedback||t.feedbackby)&&e.jsxs("div",{className:`${l(t.status)}/10 border-${l(t.status)}/20 rounded-xl p-5 border text-${l(t.status)}-900 dark:text-${l(t.status)}-100 shadow-sm relative overflow-hidden group`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-${getStatusStyles(selectedHelpDesk.status)}/5 rounded-full -mr-16 -mt-16 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"text-[11px] font-black uppercase tracking-[0.2em] mb-3 text-${getStatusStyles(selectedHelpDesk.status)}-600 dark:text-${getStatusStyles(selectedHelpDesk.status)}-500",children:"Official Support Resolution"}),e.jsx("p",{className:"text-sm leading-relaxed mb-4 font-medium",children:t.feedback||"In Progress - Awaiting final resolution."}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-${getStatusStyles(selectedHelpDesk.status)}/10 text-[10px] uppercase font-bold tracking-wider",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(N,{className:"h-3 w-3"}),((b=t.feedbackby)==null?void 0:b.name)||"Assigned Agent"]}),t.feedback_date&&e.jsxs("span",{children:["Resolved at: ",new Date(t.feedback_date).toLocaleDateString()]})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx(Z,{helpDeskId:t.id,status:t.status})})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 opacity-40",children:[e.jsx("div",{className:"w-24 h-24 bg-muted rounded-full flex items-center justify-center mb-6",children:e.jsx(N,{className:"h-12 w-12"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Your Conversations"}),e.jsx("p",{className:"text-sm text-center max-w-[300px]",children:"Select a ticket from the left sidebar to view the details and start chatting with support."})]})})]})]})}export{ke as default};
