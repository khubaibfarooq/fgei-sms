import{r as o,j as e,L}from"./app-CknFJOcO.js";import{A as V,S as x,t as S}from"./app-layout-y5ak4A3o.js";import{B as u}from"./button-BV2vwN6B.js";import{C as W,a as K,b as O,c as p}from"./card-DFM6opku.js";import{S as U,a as $,b as G,c as J,d as C}from"./select-B4R6HVxd.js";import{C as R}from"./combobox-Dq9BShHf.js";import{E as M,F as Y,a as q,b as Q}from"./jspdf.plugin.autotable-D9tLuhkB.js";import"./index-BjWG1ZKm.js";import"./createLucideIcon-CitoHvHh.js";import"./input-DtBR5Sl8.js";import"./index-CswnciTi.js";import"./app-logo-icon-OmQUrWrH.js";import"./folder-root-CPFymLTU.js";import"./grip-vertical-BZ3KeRO3.js";import"./index-CHPyQHb-.js";import"./index-BXfe4d2B.js";import"./popover-kvTdByB-.js";const X=[{title:"Reports",href:"/reports"},{title:"Funds",href:"/reports/funds"}];function he({funds:E=[],fundheads:i=[],regions:f=[],balances:T=[],filters:g}){const[j,h]=o.useState(g.institute_id||""),[b,y]=o.useState(g.fund_head_id||""),[N,k]=o.useState(g.region_id||""),[c,I]=o.useState(E),[m,B]=o.useState(T),[z,_]=o.useState([]),l=t=>t==null||t===""?0:typeof t=="number"?t:parseFloat(String(t).replace(/,/g,""))||0,d=t=>{const s=l(t);return new Intl.NumberFormat("ur-PK",{style:"currency",currency:"PKR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)},F=o.useMemo(()=>m.reduce((t,s)=>t+l(s.balance),0),[m]),A=async t=>{if(!t||t==="0"){_([]);return}try{const s=await fetch(`/reports/getInstitutes?region_id=${t}`);if(!s.ok)throw new Error;const n=await s.json();_(n)}catch{S.error("Failed to load institutes")}},H=t=>{k(t),A(t),h("")},w=async t=>{try{const s=new URLSearchParams({institute_id:j||"",region_id:N||"",fund_head_id:b||""}),n=t||`/reports/funds/getfunds?${s.toString()}`,a=await fetch(n);if(!a.ok)throw new Error;const r=await a.json();console.log(r),I(r.funds||r||[]),B(r.balances||[])}catch(s){console.error(s),S.error("Failed to load data")}},D=async()=>{const t=new M.Workbook,s=t.addWorksheet("Funds");s.columns=[{header:"Institute",key:"institute",width:50},...i.map(a=>({header:a.name,key:a.name,width:18})),{header:"Total",key:"total",width:20}],c.forEach(a=>{const r={institute:a.institute_name??(a.region_name.split(" ").pop()||a.region_name)};i.forEach(v=>r[v.name]=l(a.fund_heads[v.name])),r.total=l(a.total_balance),s.addRow(r)});const n=await t.xlsx.writeBuffer();Y.saveAs(new Blob([n]),"Funds_Report.xlsx")},P=()=>{const t=new q("l","mm","a4");t.text("Institute Wise Fund Balances",14,15);const s=["Institute",...i.map(a=>a.name),"Total"],n=c.map(a=>[a.institute_name??(a.region_name.split(" ").pop()||a.region_name),...i.map(r=>l(a.fund_heads[r.name]).toFixed(2)),l(a.total_balance).toFixed(2)]);Q(t,{head:[s],body:n,startY:25}),t.save("Funds_Report.pdf")};return e.jsxs(V,{breadcrumbs:X,children:[e.jsx(L,{title:"Funds Report"}),e.jsx("div",{className:"p-4 lg:p-6 max-w-full",children:e.jsxs(W,{className:"w-full shadow-lg",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-2xl font-bold",children:"Funds Report"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"View fund balances by institute / fund head"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:P,variant:"outline",size:"sm",children:"PDF"}),e.jsx(u,{onClick:D,variant:"outline",size:"sm",children:"Excel"})]})]})}),e.jsx(x,{}),e.jsx(p,{className:"pt-6 pb-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[f.length>0&&e.jsx(R,{entity:"region",value:N,onChange:H,options:f.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!0,placeholder:"Select Region"}),e.jsx(R,{entity:"institute",value:j,onChange:h,options:z.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!1,placeholder:"Select Institute"}),e.jsxs(U,{value:b,onValueChange:y,children:[e.jsx($,{children:e.jsx(G,{placeholder:"Fund Head"})}),e.jsxs(J,{children:[e.jsx(C,{value:"0",children:"All Fund Heads"}),i.map(t=>e.jsx(C,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:()=>w(),className:"flex-1",children:"Apply"}),e.jsx(u,{variant:"outline",onClick:()=>{k(""),h(""),y(""),w("/reports/funds")},className:"flex-1",children:"Reset"})]})]})}),e.jsx(x,{}),e.jsx(p,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-900 py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Balance"}),e.jsx("p",{className:"text-4xl font-bold text-primary mt-2",children:d(F)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Fund Heads"}),e.jsx("p",{className:"text-3xl font-bold text-muted-foreground mt-1",children:m.length})]})]})}),e.jsx(x,{}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Fund Head Balances"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:m.map((t,s)=>{var n;return e.jsxs("div",{className:"bg-muted/50 dark:bg-gray-800 p-4 rounded-lg border hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground truncate",children:((n=t.fund_head)==null?void 0:n.name)||"Unknown"}),e.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400 mt-2",children:d(t.balance)})]},s)})})]}),e.jsx(x,{})]}),e.jsx(p,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-w-[800px] lg:min-w-0",children:c.length===0?e.jsx("div",{className:"text-center py-16 text-muted-foreground",children:"No institute data found. Try adjusting filters."}):e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary text-white",children:[e.jsx("th",{className:"sticky left-0 z-20 bg-primary px-6 py-4 text-left font-semibold",children:"Institute / Region"}),i.map(t=>e.jsx("th",{className:"px-4 py-4 text-center font-medium whitespace-nowrap",children:t.name},t.id)),e.jsx("th",{className:"sticky right-0 z-20 bg-primary px-6 py-4 text-right font-bold",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:c.map(t=>e.jsxs("tr",{className:"hover:bg-muted/50",children:[e.jsx("td",{className:"sticky left-0 z-10 bg-background px-6 py-4 font-medium border-r max-w-xs truncate",children:t.institute_name||t.region_name.split(" ").pop()||t.region_name}),i.map(s=>e.jsx("td",{className:"px-4 py-4 text-right font-mono tabular-nums",children:d(t.fund_heads[s.name])},s.id)),e.jsx("td",{className:"sticky right-0 z-10 bg-green-50 dark:bg-green-900/30 px-6 py-4 text-right font-bold text-green-700 dark:text-green-400 font-mono tabular-nums border-l",children:d(t.total_balance)})]},t.institute_id??t.region_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800 font-bold",children:[e.jsx("td",{className:"sticky left-0 z-10 bg-gray-100 dark:bg-gray-800 px-6 py-4",children:"Grand Total"}),i.map(t=>{const s=c.reduce((n,a)=>n+l(a.fund_heads[t.name]),0);return e.jsx("td",{className:"px-4 py-4 text-right font-mono tabular-nums",children:d(s)},t.id)}),e.jsx("td",{className:"sticky right-0 z-10 bg-emerald-100 dark:bg-emerald-900/50 px-6 py-4 text-right font-bold text-emerald-700 dark:text-emerald-400 font-mono tabular-nums border-l",children:d(F)})]})})]})})})})]})})]})}export{he as default};
