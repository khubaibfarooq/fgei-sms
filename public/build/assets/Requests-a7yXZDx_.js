import{r as o,m as _,j as e,L as B,S as m}from"./app-DBzhDjnR.js";import{A as F,e0 as b,fP as H,B as j,aN as W,f as v,S as z}from"./app-layout-BNAloD3B.js";import{B as i}from"./button-D_pD7jfh.js";import{C as D,a as V,b as K,c as M}from"./card-BHRl5sdy.js";import{I as O}from"./input-W0h1OP1_.js";import{S as N,a as w,b as y,c as k,d as r}from"./select-Dk9WhxeT.js";import{t as S}from"./index-DB_qMx2A.js";import{C as U}from"./ChatBox-CA-bwbru.js";import{I as G}from"./image-preview2-B6c-yIoR.js";import"./index-DbQmxt2k.js";import"./createLucideIcon-bOA2hw3c.js";import"./index-CUAG3HMa.js";import"./index-DOIG-82r.js";import"./index-CvTI4rvu.js";import"./index-CCpTdKuy.js";import"./app-logo-icon-ys3Ztymg.js";import"./circle-x-nGrvtWG_.js";import"./clsx-B-dksMZM.js";import"./folder-root-BD5IpTYC.js";import"./grip-vertical-vsevKQ4A.js";import"./index-nv6te0VZ.js";import"./index-DwcGrrx3.js";const J=[{title:"Help Desks",href:"/helpdesk"}],C=a=>{switch(a){case"Pending":return"bg-yellow-500 text-white";case"Waiting":return"bg-blue-500 text-white";case"Resolved":return"bg-green-500 text-white";case"Rejected":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}};function je({helpDesk:a,filters:l,institutes:Q,auth:X}){const[c,R]=o.useState(l.search||""),[x,I]=o.useState(l.status||""),[s,u]=o.useState(null),{data:p,setData:n,put:P,processing:h,errors:f,reset:L}=_({status:"",feedback:""}),E=t=>{t.key==="Enter"&&m.get("/helpdesk",{...l,search:c,status:x},{preserveScroll:!0})},A=t=>{I(t),m.get("/helpdesk",{...l,search:c,status:t},{preserveScroll:!0})},$=t=>{var g;if(!t)return!1;const d=(g=t.split(".").pop())==null?void 0:g.toLowerCase();return["jpg","jpeg","png"].includes(d||"")},T=t=>{t.preventDefault(),s&&P(`/helpdesk/${s.id}`,{preserveScroll:!0,onSuccess:()=>{L(),S.success("Help desk ticket updated successfully.")},onError:()=>{S.error("Failed to update help desk ticket.")}})};return e.jsxs(F,{breadcrumbs:J,children:[e.jsx(B,{title:"Ticket Requests"}),e.jsxs("div",{className:"flex h-[calc(100vh-64px)] overflow-hidden bg-background",children:[e.jsxs("div",{className:`w-full md:w-80 lg:w-[400px] flex flex-col border-r bg-card transition-all ${s?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"p-4 border-b space-y-4 shadow-sm z-10",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-primary"}),"Requests"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search tickets, tokens...",value:c,onChange:t=>R(t.target.value),onKeyDown:E,className:"h-9 pl-9 bg-muted/30"})]}),e.jsxs(N,{value:x,onValueChange:A,children:[e.jsx(w,{className:"h-9",children:e.jsx(y,{placeholder:"All Status"})}),e.jsxs(k,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"Pending",children:"Pending"}),e.jsx(r,{value:"Waiting",children:"Waiting"}),e.jsx(r,{value:"Resolved",children:"Resolved"}),e.jsx(r,{value:"Rejected",children:"Rejected"})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto divide-y bg-muted/5 scrollbar-thin scrollbar-thumb-muted",children:[!(a!=null&&a.data)||a.data.length===0?e.jsxs("div",{className:"p-12 text-center text-muted-foreground",children:[e.jsx(j,{className:"h-10 w-10 mx-auto mb-3 opacity-20"}),e.jsx("p",{className:"text-sm italic",children:"No requests found"})]}):a.data.map(t=>e.jsxs("div",{onClick:()=>{u(t),n({status:t.status,feedback:t.feedback||""})},className:`p-4 cursor-pointer hover:bg-muted/50 transition-all border-l-4 min-h-[90px] flex flex-col justify-center ${(s==null?void 0:s.id)===t.id?"bg-primary/5 border-primary shadow-sm":"border-transparent"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsxs("span",{className:"text-[10px] font-bold text-muted-foreground tracking-tighter",children:["#",t.token]}),e.jsx("span",{className:`text-[9px] uppercase font-black px-1.5 py-0.5 rounded-md ${C(t.status)}`,children:t.status})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-bold text-sm truncate uppercase tracking-tight",children:t.title}),e.jsxs("p",{className:"text-[11px] text-muted-foreground font-medium flex items-center gap-1",children:[e.jsx(j,{className:"h-3 w-3"}),t.institute.name]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] text-muted-foreground italic border-t pt-2 mt-2 opacity-60",children:[e.jsxs("span",{children:["From: ",t.user.name]}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()})]})]},t.id)),(a==null?void 0:a.links)&&a.links.length>3&&e.jsx("div",{className:"p-4 flex justify-center gap-1 bg-card border-t sticky bottom-0",children:a.links.map((t,d)=>e.jsx(i,{disabled:!t.url||t.active,variant:t.active?"default":"ghost",size:"icon",className:"h-7 w-7 text-[10px]",onClick:()=>m.visit(t.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},d))})]})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-muted/5 transition-all ${s?"flex":"hidden md:flex"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b bg-card flex items-center justify-between sticky top-0 z-20 shadow-sm h-16",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>u(null),children:e.jsx(W,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"font-black text-sm uppercase truncate leading-tight tracking-tight",children:s.title}),e.jsxs("p",{className:"text-[10px] text-muted-foreground font-bold uppercase tracking-widest flex items-center gap-1.5",children:["#",s.token," ",e.jsx("span",{className:"opacity-30",children:"|"})," ",e.jsx("span",{className:"text-primary/70",children:s.institute.name})]})]})]}),e.jsx("div",{className:`text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full ${C(s.status)} shadow-sm`,children:s.status})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 lg:p-6 scrollbar-thin scrollbar-thumb-muted",children:e.jsxs("div",{className:"max-w-full mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6 items-start",children:[e.jsxs("div",{className:"lg:col-span-4 order-2 lg:order-1 space-y-6",children:[e.jsxs(D,{className:"shadow-md border-primary/10 overflow-hidden",children:[e.jsx(V,{className:"py-3 px-4 bg-primary/5 border-b",children:e.jsxs(K,{className:"text-xs uppercase font-black tracking-widest flex items-center gap-2 text-primary/80",children:[e.jsx(v,{className:"h-3.5 w-3.5"}),"Update Resolution"]})}),e.jsx(M,{className:"p-4",children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground mb-1.5 block",children:"Official Status"}),e.jsxs(N,{value:p.status,onValueChange:t=>n("status",t),children:[e.jsx(w,{className:"h-9 bg-muted/20 text-xs font-bold",children:e.jsx(y,{})}),e.jsxs(k,{children:[e.jsx(r,{value:"Pending",children:"Pending"}),e.jsx(r,{value:"Waiting",children:"Waiting"}),e.jsx(r,{value:"Resolved",children:"Resolved"}),e.jsx(r,{value:"Rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground mb-1.5 block",children:"Official Feedback"}),e.jsx("textarea",{className:"w-full text-xs p-3 rounded-md border min-h-[100px] bg-muted/20 focus:ring-1 focus:ring-primary outline-none font-medium leading-relaxed",placeholder:"Type final resolution feedback here...",value:p.feedback,onChange:t=>n("feedback",t.target.value)}),f.feedback&&e.jsx("p",{className:"text-[10px] text-destructive mt-1 font-bold italic",children:f.feedback})]}),e.jsx(i,{disabled:h,type:"submit",className:"w-full h-10 font-black uppercase text-[10px] tracking-widest shadow-sm",children:h?"Processing...":"Apply Resolution"})]})})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-5 shadow-sm space-y-4 text-[11px]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] uppercase font-black text-muted-foreground tracking-[0.2em] block mb-2 opacity-50",children:"Requester Profile"}),e.jsx("p",{className:"font-black text-sm text-foreground/80",children:s.user.name}),e.jsx("p",{className:"text-muted-foreground font-medium",children:s.institute.name}),e.jsxs("p",{className:"text-muted-foreground mt-0.5 opacity-70",children:["Institute ID: ",s.institute.id]})]}),e.jsx(z,{className:"opacity-50"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] uppercase font-black text-muted-foreground tracking-[0.2em] block mb-1 opacity-50",children:"Received"}),e.jsx("p",{className:"font-bold",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] uppercase font-black text-muted-foreground tracking-[0.2em] block mb-1 opacity-50",children:"Last Update"}),e.jsx("p",{className:"font-bold",children:new Date(s.updated_at).toLocaleDateString()})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-8 order-1 lg:order-2 space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-2xl border p-6 shadow-sm shadow-primary/5",children:[e.jsxs("h4",{className:"text-[10px] uppercase font-black tracking-widest text-primary mb-4 border-b pb-2 flex items-center justify-between",children:["Case Description",s.attachment&&e.jsxs("span",{className:"text-[10px] text-muted-foreground font-medium normal-case flex items-center gap-1",children:[e.jsx(v,{className:"h-3 w-3"})," Includes attachment"]})]}),e.jsxs("p",{className:"text-sm leading-relaxed text-foreground font-medium mb-6 whitespace-pre-wrap italic opacity-80",children:['"',s.description,'"']}),s.attachment&&e.jsx("div",{className:"pt-2",children:$(s.attachment)?e.jsx("div",{className:"relative group max-w-sm rounded-xl overflow-hidden border-2 border-muted shadow-lg",children:e.jsx(G,{dataImg:s.attachment,className:"w-full h-48 object-cover hover:scale-105 transition-transform cursor-pointer"})}):e.jsx(i,{variant:"outline",className:"font-bold text-xs flex gap-2 h-10 px-4",onClick:()=>window.open(`/${s.attachment}`,"_blank"),children:"ðŸ“„ Download Attached File"})})]}),e.jsx("div",{className:"bg-muted/30 rounded-2xl p-4 lg:p-1 border border-primary/5 min-h-[400px]",children:e.jsx(U,{helpDeskId:s.id,status:s.status})})]})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-12 text-center select-none animate-in fade-in duration-700",children:[e.jsx("div",{className:"w-24 h-24 bg-primary/5 rounded-full flex items-center justify-center mb-8 shadow-inner ring-8 ring-primary/[0.02]",children:e.jsx(b,{className:"h-10 w-10 text-primary opacity-20"})}),e.jsx("h2",{className:"text-2xl font-black uppercase tracking-tighter mb-3",children:"Ticket Command Center"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-[360px] font-medium leading-relaxed",children:"Select an incoming helpdesk ticket from the left column to begin investigating, chatting, and applying resolutions."})]})})]})]})}export{je as default};
