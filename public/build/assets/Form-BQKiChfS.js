import{r as l,j as e,L as Y,$ as Z,S as ee}from"./app-C_vGv3Mn.js";import{A as se,S as ae,P as te,T as ie,a as ne,d as de}from"./app-layout-C3DK89xl.js";import{B as x}from"./button-D3ICZUlX.js";import{C as $,a as re,b as le,c as ce}from"./card-D4hKHGA3.js";import{I as c}from"./input-Dh2IztUZ.js";import{L as d}from"./label-DZZSVEoq.js";import{S as h,a as p,b as g,c as j,d as o}from"./select-BJlDp5Vp.js";import{t as v}from"./index-B7RycKoC.js";import"./index-C4ULTFvu.js";import"./createLucideIcon-N4voy0hI.js";import"./index-B6M9QBmr.js";import"./index-iuOc_lCk.js";import"./index-Y6ZT9tnY.js";import"./index-DIjeUE5K.js";import"./app-logo-icon-D2bEHVg5.js";import"./circle-x-DVldkpcR.js";import"./folder-root-pqswtxXi.js";import"./grip-vertical-BFFqqoG4.js";import"./index-BlEnD_H_.js";import"./index-BAR51-c9.js";function Ie({project:a,projectTypes:E,fundHeads:L}){var I,k,F,M;const u=!!(a!=null&&a.id),[f,T]=l.useState((a==null?void 0:a.name)||""),[y,H]=l.useState(((I=a==null?void 0:a.estimated_amount)==null?void 0:I.toString())||""),[P,V]=l.useState(((k=a==null?void 0:a.actual_amount)==null?void 0:k.toString())||""),[w,q]=l.useState((a==null?void 0:a.final_comments)||""),[_,z]=l.useState(((F=a==null?void 0:a.fund_head_id)==null?void 0:F.toString())||""),[N,B]=l.useState(((a==null?void 0:a.project_type_id)||"").toString()),[S,R]=l.useState((a==null?void 0:a.status)||"waiting"),[A,U]=l.useState((a==null?void 0:a.description)||""),[D,O]=l.useState((a==null?void 0:a.priority)||"Medium"),[C,b]=l.useState(((M=a==null?void 0:a.milestones)==null?void 0:M.map(s=>({key:Date.now()+s.id,id:s.id,name:s.name,description:s.description||"",due_date:s.due_date,img:null,pdf:null,existingImg:s.img||void 0,existingPdf:s.pdf||void 0,preview:s.img?`${s.img}`:void 0})))||[]),W=Object.entries(E).map(([s,t])=>({id:parseInt(s),name:t})),G=()=>{b(s=>[...s,{key:Date.now(),name:"",description:"",due_date:"",img:null,pdf:null}])},J=s=>{b(t=>t.filter(n=>n.key!==s)),v.success("Milestone removed")},m=(s,t,n)=>{b(i=>i.map(r=>r.key===s?{...r,[t]:n}:r))},K=(s,t)=>{if(!t){m(s,"img",null),m(s,"preview",void 0);return}const n=new FileReader;n.onloadend=()=>{m(s,"preview",n.result)},n.readAsDataURL(t),m(s,"img",t)},Q=s=>{if(s.preventDefault(),!f.trim()||!y||!N){v.error("Please fill all required project fields");return}const t=new FormData;t.append("name",f),t.append("estimated_amount",y),t.append("actual_amount",P),t.append("final_comments",w),t.append("fund_head_id",_),t.append("project_type_id",N),t.append("status",S),t.append("description",A),t.append("priority",D),u&&t.append("_method","PUT"),C.forEach((i,r)=>{i.name.trim()&&i.due_date&&(i.id&&t.append(`milestones[${r}][id]`,i.id.toString()),t.append(`milestones[${r}][name]`,i.name),t.append(`milestones[${r}][description]`,i.description),t.append(`milestones[${r}][due_date]`,i.due_date),i.img&&t.append(`milestones[${r}][img]`,i.img),i.pdf&&t.append(`milestones[${r}][pdf]`,i.pdf))});const n=u?`/projects/${a.id}`:"/projects";ee.post(n,t,{forceFormData:!0,onSuccess:()=>{v.success(u?"Project updated!":"Project created!")},onError:i=>{console.error(i),v.error("Please fix the errors")}})},X=[{title:"Projects",href:"/projects"},{title:u?"Edit Project":"Create Project",href:"#"}];return e.jsxs(se,{breadcrumbs:X,children:[e.jsx(Y,{title:u?"Edit Project":"Create Project"}),e.jsx("div",{className:"p-4 md:p-6 w-full mx-auto",children:e.jsxs($,{children:[e.jsx(re,{children:e.jsx(le,{className:"text-2xl",children:u?"Edit Project":"Create New Project"})}),e.jsx(ae,{}),e.jsx(ce,{className:"pt-6",children:e.jsxs("form",{onSubmit:Q,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Project Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{value:f,onChange:s=>T(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Estimated Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{type:"number",value:y,onChange:s=>H(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Fund Head (Categorical) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(h,{value:_,onValueChange:z,children:[e.jsx(p,{children:e.jsx(g,{placeholder:"Select Fund Source"})}),e.jsx(j,{children:L.map(s=>e.jsx(o,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Status"}),e.jsxs(h,{value:S,onValueChange:R,children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsxs(j,{children:[e.jsx(o,{value:"draft",children:"Draft"}),e.jsx(o,{value:"waiting",children:"Waiting for Approval"}),e.jsx(o,{value:"inprogress",children:"In Progress"}),e.jsx(o,{value:"completed",children:"Completed"})]})]})]}),S==="completed"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Actual Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{type:"number",value:P,onChange:s=>V(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Final Comments ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{value:w,onChange:s=>q(s.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Project Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(h,{value:N,onValueChange:B,children:[e.jsx(p,{children:e.jsx(g,{placeholder:"Select type"})}),e.jsx(j,{children:W.map(s=>e.jsx(o,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Priority"}),e.jsxs(h,{value:D,onValueChange:O,children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsxs(j,{children:[e.jsx(o,{value:"Low",children:"Low"}),e.jsx(o,{value:"Medium",children:"Medium"}),e.jsx(o,{value:"High",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(d,{children:"Description"}),e.jsx(c,{value:A,onChange:s=>U(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Milestones"}),e.jsxs(x,{type:"button",onClick:G,size:"sm",children:[e.jsx(te,{className:"w-4 h-4 mr-2"})," Add Milestone"]})]}),C.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 border-2 border-dashed rounded-lg",children:'No milestones yet. Click "Add Milestone" to start.'}):e.jsx("div",{className:"space-y-6",children:C.map((s,t)=>e.jsx($,{className:"p-6 border",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Milestone Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{value:s.name,onChange:n=>m(s.key,"name",n.target.value),placeholder:"e.g. Site Survey"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Description"}),e.jsx(c,{value:s.description,onChange:n=>m(s.key,"description",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{type:"date",value:s.due_date,onChange:n=>m(s.key,"due_date",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Proof Image"}),e.jsx(c,{type:"file",accept:"image/*",onChange:n=>{var i;return K(s.key,((i=n.target.files)==null?void 0:i[0])||null)}}),s.existingImg&&!s.preview&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Has existing image"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Signed Document (PDF)"}),e.jsx(c,{type:"file",accept:".pdf",onChange:n=>{var i;return m(s.key,"pdf",((i=n.target.files)==null?void 0:i[0])||null)}}),s.existingPdf&&e.jsx("a",{href:`/${s.existingPdf}`,target:"_blank",className:"text-xs text-blue-500 underline mt-1 block",children:"View PDF"})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded bg-muted border flex items-center justify-center",children:s.preview||s.existingImg?e.jsx("img",{src:s.preview||`/${s.existingImg}`,alt:"Preview",className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-[10px] text-muted-foreground italic",children:"No image"})}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",onClick:()=>J(s.key),children:e.jsx(ie,{className:"w-4 h-4"})})]})]})},s.key))})]}),e.jsxs("div",{className:"flex justify-between pt-8 border-t",children:[e.jsx(x,{type:"button",variant:"secondary",asChild:!0,children:e.jsxs(Z,{href:"/projects",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"})," Back"]})}),e.jsxs(x,{type:"submit",size:"lg",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),u?"Update Project":"Create Project"]})]})]})})]})})]})}export{Ie as default};
