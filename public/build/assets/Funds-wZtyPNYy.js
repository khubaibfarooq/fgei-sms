import{r as m,j as e,L as U}from"./app-q2JjwySo.js";import{A as V,S as f,t as I}from"./app-layout-yiT8ypOT.js";import{B as b}from"./button-B6VV_y9a.js";import{C as W,a as K,b as O,c as j}from"./card-C9XrKRLG.js";import{S as G,a as J,b as M,c as Y,d as E}from"./select-LtLxtVnn.js";import{C as T}from"./combobox-DygHpiVR.js";import{E as q,F as Q,a as X,b as Z}from"./jspdf.plugin.autotable-Hy0mDznW.js";import"./index-DTcgz5Yt.js";import"./createLucideIcon-MYSWaSLq.js";import"./input-DwN2UOLx.js";import"./index-C9PrZd4U.js";import"./app-logo-icon-GvNt3h7m.js";import"./folder-root-DgoEr0CF.js";import"./grip-vertical-DjjKkN81.js";import"./index-CATOAyuA.js";import"./index-CgGQcqmX.js";import"./popover-CznlzFcS.js";const ee=[{title:"Reports",href:"/reports"},{title:"Funds",href:"/reports/funds"}];function be({funds:B=[],fundheads:i=[],regions:S=[],balances:z=[],filters:y}){var C;const[p,g]=m.useState(y.institute_id||""),[r,N]=m.useState(y.fund_head_id||""),[_,k]=m.useState(y.region_id||""),[c,A]=m.useState(B),[x,P]=m.useState(z),[H,v]=m.useState([]),d=t=>t==null||t===""?0:typeof t=="number"?t:parseFloat(String(t).replace(/,/g,""))||0,l=t=>{const n=d(t);return new Intl.NumberFormat("ur-PK",{style:"currency",currency:"PKR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n)},F=m.useMemo(()=>x.reduce((t,n)=>t+d(n.balance),0),[x]),w=async t=>{if(!t||t==="0"){v([]);return}try{const n=await fetch(`/reports/getInstitutes?region_id=${t}`);if(!n.ok)throw new Error;const a=await n.json();v(a)}catch{I.error("Failed to load institutes")}},L=t=>{k(t),w(t),g("")},h=async t=>{try{const n=new URLSearchParams({institute_id:p||"",region_id:_||"",fund_head_id:r||""}),a=t||`/reports/funds/getfunds?${n.toString()}`,s=await fetch(a);if(!s.ok)throw new Error;const o=await s.json();A(o.funds||o||[]),P(o.balances||[])}catch(n){console.error(n),I.error("Failed to load data")}},D=async()=>{const t=new q.Workbook,n=t.addWorksheet("Funds");n.columns=[{header:"Institute",key:"institute",width:50},...i.map(s=>({header:s.name,key:s.name,width:18})),{header:"Total",key:"total",width:20}],c.forEach(s=>{const o={institute:s.institute_name??(s.region_name.split(" ").pop()||s.region_name)};i.forEach(u=>o[u.name]=d(s.fund_heads[u.name])),o.total=d(s.total_balance),n.addRow(o)});const a=await t.xlsx.writeBuffer();Q.saveAs(new Blob([a]),"Funds_Report.xlsx")},$=()=>{const t=new X("l","mm","a4");t.text("Institute Wise Fund Balances",14,15);const n=["Institute",...i.map(s=>s.name),"Total"],a=c.map(s=>[s.institute_name??(s.region_name.split(" ").pop()||s.region_name),...i.map(o=>d(s.fund_heads[o.name]).toFixed(2)),d(s.total_balance).toFixed(2)]);Z(t,{head:[n],body:a,startY:25}),t.save("Funds_Report.pdf")};return e.jsxs(V,{breadcrumbs:ee,children:[e.jsx(U,{title:"Funds Report"}),e.jsx("div",{className:"p-4 lg:p-6 max-w-full",children:e.jsxs(W,{className:"w-full shadow-lg",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-2xl font-bold",children:"Funds Report"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"View fund balances by institute / fund head"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{onClick:$,variant:"outline",size:"sm",children:"PDF"}),e.jsx(b,{onClick:D,variant:"outline",size:"sm",children:"Excel"})]})]})}),e.jsx(f,{}),e.jsx(j,{className:"pt-6 pb-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[S.length>0&&e.jsx(T,{entity:"region",value:_,onChange:L,options:S.map(t=>({id:t.id.toString(),name:t.name.split(" ").pop()||t.name})),includeAllOption:!0,placeholder:"Select Region"}),e.jsx(T,{entity:"institute",value:p,onChange:g,options:H.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!1,placeholder:"Select Institute"}),e.jsxs(G,{value:r,onValueChange:N,children:[e.jsx(J,{children:e.jsx(M,{placeholder:"Fund Head"})}),e.jsxs(Y,{children:[e.jsx(E,{value:"0",children:"All Fund Heads"}),i.map(t=>e.jsx(E,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{onClick:()=>h(),className:"flex-1",children:"Apply"}),e.jsx(b,{variant:"outline",onClick:()=>{k(""),g(""),N(""),h("/reports/funds")},className:"flex-1",children:"Reset"})]})]})}),e.jsx(f,{}),e.jsx(j,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-900 py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Balance"}),e.jsx("p",{className:"text-4xl font-bold text-primary mt-2",children:l(F)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Fund Heads"}),e.jsx("p",{className:"text-3xl font-bold text-muted-foreground mt-1",children:x.length})]})]})}),e.jsx(f,{}),x.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Fund Head Balances"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:x.map((t,n)=>{var a;return e.jsxs("div",{onClick:()=>{var u,R;const s=((R=(u=t.fund_head)==null?void 0:u.id)==null?void 0:R.toString())||"";N(s);const o=new URLSearchParams({institute_id:p||"",region_id:_||"",fund_head_id:s});h(`/reports/funds/getfunds?${o.toString()}`)},className:"bg-muted/50 dark:bg-gray-800 p-4 rounded-lg border hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground truncate",children:((a=t.fund_head)==null?void 0:a.name)||"Unknown"}),e.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400 mt-2",children:l(t.balance)})]},n)})})]}),e.jsx(f,{})]}),e.jsx(j,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-w-[800px] lg:min-w-0",children:c.length===0?e.jsx("div",{className:"text-center py-16 text-muted-foreground",children:"No institute data found. Try adjusting filters."}):e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary text-white",children:[e.jsx("th",{className:"sticky left-0 z-20 bg-primary px-6 py-4 text-left font-semibold",children:c[0].institute_name?"Institute":"Region"}),r&&r!=="0"?e.jsx("th",{className:"px-4 py-4 text-center font-medium whitespace-nowrap",children:(C=i.find(t=>t.id.toString()===r))==null?void 0:C.name}):i.map(t=>e.jsx("th",{className:"px-4 py-4 text-center font-medium whitespace-nowrap",children:t.name},t.id)),r=="0"||r==""?e.jsx("th",{className:"sticky right-0 z-20 bg-primary px-6 py-4 text-right font-bold",children:"Total"}):""]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:c.map(t=>{const n=!t.institute_name&&t.region_name;return e.jsxs("tr",{className:`hover:bg-muted/50 ${n?"cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20":""}`,onClick:()=>{if(n&&t.region_id){const a=t.region_id.toString();k(a),w(a),g("");const s=new URLSearchParams({institute_id:p||"",region_id:a,fund_head_id:r||""});h(`/reports/funds/getfunds?${s.toString()}`)}},children:[e.jsx("td",{className:"sticky left-0 z-10 bg-background text-wrap px-6 py-4 font-medium border-r  ",children:e.jsx("div",{className:"flex items-center gap-2",children:t.institute_name||e.jsx(e.Fragment,{children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold   ",children:t.region_name.split(" ").pop()||t.region_name})})})}),r&&r!=="0"?e.jsx("td",{className:"px-4 py-4 text-right font-medium tabular-nums",children:(()=>{const a=i.find(s=>s.id.toString()===r);return l(t.fund_heads[(a==null?void 0:a.name)||""]||0)})()}):e.jsx(e.Fragment,{children:i.map(a=>e.jsx("td",{className:"px-4 py-4 text-right font-medium tabular-nums",children:l(t.fund_heads[a.name])},a.id))}),r=="0"||r==""?e.jsx("td",{className:"sticky right-0 z-10 bg-green-50 dark:bg-green-900/30 px-6 py-4 text-right font-bold text-green-700 dark:text-green-400  tabular-nums border-l",children:l(t.total_balance)}):""]},t.institute_id??t.region_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800 font-bold",children:[e.jsx("td",{className:"sticky left-0 z-10 bg-gray-100 dark:bg-gray-800 px-6 py-4",children:"Grand Total"}),r&&r!=="0"?e.jsx("td",{className:"px-4 py-4 text-right font-mono tabular-nums",children:(()=>{const t=i.find(a=>a.id.toString()===r),n=c.reduce((a,s)=>a+d(s.fund_heads[(t==null?void 0:t.name)||""]||0),0);return l(n)})()}):i.map(t=>{const n=c.reduce((a,s)=>a+d(s.fund_heads[t.name]),0);return e.jsx("td",{className:"px-4 py-4 text-right font-mono tabular-nums",children:l(n)},t.id)}),r=="0"||r==""?e.jsx("td",{className:"sticky right-0 z-10 bg-emerald-100 dark:bg-emerald-900/50 px-6 py-4 text-right font-bold text-emerald-700 dark:text-emerald-400 font-mono tabular-nums border-l",children:l(F)}):""]})})]})})})})]})})]})}export{be as default};
