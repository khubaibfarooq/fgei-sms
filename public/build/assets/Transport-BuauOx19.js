var D=Object.defineProperty;var M=(a,r,l)=>r in a?D(a,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[r]=l;var b=(a,r,l)=>M(a,typeof r!="symbol"?r+"":r,l);import{r as n,j as e,L as P,S as H}from"./app-3C7Qt8-p.js";import{t as R,A as W,S as $,B as J}from"./app-layout-CytTxXak.js";import{B as m}from"./button-C9j-7gdS.js";import{C as w,a as T,b as S,c as E}from"./card-D1XjIXNI.js";import{S as _,a as C,b as A,c as I,d as x}from"./select-C2DwXPeg.js";import{l as O,E as U}from"./jspdf.plugin.autotable-ClK-X5kZ.js";import{E as Y,F as q}from"./FileSaver.min-BF03T_of.js";import"./index-CtC3z9lO.js";import"./index-DPHHZ2JF.js";import"./createLucideIcon-BrAatXE1.js";import"./index-1_-krIUb.js";import"./app-logo-icon-CXgC8SwZ.js";import"./index-Bn8NVYdZ.js";import"./index-BxFvnJ5H.js";const G=[{title:"Reports",href:"/reports"},{title:"Transports",href:"/reports/transports"}];class K extends n.Component{constructor(){super(...arguments);b(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(l){return{hasError:!0,error:l.message}}componentDidCatch(l,d){console.error("ErrorBoundary caught:",l,d),R.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(m,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const u=a=>{const r=a!=null&&typeof a.id=="number"&&a.id>0&&typeof a.name=="string"&&a.name.trim()!=="";return r||console.warn("Invalid item detected:",a),r};function me({transports:a,institutes:r,vehicleTypes:l,filters:d}){const[v,Q]=n.useState(d.search||""),[f,k]=n.useState(d.institute_id||""),[j,V]=n.useState(d.vehicle_type_id||""),[i,F]=n.useState(a||[]);n.useEffect(()=>{const t={institutes:r.filter(s=>!u(s)),vehicleTypes:l.filter(s=>!u(s))};Object.entries(t).forEach(([s,o])=>{o.length>0&&console.warn(`Invalid ${s}:`,o)})},[r,l]);const B=async()=>{const t=new Y.Workbook,s=t.addWorksheet("Transports");s.columns=[{header:"VehicleNo",key:"vehicle_no",width:30},{header:"Type",key:"vehicleType",width:10},{header:"Institute",key:"institute",width:20}],i.data.forEach(c=>{var p,y;s.addRow({vehicle_no:c.vehicle_no,vehicleType:((p=c.vehicle_type)==null?void 0:p.name)||"N/A",institute:((y=c.institute)==null?void 0:y.name)||"N/A"})});const o=await t.xlsx.writeBuffer(),h=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});q.saveAs(h,"Transports_Report.xlsx")},z=()=>{const t=new U;t.setFontSize(16),t.text("Transports Report",14,15);const s=["VehicleNo","VehicleType","Institute"],o=i.data.map(h=>{var c,p;return[h.vehicle_no,((c=h.vehicle_type)==null?void 0:c.name)||"N/A",((p=h.institute)==null?void 0:p.name)||"N/A"]});t.autoTable({head:[s],body:o,startY:25,styles:{fontSize:10}}),t.save("Transport_Report.pdf")},L=n.useMemo(()=>O.debounce(()=>{const t=new URLSearchParams({search:v||"",institute_id:f||"",vehicle_type_id:j||""});fetch(`/reports/transports/getTransports?${t.toString()}`).then(s=>s.json()).then(s=>{console.log("Fetched filtered Transports:",s),F(s)}).catch(s=>{console.error("Error fetching filtered Transports:",s),R.error("Failed to fetch filtered Transports")})},300),[v,f,j]),g=n.useMemo(()=>r.filter(u),[r]),N=n.useMemo(()=>l.filter(u),[l]);return e.jsx(K,{children:e.jsxs(W,{breadcrumbs:G,children:[e.jsx(P,{title:"Transports Report"}),e.jsx("div",{className:"flex-1 p-2 md:p-2",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsx(S,{className:"text-xl font-bold",children:"Filters"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your Transport search"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs(_,{value:f,onValueChange:t=>{k(t)},children:[e.jsx(C,{children:e.jsx(A,{placeholder:"Select Institute"})}),e.jsxs(I,{children:[e.jsx(x,{value:"0",children:"All Institutes"}),g.length>0?g.map(t=>e.jsx(x,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]}),e.jsxs(_,{value:j,onValueChange:t=>{V(t)},children:[e.jsx(C,{children:e.jsx(A,{placeholder:"Select Vehicle Type"})}),e.jsxs(I,{children:[e.jsx(x,{value:"0",children:"All Vehicle Types"}),N.length>0?N.map(t=>(console.log("Rendering vehicleType SelectItem:",{id:t.id,value:t.id.toString(),name:t.name}),e.jsx(x,{value:t.id.toString(),children:t.name},t.id))):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No  Vehicle Type available"})]})]}),e.jsx(m,{onClick:L,className:"w-full",children:"Apply Filters"})]})]})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsxs(w,{children:[e.jsxs(T,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{children:e.jsx(S,{className:"text-2xl font-bold",children:"Transport Report"})}),e.jsx(m,{onClick:z,className:"w-full",children:"Export PDF"}),e.jsx(m,{onClick:B,className:"w-full",children:"Export Excel"})]}),e.jsx($,{}),e.jsxs(E,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"space-y-3",children:i.data.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"No Transports found."}):i.data.map(t=>{var s,o;return e.jsx("div",{className:"flex items-center justify-between border px-4 py-3 rounded-md bg-muted/50 hover:bg-muted/70 transition shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-sm text-foreground",children:t.vehicle_no}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Type: ",((s=t.vehicle_type)==null?void 0:s.name)||"N/A"," | Institute: ",((o=t.institute)==null?void 0:o.name)||"N/A"]})]})]})},t.id)})}),i.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:i.links.map((t,s)=>e.jsx(m,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>H.visit(t.url||"",{preserveScroll:!0}),className:t.active?"bg-blue-600 hover:bg-blue-700":"",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},s))})]})]})})]})})]})})}export{me as default};
