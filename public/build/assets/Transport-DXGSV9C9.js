var Y=Object.defineProperty;var q=(a,n,s)=>n in a?Y(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s;var z=(a,n,s)=>q(a,typeof n!="symbol"?n+"":n,s);import{r as l,j as e,L as G,S as K}from"./app-fTHYdGsa.js";import{t as E,A as Q,S as X}from"./app-layout-5H0-e-lV.js";import{B as j}from"./button-BHQAtpO8.js";import{C as B,a as L,b as M,c as P}from"./card-_EmB21vm.js";import{S as w,a as S,b as A,c as T,d as x}from"./select-CVCmw6c_.js";import{l as Z,E as ee}from"./jspdf.plugin.autotable--0Q1XXbk.js";import{E as te,F as re}from"./FileSaver.min-BbzV-nzN.js";import"./index-CDoAZSK9.js";import"./index-CmdIiAuW.js";import"./createLucideIcon-CEH6isAz.js";import"./index-BCiWSc-I.js";import"./app-logo-icon-flERtXXt.js";import"./index-BjDymVkp.js";import"./index-CWn665QU.js";const se=[{title:"Reports",href:"/reports"},{title:"Transports",href:"/reports/transports"}];class ae extends l.Component{constructor(){super(...arguments);z(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(s){return{hasError:!0,error:s.message}}componentDidCatch(s,c){console.error("ErrorBoundary caught:",s,c),E.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(j,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const p=a=>{const n=a!=null&&typeof a.id=="number"&&a.id>0&&typeof a.name=="string"&&a.name.trim()!=="";return n||console.warn("Invalid item detected:",a),n};function Ne({transports:a,institutes:n,vehicleTypes:s,regions:c,filters:y}){const[k,ne]=l.useState(y.search||""),[u,R]=l.useState(y.institute_id||""),[v,D]=l.useState(y.vehicle_type_id||""),[N,$]=l.useState(y.region_id||""),[m,H]=l.useState(a),[h,_]=l.useState(n||[]),C=l.useMemo(()=>Array.isArray(h)?h.filter(p):(console.warn("filteredInstitutes is not an array or is null:",h),[]),[h]),I=l.useMemo(()=>Array.isArray(s)?s.filter(p):(console.warn("vehicleTypes is not an array or is null:",s),[]),[s]),b=l.useMemo(()=>Array.isArray(c)?c.filter(p):(console.warn("regions is not an array or is null:",c),[]),[c]);l.useEffect(()=>{const t={institutes:Array.isArray(h)?h.filter(r=>!p(r)):[],vehicleTypes:Array.isArray(s)?s.filter(r=>!p(r)):[],regions:Array.isArray(c)?c.filter(r=>!p(r)):[]};Object.entries(t).forEach(([r,o])=>{o.length>0&&console.warn(`Invalid ${r}:`,o)})},[h,s,c]);const U=async t=>{try{const r=new URLSearchParams({region_id:t||""}).toString(),o=await fetch(`/reports/getInstitutes?${r}`);if(!o.ok)throw new Error("Failed to fetch institutes");const i=await o.json();console.log("Fetched institutes:",i),_(i),u&&t!=="0"&&!i.some(d=>d.id.toString()===u)&&R("")}catch(r){console.error("Error fetching institutes:",r),E.error("Failed to load institutes"),_([])}},W=t=>{$(t),U(t),F()},F=l.useMemo(()=>Z.debounce(()=>{const t=new URLSearchParams({search:k||"",institute_id:u||"",vehicle_type_id:v||"",region_id:N||""});fetch(`/reports/transports/getTransports?${t.toString()}`).then(r=>r.json()).then(r=>{console.log("Fetched filtered Transports:",r),H(r)}).catch(r=>{console.error("Error fetching filtered Transports:",r),E.error("Failed to fetch filtered Transports")})},300),[k,u,v,N]),J=async()=>{const t=new te.Workbook,r=t.addWorksheet("Transports");r.columns=[{header:"VehicleNo",key:"vehicle_no",width:30},{header:"Type",key:"vehicleType",width:10},{header:"Institute",key:"institute",width:20},{header:"Region",key:"region",width:20}],m.data.forEach(d=>{var f,g,V;r.addRow({vehicle_no:d.vehicle_no,vehicleType:((f=d.vehicle_type)==null?void 0:f.name)||"N/A",institute:((g=d.institute)==null?void 0:g.name)||"N/A",region:((V=d.region)==null?void 0:V.name)||"N/A"})});const o=await t.xlsx.writeBuffer(),i=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});re.saveAs(i,"Transports_Report.xlsx")},O=()=>{const t=new ee;t.setFontSize(16),t.text("Transports Report",14,15);const r=["VehicleNo","VehicleType","Institute","Region"],o=m.data.map(i=>{var d,f,g;return[i.vehicle_no,((d=i.vehicle_type)==null?void 0:d.name)||"N/A",((f=i.institute)==null?void 0:f.name)||"N/A",((g=i.region)==null?void 0:g.name)||"N/A"]});t.autoTable({head:[r],body:o,startY:25,styles:{fontSize:10}}),t.save("Transport_Report.pdf")};return e.jsx(ae,{children:e.jsxs(Q,{breadcrumbs:se,children:[e.jsx(G,{title:"Transports Report"}),e.jsx("div",{className:"flex-1 p-2 md:p-2",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs(B,{children:[e.jsxs(L,{children:[e.jsx(M,{className:"text-xl font-bold",children:"Filters"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your Transport search"})]}),e.jsxs(P,{className:"space-y-4",children:[b.length>0&&e.jsxs(w,{value:N,onValueChange:W,children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Select Region"})}),e.jsxs(T,{children:[e.jsx(x,{value:"0",children:"All Regions"}),b.length>0?b.map(t=>e.jsx(x,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No regions available"})]})]}),e.jsxs(w,{value:u,onValueChange:t=>R(t),children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Select Institute"})}),e.jsxs(T,{children:[e.jsx(x,{value:"0",children:"All Institutes"}),C.length>0?C.map(t=>e.jsx(x,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]}),e.jsxs(w,{value:v,onValueChange:t=>D(t),children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Select Vehicle Type"})}),e.jsxs(T,{children:[e.jsx(x,{value:"0",children:"All Vehicle Types"}),I.length>0?I.map(t=>e.jsx(x,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No vehicle types available"})]})]}),e.jsx(j,{onClick:F,className:"w-full",children:"Apply Filters"})]})]})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsxs(B,{children:[e.jsxs(L,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{children:e.jsx(M,{className:"text-2xl font-bold",children:"Transport Report"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{onClick:O,className:"w-full md:w-auto",children:"Export PDF"}),e.jsx(j,{onClick:J,className:"w-full md:w-auto",children:"Export Excel"})]})]}),e.jsx(X,{}),e.jsxs(P,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Vehicle No"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Type"}),e.jsx("th",{className:"border p-2 text-sm font-medium text-white dark:text-gray-200",children:"Region"})]})}),e.jsx("tbody",{children:m.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-muted-foreground text-center p-4",children:"No Transports found."})}):m.data.map(t=>{var r,o;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 text-center",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.vehicle_no}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:((r=t.vehicle_type)==null?void 0:r.name)||"N/A"}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:((o=t.region)==null?void 0:o.name)||"N/A"})]},t.id)})})]})}),m.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:m.links.map((t,r)=>e.jsx(j,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>K.visit(t.url||"",{preserveScroll:!0}),className:t.active?"bg-blue-600 hover:bg-blue-700":"",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},r))})]})]})})]})})]})})}export{Ne as default};
