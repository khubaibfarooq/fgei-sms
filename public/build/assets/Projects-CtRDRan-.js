var ns=Object.defineProperty;var is=(i,c,p)=>c in i?ns(i,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):i[c]=p;var je=(i,c,p)=>is(i,typeof c!="symbol"?c+"":c,p);import{r,K as ds,j as e,L as os,$ as Ne,a as O}from"./app-DVmN6rxl.js";import{A as cs,E as be,P as ve,c as H,F as ye}from"./app-layout-CGHmoPsR.js";import{B as x}from"./button-Y1YC9s4b.js";import{C as j,a as N,b as xs,c as b,d as we}from"./card-CCl5I7tz.js";import{I as ms}from"./input-DPpOm_0X.js";import{S as Ce,a as Se,b as _e,c as ke,d as v}from"./select-B_6lP306.js";import{C as ps}from"./checkbox-C5A0CLUl.js";import{t as g,X as Pe,D as Ae,a as Fe,b as De,c as ze,d as Re,e as Le}from"./index-BQ0bSucX.js";import{l as us}from"./lodash-B3lRCiBD.js";import{E as hs,F as fs,a as gs,b as js}from"./jspdf.plugin.autotable-CfRvzSX0.js";import{C as Ee}from"./combobox-4QtEv9vb.js";import{T as Ie,a as $e,b as k,c as P}from"./tabs-rEh6Hzgc.js";import{B as u}from"./badge-CZDLjmpv.js";import Ns from"./ApprovalModal-CxH1E4Dp.js";import bs from"./FundHeadSelectModal-C8jw1DLD.js";import{I as U}from"./image-preview2-tNVy-ZH_.js";import{L as vs}from"./label-BjtCB5ko.js";import{C as Me,a as Te}from"./circle-x-N0dkq0YT.js";import"./index-BB5L8rS7.js";import"./createLucideIcon-CRhMnQ-_.js";import"./index-CGEHoyjy.js";import"./index-Xs4jzNsd.js";import"./index-CLBkeE6e.js";import"./index-CpqM-Iiz.js";import"./app-logo-icon-ByOdZxav.js";import"./clsx-B-dksMZM.js";import"./folder-root-DlWqQeoD.js";import"./grip-vertical-LS8DZRX_.js";import"./index-ChNgx8Gj.js";import"./index-efjvqTmq.js";import"./popover-BOTOP-PZ.js";import"./textarea-BVBnzGTL.js";const ys=[{title:"Reports",href:"/reports"},{title:"Projects",href:"/reports/projects"}],V=i=>{if(i==null)return"-";const c=typeof i=="string"?parseFloat(i):i;return isNaN(c)?"-":c>=1e6?`${(c/1e6).toFixed(2)} Mn`:c.toLocaleString()};class ws extends r.Component{constructor(){super(...arguments);je(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(p){return{hasError:!0,error:p.message}}componentDidCatch(p,A){console.error("ErrorBoundary caught:",p,A),g.error("An error occurred. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(x,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const se=i=>{const c=i!=null&&typeof i.id=="number"&&i.id>0&&typeof i.name=="string"&&i.name.trim()!=="";return c||console.warn("Invalid item:",i),c};function rt({projects:i,institutes:c,regions:p,projectTypes:A,fundHeads:Oe,filters:F}){var he,fe,ge;const[te,Cs]=r.useState(F.search||""),[y,B]=r.useState(F.institute_id||""),[G,He]=r.useState(F.project_type_id||""),[W,Ue]=r.useState(F.status||""),[h,q]=r.useState(i),[X,J]=r.useState(c||[]);r.useEffect(()=>{q(i)},[i]),r.useEffect(()=>{if(d){const s=h.data.find(t=>t.id===d.id);s&&w(s)}},[h]);const[K,Ve]=r.useState(F.region_id||""),{auth:Be}=ds().props,f=Be.user,Y=s=>{var n,z;const t=(n=s.current_stage)==null?void 0:n.level,a=s.approval_status;if(!t)return!1;const l=(f.roles[0].name||"").toLowerCase(),o=t.toLowerCase(),m=((z=s.current_stage)==null?void 0:z.users_can_approve)??"";return console.log(m),console.log(f.id),!!(o==="regional"&&l==="region"&&a!=="approved"||o==="dte"&&(l==="dirhrm"||l==="directorate"||l==="sms_tech_approval")&&a!=="approved"&&m.includes(f.id))},[Ge,Q]=r.useState(!1),[We,ae]=r.useState(null),[qe,Z]=r.useState(!1),[Xe,re]=r.useState(null),[d,w]=r.useState(null),[R,le]=r.useState([]),[L,ne]=r.useState([]),[E,ie]=r.useState([]),[C,de]=r.useState(!1),[Je,I]=r.useState(!1),[D,Ke]=r.useState(null),[S,oe]=r.useState(""),[ce,xe]=r.useState(!1),[Ye,$]=r.useState(!1),[_,me]=r.useState(null),[ee,Qe]=r.useState(!1),Ze=r.useMemo(()=>Array.isArray(X)?X.filter(se):[],[X]),pe=r.useMemo(()=>Array.isArray(p)?p.filter(se):[],[p]),es=r.useMemo(()=>Array.isArray(A)?A.filter(se):[],[A]),M=r.useMemo(()=>ee?h.data.filter(s=>Y(s)):h.data,[h.data,ee,f]);r.useEffect(()=>{d?(de(!0),(async()=>{try{const[t,a,l]=await Promise.all([O.get(`/projects/${d.id}/history`),O.get(`/projects/${d.id}/milestones`),O.get(`/projects/${d.id}/payments`)]);le(t.data),ne(a.data),ie(l.data.payments)}catch(t){console.error("Failed to fetch project details",t),g.error("Failed to load project details.")}finally{de(!1)}})()):(le([]),ne([]),ie([]))},[d]);const ss=async s=>{if(!s||s==="0"){J(c||[]),y&&B("");return}try{const t=new URLSearchParams({region_id:s}).toString(),a=await fetch(`/reports/getInstitutes?${t}`);if(!a.ok)throw new Error("Failed to fetch institutes");const l=await a.json();J(l),y&&!l.some(o=>o.id.toString()===y)&&B("")}catch(t){console.error("Error fetching institutes:",t),g.error("Failed to load institutes"),J([])}},ts=s=>{Ve(s),ss(s)},ue=s=>{Ke(s),oe(parseFloat((s.completion_per||0).toString()).toString()),I(!0)},as=async()=>{var t,a;if(!D)return;const s=parseFloat(S);if(isNaN(s)||s<0||s>100){g.error("Please enter a valid percentage (0-100)");return}xe(!0);try{const l=await O.post(`/projects/${D.id}/update-completion`,{completion_per:s});l.data.success?(g.success("Completion percentage updated successfully"),I(!1),T()):g.error(l.data.message||"Failed to update")}catch(l){g.error(((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update completion percentage")}finally{xe(!1)}},rs=async()=>{const s=new hs.Workbook,t=s.addWorksheet("Projects");t.columns=[{header:"Name",key:"name",width:30},{header:"Cost",key:"cost",width:15},{header:"Status",key:"status",width:15},{header:"Project Type",key:"project_type",width:25},{header:"Institute",key:"institute",width:30},{header:"Region",key:"region",width:25}],h.data.forEach(o=>{var m,n,z;t.addRow({name:o.name,estimated_cost:o.estimated_cost,actual_cost:o.actual_cost,status:o.status,project_type:((m=o.projecttype)==null?void 0:m.name)||"N/A",institute:((n=o.institute)==null?void 0:n.name)||"N/A",region:((z=o.region)==null?void 0:z.name)||"N/A"})});const a=await s.xlsx.writeBuffer(),l=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});fs.saveAs(l,"Projects_Report.xlsx")},ls=()=>{const s=new gs;s.setFontSize(16),s.text("Projects Report",14,15);const t=["Name","Estimated Cost","Actual Cost","Status","Project Type","Institute","Region"],a=h.data.map(l=>{var o,m,n;return[l.name,l.estimated_cost,l.actual_cost,l.status,((o=l.projecttype)==null?void 0:o.name)||"N/A",((m=l.institute)==null?void 0:m.name)||"N/A",((n=l.region)==null?void 0:n.name)||"N/A"]});js(s,{head:[t],body:a,startY:25,styles:{fontSize:9,cellPadding:2},headStyles:{fillColor:[66,139,202],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]}}),s.save("Projects_Report.pdf")},T=r.useMemo(()=>us.debounce(()=>{const s=new URLSearchParams({search:te.trim(),institute_id:y||"",region_id:K||"",project_type_id:G||"",status:W||""});fetch(`/reports/projects/getprojects?${s.toString()}`).then(t=>t.json()).then(t=>{console.log("Filtered projects:",t),q(t)}).catch(t=>{console.error("Fetch error:",t),g.error("Failed to load projects")})},300),[te,y,K,G,W]);return e.jsx(ws,{children:e.jsxs(cs,{breadcrumbs:ys,children:[e.jsx(os,{title:"Projects Report"}),e.jsxs("div",{className:"flex flex-col lg:flex-row h-[calc(100vh-65px)] overflow-hidden",children:[e.jsx("div",{className:"flex-1 p-2 md:p-4 overflow-y-auto w-full min-w-0",children:e.jsxs(j,{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs(N,{className:"p-1.5 pb-0 shrink-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-1",children:e.jsx(xs,{className:"text-base font-bold",children:"Projects Report"})}),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 ${d?"xl:grid-cols-2 2xl:grid-cols-4":"lg:grid-cols-4"} gap-1.5`,children:[pe.length>0&&e.jsx("div",{className:"w-full",children:e.jsx(Ee,{entity:"region",value:K,onChange:s=>ts(s),options:pe.map(s=>({id:s.id.toString(),name:s.name.split(" ").pop()||s.name})),includeAllOption:!0})}),e.jsx("div",{className:"w-full",children:e.jsx(Ee,{entity:"institute",value:y,onChange:B,options:Ze.map(s=>({id:s.id.toString(),name:s.name})),includeAllOption:!1,placeholder:"Select Institute"})}),e.jsx("div",{className:"w-full",children:e.jsxs(Ce,{value:G,onValueChange:s=>He(s),children:[e.jsx(Se,{className:"h-7 text-xs",children:e.jsx(_e,{placeholder:"Select Project Type"})}),e.jsxs(ke,{children:[e.jsx(v,{value:"0",children:"All Project Types"}),es.map(s=>e.jsx(v,{value:s.id.toString(),children:s.name},s.id))]})]})}),e.jsx("div",{className:"w-full",children:e.jsxs(Ce,{value:W,onValueChange:s=>Ue(s),children:[e.jsx(Se,{className:"h-7 text-xs",children:e.jsx(_e,{placeholder:"Select Status"})}),e.jsxs(ke,{children:[e.jsx(v,{value:"all",children:"All Status"}),e.jsx(v,{value:"planned",children:"Planned"}),e.jsx(v,{value:"inprogress",children:"In Progress"}),e.jsx(v,{value:"completed",children:"Completed"}),e.jsx(v,{value:"waiting",children:"Waiting"})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center pt-1.5 pb-1.5 border-b",children:[e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx(ps,{checked:ee,onCheckedChange:s=>Qe(s===!0),className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-[11px] font-medium uppercase tracking-tight text-muted-foreground",children:"Need Approval"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(x,{onClick:T,size:"sm",className:"h-7 text-xs px-2",children:"Apply Filters"}),e.jsx(x,{onClick:ls,size:"sm",variant:"outline",className:"h-7 text-xs px-2",children:"PDF"}),e.jsx(x,{onClick:rs,size:"sm",variant:"outline",className:"h-7 text-xs px-2",children:"Excel"})]})]})]}),e.jsxs(b,{className:"p-0 flex-1 overflow-auto bg-muted/5 relative",children:[e.jsx("div",{className:"hidden md:block h-full",children:e.jsxs("table",{className:"w-full border-collapse text-sm min-w-[900px]",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-primary text-white text-center shadow-sm text-xs",children:[e.jsx("th",{className:"border p-1.5 font-medium",children:"Institute"}),e.jsx("th",{className:"border p-1.5 font-medium hidden xl:table-cell",children:"Type"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Project"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Est. Cost"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Act. Cost"}),e.jsx("th",{className:"border p-1.5 font-medium hidden xl:table-cell",children:"Fund Head"}),e.jsx("th",{className:"border p-1.5 font-medium hidden xl:table-cell",children:"Stage"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Approval Status"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Project Status"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"%"}),e.jsx("th",{className:"border p-1.5 font-medium hidden xl:table-cell",children:"Comments"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Action"})]})}),e.jsx("tbody",{children:M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center p-4 text-muted-foreground",children:"No projects found."})}):M.map(s=>{var t,a,l,o,m;return e.jsxs("tr",{className:`hover:bg-primary/10 dark:hover:bg-gray-700 cursor-pointer transition-colors border-b text-xs ${(d==null?void 0:d.id)===s.id?"bg-primary/5 dark:bg-gray-700 border-l-4 border-l-primary":"bg-card"}`,onClick:()=>w(s),children:[e.jsx("td",{className:"border p-1.5 text-center",children:((t=s.institute)==null?void 0:t.name)||"-"}),e.jsx("td",{className:"border p-1.5 text-center hidden xl:table-cell",children:((a=s.projecttype)==null?void 0:a.name)||"-"}),e.jsx("td",{className:"border p-1.5 font-medium",children:e.jsx(Ne,{href:`/projects/${s.id}/details`,className:"text-blue-600 hover:text-blue-800 hover:underline font-medium",onClick:n=>n.stopPropagation(),children:s.name})}),e.jsx("td",{className:"border p-1.5 text-right whitespace-nowrap",children:V(s.estimated_cost)}),e.jsx("td",{className:"border p-1.5 text-right whitespace-nowrap",children:V(s.actual_cost)}),e.jsx("td",{className:"border p-1.5 text-center hidden xl:table-cell",children:(l=s.fundhead)==null?void 0:l.name}),e.jsx("td",{className:"border p-1.5 text-center hidden xl:table-cell",children:((o=s.current_stage)==null?void 0:o.stage_name)||"Request Initiated"}),e.jsx("td",{className:"border p-1.5 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-tight ${s.approval_status==="completed"?"bg-green-100 text-green-800":s.approval_status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.approval_status.charAt(0).toUpperCase()+s.approval_status.slice(1)})}),e.jsx("td",{className:"border p-1.5 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-tight ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})}),e.jsx("td",{className:"border p-1.5 text-center",children:e.jsx("span",{className:"text-xs",children:s.completion_per?parseFloat(s.completion_per.toString()):"-"})}),e.jsx("td",{className:"border p-1.5 text-center hidden xl:table-cell",children:s.final_comments||"-"}),e.jsx("td",{className:"border p-1.5 text-center",onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.description&&e.jsx(x,{variant:"ghost",size:"sm",className:"text-blue-600 hover:text-blue-700",title:"View Description",onClick:()=>{me(s),$(!0)},children:e.jsx(be,{className:"h-4 w-4"})}),s.pdf&&e.jsx("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center text-blue-600 hover:text-blue-700",title:"View PDF",children:"PDF"}),Y(s)&&e.jsx(x,{variant:"ghost",size:"icon",title:"View/Approve",className:"text-blue-600 hover:text-blue-700",onClick:n=>{n.stopPropagation(),ae(s),Q(!0)},children:e.jsx(we,{className:"h-4 w-4"})}),((m=f.roles[0])==null?void 0:m.name.toLowerCase())==="region"&&!s.fund_head_id&&e.jsx(x,{variant:"ghost",size:"sm",title:"Select Fund Head",className:"text-orange-600 hover:text-orange-700 font-bold",onClick:n=>{n.stopPropagation(),re(s),Z(!0)},children:"Select Head"}),f.type==="Regional Office"&&s.status==="inprogress"&&e.jsx(x,{variant:"ghost",size:"icon",title:`Update Completion (${s.completion_per||0}%)`,className:"text-purple-600 hover:text-purple-700",onClick:n=>{n.stopPropagation(),ue(s)},children:e.jsx(ve,{className:"h-4 w-4"})})]})})]},s.id)})})]})}),e.jsx("div",{className:"md:hidden space-y-2 p-2 bg-muted/5",children:M.length===0?e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:"No projects found."}):e.jsx("div",{className:"space-y-2",children:M.map(s=>{var t,a,l,o,m;return e.jsxs("div",{className:`p-2 rounded-lg border bg-card shadow-sm cursor-pointer transition-all hover:shadow-md ${(d==null?void 0:d.id)===s.id?"ring-2 ring-primary":""}`,onClick:()=>w(s),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Ne,{href:`/projects/${s.id}/details`,className:"text-blue-600 hover:text-blue-800 hover:underline",onClick:n=>n.stopPropagation(),children:e.jsx("h3",{className:"font-semibold text-sm",children:s.name})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:((t=s.institute)==null?void 0:t.name)||"-"})]}),e.jsxs("div",{className:"flex gap-1",onClick:n=>n.stopPropagation(),children:[s.description&&e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7 text-blue-600",onClick:()=>{me(s),$(!0)},children:e.jsx(be,{className:"h-4 w-4"})}),s.pdf&&e.jsx("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center h-7 w-7 text-blue-600 hover:text-blue-700",children:"PDF"}),Y(s)&&e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7 text-blue-600",onClick:()=>{ae(s),Q(!0)},children:e.jsx(we,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-4 text-xs mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Est: "}),e.jsx("span",{className:"font-medium",children:V(s.estimated_cost)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Act: "}),e.jsx("span",{className:"font-medium",children:V(s.actual_cost)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.approval_status==="completed"?"bg-green-100 text-green-800":s.approval_status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:["App: ",s.approval_status.charAt(0).toUpperCase()+s.approval_status.slice(1)]}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:["Proj: ",s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.completion_per?parseFloat(s.completion_per.toString()):"-","%"]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t flex flex-wrap gap-2 text-xs text-muted-foreground",children:[((a=s.projecttype)==null?void 0:a.name)&&e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:s.projecttype.name}),((l=s.fundhead)==null?void 0:l.name)&&e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:s.fundhead.name}),e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:((o=s.current_stage)==null?void 0:o.stage_name)||"Request Initiated"})]}),e.jsxs("div",{className:"mt-2 flex gap-2",onClick:n=>n.stopPropagation(),children:[((m=f.roles[0])==null?void 0:m.name.toLowerCase())==="region"&&!s.fund_head_id&&e.jsx(x,{variant:"outline",size:"sm",className:"text-[10px] h-6 text-orange-600 border-orange-300 px-2",onClick:()=>{re(s),Z(!0)},children:"Select Head"}),f.type==="Regional Office"&&s.status==="inprogress"&&e.jsxs(x,{variant:"outline",size:"sm",className:"text-[10px] h-6 text-purple-600 border-purple-300 px-2",onClick:()=>ue(s),children:[e.jsx(ve,{className:"h-3 w-3 mr-1"})," Update"]})]})]},s.id)})})})]}),h.links.length>1&&e.jsx("div",{className:"p-2 border-t flex justify-center flex-wrap gap-1 shrink-0 bg-background",children:h.links.map((s,t)=>e.jsx(x,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",className:"h-8 text-xs px-2",onClick:()=>{s.url&&fetch(s.url).then(a=>a.json()).then(a=>{q(a)}).catch(a=>{console.error("Error:",a)})},children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t))})]})}),d&&e.jsxs("div",{className:"w-2/3  lg:w-1/3 border-l bg-background p-3 sm:p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col transition-all duration-300 ease-in-out z-20 fixed lg:relative inset-0 lg:inset-auto h-full lg:h-auto rounded-none lg:rounded-l-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:d.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(he=d.institute)==null?void 0:he.name})]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>w(null),children:e.jsx(Pe,{className:"h-5 w-5"})})]}),e.jsxs(Ie,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs($e,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"approvals",children:"Approvals"}),e.jsx(k,{value:"milestones",children:"Milestones"}),e.jsx(k,{value:"payments",children:"Payments"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(P,{value:"approvals",className:"space-y-4 m-0 h-full",children:C?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading history..."}):R.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No approval history found."}):e.jsx("div",{className:"space-y-4",children:R.map(s=>{var t,a;return e.jsxs(j,{className:"overflow-hidden border shadow-sm",children:[e.jsx(N,{className:"p-2 bg-muted/30 pb-1 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold text-xs",children:((t=s.stage)==null?void 0:t.stage_name)||"Stage"}),s.status==="approved"?e.jsxs(u,{variant:"outline",className:"h-4 border-green-500 text-green-600 bg-green-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(Me,{className:"w-2.5 h-2.5"})," Approved"]}):s.status==="rejected"?e.jsxs(u,{variant:"outline",className:"h-4 border-red-500 text-red-600 bg-red-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(Te,{className:"w-2.5 h-2.5"})," Rejected"]}):e.jsxs(u,{variant:"outline",className:"h-4 border-yellow-500 text-yellow-600 bg-yellow-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(H,{className:"w-2.5 h-2.5"})," Pending"]})]})}),e.jsxs(b,{className:"p-2 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1 mb-1",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground flex items-center",children:[e.jsx(H,{className:"w-2.5 h-2.5 mr-1"}),s.action_date?new Date(s.action_date).toLocaleString():""]}),e.jsxs("div",{className:"text-[10px]",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Appr: "}),(a=s.approver)==null?void 0:a.name]})]}),s.comments&&e.jsxs("div",{className:"bg-muted/50 px-2 py-1 rounded text-[10px] italic border mt-1 line-clamp-2",children:['"',s.comments,'"']}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.pdf&&e.jsxs("a",{href:`/${s.pdf}`,target:"_blank",className:"text-blue-600 hover:underline text-[10px] flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3"})," PDF"]}),s.img&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{dataImg:s.img,size:"h-4 w-4",className:"rounded border object-cover"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Image"})]})]})]})]},s.id)})})}),e.jsx(P,{value:"milestones",className:"space-y-4 m-0 h-full",children:C?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading milestones..."}):L.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No milestones found."}):e.jsx("div",{className:"space-y-4",children:L.map(s=>e.jsx(j,{className:"border shadow-sm overflow-hidden",children:e.jsxs("div",{className:"flex items-start",children:[s.img&&e.jsx("div",{className:"w-16 h-full shrink-0",children:e.jsx(U,{dataImg:s.img,size:"h-full w-full",className:"h-full w-full object-cover rounded-none"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(N,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsx("div",{className:"font-semibold text-xs truncate pr-2",children:s.name}),e.jsx(u,{variant:s.status==="completed"?"default":s.status==="inprogress"?"secondary":"outline",className:"capitalize text-[10px] px-1 py-0 h-4 shrink-0",children:s.status})]}),e.jsxs(b,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Due: ",s.days," days"]}),s.completed_date&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Done: ",new Date(s.completed_date).toLocaleDateString()]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-[10px] line-clamp-1",children:s.description})]})]})]})},s.id))})}),e.jsx(P,{value:"payments",className:"space-y-4 m-0 h-full",children:C?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading payments..."}):E.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No payments found."}):e.jsx("div",{className:"space-y-4",children:E.map(s=>{var t,a;return e.jsxs(j,{className:"border shadow-sm",children:[e.jsxs(N,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{className:"font-semibold text-xs",children:["Rs. ",s.amount.toLocaleString()]}),e.jsx(u,{variant:"outline",className:`capitalize text-[10px] px-1 py-0 h-4 ${s.status==="Approved"?"border-green-500 text-green-600 bg-green-50":s.status==="Rejected"?"border-red-500 text-red-600 bg-red-50":"border-yellow-500 text-yellow-600 bg-yellow-50"}`,children:s.status})]}),e.jsxs(b,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[e.jsx("div",{className:"text-muted-foreground font-medium truncate max-w-[150px]",title:((t=s.fund_head)==null?void 0:t.name)||"General Fund",children:((a=s.fund_head)==null?void 0:a.name)||"General Fund"}),e.jsx("div",{className:"text-muted-foreground",children:new Date(s.added_date).toLocaleDateString()})]}),s.description&&e.jsxs("p",{className:"text-muted-foreground text-[10px] italic bg-muted/30 px-1.5 py-0.5 rounded truncate",children:['"',s.description,'"']})]})]},s.id)})})})]})]})]})]}),e.jsx(Ns,{isOpen:Ge,onClose:()=>Q(!1),project:We,onSuccess:()=>{T()}}),e.jsx(bs,{isOpen:qe,onClose:()=>Z(!1),project:Xe,fundHeads:Oe,onSuccess:()=>{T()}}),e.jsx(Ae,{open:Je,onOpenChange:I,children:e.jsxs(Fe,{className:"sm:max-w-[400px]",children:[e.jsxs(De,{children:[e.jsx(ze,{children:"Update Completion Percentage"}),e.jsxs(Re,{children:["Update the completion percentage for ",e.jsx("strong",{children:D==null?void 0:D.name}),"."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(vs,{htmlFor:"completion_per",className:"text-right",children:"Percentage"}),e.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[e.jsx(ms,{id:"completion_per",type:"number",min:"0",max:"100",step:"1",placeholder:"0-100",className:"flex-1",value:S,onChange:s=>oe(s.target.value)}),e.jsx("span",{className:"text-muted-foreground",children:"%"})]})]}),(parseFloat(S)<0||parseFloat(S)>100)&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:"Percentage must be between 0 and 100"})]}),e.jsxs(Le,{children:[e.jsx(x,{variant:"secondary",onClick:()=>I(!1),children:"Cancel"}),e.jsx(x,{onClick:as,disabled:ce||parseFloat(S)<0||parseFloat(S)>100,children:ce?"Updating...":"Save"})]})]})}),e.jsx(Ae,{open:Ye,onOpenChange:$,children:e.jsxs(Fe,{className:"sm:max-w-[500px]",children:[e.jsxs(De,{children:[e.jsx(ze,{children:"Project Description"}),e.jsx(Re,{children:_==null?void 0:_.name})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"bg-muted/30 p-4 rounded-lg border text-sm leading-relaxed whitespace-pre-wrap",children:(_==null?void 0:_.description)||"No description available."})}),e.jsx(Le,{children:e.jsx(x,{onClick:()=>$(!1),children:"Close"})})]})}),d&&e.jsxs("div",{className:"w-full lg:w-[350px] xl:w-[400px] border-l bg-background p-3 sm:p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col transition-all duration-300 ease-in-out z-20 fixed lg:static inset-y-0 right-0 h-full lg:h-auto shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold truncate max-w-[200px]",title:d.name,children:d.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[200px]",title:(fe=d.institute)==null?void 0:fe.name,children:(ge=d.institute)==null?void 0:ge.name})]}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>w(null),children:e.jsx(Pe,{className:"h-4 w-4"})})]}),e.jsxs(Ie,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs($e,{className:"grid w-full grid-cols-3 h-8",children:[e.jsx(k,{value:"approvals",className:"text-xs",children:"Approvals"}),e.jsx(k,{value:"milestones",className:"text-xs",children:"Milestones"}),e.jsx(k,{value:"payments",className:"text-xs",children:"Payments"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(P,{value:"approvals",className:"space-y-3 m-0 h-full",children:C?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground text-xs",children:"Loading history..."}):R.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed text-xs",children:"No approval history found."}):e.jsx("div",{className:"space-y-3",children:R.map(s=>{var t,a;return e.jsxs(j,{className:"overflow-hidden border shadow-sm",children:[e.jsx(N,{className:"p-2 bg-muted/30 pb-1 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold text-xs",children:((t=s.stage)==null?void 0:t.stage_name)||"Stage"}),s.status==="approved"?e.jsxs(u,{variant:"outline",className:"h-4 border-green-500 text-green-600 bg-green-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(Me,{className:"w-2.5 h-2.5"})," Approved"]}):s.status==="rejected"?e.jsxs(u,{variant:"outline",className:"h-4 border-red-500 text-red-600 bg-red-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(Te,{className:"w-2.5 h-2.5"})," Rejected"]}):e.jsxs(u,{variant:"outline",className:"h-4 border-yellow-500 text-yellow-600 bg-yellow-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(H,{className:"w-2.5 h-2.5"})," Pending"]})]})}),e.jsxs(b,{className:"p-2 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1 mb-1",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground flex items-center",children:[e.jsx(H,{className:"w-2.5 h-2.5 mr-1"}),s.action_date?new Date(s.action_date).toLocaleString():""]}),e.jsxs("div",{className:"text-[10px]",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Appr: "}),(a=s.approver)==null?void 0:a.name]})]}),s.comments&&e.jsxs("div",{className:"bg-muted/50 px-2 py-1 rounded text-[10px] italic border mt-1 line-clamp-2",children:['"',s.comments,'"']}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.pdf&&e.jsxs("a",{href:`/${s.pdf}`,target:"_blank",className:"text-blue-600 hover:underline text-[10px] flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3"})," PDF"]}),s.img&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{dataImg:s.img,size:"h-4 w-4",className:"rounded border object-cover"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Image"})]})]})]})]},s.id)})})}),e.jsx(P,{value:"milestones",className:"space-y-3 m-0 h-full",children:C?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground text-xs",children:"Loading milestones..."}):L.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed text-xs",children:"No milestones found."}):e.jsx("div",{className:"space-y-3",children:L.map(s=>e.jsx(j,{className:"border shadow-sm overflow-hidden",children:e.jsxs("div",{className:"flex items-start",children:[s.img&&e.jsx("div",{className:"w-16 h-full shrink-0",children:e.jsx(U,{dataImg:s.img,size:"h-full w-full",className:"h-full w-full object-cover rounded-none"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(N,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsx("div",{className:"font-semibold text-xs truncate pr-2",children:s.name}),e.jsx(u,{variant:s.status==="completed"?"default":s.status==="inprogress"?"secondary":"outline",className:"capitalize text-[10px] px-1 py-0 h-4 shrink-0",children:s.status})]}),e.jsxs(b,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Due: ",s.days," days"]}),s.completed_date&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Done: ",new Date(s.completed_date).toLocaleDateString()]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-[10px] line-clamp-1",children:s.description})]})]})]})},s.id))})}),e.jsx(P,{value:"payments",className:"space-y-3 m-0 h-full",children:C?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground text-xs",children:"Loading payments..."}):E.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed text-xs",children:"No payments found."}):e.jsx("div",{className:"space-y-3",children:E.map(s=>{var t,a;return e.jsxs(j,{className:"border shadow-sm",children:[e.jsxs(N,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{className:"font-semibold text-xs",children:["Rs. ",s.amount.toLocaleString()]}),e.jsx(u,{variant:"outline",className:`capitalize text-[10px] px-1 py-0 h-4 ${s.status==="Approved"?"border-green-500 text-green-600 bg-green-50":s.status==="Rejected"?"border-red-500 text-red-600 bg-red-50":"border-yellow-500 text-yellow-600 bg-yellow-50"}`,children:s.status})]}),e.jsxs(b,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[e.jsx("div",{className:"text-muted-foreground font-medium truncate max-w-[150px]",title:((t=s.fund_head)==null?void 0:t.name)||"General Fund",children:((a=s.fund_head)==null?void 0:a.name)||"General Fund"}),e.jsx("div",{className:"text-muted-foreground",children:new Date(s.added_date).toLocaleDateString()})]}),s.description&&e.jsxs("p",{className:"text-muted-foreground text-[10px] italic bg-muted/30 px-1.5 py-0.5 rounded truncate",children:['"',s.description,'"']})]})]},s.id)})})})]})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/20 lg:hidden z-10",onClick:()=>w(null)})]})})}export{rt as default};
