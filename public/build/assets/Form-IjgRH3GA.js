import{r,R as X,j as e,L as Ae,$ as Ie,a as z,S as L}from"./app-DfK0LB9K.js";import{A as Fe,S as Me,g as V,T as $e,a as Te,f as ze}from"./app-layout-C5OvlP-t.js";import{B as u}from"./button-DpXPv_jl.js";import{C as Y,a as Le,b as Ve,c as Oe}from"./card-CP_hDGfN.js";import{I as d}from"./input-B-D2vae7.js";import{L as i}from"./label-jrcvH1h6.js";import{S as b,a as w,b as P,c as _,d as j}from"./select-WCTINDR1.js";import{D as Z,a as ee,b as se,c as ae,d as te,e as ne,t as h}from"./index-C1YaodqL.js";import{T as ie}from"./textarea-DcJW54Eg.js";import"./index-BxgWxWYu.js";import"./createLucideIcon-DxhY9BYd.js";import"./index-cKAGTNjI.js";import"./index-D0KctOEB.js";import"./index-BHsJuU60.js";import"./index-jw5J8fVl.js";import"./app-logo-icon-DkyJ5Sej.js";import"./circle-x-LWAlBi2F.js";import"./clsx-B-dksMZM.js";import"./folder-root-DtIdaB_R.js";import"./grip-vertical-CwQDUElQ.js";import"./index-C4TvmPLC.js";import"./index-PY_1Cr1D.js";function gs({project:a,projectTypes:le,contractors:C,companies:D}){var J,K,Q,W;const m=!!(a!=null&&a.id),[k,re]=r.useState((a==null?void 0:a.name)||""),[E,de]=r.useState(((J=a==null?void 0:a.estimated_cost)==null?void 0:J.toString())||""),[ce,Re]=r.useState(((K=a==null?void 0:a.actual_cost)==null?void 0:K.toString())||""),[O,qe]=r.useState((a==null?void 0:a.approval_status)||""),[He,Be]=r.useState((a==null?void 0:a.status)||""),[oe,Ue]=r.useState((a==null?void 0:a.final_comments)||""),[A,me]=r.useState(((a==null?void 0:a.project_type_id)||"").toString()),[R,pe]=r.useState((a==null?void 0:a.description)||""),[q,xe]=r.useState((a==null?void 0:a.priority)||"Medium"),[v,ue]=r.useState(null),[I,Ge]=r.useState((a==null?void 0:a.pdf)||null),[F,he]=r.useState(((Q=a==null?void 0:a.contractor_id)==null?void 0:Q.toString())||""),[y,ge]=r.useState(null),[M,Je]=r.useState((a==null?void 0:a.structural_plan)||null),[je,ve]=r.useState(C),[ye,N]=r.useState(!1),[c,g]=r.useState({company_id:"",name:"",email:"",phone:"",address:"",specialization:""}),[H,B]=r.useState(!1),[fe,Ce]=r.useState(C.length>=0?D:[]),[Ne,S]=r.useState(!1),[p,f]=r.useState({name:"",email:"",contact:"",address:""}),[U,G]=r.useState(!1),[$,T]=r.useState(((W=a==null?void 0:a.milestones)==null?void 0:W.map(s=>({key:Date.now()+s.id,id:s.id,name:s.name,description:s.description||"",days:(s.days||"").toString(),img:null,pdf:null,existingImg:s.img||void 0,existingPdf:s.pdf||void 0,preview:s.img?`${s.img}`:void 0,status:s.status||"pending",completed_date:s.completed_date?s.completed_date.split("T")[0]:""})))||[]),Se=Object.entries(le).map(([s,t])=>({id:parseInt(s),name:t})),be=()=>{T(s=>[...s,{key:Date.now(),name:"",description:"",days:"",img:null,pdf:null,status:"pending",completed_date:""}])},we=s=>{T(t=>t.filter(l=>l.key!==s)),h.success("Milestone removed")},x=(s,t,l)=>{T(n=>n.map(o=>o.key===s?{...o,[t]:l}:o))},Pe=(s,t)=>{if(!t){x(s,"img",null),x(s,"preview",void 0);return}const l=new FileReader;l.onloadend=()=>{x(s,"preview",l.result)},l.readAsDataURL(t),x(s,"img",t)},_e=async()=>{if(!c.name||!c.company_id){h.error("Name and Company are required");return}B(!0);try{const s=await z.post("/contractor",c),t=await z.get(route("contractor.index"),{params:{json:!0}}).catch(()=>null);L.reload({only:["contractors"],onSuccess:l=>{h.success("Contractor added"),N(!1),g({company_id:"",name:"",email:"",phone:"",address:"",specialization:""})}})}catch(s){console.error(s),h.error("Failed to add contractor")}finally{B(!1)}},De=async()=>{if(!p.name){h.error("Company Name is required");return}G(!0);try{await z.post("/company",p),L.reload({only:["companies"],onSuccess:()=>{h.success("Company added"),S(!1),f({name:"",email:"",contact:"",address:""})}})}catch(s){console.error(s),h.error("Failed to add company")}finally{G(!1)}};X.useEffect(()=>{ve(C)},[C]),X.useEffect(()=>{Ce(D)},[D]);const ke=s=>{if(s.preventDefault(),!k.trim()||!E||!A){h.error("Please fill all required project fields");return}const t=new FormData;t.append("name",k),t.append("estimated_cost",E),t.append("actual_cost",ce),t.append("final_comments",oe),t.append("project_type_id",A),t.append("description",R),t.append("priority",q),F&&t.append("contractor_id",F),v&&t.append("pdf",v),y&&t.append("structural_plan",y),m&&t.append("_method","PUT"),$.forEach((n,o)=>{n.name.trim()&&n.days&&(n.id&&t.append(`milestones[${o}][id]`,n.id.toString()),t.append(`milestones[${o}][name]`,n.name),t.append(`milestones[${o}][description]`,n.description),t.append(`milestones[${o}][days]`,n.days),t.append(`milestones[${o}][status]`,n.status),n.status==="completed"&&n.completed_date&&t.append(`milestones[${o}][completed_date]`,n.completed_date),n.img&&t.append(`milestones[${o}][img]`,n.img),n.pdf&&t.append(`milestones[${o}][pdf]`,n.pdf))});const l=m?`/projects/${a.id}`:"/projects";L.post(l,t,{forceFormData:!0,onSuccess:()=>{h.success(m?"Project updated!":"Project created!")},onError:n=>{console.error(n),h.error("Please fix the errors")}})},Ee=[{title:"Projects",href:"/projects"},{title:m?"Edit Project":"Create Project",href:"#"}];return e.jsxs(Fe,{breadcrumbs:Ee,children:[e.jsx(Ae,{title:m?"Edit Project":"Create Project"}),e.jsx("div",{className:"p-4 md:p-6 w-full mx-auto",children:e.jsxs(Y,{children:[e.jsx(Le,{children:e.jsx(Ve,{className:"text-2xl",children:m?"Edit Project":"Create New Project"})}),e.jsx(Me,{}),e.jsx(Oe,{className:"pt-6",children:e.jsxs("form",{onSubmit:ke,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Project Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:k,onChange:s=>re(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Estimated Cost ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"number",disabled:m,value:E,onChange:s=>de(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Project Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(b,{value:A,onValueChange:me,children:[e.jsx(w,{children:e.jsx(P,{placeholder:"Select type"})}),e.jsx(_,{children:Se.map(s=>e.jsx(j,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Priority"}),e.jsxs(b,{value:q,onValueChange:xe,children:[e.jsx(w,{children:e.jsx(P,{})}),e.jsxs(_,{children:[e.jsx(j,{value:"Low",children:"Low"}),e.jsx(j,{value:"Medium",children:"Medium"}),e.jsx(j,{value:"High",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{children:"Description"}),e.jsx(d,{value:R,onChange:s=>pe(s.target.value)})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{children:"Project PDF Document"}),(O!=="approved"||!I)&&e.jsx(d,{type:"file",accept:".pdf",onChange:s=>{var t;return ue(((t=s.target.files)==null?void 0:t[0])||null)}}),I&&!v&&e.jsx("a",{href:`/assets/${I}`,target:"_blank",className:"text-sm text-blue-600 hover:underline",children:"View Current PDF"}),v&&e.jsxs("p",{className:"text-sm text-green-600",children:["New PDF selected: ",v.name]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Contractor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(b,{value:F,onValueChange:he,children:[e.jsx(w,{children:e.jsx(P,{placeholder:"Select contractor"})}),e.jsx(_,{children:je.map(s=>e.jsx(j,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(u,{type:"button",variant:"outline",size:"icon",onClick:()=>N(!0),title:"Add New Contractor",children:e.jsx(V,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{children:"Structural Plan (PDF)"}),(O!=="approved"||!M)&&e.jsx(d,{type:"file",accept:".pdf",onChange:s=>{var t;return ge(((t=s.target.files)==null?void 0:t[0])||null)}}),M&&!y&&e.jsx("a",{href:`/assets/${M}`,target:"_blank",className:"text-sm text-blue-600 hover:underline",children:"View Current Structural Plan"}),y&&e.jsxs("p",{className:"text-sm text-green-600",children:["New Plan selected: ",y.name]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Milestones"}),e.jsxs(u,{type:"button",onClick:be,size:"sm",children:[e.jsx(V,{className:"w-4 h-4 mr-2"})," Add Milestone"]})]}),$.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 border-2 border-dashed rounded-lg",children:'No milestones yet. Click "Add Milestone" to start.'}):e.jsx("div",{className:"space-y-6",children:$.map((s,t)=>e.jsx(Y,{className:"p-6 border",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Milestone Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:s.name,onChange:l=>x(s.key,"name",l.target.value),placeholder:"e.g. Site Survey"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Description"}),e.jsx(d,{value:s.description,onChange:l=>x(s.key,"description",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Due (Days) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"number",value:s.days,onChange:l=>x(s.key,"days",l.target.value),placeholder:"e.g. 30"})]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Status"}),e.jsxs("select",{value:s.status,onChange:l=>x(s.key,"status",l.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"inprogress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),s.status==="completed"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Completed Date"}),e.jsx(d,{type:"date",value:s.completed_date,onChange:l=>x(s.key,"completed_date",l.target.value)})]})]}),m&&e.jsxs(e.Fragment,{children:[(s.status!=="completed"||!s.existingPdf)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Proof Image"}),e.jsx(d,{type:"file",accept:"image/*",onChange:l=>{var n;return Pe(s.key,((n=l.target.files)==null?void 0:n[0])||null)}}),s.existingImg&&!s.preview&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Has existing image"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Signed Document (PDF)"}),(s.status!=="completed"||!s.existingPdf)&&e.jsx(d,{type:"file",accept:".pdf",onChange:l=>{var n;return x(s.key,"pdf",((n=l.target.files)==null?void 0:n[0])||null)}}),s.existingPdf&&e.jsx("a",{href:`/${s.existingPdf}`,target:"_blank",className:"text-xs text-blue-500 underline mt-1 block",children:"View PDF"})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded bg-muted border flex items-center justify-center",children:s.preview||s.existingImg?e.jsx("img",{src:s.preview||`/${s.existingImg}`,alt:"Preview",className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-[10px] text-muted-foreground italic",children:"No image"})}),s.status!=="completed"&&e.jsx(u,{type:"button",variant:"destructive",size:"icon",onClick:()=>we(s.key),children:e.jsx($e,{className:"w-4 h-4"})})]})]})]})},s.key))})]}),e.jsxs("div",{className:"flex justify-between pt-8 border-t",children:[e.jsx(u,{type:"button",variant:"secondary",asChild:!0,children:e.jsxs(Ie,{href:"/projects",children:[e.jsx(Te,{className:"mr-2 h-4 w-4"})," Back"]})}),e.jsxs(u,{type:"submit",size:"lg",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),m?"Update Project":"Create Project"]})]})]})})]})}),e.jsx(Z,{open:ye,onOpenChange:N,children:e.jsxs(ee,{className:"max-w-lg",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Add New Contractor"}),e.jsx(te,{children:"Create a new contractor to assign to this project immediately."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Company ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(b,{value:c.company_id,onValueChange:s=>g({...c,company_id:s}),children:[e.jsx(w,{children:e.jsx(P,{placeholder:"Select Company"})}),e.jsx(_,{children:fe.map(s=>e.jsx(j,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(u,{type:"button",variant:"outline",size:"icon",onClick:()=>S(!0),title:"Add New Company",children:e.jsx(V,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Contractor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:c.name,onChange:s=>g({...c,name:s.target.value}),placeholder:"Enter contractor name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Specialization"}),e.jsx(d,{value:c.specialization,onChange:s=>g({...c,specialization:s.target.value}),placeholder:"e.g. Electrical, Civil"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Email"}),e.jsx(d,{type:"email",value:c.email,onChange:s=>g({...c,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Phone"}),e.jsx(d,{value:c.phone,onChange:s=>g({...c,phone:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Address"}),e.jsx(ie,{value:c.address,onChange:s=>g({...c,address:s.target.value})})]})]}),e.jsxs(ne,{children:[e.jsx(u,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(u,{onClick:_e,disabled:H,children:H?"Creating...":"Create Contractor"})]})]})}),e.jsx(Z,{open:Ne,onOpenChange:S,children:e.jsxs(ee,{className:"max-w-md",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Add New Company"}),e.jsx(te,{children:"Create a new company to assign to the contractor."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Company Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:p.name,onChange:s=>f({...p,name:s.target.value}),placeholder:"Enter company name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Email"}),e.jsx(d,{type:"email",value:p.email,onChange:s=>f({...p,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Contact Number"}),e.jsx(d,{value:p.contact,onChange:s=>f({...p,contact:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Address"}),e.jsx(ie,{value:p.address,onChange:s=>f({...p,address:s.target.value})})]})]}),e.jsxs(ne,{children:[e.jsx(u,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(u,{onClick:De,disabled:U,children:U?"Creating...":"Create Company"})]})]})})]})}export{gs as default};
