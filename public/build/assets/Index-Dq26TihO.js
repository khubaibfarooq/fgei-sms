import{r as d,j as e,L as Ne}from"./app-Dk37D3Vr.js";import{A as ke,S as we,t as W}from"./app-layout-BDlOMZuu.js";import{B as q}from"./button-Df5ZUQP5.js";import{C as ve,a as Se,b as Ce,c as Ie}from"./card-CyiXp4xx.js";import{L as B}from"./label-B-8AomcI.js";import{I as j}from"./image-preview-B7lcn7hm.js";import{C as $}from"./combobox-CkioGLQw.js";import{f as L}from"./dateFormatter-Cn65gwBN.js";import{E as _e,F as Re,a as Ae,b as Be}from"./jspdf.plugin.autotable-DHoj7Deg.js";import"./index-C-azhO0l.js";import"./createLucideIcon-D9wZ9u-N.js";import"./input-vJo_1isZ.js";import"./index-BJjaeL9e.js";import"./app-logo-icon-BATg0_BG.js";import"./folder-root-NkT4TAtI.js";import"./grip-vertical-DhE6WAe1.js";import"./popover-deJ4FDRg.js";const Le=[{title:"Institutional Report",href:"/reports/institutes"}],z=x=>{const y=x!=null&&typeof x.id=="number"&&x.id>0&&typeof x.name=="string"&&x.name.trim()!=="";return y||console.warn("Invalid item detected:",x),y};function et({institutes:x=[],regions:y=[],blocks:M=[],instituteAssets:U=[],rooms:Y=[],shifts:H=[],upgradations:Q=[],funds:V=[],projects:J=[],filters:N={search:"",institute_id:"",region_id:""}}){const[G,De]=d.useState(N.search||""),[k,D]=d.useState(N.institute_id||""),[i,K]=d.useState(),[F,X]=d.useState(N.region_id||""),[E,P]=d.useState(x),[T,Fe]=d.useState(y),[h,Z]=d.useState(M),[g,ee]=d.useState(U),[u,te]=d.useState(Y),[p,se]=d.useState(H),[f,ae]=d.useState(Q),[w,re]=d.useState(!1),[v,oe]=d.useState(!1),[S,de]=d.useState(!1),[C,le]=d.useState(!1),[I,ne]=d.useState(!1),[Ee,Pe]=d.useState(!1),[_,ie]=d.useState(V),[b,ce]=d.useState(J),[R,me]=d.useState(!1),xe=d.useMemo(()=>E.filter(z),[E]),A=d.useMemo(()=>T.filter(z),[T]);console.log(A);const he=async t=>{try{const o=new URLSearchParams(t).toString(),n=await fetch(`/reports/institutes/getData?${o}`);if(!n.ok)throw new Error("Failed to fetch data");const a=await n.json();K(a.institute||[]),console.log(i),Z(a.blocks||[]),ee(a.instituteAssets||[]),console.log(a.instituteAssets),te(a.rooms||[]),se(a.shifts||[]),ae(a.upgradations||[]),ie(a.funds||[]),console.log(a.projects),ce(a.projects||[])}catch(o){console.error("Error fetching data:",o),W.error("Failed to load data")}},ge=t=>{D(t),he({search:G,institute_id:t,region_id:F})},ue=async t=>{try{const o=new URLSearchParams({region_id:t||""}).toString(),n=await fetch(`/reports/getInstitutes?${o}`);if(!n.ok)throw new Error("Failed to fetch institutes");const a=await n.json();console.log("Fetched institutes:",a),P(a),k&&t!=="0"&&!a.some(l=>l.id.toString()===k)&&D("")}catch(o){console.error("Error fetching institutes:",o),W.error("Failed to load institutes"),P([])}},pe=async t=>{X(t),ue(t)},fe=async()=>{const t=new _e.Workbook,o=t.addWorksheet("Shifts");o.columns=[{header:"Name",key:"name",width:20},{header:"Building Name",key:"building_name",width:20},{header:"Building Type",key:"building_type",width:20}],p.forEach(r=>{var m;o.addRow({name:r.name,building_name:r.building_name,building_type:((m=r.building_type)==null?void 0:m.name)||"N/A"})});const n=t.addWorksheet("Blocks");n.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15}],h.forEach(r=>{n.addRow({name:r.name,area:r.area})});const a=t.addWorksheet("Rooms");a.columns=[{header:"Name",key:"name",width:20},{header:"Area (sq ft)",key:"area",width:15},{header:"Block",key:"block",width:20}],u.forEach(r=>{var m;a.addRow({name:r.name,area:r.area,block:((m=r.block)==null?void 0:m.name)||"N/A"})});const l=t.addWorksheet("Assets");l.columns=[{header:"Asset",key:"asset",width:20},{header:"Quantity",key:"qty",width:10},{header:"Rooms",key:"locations",width:20}],g.forEach(r=>{var m;l.addRow({asset:((m=r.asset)==null?void 0:m.name)||"N/A",qty:r.total_qty,locations:r.locations_count})});const s=t.addWorksheet("Funds");s.columns=[{header:"Fund Head",key:"Fundhead",width:30},{header:"Balance",key:"balance",width:15}],_.forEach(r=>{var m;s.addRow({Fundhead:(m=r.fund_head)==null?void 0:m.name,balance:r.balance})});const c=t.addWorksheet("Upgradations");c.columns=[{header:"Details",key:"details",width:30},{header:"Date From",key:"from",width:15},{header:"Date To",key:"to",width:15},{header:"Level From",key:"levelfrom",width:15},{header:"Level To",key:"levelto",width:15},{header:"Status",key:"status",width:15}],f.forEach(r=>{c.addRow({details:r.details,from:r.from,to:r.to,levelfrom:r.levelfrom,levelto:r.levelto,status:r.status})});const O=t.addWorksheet("Projects");O.columns=[{header:"Project Type",key:"projecttype",width:30},{header:"Completed",key:"completed",width:15},{header:"In  Progress",key:"inprogress",width:15},{header:"Planned",key:"planned",width:15}],b.forEach(r=>{O.addRow({projecttype:r.name,completed:r.completed,inprogress:r.inprogress,planned:r.planned})});const ye=await t.xlsx.writeBuffer(),je=new Blob([ye],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Re.saveAs(je,"Institutional_Report.xlsx")},be=()=>{const t=new Ae;let o=20;const n=(a,l,s)=>{t.setFontSize(14),t.text(a,14,o),Be(t,{head:[l],body:s,startY:o+3,styles:{fontSize:10},headStyles:{fillColor:[11,67,27]}}),o=t.lastAutoTable.finalY+8,o>t.internal.pageSize.height-50&&(t.addPage(),o=20)};if(t.setFontSize(16),t.text("Institutional Report",14,15),o=25,p.length>0){const a=["Name","Building Name","Building Type"],l=p.map(s=>{var c;return[s.name,s.building_name,((c=s.building_type)==null?void 0:c.name)||"N/A"]});n("Shifts",a,l)}if(h.length>0){const a=["Name","Area (sq ft)"],l=h.map(s=>[s.name,s.area]);n("Blocks",a,l)}if(u.length>0){const a=["Name","Area (sq ft)","Block"],l=u.map(s=>{var c;return[s.name,s.area,((c=s.block)==null?void 0:c.name)||"N/A"]});n("Rooms",a,l)}if(g.length>0){const a=["Asset Name","Quantity","Rooms"],l=g.map(s=>[s.name,s.total_qty.toString(),s.locations_count.toString()]);n("Institute Assets",a,l)}if(_.length>0){const a=["Fund Head","Balance"],l=_.map(s=>{var c;return[(c=s.fund_head)==null?void 0:c.name,s.balance]});n("Institute Funds",a,l)}if(f.length>0){const a=["Details","Date From","Date To","Level From","Level To","Status"],l=f.map(s=>[s.details,s.from,s.to,s.levelfrom,s.levelto,s.status]);n("Institute Upgradations",a,l)}if(b.length>0){const a=["Project Type","Completed","In Progress","Planned"],l=b.map(s=>[s.name,s.completed,s.inprogress,s.planned]);n("Institute Projects",a,l)}t.save("Institutional_Report.pdf")};return e.jsxs(ke,{breadcrumbs:Le,children:[e.jsx(Ne,{title:"Institutional Report"}),e.jsxs("div",{className:"flex-1 p-3 ",children:[e.jsxs(ve,{children:[e.jsxs(Se,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:["          ",e.jsx(Ce,{children:"Institutional Report"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{onClick:be,className:"w-full md:w-auto",children:"Export PDF"}),e.jsx(q,{onClick:fe,className:"w-full md:w-auto",children:"Export Excel"})]})]}),e.jsx(we,{}),e.jsx(Ie,{className:"py-3 space-y-2",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[A.length>0&&e.jsx($,{entity:"region",value:F,onChange:t=>pe(t),options:A.map(t=>({id:t.id.toString(),name:t.name.split(" ").pop()||t.name})),includeAllOption:!0}),e.jsx($,{entity:"institute",value:k,onChange:t=>ge(t),options:xe.map(t=>({id:t.id.toString(),name:t.name})),includeAllOption:!0})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Current Layout Image"}),i!=null&&i.img_layout?e.jsx(j,{dataImg:`${i.img_layout}`,className:"w-full h-48 object-cover rounded"}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No layout image uploaded."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Current 3D Image"}),i!=null&&i.img_3d?e.jsx(j,{dataImg:`${i.img_3d}`,className:"w-full h-48 object-cover rounded"}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No 3D image uploaded."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Current Video"}),i!=null&&i.video?e.jsxs("video",{controls:!0,className:"w-full h-48 rounded",children:[e.jsx("source",{src:`/assets/${i.video}`,type:"video/mp4"}),"Your browser does not support the video tag."]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No video uploaded."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 my-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg  border-primary/95",children:[e.jsxs("button",{className:`w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800 

  `,onClick:()=>re(!w),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Shifts(",p.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${w?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&e.jsx("div",{className:"p-4 border-t",children:p.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-md overflow-hidden shadow-sm border-1",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Building Type"})]})}),e.jsx("tbody",{children:p.map(t=>{var o;return e.jsxs("tr",{className:"hover:bg-primary/10  dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.building_name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(o=t.building_type)==null?void 0:o.name})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No shifts available"})})]}),e.jsxs("div",{className:"border rounded-lg border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>oe(!v),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Blocks(",h.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${v?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&e.jsx("div",{className:"p-4 border-t",children:h.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-md overflow-hidden shadow-sm border-1",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Establish Date"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"hover:bg-primary/10  dark:hover:bg-gray-700",children:[e.jsxs("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:["  ",e.jsxs("div",{className:"flex flex-column gap-2 align-middle",children:[" ",e.jsx(j,{dataImg:t.img,size:"h-20"}),"  ",e.jsx("span",{className:"font-bold",children:t.name})]})," "]}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:L(t.establish_date)})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No blocks available"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 my-2  gap-6",children:[e.jsxs("div",{className:"border rounded-lg  border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>de(!S),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Rooms(",u.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${S?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),S&&e.jsx("div",{className:"p-4 border-t",children:u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-md overflow-hidden shadow-sm border-1",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Block"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Area (sq ft)"})]})}),e.jsx("tbody",{children:u.map(t=>{var o;return e.jsxs("tr",{className:"hover:bg-primary/10  dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:(o=t.block)==null?void 0:o.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"flex flex-column gap-2 align-middle",children:[" ",e.jsx(j,{dataImg:t.img,size:"h-20"}),"  ",e.jsx("span",{className:"font-bold",children:t.name})]})}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.area})]},t.id)})})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No rooms available"})})]}),e.jsxs("div",{className:"border rounded-lg  border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>le(!C),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Assets(",g.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${C?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),C&&e.jsx("div",{className:"p-4 border-t",children:g.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-md overflow-hidden shadow-sm border-1",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Asset Name"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Total Quantity"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Rooms"})]})}),e.jsx("tbody",{children:g.map(t=>e.jsxs("tr",{className:"hover:bg-primary/10  dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 font-bold dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-green-700 font-bold dark:text-gray-100",children:t.total_qty}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.locations_count})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No assets available"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 my-2  md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg  border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>ne(!I),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Upgradations(",f.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${I?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),I&&e.jsx("div",{className:"p-4 border-t",children:f.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-md overflow-hidden shadow-sm border-1",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Details"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date from"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date to"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level From"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Level To"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Status"})]})}),e.jsx("tbody",{children:f.map(t=>e.jsxs("tr",{className:"hover:bg-primary/10  dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.details}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:L(t.from)}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:L(t.to)}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelfrom}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.levelto}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.status})]},t.id))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No upgradations available"})})]}),e.jsxs("div",{className:"border rounded-lg border-primary/95",children:[e.jsxs("button",{className:"w-full p-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>me(!R),children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Institute Projects(",b.length,")"]}),e.jsx("svg",{className:`w-5 h-5 transform transition-transform ${R?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),R&&e.jsx("div",{className:"p-4 border-t",children:b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-md overflow-hidden shadow-sm border-1",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#0b431b] dark:bg-gray-800",children:[e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Project Type"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Completed"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"In Progress"}),e.jsx("th",{className:"border p-2 text-left text-sm font-medium text-white dark:text-gray-200",children:"Planned"})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{className:"hover:bg-primary/10  dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.completed}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.inprogress}),e.jsx("td",{className:"border p-2 text-sm text-gray-900 dark:text-gray-100",children:t.planned})]}))})]})}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No Fund available"})})]})]})]})]})}export{et as default};
