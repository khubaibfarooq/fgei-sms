import{r as d,m as F,j as e,L as H,S as p}from"./app-BC4g3-Sh.js";import{A as P,e as T,fP as E,aN as z,B as w}from"./app-layout-D2DE53xZ.js";import{B as n}from"./button-NzCsb15S.js";import{I as c}from"./input-B38sVd47.js";import{S as B,a as W,b as O,c as M,d as r}from"./select-CKkZPOst.js";import{A as K,a as V,b as U,c as Y,d as G,e as J,f as Q,g as X,h as Z}from"./alert-dialog-ESOynmcv.js";import{t as N}from"./index-D5grnXr_.js";import{C as q}from"./ChatBox-B0oUWl2_.js";import"./index-q3AzPoZD.js";import"./createLucideIcon-CuuBrquh.js";import"./index-DXUZiMwj.js";import"./index-B8QJ6AuC.js";import"./index-QP_HzfFt.js";import"./index-D368l6qP.js";import"./app-logo-icon-CWQ_cq_6.js";import"./circle-x-BFsT17H-.js";import"./index-CxugRWfh.js";import"./index-BEeyM0RA.js";import"./card-D3FFSLEP.js";import"./folder-root-Djpr5ABJ.js";import"./grip-vertical-DpyLEmjT.js";const ee=[{title:"HelpDesks",href:"/helpdesk"}],y=a=>{switch(a){case"Pending":return"bg-yellow-500 text-white";case"Waiting":return"bg-blue-500 text-white";case"Resolved":return"bg-green-500 text-white";case"Rejected":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},o=a=>{switch(a){case"Pending":return"yellow";case"Waiting":return"blue";case"Resolved":return"green";case"Rejected":return"red";default:return"gray"}};function ke({helpDesk:a,filters:l,institutes:te,auth:se}){var b;const[x,k]=d.useState(l.search||""),[h,S]=d.useState(l.status||""),[C,g]=d.useState(!1),[t,f]=d.useState(null),{data:j,setData:m,post:A,processing:D,errors:i,reset:R}=F({title:"",description:"",attachment:null}),$=s=>{s.key==="Enter"&&p.get("/helpdesk",{...l,search:x,status:h},{preserveScroll:!0})},L=s=>{S(s),p.get("/helpdesk",{...l,search:x,status:s},{preserveScroll:!0})},I=s=>{s.preventDefault(),A("/helpdesk",{preserveScroll:!0,onSuccess:()=>{g(!1),R(),N.success("Help desk ticket created successfully.")},onError:()=>{N.error("Failed to create help desk ticket.")}})},_=s=>{var v;if(!s)return!1;const u=(v=s.split(".").pop())==null?void 0:v.toLowerCase();return["jpg","jpeg","png"].includes(u||"")};return e.jsxs(P,{breadcrumbs:ee,children:[e.jsx(H,{title:"HelpDesk"}),e.jsxs("div",{className:"flex h-[calc(100vh-64px)] overflow-hidden bg-background",children:[e.jsxs("div",{className:`w-full md:w-80 lg:w-96 flex flex-col border-r bg-card transition-all ${t?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"p-4 border-b space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold",children:"HelpDesk"}),e.jsxs(K,{open:C,onOpenChange:g,children:[e.jsx(V,{asChild:!0,children:e.jsx(n,{size:"icon",variant:"ghost",children:e.jsx(T,{className:"h-5 w-5"})})}),e.jsxs(U,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Create Help Desk Ticket"}),e.jsx(J,{children:"Fill in the details to create a new help desk ticket."})]}),e.jsxs("form",{onSubmit:I,encType:"multipart/form-data",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"create-title",className:"block text-sm font-medium",children:"Title"}),e.jsx(c,{id:"create-title",type:"text",value:j.title,onChange:s=>m("title",s.target.value),placeholder:"Enter ticket title"}),i.title&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:i.title})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"create-description",className:"block text-sm font-medium",children:"Description"}),e.jsx(c,{id:"create-description",type:"text",value:j.description,onChange:s=>m("description",s.target.value),placeholder:"Enter description"}),i.description&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:i.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"create-attachment",className:"block text-sm font-medium",children:"Attachment"}),e.jsx(c,{id:"create-attachment",type:"file",accept:".jpg,.png,.pdf,.doc,.docx",onChange:s=>m("attachment",s.target.files?s.target.files[0]:null)})]}),e.jsxs(Q,{children:[e.jsx(X,{children:"Cancel"}),e.jsx(Z,{type:"submit",disabled:D,children:"Create"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Search...",value:x,onChange:s=>k(s.target.value),onKeyDown:$,className:"h-9 pl-9"})]}),e.jsxs(B,{value:h,onValueChange:L,children:[e.jsx(W,{className:"h-9",children:e.jsx(O,{placeholder:"Status"})}),e.jsxs(M,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"Pending",children:"Pending"}),e.jsx(r,{value:"Waiting",children:"Waiting"}),e.jsx(r,{value:"Resolved",children:"Resolved"}),e.jsx(r,{value:"Rejected",children:"Rejected"})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto divide-y",children:[!(a!=null&&a.data)||a.data.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground text-sm italic",children:"No tickets found"}):a.data.map(s=>e.jsxs("div",{onClick:()=>f(s),className:`p-4 cursor-pointer hover:bg-muted/50 transition-colors min-h-[80px] flex flex-col justify-center ${(t==null?void 0:t.id)===s.id?"bg-primary/10 border-r-2 border-primary":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("span",{className:"text-[10px] font-mono font-medium text-muted-foreground",children:["#",s.token]}),e.jsx("span",{className:`text-[9px] uppercase font-bold px-1.5 py-0.5 rounded-full ${y(s.status)}`,children:s.status})]}),e.jsx("h3",{className:"font-semibold text-sm truncate",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.description}),e.jsx("div",{className:"flex justify-between mt-2 text-[10px] text-muted-foreground italic",children:e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()})})]},s.id)),(a==null?void 0:a.links)&&a.links.length>3&&e.jsx("div",{className:"p-4 flex justify-center gap-1 border-t",children:a.links.map((s,u)=>e.jsx(n,{disabled:!s.url,variant:s.active?"default":"ghost",size:"icon",className:"h-8 w-8 text-[10px]",onClick:()=>p.visit(s.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},u))})]})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-muted/5 transition-all ${t?"flex":"hidden md:flex"}`,children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b bg-card flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>f(null),children:e.jsx(z,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-base leading-none mb-1",children:t.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ticket #",t.token," â€¢ ",t.institute.name]})]})]}),e.jsx("div",{className:`text-[10px] uppercase font-black px-2 py-1 rounded-full ${y(t.status)}`,children:t.status})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-1 lg:p-2",children:e.jsxs("div",{className:"max-w-full mx-auto space-y-2",children:[e.jsxs("div",{className:"bg-card rounded-xl border p-2 shadow-sm space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 pb-2 border-b",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-1",children:"Created By"}),e.jsx("p",{className:"text-sm font-medium",children:t.user.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-1",children:"Date Created"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-1",children:"Last Update"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(t.updated_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-1",children:"Institute"}),e.jsx("p",{className:"text-sm font-medium truncate",children:t.institute.name})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm leading-relaxed text-foreground/80 whitespace-pre-wrap italic",children:['"',t.description,'"']}),t.attachment&&e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest block mb-2",children:"Attached Documents"}),_(t.attachment)?e.jsx("div",{className:"relative group max-w-[240px]",children:e.jsx("img",{src:`/${t.attachment}`,alt:"Attachment preview",className:"rounded-lg border object-cover h-32 w-full hover:brightness-90 transition-all cursor-zoom-in",onClick:()=>window.open(`/${t.attachment}`,"_blank")})}):e.jsx(n,{variant:"outline",size:"sm",className:"h-8",onClick:()=>window.open(`/${t.attachment}`,"_blank"),children:"Download File"})]})]})]}),(t.feedback||t.feedbackby)&&e.jsxs("div",{className:t.status==="Pending"?"bg-yellow-500/10 border-yellow-500/20 rounded-xl p-4 md:p-5 border text-yellow-900 dark:text-yellow-100 shadow-sm relative overflow-hidden group":t.status==="Waiting"?"bg-blue-500/10 border-blue-500/20 rounded-xl p-4 md:p-5 border text-blue-900 dark:text-blue-100 shadow-sm relative overflow-hidden group":t.status==="Resolved"?"bg-green-500/10 border-green-500/20 rounded-xl p-4 md:p-5 border text-green-900 dark:text-green-100 shadow-sm relative overflow-hidden group":t.status==="Rejected"?"bg-red-500/10 border-red-500/20 rounded-xl p-4 md:p-5 border text-red-900 dark:text-red-100 shadow-sm relative overflow-hidden group":"bg-gray-500/10 border-gray-500/20 rounded-xl p-4 md:p-5 border text-gray-900 dark:text-gray-100 shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-${o(t.status)}-500/5 rounded-full -mr-16 -mt-16 group-hover:scale-110 transition-transform`}),e.jsx("h4",{className:`text-[11px] font-black uppercase tracking-[0.2em] mb-3 text-${o(t.status)}-600 dark:text-${o(t.status)}-500`,children:"Official Support Resolution"}),e.jsx("p",{className:"text-sm leading-relaxed mb-4 font-medium",children:t.feedback||"In Progress - Awaiting final resolution."}),e.jsxs("div",{className:`flex items-center justify-between pt-3 border-t border-${o(t.status)}-500/10 text-[10px] uppercase font-bold tracking-wider`,children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(w,{className:"h-3 w-3"}),((b=t.feedbackby)==null?void 0:b.name)||"Assigned Agent"]}),t.feedback_date&&e.jsxs("span",{children:["Resolved at: ",new Date(t.feedback_date).toLocaleDateString()]})]})]}),e.jsx("div",{className:"pt-1",children:e.jsx(q,{helpDeskId:t.id,status:t.status})})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 opacity-40",children:[e.jsx("div",{className:"w-24 h-24 bg-muted rounded-full flex items-center justify-center mb-6",children:e.jsx(w,{className:"h-12 w-12"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Your Conversations"}),e.jsx("p",{className:"text-sm text-center max-w-[300px]",children:"Select a ticket from the left sidebar to view the details and start chatting with support."})]})})]})]})}export{ke as default};
