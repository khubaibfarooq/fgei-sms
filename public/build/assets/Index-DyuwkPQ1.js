import{r as l,j as e,L as B,$ as k,S as o,a as C}from"./app-Ckd00XjB.js";import{A as F,P as H,S as I,e as R,T as K,c as D}from"./app-layout-Dp-QZCwA.js";import{B as r}from"./button-DN_423EJ.js";import{C as g,a as u,b as X,c as p}from"./card-Bfsm_5HH.js";import{I as q}from"./input-DREULnrk.js";import{A as V,a as G,b as J,c as O,d as Q,e as U,f as W,g as Y,h as Z}from"./alert-dialog-Dwrb7hrf.js";import{X as ee,C as te,e as se,t as j}from"./index-Cr4Z16Jw.js";import{T as ae,a as le,b as A,c as P}from"./tabs-DK5Mavol.js";import{B as n}from"./badge-DPoclSiK.js";import"./index-C3MGCd83.js";import"./createLucideIcon-CImEr1Cq.js";import"./index-CN9Vo_2d.js";import"./index-BQq7n3OH.js";import"./app-logo-icon-PGaPTxAU.js";import"./folder-root-BQwvl7Sg.js";import"./grip-vertical--mq8m-37.js";const re=[{title:"Projects",href:"/projects"}];function ye({projects:d,filters:i,permissions:x}){var S;const[m,T]=l.useState(i.search||""),[L,_]=l.useState(i.status||""),[a,h]=l.useState(null),[f,v]=l.useState([]),[N,b]=l.useState([]),[y,w]=l.useState(!1),z=t=>{o.delete(`/projects/${t}`,{onSuccess:()=>j.success("Project deleted successfully"),onError:()=>j.error("Failed to delete project")})},$=t=>{t.key==="Enter"&&o.get("/projects",{...i,search:m},{preserveScroll:!0})},E=t=>{const s=t.target.value;_(s),M({search:m,status:s})},M=t=>{o.get("/projects",{...i,...t},{preserveScroll:!0,preserveState:!0,replace:!0,only:["projects","filters"]})};return l.useEffect(()=>{a?(w(!0),(async()=>{try{const[s,c]=await Promise.all([C.get(`/projects/${a.id}/history`),C.get(`/projects/${a.id}/milestones`)]);v(s.data),b(c.data)}catch(s){console.error("Failed to fetch project details",s),j.error("Failed to load project details.")}finally{w(!1)}})()):(v([]),b([]))},[a]),e.jsxs(F,{breadcrumbs:re,children:[e.jsx(B,{title:"Project Management"}),e.jsxs("div",{className:"flex flex-col lg:flex-row h-[calc(100vh-65px)] overflow-hidden",children:[e.jsx("div",{className:`flex-1 p-4 md:p-6 overflow-y-auto ${a?"lg:w-2/3":"w-full"}`,children:e.jsxs(g,{className:"h-full flex flex-col",children:[e.jsxs(u,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shrink-0",children:[e.jsxs("div",{children:[e.jsx(X,{className:"text-2xl font-bold",children:"Projects"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-md lg:text-lg",children:"Manage institutional projects"})]}),x.can_add&&e.jsx(k,{href:"/projects/create",children:e.jsxs(r,{children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Add Project"]})})]}),e.jsx(I,{}),e.jsxs(p,{className:"pt-6 space-y-6 flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 shrink-0",children:[e.jsx(q,{type:"text",placeholder:"Search projects... (press Enter)",value:m,onChange:t=>T(t.target.value),onKeyDown:$}),e.jsxs("select",{value:L,onChange:E,className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"inprogress",children:"InProgress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"planned",children:"Planned"})]})]}),e.jsx("div",{className:"space-y-3 flex-1 overflow-auto",children:e.jsxs("table",{className:"w-full border-collapse border-1 rounded-md overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800 text-center",children:[e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Name"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Budget"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Priority"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Status"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Stage"}),e.jsx("th",{className:"border p-2 text-sm md:text-md lg:text-lg font-medium text-white dark:text-gray-200",children:"Action"})]})}),e.jsx("tbody",{children:d.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-muted-foreground text-center p-4",children:"No projects found."})}):d.data.map(t=>e.jsxs("tr",{className:`hover:bg-primary/10 dark:hover:bg-gray-700 text-center cursor-pointer transition-colors ${(a==null?void 0:a.id)===t.id?"bg-primary/5 dark:bg-gray-700 border-l-4 border-l-primary":""}`,onClick:()=>h(t),children:[e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.budget}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:t.priority||"-"}),e.jsxs("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:[t.overall_status,e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",t.status,")"]})]}),e.jsx("td",{className:"border  text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",children:"Draft"}),e.jsxs("td",{className:"border text-sm md:text-md lg:text-lg text-gray-900 dark:text-gray-100",onClick:s=>s.stopPropagation(),children:[x.can_edit&&e.jsx(k,{href:`/projects/${t.id}/edit`,children:e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(R,{className:"h-4 w-4"})})}),x.can_delete&&e.jsxs(V,{children:[e.jsx(G,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"icon",className:"text-destructive hover:text-red-600",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsxs(J,{children:[e.jsxs(O,{children:[e.jsx(Q,{children:"Delete this project?"}),e.jsxs(U,{children:["Project ",e.jsx("strong",{children:t.name})," will be permanently deleted."]})]}),e.jsxs(W,{children:[e.jsx(Y,{children:"Cancel"}),e.jsx(Z,{className:"bg-destructive hover:bg-destructive/90",onClick:()=>z(t.id),children:"Delete"})]})]})]})]})]},t.id))})]})}),d.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2 shrink-0",children:d.links.map((t,s)=>e.jsx(r,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>o.visit(t.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},s))})]})]})}),a&&e.jsxs("div",{className:"w-full lg:w-1/3 border-l bg-background p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col h-full transition-all duration-300 ease-in-out z-20 absolute lg:relative right-0 top-0 lg:top-auto bottom-0 lg:bottom-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(S=a.institute)==null?void 0:S.name})]}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>h(null),children:e.jsx(ee,{className:"h-5 w-5"})})]}),e.jsxs(ae,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs(le,{className:"grid w-full grid-cols-2",children:[e.jsx(A,{value:"approvals",children:"Approvals"}),e.jsx(A,{value:"milestones",children:"Milestones"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(P,{value:"approvals",className:"space-y-4 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading history..."}):f.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No approval history found."}):e.jsx("div",{className:"space-y-4",children:f.map(t=>{var s,c;return e.jsxs(g,{className:"overflow-hidden",children:[e.jsx(u,{className:"p-3 bg-muted/50 pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"font-semibold text-sm",children:((s=t.stage)==null?void 0:s.stage_name)||"Stage"}),t.status==="approved"?e.jsxs(n,{variant:"outline",className:"border-green-500 text-green-600 bg-green-50 gap-1",children:[e.jsx(te,{className:"w-3 h-3"})," Approved"]}):t.status==="rejected"?e.jsxs(n,{variant:"outline",className:"border-red-500 text-red-600 bg-red-50 gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Rejected"]}):e.jsxs(n,{variant:"outline",className:"border-yellow-500 text-yellow-600 bg-yellow-50 gap-1",children:[e.jsx(D,{className:"w-3 h-3"})," Pending"]})]})}),e.jsxs(p,{className:"p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mb-2",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),new Date(t.action_date).toLocaleString()]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-medium text-xs",children:"Approver: "}),(c=t.approver)==null?void 0:c.name]}),t.comments&&e.jsxs("div",{className:"bg-muted/30 p-2 rounded text-xs italic border",children:['"',t.comments,'"']})]})]},t.id)})})}),e.jsx(P,{value:"milestones",className:"space-y-4 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading milestones..."}):N.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No milestones found."}):e.jsx("div",{className:"space-y-4",children:N.map(t=>e.jsxs(g,{children:[e.jsx(u,{className:"p-3 pb-1",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.name}),e.jsx(n,{variant:t.status==="completed"?"default":t.status==="inprogress"?"secondary":"outline",className:"capitalize text-xs",children:t.status})]})}),e.jsxs(p,{className:"p-3 text-sm space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Due: "}),new Date(t.due_date).toLocaleDateString()]}),t.completed_date&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Completed: "}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:new Date(t.completed_date).toLocaleDateString()})]})]}),t.description&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:t.description})]})]},t.id))})})]})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/20 lg:hidden z-10",onClick:()=>h(null)})]})}export{ye as default};
