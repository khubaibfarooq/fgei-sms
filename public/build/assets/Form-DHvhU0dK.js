import{r as o,m as $,j as e,L as A,$ as D,S as _}from"./app-ADzG2rYI.js";import{A as k,S as L,P as T,T as B,a as O,d as F}from"./app-layout-DZt2u7OW.js";import{B as j}from"./button-DVIKrKFu.js";import{C as P,a as Q,b as K,c as z}from"./card-91XOs0eZ.js";import{I as y}from"./input-CBvVQk42.js";import{L as N}from"./label-Bez7oWko.js";import{C as b}from"./combobox-D6--8dHt.js";import"./index-DfwguSXO.js";import"./createLucideIcon-08-ykCjm.js";import"./index-BOETULnM.js";import"./index-DzLZkUaf.js";import"./index-pi1xt5vr.js";import"./index-B_Vx2enh.js";import"./index-CAHOQswZ.js";import"./app-logo-icon-BSvNkE0z.js";import"./circle-x-POrcJP5b.js";import"./folder-root-CIb7lu_d.js";import"./grip-vertical-Dcp5-4rb.js";import"./popover-BUnlqGTv.js";function oe({instituteAsset:i,assets:S,rooms:w}){const l=!!i,[m,C]=o.useState((i==null?void 0:i.room_id)||""),[u,E]=o.useState((i==null?void 0:i.added_date)||new Date().toISOString().split("T")[0]),[d,p]=o.useState(l?[{id:"1",asset_id:i.asset_id,current_qty:i.current_qty,details:i.details}]:[]),{processing:v}=$({room_id:m,added_date:u,assets:[]}),[r,h]=o.useState({}),x=o.useRef(null),g=()=>{const t=Date.now().toString(),s={id:t,asset_id:"",current_qty:"",details:""};p([...d,s]),x.current=t};o.useEffect(()=>{x.current&&setTimeout(()=>{const t=document.querySelector(`[data-row-id="${x.current}"] button[role="combobox"]`);t&&t.click(),x.current=null},50)},[d]);const q=t=>{p(d.filter(s=>s.id!==t))},f=(t,s,a)=>{p(d.map(n=>n.id===t?{...n,[s]:a}:n))};o.useEffect(()=>{const t=s=>{s.shiftKey&&s.key==="Enter"&&(s.preventDefault(),g())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[d]);const I=t=>{t.preventDefault();const s={};if(m||(s.room_id="Room is required"),u||(s.added_date="Date is required"),d.length===0&&(s.assets="Please add at least one asset"),d.forEach((n,c)=>{n.asset_id||(s[`assets.${c}.asset_id`]="Asset is required"),n.current_qty||(s[`assets.${c}.current_qty`]="Quantity is required"),n.details||(s[`assets.${c}.details`]="Description is required")}),Object.keys(s).length>0){h(s);return}h({});const a={room_id:m,added_date:u,assets:d.map(({id:n,...c})=>c)};l?_.put(`/institute-assets/${i.id}`,{...a,asset_id:d[0].asset_id,current_qty:d[0].current_qty,details:d[0].details},{preserveScroll:!0,preserveState:!0}):_.post("/institute-assets",a,{onSuccess:()=>{p([]),h({})},onError:n=>{h(n)}})},R=[{title:"Institute Assets",href:"/institute-assets"},{title:l?"Edit Asset":"Add Asset",href:"#"}];return e.jsxs(k,{breadcrumbs:R,children:[e.jsx(A,{title:l?"Edit Institute Asset":"Add Institute Asset"}),e.jsx("div",{className:"flex-1 p-4 md:p-6 w-[80vw] mx-auto",children:e.jsxs(P,{children:[e.jsxs(Q,{children:[e.jsx(K,{className:"text-2xl font-bold",children:l?"Edit Institute Asset":"Add Institute Asset"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l?"Edit institute asset details":"Add new assets to institute inventory"})]}),e.jsx(L,{}),e.jsx(z,{className:"pt-6",children:e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"room_id",children:"Room"}),e.jsx(b,{entity:"room",value:m.toString(),onChange:t=>C(t?parseInt(t):""),options:w.map(t=>({id:t.id.toString(),name:t.name+(t.block?` (${t.block.name})`:"")+(t.type?` - ${t.type.name}`:"")})),includeAllOption:!1}),r.room_id&&e.jsx("p",{className:"text-sm text-destructive",children:r.room_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"added_date",children:"Added Date"}),e.jsx(y,{id:"added_date",type:"date",value:u,onChange:t=>E(t.target.value)}),r.added_date&&e.jsx("p",{className:"text-sm text-destructive",children:r.added_date})]}),e.jsx("div",{children:e.jsxs(j,{type:"button",onClick:g,className:"w-full",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Add Row (Shit+ Entr)"]})})]}),r.assets&&e.jsx("p",{className:"text-sm text-destructive",children:r.assets}),d.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-primary text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left font-medium",children:"Asset"}),e.jsx("th",{className:"p-3 text-left font-medium w-32",children:"Quantity"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Description"}),e.jsx("th",{className:"p-3 text-center font-medium w-20",children:"Actions"})]})}),e.jsx("tbody",{children:d.map((t,s)=>e.jsxs("tr",{"data-row-id":t.id,className:"border-t hover:bg-muted/50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx(b,{entity:"asset",value:t.asset_id.toString(),onChange:a=>f(t.id,"asset_id",a?parseInt(a):""),options:S.map(a=>({id:a.id.toString(),name:a.name+(a.category?` (${a.category.name})`:"")})),includeAllOption:!1}),r[`assets.${s}.asset_id`]&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r[`assets.${s}.asset_id`]})]}),e.jsxs("td",{className:"p-3",children:[e.jsx(y,{type:"number",min:"1",value:t.current_qty,onChange:a=>f(t.id,"current_qty",a.target.value?parseInt(a.target.value):""),placeholder:"Qty"}),r[`assets.${s}.current_qty`]&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r[`assets.${s}.current_qty`]})]}),e.jsxs("td",{className:"p-3",children:[e.jsx(y,{type:"text",value:t.details,onChange:a=>f(t.id,"details",a.target.value),placeholder:"Enter description"}),r[`assets.${s}.details`]&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r[`assets.${s}.details`]})]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(j,{type:"button",variant:"ghost",size:"icon",onClick:()=>q(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(B,{className:"h-4 w-4"})})})]},t.id))})]})}),d.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:e.jsx("p",{children:'No assets added yet. Click "Add Row" to start adding assets.'})}),e.jsxs("div",{className:"flex items-center justify-between pt-6",children:[e.jsx(D,{href:"/institute-assets",children:e.jsxs(j,{type:"button",variant:"secondary",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Back"]})}),e.jsxs(j,{type:"submit",disabled:v||d.length===0,children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),v?"Saving...":l?"Save Changes":"Save Assets"]})]})]})})]})})]})}export{oe as default};
