var Us=Object.defineProperty;var Hs=(o,m,u)=>m in o?Us(o,m,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[m]=u;var Qe=(o,m,u)=>Hs(o,typeof m!="symbol"?m+"":m,u);import{r,K as Vs,j as e,L as Bs,$ as Ze,a as w,S as es}from"./app-C9WfztRQ.js";import{A as Gs,E as ss,P as ts,c as as,d as ie,F as we,e as Ws}from"./app-layout-CNt0W_av.js";import{B as n}from"./button-BE3Ce_uu.js";import{C as b,a as F,b as qs,c as v,d as rs}from"./card-V3z29RNA.js";import{I as Ce}from"./input-CSUp1zuz.js";import{T as Se}from"./textarea-WENuIkkJ.js";import{S as ls,a as ns,b as is,c as os,d as A}from"./select-BMb4jG8_.js";import{C as Xs}from"./checkbox-BgbfLBJZ.js";import{t as x,X as _e,D as T,a as U,b as H,c as V,d as B,e as G}from"./index-DutATmo1.js";import{l as Js}from"./lodash-DXmgeYyq.js";import{E as Ks,F as Ys,a as Qs,b as Zs}from"./jspdf.plugin.autotable-Cv2tKiuc.js";import{C as ds}from"./combobox-BIoQ7wiN.js";import{T as cs,a as xs,b as C,c as S}from"./tabs-DDzXrQyI.js";import{B as N}from"./badge-Dgrp1fHH.js";import et from"./ApprovalModal-B8LVX9kt.js";import st from"./FundHeadSelectModal-DLahYY-1.js";import{I as z}from"./image-preview2-D6MZLaCq.js";import{L as $}from"./label-C68lnttW.js";import{C as ms,a as ps}from"./circle-x-C0CNvp1w.js";import"./index-CHuj_ucu.js";import"./createLucideIcon-hOREz1eM.js";import"./index-CIbTaAjT.js";import"./index-PNEdSGI_.js";import"./index-Cv3LwmfU.js";import"./index-C9PI5Fkl.js";import"./app-logo-icon-Q1OROyQ7.js";import"./clsx-B-dksMZM.js";import"./folder-root-DK_zX2zN.js";import"./grip-vertical-B_VOs2p8.js";import"./index-iPh0D4is.js";import"./index-BlxcDTth.js";import"./popover-26mO5ywa.js";const tt=[{title:"Reports",href:"/reports"},{title:"Projects",href:"/reports/projects"}],_=o=>{if(o==null)return"-";const m=typeof o=="string"?parseFloat(o):o;return isNaN(m)?"-":m>=1e6?`${(m/1e6).toFixed(2)} Mn`:m.toLocaleString()};class at extends r.Component{constructor(){super(...arguments);Qe(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(u){return{hasError:!0,error:u.message}}componentDidCatch(u,E){console.error("ErrorBoundary caught:",u,E),x.error("An error occurred. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(n,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const Pe=o=>{const m=o!=null&&typeof o.id=="number"&&o.id>0&&typeof o.name=="string"&&o.name.trim()!=="";return m||console.warn("Invalid item:",o),m};function Mt({projects:o,institutes:m,regions:u,projectTypes:E,fundHeads:hs,filters:M}){var Je,Ke,Ye;const[oe,rt]=r.useState(M.search||""),[P,de]=r.useState(M.institute_id||""),[W,us]=r.useState(M.project_type_id||""),[q,gs]=r.useState(M.status||""),[k,ce]=r.useState(o),[xe,me]=r.useState(m||[]);r.useEffect(()=>{ce(o)},[o]),r.useEffect(()=>{if(l){const s=k.data.find(t=>t.id===l.id);s&&I(s)}},[k]);const[X,fs]=r.useState(M.region_id||""),{auth:js}=Vs().props,g=js.user,pe=s=>{var h,j;const t=(h=s.current_stage)==null?void 0:h.level,a=s.approval_status;if(!t)return!1;const i=(g.roles[0].name||"").toLowerCase(),c=t.toLowerCase(),p=((j=s.current_stage)==null?void 0:j.users_can_approve)??"";return console.log(p),console.log(g.id),!!(c==="regional"&&i==="region"&&a!=="approved"||c==="dte"&&(i==="dirhrm"||i==="directorate"||i==="sms_tech_approval")&&a!=="approved"&&p.includes(g.id))},[Ns,he]=r.useState(!1),[bs,ke]=r.useState(null),[vs,ue]=r.useState(!1),[ys,Fe]=r.useState(null),[l,I]=r.useState(null),[J,Ae]=r.useState([]),[K,Ie]=r.useState([]),[Y,Re]=r.useState([]),[Q,Z]=r.useState([]),[y,De]=r.useState(!1),[ws,ee]=r.useState(!1),[f,se]=r.useState({desc:"",date:"",image:null}),[Le,ze]=r.useState(!1),[Cs,te]=r.useState(!1),[O,Ss]=r.useState(null),[R,$e]=r.useState(""),[Ee,Me]=r.useState(!1),[_s,ae]=r.useState(!1),[D,Oe]=r.useState(null),[ge,Ps]=r.useState(!1),[ks,re]=r.useState(!1),[Te,Fs]=r.useState(null),[fe,Ue]=r.useState(""),[je,Ne]=r.useState(!1),[As,le]=r.useState(!1),[He,Is]=r.useState(null),[be,Ve]=r.useState(""),[ve,ye]=r.useState(!1),Rs=r.useMemo(()=>Array.isArray(xe)?xe.filter(Pe):[],[xe]),Be=r.useMemo(()=>Array.isArray(u)?u.filter(Pe):[],[u]),Ds=r.useMemo(()=>Array.isArray(E)?E.filter(Pe):[],[E]),ne=r.useMemo(()=>ge?k.data.filter(s=>pe(s)):k.data,[k.data,ge,g]);r.useEffect(()=>{l?(De(!0),(async()=>{try{const[t,a,i,c]=await Promise.all([w.get(`/projects/${l.id}/history`),w.get(`/projects/${l.id}/milestones`),w.get(`/projects/${l.id}/payments`),w.get(`/projects/${l.id}/images`)]);Ae(t.data),Ie(a.data),Re(i.data.payments),Z(c.data)}catch(t){console.error("Failed to fetch project details",t),x.error("Failed to load project details.")}finally{De(!1)}})()):(Ae([]),Ie([]),Re([]),Z([]))},[l]);const Ls=async s=>{if(!s||s==="0"){me(m||[]),P&&de("");return}try{const t=new URLSearchParams({region_id:s}).toString(),a=await fetch(`/reports/getInstitutes?${t}`);if(!a.ok)throw new Error("Failed to fetch institutes");const i=await a.json();me(i),P&&!i.some(c=>c.id.toString()===P)&&de("")}catch(t){console.error("Error fetching institutes:",t),x.error("Failed to load institutes"),me([])}},zs=s=>{fs(s),Ls(s)},Ge=s=>{Ss(s),$e(parseFloat((s.completion_per||0).toString()).toString()),te(!0)},$s=async()=>{var t,a;if(!O)return;const s=parseFloat(R);if(isNaN(s)||s<0||s>100){x.error("Please enter a valid percentage (0-100)");return}Me(!0);try{const i=await w.post(`/projects/${O.id}/update-completion`,{completion_per:s});i.data.success?(x.success("Completion percentage updated successfully"),te(!1),L()):x.error(i.data.message||"Failed to update")}catch(i){x.error(((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update completion percentage")}finally{Me(!1)}},We=async()=>{const s=new URLSearchParams({search:oe.trim(),institute_id:P||"",region_id:X||"",project_type_id:W||"",status:q||"",export:"true"});try{const t=await fetch(`/reports/projects/getprojects?${s.toString()}`);if(!t.ok)throw new Error("Failed to fetch projects");const a=await t.json();return Array.isArray(a)?a:a.data}catch(t){return console.error(t),x.error("Failed to fetch all projects for export"),[]}},Es=async()=>{const s=await We();if(!s||s.length===0){x.warning("No projects to export");return}const t=new Ks.Workbook,a=t.addWorksheet("Projects");a.columns=[{header:"Name",key:"name",width:30},{header:"Cost",key:"cost",width:15},{header:"Actual Cost",key:"actual_cost",width:15},{header:"Status",key:"status",width:15},{header:"Project Type",key:"project_type",width:25},{header:"Institute",key:"institute",width:30}],s.forEach(p=>{var h,j;a.addRow({name:p.name,cost:_(p.estimated_cost),actual_cost:_(p.actual_cost),status:p.status,project_type:((h=p.projecttype)==null?void 0:h.name)||"N/A",institute:((j=p.institute)==null?void 0:j.name)||"N/A"})});const i=await t.xlsx.writeBuffer(),c=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ys.saveAs(c,"Projects_Report.xlsx")},Ms=async()=>{const s=await We();if(!s||s.length===0){x.warning("No projects to export");return}const t=new Qs;t.setFontSize(16),t.text("Projects Report",14,15);const a=["Name","Estimated Cost","Actual Cost","Status","Project Type","Institute"],i=s.map(c=>{var p,h;return[c.name,_(c.estimated_cost),_(c.actual_cost),c.status,((p=c.projecttype)==null?void 0:p.name)||"N/A",((h=c.institute)==null?void 0:h.name)||"N/A"]});Zs(t,{head:[a],body:i,startY:25,styles:{fontSize:9,cellPadding:2},headStyles:{fillColor:[66,139,202],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]}}),t.save("Projects_Report.pdf")},qe=s=>{Fs(s),Ue(""),re(!0)},Os=()=>{if(Te){if(!fe.trim()){x.error("Please provide a reason for rejection.");return}confirm("Are you sure you want to reject this project?")&&(Ne(!0),es.post(`/projects/${Te.id}/reject`,{reason:fe},{onSuccess:()=>{x.success("Project rejected successfully"),Ne(!1),re(!1),L()},onError:()=>{x.error("Failed to reject project"),Ne(!1)}}))}},Ts=()=>{if(He){if(!be.trim()){x.error("Please provide a reason for initiation.");return}confirm("Are you sure you want to initiate this project?")&&(ye(!0),es.post(`/projects/${He.id}/initiate`,{reason:be},{onSuccess:()=>{x.success("Project initiated successfully"),ye(!1),le(!1),L()},onError:()=>{x.error("Failed to initiate project"),ye(!1)}}))}},Xe=s=>{Is(s),Ve(""),le(!0)},L=r.useMemo(()=>Js.debounce(()=>{const s=new URLSearchParams({search:oe.trim(),institute_id:P||"",region_id:X||"",project_type_id:W||"",status:q||""});fetch(`/reports/projects/getprojects?${s.toString()}`).then(t=>t.json()).then(t=>{console.log("Filtered projects:",t),ce(t)}).catch(t=>{console.error("Fetch error:",t),x.error("Failed to load projects")})},300),[oe,P,X,W,q]);return e.jsx(at,{children:e.jsxs(Gs,{breadcrumbs:tt,children:[e.jsx(Bs,{title:"Projects Report"}),e.jsxs("div",{className:"flex flex-col lg:flex-row h-[calc(100vh-65px)] overflow-hidden",children:[e.jsx("div",{className:"flex-1 p-2 md:p-4 overflow-y-auto w-full min-w-0",children:e.jsxs(b,{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs(F,{className:"p-1.5 pb-0 shrink-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-1",children:e.jsx(qs,{className:"text-base font-bold",children:"Projects Report"})}),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 ${l?"xl:grid-cols-2 2xl:grid-cols-4":"lg:grid-cols-4"} gap-1.5`,children:[Be.length>0&&e.jsx("div",{className:"w-full",children:e.jsx(ds,{entity:"region",value:X,onChange:s=>zs(s),options:Be.map(s=>({id:s.id.toString(),name:s.name.split(" ").pop()||s.name})),includeAllOption:!0})}),e.jsx("div",{className:"w-full",children:e.jsx(ds,{entity:"institute",value:P,onChange:de,options:Rs.map(s=>({id:s.id.toString(),name:s.name})),includeAllOption:!1,placeholder:"Select Institute"})}),e.jsx("div",{className:"w-full",children:e.jsxs(ls,{value:W,onValueChange:s=>us(s),children:[e.jsx(ns,{className:"h-7 text-xs",children:e.jsx(is,{placeholder:"Select Project Type"})}),e.jsxs(os,{children:[e.jsx(A,{value:"0",children:"All Project Types"}),Ds.map(s=>e.jsx(A,{value:s.id.toString(),children:s.name},s.id))]})]})}),e.jsx("div",{className:"w-full",children:e.jsxs(ls,{value:q,onValueChange:s=>gs(s),children:[e.jsx(ns,{className:"h-7 text-xs",children:e.jsx(is,{placeholder:"Select Status"})}),e.jsxs(os,{children:[e.jsx(A,{value:"all",children:"All Status"}),e.jsx(A,{value:"planned",children:"Planned"}),e.jsx(A,{value:"inprogress",children:"In Progress"}),e.jsx(A,{value:"completed",children:"Completed"}),e.jsx(A,{value:"waiting",children:"Waiting"})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center pt-1.5 pb-1.5 border-b",children:[e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx(Xs,{checked:ge,onCheckedChange:s=>Ps(s===!0),className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-[11px] font-medium uppercase tracking-tight text-muted-foreground",children:"Need Approval"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(n,{onClick:L,size:"sm",className:"h-7 text-xs px-2",children:"Apply Filters"}),e.jsx(n,{onClick:Ms,size:"sm",variant:"outline",className:"h-7 text-xs px-2",children:"PDF"}),e.jsx(n,{onClick:Es,size:"sm",variant:"outline",className:"h-7 text-xs px-2",children:"Excel"})]})]})]}),e.jsxs(v,{className:"p-0 flex-1 overflow-auto bg-muted/5 relative",children:[e.jsx("div",{className:"hidden md:block h-full",children:e.jsxs("table",{className:"w-full border-collapse text-sm min-w-[900px]",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-primary text-white text-center shadow-sm text-xs",children:[e.jsx("th",{className:"border p-1.5 font-medium",children:"Institute"}),e.jsx("th",{className:"border p-1.5 font-medium hidden xl:table-cell",children:"Type"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Project"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Est. Cost"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Act. Cost"}),e.jsx("th",{className:"border p-1.5 font-medium hidden xl:table-cell",children:"Fund Head"}),e.jsx("th",{className:"border p-1.5 font-medium hidden xl:table-cell",children:"Stage"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Approval Status"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Project Status"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Progress"}),e.jsx("th",{className:"border p-1.5 font-medium hidden xl:table-cell",children:"Comments"}),e.jsx("th",{className:"border p-1.5 font-medium",children:"Action"})]})}),e.jsx("tbody",{children:ne.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center p-4 text-muted-foreground",children:"No projects found."})}):ne.map(s=>{var t,a,i,c,p,h,j;return e.jsxs("tr",{className:`hover:bg-primary/10 dark:hover:bg-gray-700 cursor-pointer transition-colors border-b text-xs ${(l==null?void 0:l.id)===s.id?"bg-primary/5 dark:bg-gray-700 border-l-4 border-l-primary":"bg-card"}`,onClick:()=>I(s),children:[e.jsx("td",{className:"border p-1.5 text-center",children:((t=s.institute)==null?void 0:t.name)||"-"}),e.jsx("td",{className:"border p-1.5 text-center hidden xl:table-cell",children:((a=s.projecttype)==null?void 0:a.name)||"-"}),e.jsx("td",{className:"border p-1.5 font-medium",children:e.jsx(Ze,{href:`/projects/${s.id}/details`,className:"text-blue-600 hover:text-blue-800 hover:underline font-medium",onClick:d=>d.stopPropagation(),children:s.name})}),e.jsx("td",{className:"border p-1.5 text-right whitespace-nowrap",children:_(s.estimated_cost)}),e.jsx("td",{className:"border p-1.5 text-right whitespace-nowrap",children:_(s.actual_cost)}),e.jsx("td",{className:"border p-1.5 text-center hidden xl:table-cell",children:(i=s.fundhead)==null?void 0:i.name}),e.jsx("td",{className:"border p-1.5 text-center hidden xl:table-cell",children:((c=s.current_stage)==null?void 0:c.stage_name)||"Request Initiated"}),e.jsx("td",{className:"border p-1.5 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-tight ${s.approval_status==="completed"?"bg-green-100 text-green-800":s.approval_status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.approval_status.charAt(0).toUpperCase()+s.approval_status.slice(1)})}),e.jsx("td",{className:"border p-1.5 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-tight ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})}),e.jsx("td",{className:"border p-1.5 text-center",children:e.jsx("span",{className:"text-xs",children:s.completion_per?parseFloat(s.completion_per.toString()):"-"})}),e.jsx("td",{className:"border p-1.5 text-center hidden xl:table-cell",children:s.final_comments||"-"}),e.jsx("td",{className:"border p-1.5 text-center",onClick:d=>d.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.description&&e.jsx(n,{variant:"ghost",size:"sm",className:"text-blue-600 hover:text-blue-700",title:"View Description",onClick:()=>{Oe(s),ae(!0)},children:e.jsx(ss,{className:"h-4 w-4"})}),s.pdf&&e.jsx("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center text-blue-600 hover:text-blue-700",title:"View PDF",children:"PDF"}),pe(s)&&e.jsx(n,{variant:"ghost",size:"icon",title:"View/Approve",className:"text-blue-600 hover:text-blue-700",onClick:d=>{d.stopPropagation(),ke(s),he(!0)},children:e.jsx(rs,{className:"h-4 w-4"})}),((p=g.roles[0])==null?void 0:p.name.toLowerCase())==="region"&&!s.fund_head_id&&s.status!=="rejected"&&e.jsx(n,{variant:"ghost",size:"sm",title:"Select Fund Head",className:"text-orange-600 hover:text-orange-700 font-bold",onClick:d=>{d.stopPropagation(),Fe(s),ue(!0)},children:"Select Head"}),((h=g.roles[0])==null?void 0:h.name.toLowerCase())==="region"&&!s.fund_head_id&&s.status!=="rejected"&&e.jsx(n,{variant:"ghost",size:"sm",title:"Reject Project",className:"text-red-600 hover:text-red-700 font-bold",onClick:d=>{d.stopPropagation(),qe(s)},children:"Reject"}),((j=g.roles[0])==null?void 0:j.name.toLowerCase())==="region"&&!s.fund_head_id&&s.status==="rejected"&&e.jsx(n,{variant:"ghost",size:"sm",title:"Initiate Project",className:"text-green-600 hover:text-green-700 font-bold",onClick:d=>{d.stopPropagation(),Xe(s)},children:"Re-Initiate"}),g.type==="Regional Office"&&s.status==="inprogress"&&e.jsx(n,{variant:"ghost",size:"icon",title:`Update Completion (${s.completion_per||0}%)`,className:"text-purple-600 hover:text-purple-700",onClick:d=>{d.stopPropagation(),Ge(s)},children:e.jsx(ts,{className:"h-4 w-4"})})]})})]},s.id)})})]})}),e.jsx("div",{className:"md:hidden space-y-2 p-2 bg-muted/5",children:ne.length===0?e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:"No projects found."}):e.jsx("div",{className:"space-y-2",children:ne.map(s=>{var t,a,i,c,p,h,j;return e.jsxs("div",{className:`p-2 rounded-lg border bg-card shadow-sm cursor-pointer transition-all hover:shadow-md ${(l==null?void 0:l.id)===s.id?"ring-2 ring-primary":""}`,onClick:()=>I(s),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Ze,{href:`/projects/${s.id}/details`,className:"text-blue-600 hover:text-blue-800 hover:underline",onClick:d=>d.stopPropagation(),children:e.jsx("h3",{className:"font-semibold text-sm",children:s.name})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:((t=s.institute)==null?void 0:t.name)||"-"})]}),e.jsxs("div",{className:"flex gap-1",onClick:d=>d.stopPropagation(),children:[s.description&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7 text-blue-600",onClick:()=>{Oe(s),ae(!0)},children:e.jsx(ss,{className:"h-4 w-4"})}),s.pdf&&e.jsx("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center h-7 w-7 text-blue-600 hover:text-blue-700",children:"PDF"}),pe(s)&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7 text-blue-600",onClick:()=>{ke(s),he(!0)},children:e.jsx(rs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-4 text-xs mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Est: "}),e.jsx("span",{className:"font-medium",children:_(s.estimated_cost)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Act: "}),e.jsx("span",{className:"font-medium",children:_(s.actual_cost)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.approval_status==="completed"?"bg-green-100 text-green-800":s.approval_status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:["App: ",s.approval_status.charAt(0).toUpperCase()+s.approval_status.slice(1)]}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="inprogress"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:["Proj: ",s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.completion_per?parseFloat(s.completion_per.toString()):"-","%"]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t flex flex-wrap gap-2 text-xs text-muted-foreground",children:[((a=s.projecttype)==null?void 0:a.name)&&e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:s.projecttype.name}),((i=s.fundhead)==null?void 0:i.name)&&e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:s.fundhead.name}),e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:((c=s.current_stage)==null?void 0:c.stage_name)||"Request Initiated"})]}),e.jsxs("div",{className:"mt-2 flex gap-2",onClick:d=>d.stopPropagation(),children:[((p=g.roles[0])==null?void 0:p.name.toLowerCase())==="region"&&!s.fund_head_id&&e.jsx(n,{variant:"outline",size:"sm",className:"text-[10px] h-6 text-orange-600 border-orange-300 px-2",onClick:()=>{Fe(s),ue(!0)},children:"Select Head"})," ",((h=g.roles[0])==null?void 0:h.name.toLowerCase())==="region"&&!s.fund_head_id&&s.status!=="rejected"&&e.jsx(n,{variant:"outline",size:"sm",className:"text-[10px] h-6 text-orange-600 border-orange-300 px-2",onClick:d=>{d.stopPropagation(),qe(s)},children:"Reject"}),((j=g.roles[0])==null?void 0:j.name.toLowerCase())==="region"&&!s.fund_head_id&&s.status==="rejected"&&e.jsx(n,{variant:"outline",size:"sm",className:"text-[10px] h-6 text-green-600 border-green-300 px-2",onClick:d=>{d.stopPropagation(),Xe(s)},children:"Re-Initiate"}),g.type==="Regional Office"&&s.status==="inprogress"&&e.jsxs(n,{variant:"outline",size:"sm",className:"text-[10px] h-6 text-purple-600 border-purple-300 px-2",onClick:()=>Ge(s),children:[e.jsx(ts,{className:"h-3 w-3 mr-1"})," Update"]})]})]},s.id)})})})]}),k.links.length>1&&e.jsx("div",{className:"p-2 border-t flex justify-center flex-wrap gap-1 shrink-0 bg-background",children:k.links.map((s,t)=>e.jsx(n,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",className:"h-8 text-xs px-2",onClick:()=>{s.url&&fetch(s.url).then(a=>a.json()).then(a=>{ce(a)}).catch(a=>{console.error("Error:",a)})},children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t))})]})}),l&&e.jsxs("div",{className:"w-2/3  lg:w-1/3 border-l bg-background p-3 sm:p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col transition-all duration-300 ease-in-out z-20 fixed lg:relative inset-0 lg:inset-auto h-full lg:h-auto rounded-none lg:rounded-l-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:l.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(Je=l.institute)==null?void 0:Je.name})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>I(null),children:e.jsx(_e,{className:"h-5 w-5"})})]}),e.jsxs(cs,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs(xs,{className:"grid w-full grid-cols-4",children:[e.jsx(C,{value:"approvals",children:"Approvals"}),e.jsx(C,{value:"milestones",children:"Milestones"}),e.jsx(C,{value:"payments",children:"Payments"}),e.jsxs(C,{value:"images",className:"flex items-center gap-1",children:[e.jsx(as,{className:"h-3 w-3"})," Images"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(S,{value:"approvals",className:"space-y-4 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading history..."}):J.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No approval history found."}):e.jsx("div",{className:"space-y-4",children:J.map(s=>{var t,a;return e.jsxs(b,{className:"overflow-hidden border shadow-sm",children:[e.jsx(F,{className:"p-2 bg-muted/30 pb-1 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold text-xs",children:((t=s.stage)==null?void 0:t.stage_name)||"Stage"}),s.status==="approved"?e.jsxs(N,{variant:"outline",className:"h-4 border-green-500 text-green-600 bg-green-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(ms,{className:"w-2.5 h-2.5"})," Approved"]}):s.status==="rejected"?e.jsxs(N,{variant:"outline",className:"h-4 border-red-500 text-red-600 bg-red-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(ps,{className:"w-2.5 h-2.5"})," Rejected"]}):e.jsxs(N,{variant:"outline",className:"h-4 border-yellow-500 text-yellow-600 bg-yellow-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(ie,{className:"w-2.5 h-2.5"})," Pending"]})]})}),e.jsxs(v,{className:"p-2 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1 mb-1",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground flex items-center",children:[e.jsx(ie,{className:"w-2.5 h-2.5 mr-1"}),s.action_date?new Date(s.action_date).toLocaleString():""]}),e.jsxs("div",{className:"text-[10px]",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Approved by: "}),e.jsx("span",{className:"font-medium",children:(a=s.approver)==null?void 0:a.name})]})]}),s.comments&&e.jsxs("div",{className:"bg-muted/50 px-2 py-1 rounded text-[10px] italic border mt-1 line-clamp-2",children:['"',s.comments,'"']}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.pdf&&e.jsxs("a",{href:`/${s.pdf}`,target:"_blank",className:"text-blue-600 hover:underline text-[10px] flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"})," PDF"]}),s.img&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{dataImg:s.img,size:"h-4 w-4",className:"rounded border object-cover"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Image"})]})]})]})]},s.id)})})}),e.jsx(S,{value:"milestones",className:"space-y-4 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading milestones..."}):K.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No milestones found."}):e.jsx("div",{className:"space-y-4",children:K.map(s=>e.jsx(b,{className:"border shadow-sm overflow-hidden",children:e.jsxs("div",{className:"flex items-start",children:[s.img&&e.jsx("div",{className:"w-16 h-16 shrink-0",children:e.jsx(z,{dataImg:s.img,size:"h-16 w-16",className:"h-16 w-16 object-cover rounded-none"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(F,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsx("div",{className:"font-semibold text-xs truncate pr-2",children:s.name}),e.jsx(N,{variant:s.status==="completed"?"default":s.status==="inprogress"?"secondary":"outline",className:"capitalize text-[10px] px-1 py-0 h-4 shrink-0",children:s.status})]}),e.jsxs(v,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Due: ",s.days," days"]}),s.completed_date&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Done: ",new Date(s.completed_date).toLocaleDateString()]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-[10px] line-clamp-1",children:s.description}),"    ",s.pdf&&e.jsxs("a",{href:`/assets/${s.pdf}`,target:"_blank",rel:"noopener noreferrer",onClick:t=>t.stopPropagation(),className:"text-blue-600 hover:underline text-[10px] flex items-center gap-1 mt-0.5",children:[e.jsx(we,{className:"h-3 w-3"})," View PDF"]})]})]})]})},s.id))})}),e.jsx(S,{value:"payments",className:"space-y-4 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading payments..."}):Y.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:"No payments found."}):e.jsx("div",{className:"space-y-4",children:Y.map(s=>{var t,a;return e.jsxs(b,{className:"border shadow-sm",children:[e.jsxs(F,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{className:"font-semibold text-xs",children:["Rs. ",s.amount.toLocaleString()]}),e.jsx(N,{variant:"outline",className:`capitalize text-[10px] px-1 py-0 h-4 ${s.status==="Approved"?"border-green-500 text-green-600 bg-green-50":s.status==="Rejected"?"border-red-500 text-red-600 bg-red-50":"border-yellow-500 text-yellow-600 bg-yellow-50"}`,children:s.status})]}),e.jsxs(v,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[e.jsx("div",{className:"text-muted-foreground font-medium truncate max-w-[150px]",title:((t=s.fund_head)==null?void 0:t.name)||"General Fund",children:((a=s.fund_head)==null?void 0:a.name)||"General Fund"}),e.jsx("div",{className:"text-muted-foreground",children:new Date(s.added_date).toLocaleDateString()})]}),s.description&&e.jsxs("p",{className:"text-muted-foreground text-[10px] italic bg-muted/30 px-1.5 py-0.5 rounded truncate",children:['"',s.description,'"']})]})]},s.id)})})}),e.jsx(S,{value:"images",className:"space-y-4 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground",children:"Loading images..."}):e.jsx("div",{className:"space-y-3",children:Q.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed text-xs",children:"No images found."}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Q.map(s=>e.jsxs(b,{className:"overflow-hidden border shadow-sm",children:[e.jsx("div",{className:"relative group",children:e.jsx(z,{dataImg:`assets/${s.image}`,size:"w-full h-24 object-cover"})}),e.jsxs(v,{className:"p-2",children:[s.desc&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 mb-0.5",title:s.desc,children:s.desc}),s.date&&e.jsx("p",{className:"text-[9px] text-muted-foreground block",children:new Date(s.date).toLocaleDateString()})]})]},s.id))})})})]})]})]})]}),e.jsx(T,{open:ks,onOpenChange:re,children:e.jsxs(U,{children:[e.jsxs(H,{children:[e.jsx(V,{children:"Reject Project"}),e.jsx(B,{children:"Please provide a reason for rejecting this project. This action cannot be undone."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"reason",className:"text-right",children:"Reason"}),e.jsx(Se,{id:"reason",className:"col-span-3",value:fe,onChange:s=>Ue(s.target.value),placeholder:"Enter rejection reason..."})]})}),e.jsxs(G,{children:[e.jsx(n,{variant:"outline",onClick:()=>re(!1),disabled:je,children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:Os,disabled:je,children:je?"Rejecting...":"Reject Project"})]})]})}),e.jsx(T,{open:As,onOpenChange:le,children:e.jsxs(U,{children:[e.jsxs(H,{children:[e.jsx(V,{children:"Initiate Project"}),e.jsx(B,{children:"Please provide a reason for initiating this project."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"initiate-reason",className:"text-right",children:"Reason"}),e.jsx(Se,{id:"initiate-reason",className:"col-span-3",value:be,onChange:s=>Ve(s.target.value),placeholder:"Enter initiation reason..."})]})}),e.jsxs(G,{children:[e.jsx(n,{variant:"outline",onClick:()=>le(!1),disabled:ve,children:"Cancel"}),e.jsx(n,{onClick:Ts,disabled:ve,children:ve?"Initiating...":"Initiate Project"})]})]})}),e.jsx(et,{isOpen:Ns,onClose:()=>he(!1),project:bs,onSuccess:()=>{L()}}),e.jsx(T,{open:ws,onOpenChange:ee,children:e.jsxs(U,{className:"sm:max-w-[450px]",children:[e.jsxs(H,{children:[e.jsx(V,{children:"Upload Project Image"}),e.jsxs(B,{children:["Add a new image for ",e.jsx("strong",{children:l==null?void 0:l.name}),"."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"img_file",className:"text-right",children:"Image"}),e.jsx(Ce,{id:"img_file",type:"file",accept:"image/*",className:"col-span-3",onChange:s=>{s.target.files&&s.target.files[0]&&se({...f,image:s.target.files[0]})}})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"img_desc",className:"text-right",children:"Description"}),e.jsx(Se,{id:"img_desc",placeholder:"Describe the image...",className:"col-span-3",value:f.desc,onChange:s=>se({...f,desc:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"img_date",className:"text-right",children:"Date"}),e.jsx(Ce,{id:"img_date",type:"date",className:"col-span-3",value:f.date,onChange:s=>se({...f,date:s.target.value})})]})]}),e.jsxs(G,{children:[e.jsx(n,{variant:"secondary",onClick:()=>ee(!1),children:"Cancel"}),e.jsx(n,{disabled:Le||!f.image,onClick:async()=>{if(!f.image||!l)return;ze(!0);const s=new FormData;s.append("image",f.image),f.desc&&s.append("desc",f.desc),f.date&&s.append("date",f.date);try{await w.post(`/projects/${l.id}/images`,s,{headers:{"Content-Type":"multipart/form-data"}}),x.success("Image uploaded successfully"),ee(!1);const t=await w.get(`/projects/${l.id}/images`);Z(t.data)}catch{x.error("Failed to upload image")}finally{ze(!1)}},children:Le?"Uploading...":"Upload"})]})]})}),e.jsx(st,{isOpen:vs,onClose:()=>ue(!1),project:ys,fundHeads:hs,onSuccess:()=>{L()}}),e.jsx(T,{open:Cs,onOpenChange:te,children:e.jsxs(U,{className:"sm:max-w-[400px]",children:[e.jsxs(H,{children:[e.jsx(V,{children:"Update Completion Percentage"}),e.jsxs(B,{children:["Update the completion percentage for ",e.jsx("strong",{children:O==null?void 0:O.name}),"."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"completion_per",className:"text-right",children:"Percentage"}),e.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[e.jsx(Ce,{id:"completion_per",type:"number",min:"0",max:"100",step:"1",placeholder:"0-100",className:"flex-1",value:R,onChange:s=>$e(s.target.value)}),e.jsx("span",{className:"text-muted-foreground",children:"%"})]})]}),(parseFloat(R)<0||parseFloat(R)>100)&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:"Percentage must be between 0 and 100"})]}),e.jsxs(G,{children:[e.jsx(n,{variant:"secondary",onClick:()=>te(!1),children:"Cancel"}),e.jsx(n,{onClick:$s,disabled:Ee||parseFloat(R)<0||parseFloat(R)>100,children:Ee?"Updating...":"Save"})]})]})}),e.jsx(T,{open:_s,onOpenChange:ae,children:e.jsxs(U,{className:"sm:max-w-[500px]",children:[e.jsxs(H,{children:[e.jsx(V,{children:"Project Description"}),e.jsx(B,{children:D==null?void 0:D.name})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"bg-muted/30 p-4 rounded-lg border text-sm leading-relaxed whitespace-pre-wrap",children:(D==null?void 0:D.description)||"No description available."})}),e.jsx(G,{children:e.jsx(n,{onClick:()=>ae(!1),children:"Close"})})]})}),l&&e.jsxs("div",{className:"w-full lg:w-[350px] xl:w-[400px] border-l bg-background p-3 sm:p-4 md:p-6 shadow-xl overflow-y-auto flex flex-col transition-all duration-300 ease-in-out z-20 fixed lg:static inset-y-0 right-0 h-full lg:h-auto shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold truncate max-w-[200px]",title:l.name,children:l.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[200px]",title:(Ke=l.institute)==null?void 0:Ke.name,children:(Ye=l.institute)==null?void 0:Ye.name})]}),e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>I(null),children:e.jsx(_e,{className:"h-4 w-4"})})]}),e.jsxs(cs,{defaultValue:"approvals",className:"w-full flex-1 flex flex-col",children:[e.jsxs(xs,{className:"grid w-full grid-cols-4 h-8",children:[e.jsx(C,{value:"approvals",className:"text-xs",children:"Approvals"}),e.jsx(C,{value:"milestones",className:"text-xs",children:"Milestones"}),e.jsx(C,{value:"payments",className:"text-xs",children:"Payments"}),e.jsx(C,{value:"images",className:"text-xs flex items-center justify-center",children:e.jsx(as,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-4 px-1",children:[e.jsx(S,{value:"approvals",className:"space-y-3 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground text-xs",children:"Loading history..."}):J.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed text-xs",children:"No approval history found."}):e.jsx("div",{className:"space-y-3",children:J.map(s=>{var t,a;return e.jsxs(b,{className:"overflow-hidden border shadow-sm",children:[e.jsx(F,{className:"p-2 bg-muted/30 pb-1 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold text-xs",children:((t=s.stage)==null?void 0:t.stage_name)||"Stage"}),s.status==="approved"?e.jsxs(N,{variant:"outline",className:"h-4 border-green-500 text-green-600 bg-green-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(ms,{className:"w-2.5 h-2.5"})," Approved"]}):s.status==="rejected"?e.jsxs(N,{variant:"outline",className:"h-4 border-red-500 text-red-600 bg-red-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(ps,{className:"w-2.5 h-2.5"})," Rejected"]}):e.jsxs(N,{variant:"outline",className:"h-4 border-yellow-500 text-yellow-600 bg-yellow-50 gap-1 px-1 py-0 text-[10px]",children:[e.jsx(ie,{className:"w-2.5 h-2.5"})," Pending"]})]})}),e.jsxs(v,{className:"p-2 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1 mb-1",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground flex items-center",children:[e.jsx(ie,{className:"w-2.5 h-2.5 mr-1"}),s.action_date?new Date(s.action_date).toLocaleString():""]}),e.jsxs("div",{className:"text-[10px]",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Appr: "}),(a=s.approver)==null?void 0:a.name]})]}),s.comments&&e.jsxs("div",{className:"bg-muted/50 px-2 py-1 rounded text-[10px] italic border mt-1 line-clamp-2",children:['"',s.comments,'"']}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.pdf&&e.jsxs("a",{href:`/${s.pdf}`,target:"_blank",className:"text-blue-600 hover:underline text-[10px] flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"})," PDF"]}),s.img&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{dataImg:s.img,size:"h-4 w-4",className:"rounded border object-cover"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Image"})]})]})]})]},s.id)})})}),e.jsx(S,{value:"milestones",className:"space-y-3 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground text-xs",children:"Loading milestones..."}):K.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed text-xs",children:"No milestones found."}):e.jsx("div",{className:"space-y-3",children:K.map(s=>e.jsx(b,{className:"border shadow-sm overflow-hidden",children:e.jsxs("div",{className:"flex items-start",children:[s.img&&e.jsx("div",{className:"w-16 h-full shrink-0",children:e.jsx(z,{dataImg:s.img,size:"h-full w-full",className:"h-full w-full object-cover rounded-none"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(F,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsx("div",{className:"font-semibold text-xs truncate pr-2",children:s.name}),e.jsx(N,{variant:s.status==="completed"?"default":s.status==="inprogress"?"secondary":"outline",className:"capitalize text-[10px] px-1 py-0 h-4 shrink-0",children:s.status})]}),e.jsxs(v,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Due: ",s.days," days"]}),s.completed_date&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Done: ",new Date(s.completed_date).toLocaleDateString()]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-[10px] line-clamp-1",children:s.description})]})]})]})},s.id))})}),e.jsx(S,{value:"payments",className:"space-y-3 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground text-xs",children:"Loading payments..."}):Y.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed text-xs",children:"No payments found."}):e.jsx("div",{className:"space-y-3",children:Y.map(s=>{var t,a;return e.jsxs(b,{className:"border shadow-sm",children:[e.jsxs(F,{className:"p-2 py-1.5 border-b bg-muted/10 flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{className:"font-semibold text-xs",children:["Rs. ",s.amount.toLocaleString()]}),e.jsx(N,{variant:"outline",className:`capitalize text-[10px] px-1 py-0 h-4 ${s.status==="Approved"?"border-green-500 text-green-600 bg-green-50":s.status==="Rejected"?"border-red-500 text-red-600 bg-red-50":"border-yellow-500 text-yellow-600 bg-yellow-50"}`,children:s.status})]}),e.jsxs(v,{className:"p-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[e.jsx("div",{className:"text-muted-foreground font-medium truncate max-w-[150px]",title:((t=s.fund_head)==null?void 0:t.name)||"General Fund",children:((a=s.fund_head)==null?void 0:a.name)||"General Fund"}),e.jsx("div",{className:"text-muted-foreground",children:new Date(s.added_date).toLocaleDateString()})]}),s.description&&e.jsxs("p",{className:"text-muted-foreground text-[10px] italic bg-muted/30 px-1.5 py-0.5 rounded truncate",children:['"',s.description,'"']})]})]},s.id)})})}),e.jsx(S,{value:"images",className:"space-y-3 m-0 h-full",children:y?e.jsx("div",{className:"flex justify-center py-8 text-muted-foreground text-xs",children:"Loading images..."}):Q.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed text-xs",children:"No images found."}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end p-1",children:e.jsxs(n,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 h-7 text-[10px] px-2",onClick:()=>{se({desc:"",date:new Date().toISOString().split("T")[0],image:null}),ee(!0)},children:[e.jsx(Ws,{className:"h-3 w-3 mr-1"})," Upload"]})}),Q.map(s=>e.jsxs(b,{className:"overflow-hidden border shadow-sm",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(z,{dataImg:`assets/${s.image}`,size:"w-full h-32 object-cover"}),e.jsx("button",{className:"absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white rounded-full h-6 w-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete image",onClick:async()=>{if(confirm("Delete this image?"))try{await w.delete(`/project-images/${s.id}`),x.success("Image deleted"),Z(t=>t.filter(a=>a.id!==s.id))}catch{x.error("Failed to delete image")}},children:e.jsx(_e,{className:"h-3.5 w-3.5"})})]}),e.jsxs(v,{className:"p-2 text-xs text-center",children:[s.desc&&e.jsx("p",{className:"line-clamp-2 mb-1",children:s.desc}),s.date&&e.jsx("p",{className:"text-muted-foreground opacity-75",children:new Date(s.date).toLocaleDateString()})]})]},s.id))]})})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/20 lg:hidden z-10",onClick:()=>I(null)})]})})}export{Mt as default};
