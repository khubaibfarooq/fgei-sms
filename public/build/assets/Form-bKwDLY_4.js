import{r as m,j as e,L as R,S as U}from"./app-Ckd00XjB.js";import{A as O,S as G,P as J,T as K,a as Q,d as W}from"./app-layout-Dp-QZCwA.js";import{B as u}from"./button-DN_423EJ.js";import{C as k,a as X,b as Y,c as Z}from"./card-Bfsm_5HH.js";import{I as o}from"./input-DREULnrk.js";import{L as r}from"./label-DEtFFioE.js";import{S as x,a as h,b as j,c as g,d as n}from"./select-BuIdBPU8.js";import{t as v}from"./index-Cr4Z16Jw.js";import{I as ee}from"./image-preview-DUVD-rW0.js";import"./index-C3MGCd83.js";import"./createLucideIcon-CImEr1Cq.js";import"./index-CN9Vo_2d.js";import"./index-BQq7n3OH.js";import"./app-logo-icon-PGaPTxAU.js";import"./folder-root-BQwvl7Sg.js";import"./grip-vertical--mq8m-37.js";import"./index-CdgcWHLa.js";import"./index-DqfOopd4.js";function ye({project:t,projectTypes:D}){var _,I;const p=!!(t!=null&&t.id),[y,M]=m.useState((t==null?void 0:t.name)||""),[f,$]=m.useState(((_=t==null?void 0:t.budget)==null?void 0:_.toString())||""),[N,L]=m.useState(((t==null?void 0:t.project_type_id)||"").toString()),[P,T]=m.useState((t==null?void 0:t.description)||""),[b,E]=m.useState((t==null?void 0:t.priority)||"Medium"),[w,A]=m.useState((t==null?void 0:t.status)||"planned"),[C,S]=m.useState(((I=t==null?void 0:t.milestones)==null?void 0:I.map(s=>({key:Date.now()+s.id,id:s.id,name:s.name,description:s.description||"",due_date:s.due_date,status:s.status,completed_date:s.completed_date||null,img:null,existingImg:s.img||void 0,preview:s.img?`${s.img}`:void 0})))||[]),V=Object.entries(D).map(([s,a])=>({id:parseInt(s),name:a})),B=()=>{S(s=>[...s,{key:Date.now(),name:"",description:"",due_date:"",status:"planned",completed_date:null,img:null}])},F=s=>{S(a=>a.filter(d=>d.key!==s)),v.success("Milestone removed")},c=(s,a,d)=>{S(i=>i.map(l=>l.key===s?{...l,[a]:d}:l))},q=(s,a)=>{if(!a){c(s,"img",null),c(s,"preview",void 0);return}const d=new FileReader;d.onloadend=()=>{c(s,"preview",d.result)},d.readAsDataURL(a),c(s,"img",a)},z=s=>{if(s.preventDefault(),!y.trim()||!f||!N){v.error("Please fill all required project fields");return}const a=new FormData;a.append("name",y),a.append("budget",f),a.append("project_type_id",N),a.append("description",P),a.append("priority",b),a.append("status",w),p&&a.append("_method","PUT"),C.forEach((i,l)=>{i.name.trim()&&i.due_date&&(i.id&&a.append(`milestones[${l}][id]`,i.id.toString()),a.append(`milestones[${l}][name]`,i.name),a.append(`milestones[${l}][description]`,i.description),a.append(`milestones[${l}][due_date]`,i.due_date),a.append(`milestones[${l}][status]`,i.status),i.completed_date&&a.append(`milestones[${l}][completed_date]`,i.completed_date),i.img&&a.append(`milestones[${l}][img]`,i.img))});const d=p?`/projects/${t.id}`:"/projects";U.post(d,a,{forceFormData:!0,onSuccess:()=>{v.success(p?"Project updated!":"Project created!")},onError:i=>{console.error(i),v.error("Please fix the errors")}})},H=[{title:"Projects",href:"/projects"},{title:p?"Edit Project":"Create Project",href:"#"}];return e.jsxs(O,{breadcrumbs:H,children:[e.jsx(R,{title:p?"Edit Project":"Create Project"}),e.jsx("div",{className:"p-4 md:p-6 w-full mx-auto",children:e.jsxs(k,{children:[e.jsx(X,{children:e.jsx(Y,{className:"text-2xl",children:p?"Edit Project":"Create New Project"})}),e.jsx(G,{}),e.jsx(Z,{className:"pt-6",children:e.jsxs("form",{onSubmit:z,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{children:["Project Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{value:y,onChange:s=>M(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{children:["Budget ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{type:"number",value:f,onChange:s=>$(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{children:["Project Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(x,{value:N,onValueChange:L,children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select type"})}),e.jsx(g,{children:V.map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Status"}),e.jsxs(x,{value:w,onValueChange:s=>A(s),children:[e.jsx(h,{children:e.jsx(j,{})}),e.jsxs(g,{children:[e.jsx(n,{value:"planned",children:"Planned"}),e.jsx(n,{value:"inprogress",children:"In Progress"}),e.jsx(n,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Priority"}),e.jsxs(x,{value:b,onValueChange:E,children:[e.jsx(h,{children:e.jsx(j,{})}),e.jsxs(g,{children:[e.jsx(n,{value:"Low",children:"Low"}),e.jsx(n,{value:"Medium",children:"Medium"}),e.jsx(n,{value:"High",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(r,{children:"Description"}),e.jsx(o,{value:P,onChange:s=>T(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Milestones"}),e.jsxs(u,{type:"button",onClick:B,size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"})," Add Milestone"]})]}),C.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 border-2 border-dashed rounded-lg",children:'No milestones yet. Click "Add Milestone" to start.'}):e.jsx("div",{className:"space-y-6",children:C.map(s=>e.jsx(k,{className:"p-6 border",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{children:["Milestone Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{value:s.name,onChange:a=>c(s.key,"name",a.target.value),placeholder:"e.g. Site Survey"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Description"}),e.jsx(o,{value:s.description,onChange:a=>c(s.key,"description",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{type:"date",value:s.due_date,onChange:a=>c(s.key,"due_date",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Status"}),e.jsxs(x,{value:s.status,onValueChange:a=>c(s.key,"status",a),children:[e.jsx(h,{children:e.jsx(j,{})}),e.jsxs(g,{children:[e.jsx(n,{value:"planned",children:"Planned"}),e.jsx(n,{value:"inprogress",children:"In Progress"}),e.jsx(n,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Completed Date"}),e.jsx(o,{type:"date",value:s.completed_date||"",onChange:a=>c(s.key,"completed_date",a.target.value||null),disabled:s.status!=="completed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Proof Image"}),e.jsx(o,{type:"file",accept:"image/*",onChange:a=>{var d;return q(s.key,((d=a.target.files)==null?void 0:d[0])||null)}}),(s.preview||s.existingImg)&&e.jsx(ee,{dataImg:s.preview||`${s.existingImg}`})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(u,{type:"button",variant:"destructive",size:"sm",onClick:()=>F(s.key),children:e.jsx(K,{className:"w-4 h-4"})})})]})},s.key))})]}),e.jsxs("div",{className:"flex justify-between pt-8 border-t",children:[e.jsx(u,{type:"button",variant:"secondary",asChild:!0,children:e.jsxs("a",{href:"/projects",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"})," Back"]})}),e.jsxs(u,{type:"submit",size:"lg",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),p?"Update Project":"Create Project"]})]})]})})]})})]})}export{ye as default};
