var k=Object.defineProperty;var R=(a,r,l)=>r in a?k(a,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[r]=l;var f=(a,r,l)=>R(a,typeof r!="symbol"?r+"":r,l);import{r as n,j as e,L as F,S as A}from"./app-3C7Qt8-p.js";import{t as w,A as B,S as T,B as _}from"./app-layout-CytTxXak.js";import{B as m}from"./button-C9j-7gdS.js";import{C as j,a as b,b as y,c as N}from"./card-D1XjIXNI.js";import{S as q,a as L,b as z,c as D,d as g}from"./select-C2DwXPeg.js";import{l as V,E as M}from"./jspdf.plugin.autotable-ClK-X5kZ.js";import{E as Q,F as H}from"./FileSaver.min-BF03T_of.js";import"./index-CtC3z9lO.js";import"./index-DPHHZ2JF.js";import"./createLucideIcon-BrAatXE1.js";import"./index-1_-krIUb.js";import"./app-logo-icon-CXgC8SwZ.js";import"./index-Bn8NVYdZ.js";import"./index-BxFvnJ5H.js";const W=[{title:"Reports",href:"/reports"},{title:"Plants",href:"/reports/Plants"}];class $ extends n.Component{constructor(){super(...arguments);f(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(l){return{hasError:!0,error:l.message}}componentDidCatch(l,x){console.error("ErrorBoundary caught:",l,x),w.error("An error occurred while rendering the component. Please try again or contact support.")}render(){return this.state.hasError?e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",this.state.error]}),e.jsx(m,{onClick:()=>window.location.reload(),className:"mt-2",children:"Retry"})]}):this.props.children}}const v=a=>{const r=a!=null&&typeof a.id=="number"&&a.id>0&&typeof a.name=="string"&&a.name.trim()!=="";return r||console.warn("Invalid item detected:",a),r};function ie({plants:a,institutes:r,filters:l}){const[x,J]=n.useState(l.search||""),[u,S]=n.useState(l.institute_id||""),[o,E]=n.useState(a||[]);n.useEffect(()=>{const t={institutes:r.filter(s=>!v(s))};Object.entries(t).forEach(([s,i])=>{i.length>0&&console.warn(`Invalid ${s}:`,i)})},[r]);const C=async()=>{const t=new Q.Workbook,s=t.addWorksheet("Plants");s.columns=[{header:"Name",key:"name",width:30},{header:"Quantity",key:"qty",width:30},{header:"Institute",key:"institute",width:20}],o.data.forEach(c=>{var p;s.addRow({name:c.name,qty:c.qty,institute:((p=c.institute)==null?void 0:p.name)||"N/A"})});const i=await t.xlsx.writeBuffer(),d=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});H.saveAs(d,"Plants_Report.xlsx")},P=()=>{const t=new M;t.setFontSize(16),t.text("Plants Report",14,15);const s=["Name","Quantity","Institute"],i=o.data.map(d=>{var c;return[d.name,d.qty,((c=d.institute)==null?void 0:c.name)||"N/A"]});t.autoTable({head:[s],body:i,startY:25,styles:{fontSize:10}}),t.save("plant_Report.pdf")},I=n.useMemo(()=>V.debounce(()=>{const t=new URLSearchParams({search:x||"",institute_id:u||""});fetch(`/reports/plants/getPlants?${t.toString()}`).then(s=>s.json()).then(s=>{console.log("Fetched filtered Plants:",s),E(s)}).catch(s=>{console.error("Error fetching filtered Plants:",s),w.error("Failed to fetch filtered Plants")})},300),[x,u]),h=n.useMemo(()=>r.filter(v),[r]);return e.jsx($,{children:e.jsxs(B,{breadcrumbs:W,children:[e.jsx(F,{title:"Plants Report"}),e.jsx("div",{className:"flex-1 p-2 md:p-2",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs(j,{children:[e.jsxs(b,{children:[e.jsx(y,{className:"text-xl font-bold",children:"Filters"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Refine your plant search"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs(q,{value:u,onValueChange:t=>{S(t)},children:[e.jsx(L,{children:e.jsx(z,{placeholder:"Select Institute"})}),e.jsxs(D,{children:[e.jsx(g,{value:"0",children:"All Institutes"}),h.length>0?h.map(t=>e.jsx(g,{value:t.id.toString(),children:t.name},t.id)):e.jsx("div",{className:"text-muted-foreground text-sm p-2",children:"No institutes available"})]})]}),e.jsx(m,{onClick:I,className:"w-full",children:"Apply Filters"})]})]})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsxs(j,{children:[e.jsxs(b,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{children:e.jsx(y,{className:"text-2xl font-bold",children:"plant Report"})}),e.jsx(m,{onClick:P,className:"w-full",children:"Export PDF"}),e.jsx(m,{onClick:C,className:"w-full",children:"Export Excel"})]}),e.jsx(T,{}),e.jsxs(N,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"space-y-3",children:o.data.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"No Plants found."}):o.data.map(t=>{var s;return e.jsx("div",{className:"flex items-center justify-between border px-4 py-3 rounded-md bg-muted/50 hover:bg-muted/70 transition shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-sm text-foreground",children:t.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Qty: ",t.qty,"   Institute: ",((s=t.institute)==null?void 0:s.name)||"N/A"]})]})]})},t.id)})}),o.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:o.links.map((t,s)=>e.jsx(m,{disabled:!t.url,variant:t.active?"default":"outline",size:"sm",onClick:()=>A.visit(t.url||"",{preserveScroll:!0}),className:t.active?"bg-blue-600 hover:bg-blue-700":"",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})},s))})]})]})})]})})]})})}export{ie as default};
