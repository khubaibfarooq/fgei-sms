import{r as d,j as e,L as ve,S as k,a as p}from"./app-D4o7eROr.js";import{A as be,F as T,S as F,cx as ye,C as X,U as J,E as we,hc as Se,B as Ce,b as Q,c as ke}from"./app-layout-DRtG-ld1.js";import{B as c}from"./button-D9tlOds1.js";import{C as h,a as Te,b as Fe,c as b}from"./card-CjF9dYHh.js";import{I as _}from"./input-BzfJ6MBH.js";import{B as x}from"./badge-CTGqqZKv.js";import{D as A,a as D,b as I,c as P,d as L,X as _e,e as M,t as W}from"./index-Y5wvXE6M.js";import{S as Ae,a as De,b as Ie,c as Pe,d as Y}from"./select-Db6fLHzD.js";import{T as Le,a as Me,b as O,c as B}from"./tabs-zp7JYeoP.js";import{I as Oe}from"./image-preview-C3Sh4Z9y.js";import{C as Z}from"./index-CRc6VPtR.js";import{a as Be}from"./circle-x-VGXzQpcn.js";import{f as He}from"./format-CAPgRCzf.js";import"./index-a-jNbs9e.js";import"./index-CHZK6BuV.js";import"./index-CAaDZYh5.js";import"./index-BEwQ2GMD.js";import"./createLucideIcon-BRFlh17y.js";import"./app-logo-icon-DGfZ8sC5.js";import"./folder-root-Dt4cfWMt.js";import"./grip-vertical-BAn3kiHD.js";import"./index-DoW7FhHn.js";import"./index-BMr_0gtK.js";const Re=[{title:"Funds",href:"/funds"},{title:"Pending Transactions",href:"#"}];function cs({transactions:o,summary:y,fundHeads:ee,filters:u}){const[H,se]=d.useState(u.search||""),[R,ae]=d.useState(u.from||""),[z,te]=d.useState(u.to||""),[U,le]=d.useState(u.fund_head_id||""),[re,w]=d.useState(!1),[m,E]=d.useState(null),[i,de]=d.useState(null),[ne,S]=d.useState(!1),[a,ie]=d.useState(null),[$,j]=d.useState(!1),[ce,g]=d.useState(!1),[r,oe]=d.useState(null),[C,G]=d.useState(null),me=async s=>{var t;if(s.tid){E(s),w(!0),j(!0);try{const{data:l}=await p.get(`/transactions/getbytid?tid=${s.tid}`);de(((t=l.transdetails)==null?void 0:t[0])||null)}catch(l){console.error("Failed to load transaction details:",l),W.error("Failed to load transaction details")}finally{j(!1)}}},xe=async s=>{const t=s.tid;if(t){E(s),S(!0),j(!0);try{const[l,n,Ne]=await Promise.all([p.get(`/projects/${t}/history`),p.get(`/projects/${t}/milestones`),p.get(`/projects/${t}/payments`)]);ie({project:{id:t,name:s.description,estimated_cost:s.amount,actual_cost:null,status:s.status,overall_status:s.status,priority:"",institute:s.institute},history:l.data,milestones:n.data,payments:Ne.data.payments})}catch(l){console.error("Failed to load project details:",l),W.error("Failed to load project details")}finally{j(!1)}}},he=s=>{s.trans_type==="project"?xe(s):me(s)},[f,N]=d.useState(null),[V,v]=d.useState(null),q=()=>{k.get(window.location.pathname,{search:H,from:R||void 0,to:z||void 0,fund_head_id:U||void 0},{preserveState:!0,preserveScroll:!0})},pe=s=>{s.key==="Enter"&&q()},ue=s=>{oe(s),N(null),v(null),g(!0)},je=s=>{var l;const t=(l=s.target.files)==null?void 0:l[0];if(t){N(t);const n=new FileReader;n.onloadend=()=>{v(n.result)},n.readAsDataURL(t)}},ge=()=>{N(null),v(null)},fe=async()=>{var s,t;if(r){G(r.id);try{const l=new FormData;f?(console.log("Appending image to FormData:",f.name,f.size),l.append("img",f)):console.log("No image selected"),console.log("Sending approval request for transaction:",r.id);const{data:n}=await p.post(`/funds/${r.id}/approve`,l);n.success?(g(!1),N(null),v(null),k.reload()):alert(n.message||"Failed to approve transaction")}catch(l){console.error("Failed to approve transaction:",l);const n=((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"An error occurred while approving the transaction";alert(n)}finally{G(null)}}},K=s=>s==="in"?e.jsx(x,{variant:"default",className:"bg-green-100 text-green-800 hover:bg-green-200",children:"IN"}):e.jsx(x,{variant:"destructive",className:"bg-red-100 text-red-800 hover:bg-red-200",children:"OUT"});return e.jsxs(be,{breadcrumbs:Re,children:[e.jsx(ve,{title:"Pending Fund Transactions"}),e.jsx("div",{className:"flex-1 p-2 md:p-3",children:e.jsxs(h,{children:[e.jsx(Te,{className:"pb-3",children:e.jsxs(Fe,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(T,{className:"h-6 w-6"}),"Pending Fund Transactions"]})}),e.jsx(F,{}),e.jsxs(b,{className:"pt-3 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Pending"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:y.total_count})]}),e.jsx(T,{className:"h-5 w-5 text-blue-600"})]})})}),e.jsx(h,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending IN"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:y.total_in.toLocaleString()})]}),e.jsx(x,{variant:"default",className:"bg-green-100 text-green-800",children:"IN"})]})})}),e.jsx(h,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending OUT"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:y.total_out.toLocaleString()})]}),e.jsx(x,{variant:"destructive",className:"bg-red-100 text-red-800",children:"OUT"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search"}),e.jsx(_,{placeholder:"Search description...",value:H,onChange:s=>se(s.target.value),onKeyDown:pe})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fund Head"}),e.jsxs(Ae,{value:U,onValueChange:le,children:[e.jsx(De,{children:e.jsx(Ie,{placeholder:"All Fund Heads"})}),e.jsxs(Pe,{children:[e.jsx(Y,{value:"0",children:"All Fund Heads"}),ee.map(s=>e.jsx(Y,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"From"}),e.jsx(_,{type:"date",value:R,onChange:s=>ae(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"To"}),e.jsx(_,{type:"date",value:z,onChange:s=>te(s.target.value)})]})]}),e.jsxs(c,{onClick:q,className:"w-full md:w-auto",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Apply Filters"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o.from," to ",o.to," of ",o.total," pending transactions"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary dark:bg-gray-800",children:[e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Date"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Fund Head"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Institute"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Description"}),e.jsx("th",{className:"border p-3 text-center text-sm font-medium text-white dark:text-gray-200",children:"Type"}),e.jsx("th",{className:"border p-3 text-right text-sm font-medium text-white dark:text-gray-200",children:"Amount"}),e.jsx("th",{className:"border p-3 text-left text-sm font-medium text-white dark:text-gray-200",children:"Added By"}),e.jsx("th",{className:"border p-3 text-center text-sm font-medium text-white dark:text-gray-200",children:"Actions"})]})}),e.jsx("tbody",{children:o.data.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"border p-8 text-center",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending transactions found."})]})}):o.data.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"border p-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),new Date(s.added_date).toLocaleDateString()]})}),e.jsx("td",{className:"border p-3 text-sm font-medium",children:s.fund_head.name}),e.jsx("td",{className:"border p-3 text-sm",children:s.institute.name}),e.jsx("td",{className:"border p-3 text-sm",children:s.description}),e.jsx("td",{className:"border p-3 text-center",children:K(s.type)}),e.jsx("td",{className:"border p-3 text-right text-sm font-medium",children:e.jsxs("span",{className:s.type==="in"?"text-green-600":"text-red-600",children:[s.type==="in"?"+":"-",s.amount.toLocaleString()]})}),e.jsx("td",{className:"border p-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),s.user.name]})}),e.jsx("td",{className:"border p-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>he(s),className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(c,{size:"sm",variant:"default",onClick:()=>ue(s),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Approve"]})]})})]},s.id))})]})}),o.links.length>1&&e.jsx("div",{className:"flex justify-center pt-6 flex-wrap gap-2",children:o.links.map((s,t)=>e.jsx(c,{disabled:!s.url,variant:s.active?"default":"outline",size:"sm",onClick:()=>k.visit(s.url||"",{preserveScroll:!0}),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t))})]})]})}),e.jsx(A,{open:ce,onOpenChange:g,children:e.jsxs(D,{className:"max-w-2xl",children:[e.jsxs(I,{children:[e.jsx(P,{children:"Approve Transaction"}),e.jsx(L,{children:"Review the transaction details before approving"})]}),r&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fund Head:"})," ",r.fund_head.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Institute:"})," ",r.institute.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",K(r.type)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Amount:"})," ",e.jsxs("span",{className:r.type==="in"?"text-green-600 font-semibold":"text-red-600 font-semibold",children:[r.type==="in"?"+":"-",r.amount.toLocaleString()]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("strong",{children:"Description:"})," ",r.description]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",He(new Date(r.added_date),"dd MMM yyyy")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Added By:"})," ",r.user.name]})]}),e.jsx(F,{}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Note:"})," Approving this transaction will update the fund balance.",r.type==="in"?" The balance will be increased by the transaction amount.":" The balance will be decreased by the transaction amount."]})}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Attach Image (Optional)"}),V?e.jsxs("div",{className:"relative border rounded-lg p-2",children:[e.jsx("img",{src:V,alt:"Preview",className:"max-h-48 mx-auto rounded"}),e.jsx(c,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:ge,children:e.jsx(_e,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center hover:border-gray-400 dark:hover:border-gray-500 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:je,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(Se,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Click to upload an image"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"PNG, JPG, GIF up to 5MB"})]})]})]})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>g(!1),disabled:C!==null,children:"Cancel"}),e.jsx(c,{onClick:fe,disabled:C!==null,className:"bg-green-600 hover:bg-green-700",children:C!==null?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Approve Transaction"]})})]})]})}),e.jsx(A,{open:re,onOpenChange:w,children:e.jsxs(D,{className:"max-w-md h-[90vh]  overflow-y-auto",children:[e.jsxs(I,{children:[e.jsx(P,{children:"Transaction Details"}),e.jsx(L,{children:"Detailed breakdown of the selected transaction"})]}),$?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Fund Head"}),e.jsx("p",{className:"font-medium",children:i.fund_head_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-medium text-lg",children:Number(i.amount).toLocaleString()})]}),i.asset_name&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Asset"}),e.jsx("p",{className:"font-medium",children:i.asset_name})]}),i.qty>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:i.qty})]}),i.room_name&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Room"}),e.jsx("p",{className:"font-medium",children:i.room_name})]})]}),(m==null?void 0:m.img)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction Evidence"}),e.jsx(Oe,{dataImg:m.img,size:"h-64 w-full"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Description"}),e.jsx("p",{className:"text-sm p-3 bg-muted rounded-md border",children:(m==null?void 0:m.description)||"No description provided"})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No additional details found for this transaction."}),e.jsx(M,{children:e.jsx(c,{variant:"outline",onClick:()=>w(!1),children:"Close"})})]})}),e.jsx(A,{open:ne,onOpenChange:S,children:e.jsxs(D,{className:"max-w-3xl h-[90vh] flex flex-col p-0",children:[e.jsxs(I,{className:"p-6 pb-0",children:[e.jsxs(P,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-primary"}),a==null?void 0:a.project.name]}),e.jsx(L,{children:a==null?void 0:a.project.institute.name})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 h-full min-h-0",children:e.jsxs(Le,{defaultValue:"approvals",className:"w-full h-full flex flex-col",children:[e.jsxs(Me,{className:"grid w-full grid-cols-3 shrink-0",children:[e.jsx(O,{value:"approvals",children:"Approvals"}),e.jsx(O,{value:"milestones",children:"Milestones"}),e.jsx(O,{value:"payments",children:"Payments"})]}),e.jsxs("div",{className:"flex-1 mt-4 pb-6 h-full min-h-0",children:[e.jsx(B,{value:"approvals",className:"m-0 space-y-4",children:$?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(a==null?void 0:a.history.length)===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground border-2 border-dashed rounded-lg",children:"No approval history."}):e.jsx("div",{className:"space-y-4",children:a==null?void 0:a.history.map(s=>{var t,l;return e.jsx(h,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-4 flex gap-4",children:[e.jsx("div",{className:"mt-1",children:s.status==="approved"?e.jsx(Q,{className:"h-5 w-5 text-green-500"}):e.jsx(Be,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold",children:((t=s.stage)==null?void 0:t.stage_name)||"Stage"}),e.jsx(x,{variant:s.status==="approved"?"default":"destructive",className:"capitalize",children:s.status})]}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"})," ",(l=s.approver)==null?void 0:l.name," • ",e.jsx(ke,{className:"h-3 w-3 ml-1"})," ",new Date(s.action_date).toLocaleString()]}),s.comments&&e.jsxs("p",{className:"text-sm bg-muted/50 p-2 rounded mt-2 border italic",children:['"',s.comments,'"']})]})]})},s.id)})})}),e.jsx(B,{value:"milestones",className:"m-0 space-y-4",children:(a==null?void 0:a.milestones.length)===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground border-2 border-dashed rounded-lg",children:"No milestones found."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a==null?void 0:a.milestones.map(s=>e.jsxs(h,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("p",{className:"font-semibold text-sm",children:s.name}),e.jsx(x,{variant:s.status==="completed"?"default":"outline",className:"text-[10px]",children:s.status})]}),e.jsxs("div",{className:"text-[10px] text-muted-foreground space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"})," Due in: ",s.days," days"]}),s.completed_date&&e.jsxs("p",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Q,{className:"h-3 w-3"})," Done: ",new Date(s.completed_date).toLocaleDateString()]})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.description})]},s.id))})}),e.jsx(B,{value:"payments",className:"m-0 space-y-4",children:(a==null?void 0:a.payments.length)===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground border-2 border-dashed rounded-lg",children:"No payments recorded."}):e.jsx("div",{className:"space-y-3",children:a==null?void 0:a.payments.map(s=>{var t;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-bold",children:s.amount.toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((t=s.fund_head)==null?void 0:t.name)||"General Fund"," • ",new Date(s.added_date).toLocaleDateString()]})]}),e.jsx(x,{variant:s.status==="Approved"?"default":"outline",children:s.status})]},s.id)})})})]})]})}),e.jsx(M,{className:"p-6 border-t shrink-0",children:e.jsx(c,{variant:"outline",onClick:()=>S(!1),children:"Close"})})]})})]})}export{cs as default};
